{"ast":null,"code":"import { isNullOrUndefined, remove, extend } from '@syncfusion/ej2-base';\nimport { RowModelGenerator } from '../services/row-model-generator';\nimport { FreezeRowModelGenerator } from '../services/freeze-row-model-generator';\nimport { RowRenderer } from '../renderer/row-renderer';\nimport * as events from '../base/constant';\nimport { getScrollBarWidth, getEditedDataIndex, resetRowIndex, setRowElements, getRowIndexFromElement, getGroupKeysAndFields, getPredicates, generateExpandPredicates } from '../base/util';\nimport * as literals from '../base/string-literals';\n/**\n * Infinite Scrolling class\n *\n * @hidden\n */\n\nvar InfiniteScroll =\n/** @class */\nfunction () {\n  /**\n   * Constructor for the Grid infinite scrolling.\n   *\n   * @param {IGrid} parent - specifies the IGrid\n   * @param {ServiceLocator} serviceLocator - specifies the ServiceLocator\n   * @hidden\n   */\n  function InfiniteScroll(parent, serviceLocator) {\n    this.infiniteCache = {};\n    this.infiniteCurrentViewData = {};\n    this.infiniteFrozenCache = {};\n    this.isDownScroll = false;\n    this.isUpScroll = false;\n    this.isScroll = true;\n    this.enableContinuousScroll = false;\n    this.initialRender = true;\n    this.isRemove = false;\n    this.isInitialCollapse = false;\n    this.prevScrollTop = 0;\n    this.actions = ['filtering', 'searching', 'grouping', 'ungrouping', 'reorder', 'sorting', 'refresh'];\n    this.keys = [literals.downArrow, literals.upArrow, literals.enter, literals.shiftEnter];\n    this.rowTop = 0;\n    this.isInitialMovableRender = true;\n    this.virtualInfiniteData = {};\n    this.isCancel = false;\n    this.emptyRowData = {};\n    this.isNormaledit = false;\n    this.isInfiniteScroll = false;\n    this.isLastPage = false;\n    this.isInitialRender = true;\n    this.isFocusScroll = false;\n    this.isGroupCollapse = false;\n    this.parent = parent;\n    this.serviceLocator = serviceLocator;\n    this.isNormaledit = this.parent.editSettings.mode === 'Normal';\n    this.addEventListener();\n    this.widthService = serviceLocator.getService('widthService');\n    this.rowModelGenerator = this.parent.isFrozenGrid() ? new FreezeRowModelGenerator(this.parent) : new RowModelGenerator(this.parent);\n  }\n\n  InfiniteScroll.prototype.getModuleName = function () {\n    return 'infiniteScroll';\n  };\n  /**\n   * @returns {void}\n   * @hidden\n   */\n\n\n  InfiniteScroll.prototype.addEventListener = function () {\n    this.parent.on(events.dataReady, this.onDataReady, this);\n    this.parent.on(events.dataSourceModified, this.dataSourceModified, this);\n    this.parent.on(events.infinitePageQuery, this.infinitePageQuery, this);\n    this.parent.on(events.infiniteScrollHandler, this.infiniteScrollHandler, this);\n    this.parent.on(events.beforeCellFocused, this.infiniteCellFocus, this);\n    this.parent.on(events.appendInfiniteContent, this.appendInfiniteRows, this);\n    this.parent.on(events.removeInfiniteRows, this.removeInfiniteCacheRows, this);\n    this.parent.on(events.resetInfiniteBlocks, this.resetInfiniteBlocks, this);\n    this.parent.on(events.setInfiniteCache, this.setCache, this);\n    this.parent.on(events.initialCollapse, this.ensureIntialCollapse, this);\n    this.parent.on(events.keyPressed, this.infiniteCellFocus, this);\n    this.parent.on(events.infiniteShowHide, this.setDisplayNone, this);\n    this.parent.on(events.virtualScrollEditActionBegin, this.editActionBegin, this);\n    this.parent.on(events.getVirtualData, this.getVirtualInfiniteData, this);\n    this.parent.on(events.editReset, this.resetInfiniteEdit, this);\n    this.parent.on(events.virtualScrollEditSuccess, this.infiniteEditSuccess, this);\n    this.parent.on(events.refreshVirtualCache, this.refreshInfiniteCache, this);\n    this.parent.on(events.refreshInfiniteEditrowindex, this.refreshInfiniteEditrowindex, this);\n    this.parent.on(events.infiniteEditHandler, this.infiniteEditHandler, this);\n    this.parent.on(events.virtualScrollAddActionBegin, this.infiniteAddActionBegin, this);\n    this.parent.on(events.modelChanged, this.modelChanged, this);\n    this.parent.on(events.refreshInfiniteCurrentViewData, this.refreshInfiniteCurrentViewData, this);\n    this.parent.on(events.destroy, this.destroy, this);\n    this.parent.on(events.contentReady, this.selectNewRow, this);\n    this.parent.on(events.captionActionComplete, this.captionActionComplete, this);\n    this.parent.on(events.setVirtualPageQuery, this.setGroupCollapsePageQuery, this);\n    this.actionBeginFunction = this.actionBegin.bind(this);\n    this.actionCompleteFunction = this.actionComplete.bind(this);\n    this.dataBoundFunction = this.dataBound.bind(this);\n    this.parent.on(events.deleteComplete, this.deleteComplate, this);\n    this.parent.addEventListener(events.actionBegin, this.actionBeginFunction);\n    this.parent.addEventListener(events.actionComplete, this.actionCompleteFunction);\n    this.parent.addEventListener(events.dataBound, this.dataBoundFunction);\n  };\n  /**\n   * @returns {void}\n   * @hidden\n   */\n\n\n  InfiniteScroll.prototype.removeEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.off(events.dataReady, this.onDataReady);\n    this.parent.off(events.dataSourceModified, this.dataSourceModified);\n    this.parent.off(events.infinitePageQuery, this.infinitePageQuery);\n    this.parent.off(events.infiniteScrollHandler, this.infiniteScrollHandler);\n    this.parent.off(events.beforeCellFocused, this.infiniteCellFocus);\n    this.parent.off(events.appendInfiniteContent, this.appendInfiniteRows);\n    this.parent.off(events.removeInfiniteRows, this.removeInfiniteCacheRows);\n    this.parent.off(events.resetInfiniteBlocks, this.resetInfiniteBlocks);\n    this.parent.off(events.setInfiniteCache, this.setCache);\n    this.parent.off(events.initialCollapse, this.ensureIntialCollapse);\n    this.parent.off(events.keyPressed, this.infiniteCellFocus);\n    this.parent.off(events.infiniteShowHide, this.setDisplayNone);\n    this.parent.off(events.virtualScrollEditActionBegin, this.editActionBegin);\n    this.parent.off(events.getVirtualData, this.getVirtualInfiniteData);\n    this.parent.off(events.editReset, this.resetInfiniteEdit);\n    this.parent.off(events.virtualScrollEditSuccess, this.infiniteEditSuccess);\n    this.parent.off(events.refreshVirtualCache, this.refreshInfiniteCache);\n    this.parent.on(events.refreshInfiniteEditrowindex, this.refreshInfiniteEditrowindex);\n    this.parent.off(events.infiniteEditHandler, this.infiniteEditHandler);\n    this.parent.off(events.virtualScrollAddActionBegin, this.infiniteAddActionBegin);\n    this.parent.off(events.modelChanged, this.modelChanged);\n    this.parent.off(events.refreshInfiniteCurrentViewData, this.refreshInfiniteCurrentViewData);\n    this.parent.off(events.destroy, this.destroy);\n    this.parent.off(events.contentReady, this.selectNewRow);\n    this.parent.off(events.captionActionComplete, this.captionActionComplete);\n    this.parent.off(events.setVirtualPageQuery, this.setGroupCollapsePageQuery);\n    this.parent.removeEventListener(events.actionBegin, this.actionBeginFunction);\n    this.parent.removeEventListener(events.actionComplete, this.actionCompleteFunction);\n    this.parent.removeEventListener(events.dataBound, this.dataBoundFunction);\n  };\n\n  InfiniteScroll.prototype.dataBound = function () {\n    if (this.groupCaptionAction === 'collapse') {\n      this.groupCaptionAction = 'refresh';\n      this.makeGroupCollapseRequest();\n    } else if (this.groupCaptionAction === 'refresh') {\n      this.parent.hideSpinner();\n      this.groupCaptionAction = this.empty;\n    }\n  };\n\n  InfiniteScroll.prototype.setGroupCollapsePageQuery = function (args) {\n    var gObj = this.parent;\n\n    if (!gObj.infiniteScrollSettings.enableCache && this.isGroupCollapse) {\n      args.skipPage = true;\n      this.isGroupCollapse = false;\n\n      if (this.groupCaptionAction === 'collapse') {\n        var captionRow = gObj.getRowObjectFromUID(this.parentCapUid);\n        var rowObjs = gObj.getRowsObject();\n        var childCount = 0;\n\n        for (var i = rowObjs.length - 1; i >= 0; i--) {\n          if (rowObjs[i].indent === captionRow.indent) {\n            break;\n          }\n\n          if (rowObjs[i].isDataRow) {\n            childCount++;\n          }\n        }\n\n        var key = getGroupKeysAndFields(rowObjs.indexOf(captionRow), rowObjs);\n        var pred = generateExpandPredicates(key.fields, key.keys, this);\n        var predicateList = getPredicates(pred);\n        pred = predicateList[predicateList.length - 1];\n\n        for (var i = predicateList.length - 2; i >= 0; i--) {\n          pred = pred.and(predicateList[i]);\n        }\n\n        args.query.where(pred);\n        args.query.skip(childCount);\n        this.parentCapUid = this.empty;\n      } else {\n        var rows = gObj.getRows();\n        var size = gObj.pageSettings.pageSize;\n        var skip = getRowIndexFromElement(rows[rows.length - 1]) + 1;\n        var additionalCnt = skip - skip % size + size - skip;\n\n        if (skip % size === 0) {\n          additionalCnt = 0;\n        }\n\n        args.query.skip(skip);\n        args.query.take(gObj.infiniteScrollSettings.initialBlocks * gObj.pageSettings.pageSize + additionalCnt);\n      }\n    }\n  };\n\n  InfiniteScroll.prototype.captionActionComplete = function (args) {\n    var gObj = this.parent;\n\n    if (!gObj.infiniteScrollSettings.enableCache && args.isCollapse) {\n      var contetRect = gObj.getContent().firstElementChild.getBoundingClientRect();\n      var tableReact = gObj.contentModule.getTable().getBoundingClientRect();\n\n      if (Math.round(tableReact.bottom - gObj.getRowHeight()) <= Math.round(contetRect.bottom)) {\n        this.parentCapUid = args.parentUid;\n        this.groupCaptionAction = 'collapse';\n        gObj.showSpinner();\n        var caption = gObj.getRowObjectFromUID(args.parentUid);\n        var childCount = this.getCaptionChildCount(caption);\n\n        if (!childCount) {\n          this.groupCaptionAction = 'refresh';\n          this.makeGroupCollapseRequest();\n        } else {\n          this.makeGroupCollapseRequest(args.parentUid);\n        }\n      }\n    }\n  };\n\n  InfiniteScroll.prototype.makeGroupCollapseRequest = function (parentUid) {\n    var gObj = this.parent;\n    var rows = gObj.getRows();\n    var index = getRowIndexFromElement(rows[rows.length - 1]);\n    var prevPage = this.parent.pageSettings.currentPage;\n    this.parent.pageSettings.currentPage = Math.ceil(index / this.parent.pageSettings.pageSize) + 1;\n\n    if (this.parent.pageSettings.currentPage > this.maxPage) {\n      gObj.hideSpinner();\n      return;\n    }\n\n    var scrollArg = {\n      requestType: 'infiniteScroll',\n      currentPage: this.parent.pageSettings.currentPage,\n      prevPage: prevPage,\n      startIndex: index + 1,\n      direction: 'down',\n      isCaptionCollapse: true,\n      parentUid: parentUid\n    };\n    this.isGroupCollapse = true;\n    this.parent.notify('model-changed', scrollArg);\n  };\n\n  InfiniteScroll.prototype.getCaptionChildCount = function (caption) {\n    var rowObj = this.parent.getRowsObject();\n    var index = rowObj.indexOf(caption);\n    var make = false;\n\n    for (var i = index; i < rowObj.length; i++) {\n      if ((rowObj[i].indent === caption.indent || rowObj[i].indent < caption.indent) && rowObj[i].data.key !== caption.data.key) {\n        break;\n      }\n\n      if (rowObj[i].isCaptionRow && !this.childCheck(rowObj, rowObj[i], i)) {\n        make = true;\n        break;\n      }\n    }\n\n    return make;\n  };\n\n  InfiniteScroll.prototype.childCheck = function (rowObj, row, index) {\n    var childCount = 0;\n\n    for (var i = index + 1; i < rowObj.length; i++) {\n      if (rowObj[i].indent === row.indent) {\n        break;\n      }\n\n      if (rowObj[i].indent === row.indent + 1 && rowObj[i].parentUid === row.uid) {\n        childCount++;\n      }\n    }\n\n    return row.data.count === childCount;\n  };\n\n  InfiniteScroll.prototype.updateCurrentViewData = function () {\n    var gObj = this.parent;\n\n    if (gObj.groupSettings.columns.length) {\n      return;\n    }\n\n    var keys = Object.keys(this.infiniteCurrentViewData);\n    gObj.currentViewData = [];\n    var page = gObj.pageSettings.currentPage;\n    var isCache = gObj.infiniteScrollSettings.enableCache;\n    var blocks = gObj.infiniteScrollSettings.maxBlocks;\n    var isMiddlePage = isCache && (page > blocks || this.isUpScroll && page > 1);\n    var start = isMiddlePage ? this.isUpScroll ? page : page - blocks + 1 : 1;\n    var end = isMiddlePage ? start + blocks - 1 : isCache ? blocks : keys.length;\n\n    for (var i = start; i <= end; i++) {\n      if (this.infiniteCurrentViewData[i]) {\n        gObj.currentViewData = gObj.currentViewData.concat(this.infiniteCurrentViewData[i]);\n      }\n    }\n  };\n\n  InfiniteScroll.prototype.refreshInfiniteCurrentViewData = function (e) {\n    var page = this.parent.pageSettings.currentPage;\n    var size = this.parent.pageSettings.pageSize;\n    var blocks = this.parent.infiniteScrollSettings.initialBlocks;\n    var keys = Object.keys(this.infiniteCurrentViewData);\n    var cache = this.parent.infiniteScrollSettings.enableCache;\n\n    if (!this.parent.groupSettings.columns.length) {\n      var isAdd = e.args.requestType === 'save' && !(this.parent.sortSettings.columns.length || this.parent.filterSettings.columns.length || this.parent.groupSettings.columns.length || this.parent.searchSettings.key);\n      var isDelete = e.args.requestType === 'delete';\n\n      if (!cache && (isAdd || isDelete)) {\n        if (isAdd) {\n          var indexCount = 0;\n\n          for (var i = 1; i <= keys.length; i++) {\n            indexCount += this.infiniteCurrentViewData[i].length - 1;\n\n            if (e.args.index <= indexCount) {\n              this.resetCurrentViewData(i);\n              this.infiniteCurrentViewData[i].splice(e.args.index, 0, e.args.data);\n              break;\n            }\n          }\n        } else {\n          this.infiniteCurrentViewData[keys[keys.length - 1]].push(e.data[0]);\n        }\n      } else {\n        if (blocks > 1 && e.data.length === blocks * size) {\n          this.setInitialCache(e.data.slice(), {}, cache && e.args.requestType === 'delete', true);\n        } else {\n          this.infiniteCurrentViewData[page] = e.data.slice();\n        }\n      }\n    }\n  };\n\n  InfiniteScroll.prototype.resetCurrentViewData = function (startIndex) {\n    var keys = Object.keys(this.infiniteCurrentViewData);\n\n    for (var i = startIndex; i <= keys.length; i++) {\n      var lastViewData = this.infiniteCurrentViewData[i][this.infiniteCurrentViewData[i].length - 1];\n\n      if (this.infiniteCurrentViewData[i + 1]) {\n        this.infiniteCurrentViewData[i + 1].splice(0, 0, lastViewData);\n      }\n\n      this.infiniteCurrentViewData[i].pop();\n    }\n  };\n\n  InfiniteScroll.prototype.deleteComplate = function () {\n    if (this.parent.isFrozenGrid() && !this.parent.infiniteScrollSettings.enableCache) {\n      this.parent.contentModule.refreshScrollOffset();\n    }\n  };\n\n  InfiniteScroll.prototype.modelChanged = function (args) {\n    var rows = this.parent.getRows();\n\n    if (args.requestType === 'save' && args.index && args.data) {\n      this.addRowIndex = args.index;\n    }\n\n    if (rows && rows.length && args.requestType !== 'infiniteScroll' && (args.requestType === 'delete' || this.requestType === 'add')) {\n      this.firstIndex = getRowIndexFromElement(rows[0]);\n      this.firstBlock = Math.ceil((this.firstIndex + 1) / this.parent.pageSettings.pageSize);\n      this.lastIndex = getRowIndexFromElement(rows[rows.length - 1]);\n\n      if (args.requestType === 'delete') {\n        var rowObj = this.parent.getRowsObject();\n        args.startIndex = this.parent.infiniteScrollSettings.enableCache ? (this.firstBlock - 1) * this.parent.pageSettings.pageSize : rowObj[rowObj.length - 1].index;\n      } else {\n        args.startIndex = this.firstIndex;\n      }\n\n      if (!this.parent.infiniteScrollSettings.enableCache && this.parent.pageSettings.currentPage === this.maxPage && args.requestType === 'delete') {\n        this.isLastPage = true;\n        this.lastIndex = this.lastIndex - 1;\n      }\n    }\n  };\n\n  InfiniteScroll.prototype.infiniteAddActionBegin = function (args) {\n    if (this.isNormaledit) {\n      this.isAdd = true;\n\n      if (this.parent.infiniteScrollSettings.enableCache) {\n        if (!Object.keys(this.emptyRowData).length) {\n          this.createEmptyRowdata();\n        }\n\n        if (this.parent.pageSettings.currentPage > 1) {\n          args.startEdit = false;\n          this.resetInfiniteBlocks({}, true);\n          this.makeRequest({\n            currentPage: 1\n          });\n        }\n      }\n    }\n  };\n\n  InfiniteScroll.prototype.infiniteEditHandler = function (args) {\n    if (!this.parent.infiniteScrollSettings.enableCache && (args.e.requestType === 'delete' || args.e.requestType === 'save' && this.requestType === 'add')) {\n      var frozenCols = this.parent.isFrozenGrid();\n      var rowElms = this.parent.getRows();\n      var rows = this.parent.getRowsObject();\n\n      if (this.ensureRowAvailability(rows, args.result[0])) {\n        if (rowElms.length && !(this.addRowIndex && this.addRowIndex >= rowElms.length)) {\n          this.resetRowIndex(rows, args.e, rowElms, this.requestType === 'add', true);\n\n          if (frozenCols) {\n            var rows_1 = this.parent.getMovableRowsObject();\n            this.resetRowIndex(rows_1, args.e, this.parent.getMovableDataRows(), this.requestType === 'add');\n\n            if (this.parent.getFrozenMode() === literals.leftRight) {\n              var frRows = this.parent.getFrozenRightRowsObject();\n              this.resetRowIndex(frRows, args.e, this.parent.getFrozenRightRows(), this.requestType === 'add');\n            }\n          }\n        }\n\n        if (!this.isLastPage) {\n          this.createRow(rows, args);\n        } else {\n          this.isLastPage = false;\n          this.parent.pageSettings.currentPage = this.maxPage;\n\n          if (this.parent.selectionModule.index < this.parent.frozenRows) {\n            remove(rowElms[this.parent.frozenRows - 1]);\n            this.createRow([rows[this.parent.frozenRows - 1]], args, false, true);\n\n            if (frozenCols) {\n              var movableRows = this.parent.getMovableDataRows();\n              remove(movableRows[this.parent.frozenRows]);\n              this.createRow([this.parent.getMovableRowsObject()[this.parent.frozenRows - 1]], args, true, true);\n\n              if (this.parent.getFrozenMode() === literals.leftRight) {\n                var rightRows = this.parent.getFrozenRightDataRows();\n                remove(rightRows[this.parent.frozenRows]);\n                this.createRow([this.parent.getFrozenRightRowsObject()[this.parent.frozenRows - 1]], args, false, true, true);\n              }\n            }\n\n            setRowElements(this.parent);\n          }\n        }\n      }\n\n      this.parent.hideSpinner();\n      this.parent.notify(events.refreshInfinitePersistSelection, {});\n\n      if (this.requestType === 'delete') {\n        this.parent.notify(events.deleteComplete, args.e);\n      } else {\n        this.parent.notify(events.saveComplete, args.e);\n      }\n    }\n\n    this.parent.notify(events.freezeRender, {\n      case: 'refreshHeight'\n    });\n  };\n\n  InfiniteScroll.prototype.createRow = function (rows, args, isMovable, isFrozenRows, isFrozenRight) {\n    var row = !isFrozenRows ? this.generateRows(args.result, args.e) : rows;\n    var rowRenderer = new RowRenderer(this.serviceLocator, null, this.parent);\n\n    if (args.e.requestType === 'save' && args.e.index && args.e.data) {\n      row[0].index = this.addRowIndex;\n      this.addRowIndex = null;\n\n      if (row[0].index >= rows.length) {\n        return;\n      }\n    }\n\n    var tbody;\n\n    if (isFrozenRight) {\n      tbody = this.parent.element.querySelector('.e-frozen-right-content').querySelector(literals.tbody);\n    } else {\n      tbody = !this.parent.isFrozenGrid() ? this.parent.getContent().querySelector(literals.tbody) : isMovable ? this.parent.getMovableVirtualContent().querySelector(literals.tbody) : this.parent.getFrozenVirtualContent().querySelector(literals.tbody);\n    }\n\n    if (this.parent.frozenRows) {\n      tbody = isFrozenRows && this.requestType !== 'add' || !isFrozenRows && this.requestType === 'add' ? !this.parent.isFrozenGrid() ? this.parent.getHeaderContent().querySelector(literals.tbody) : isMovable ? this.parent.getMovableVirtualHeader().querySelector(literals.tbody) : isFrozenRight ? this.parent.element.querySelector('.e-frozen-right-header').querySelector(literals.tbody) : this.parent.getFrozenVirtualHeader().querySelector(literals.tbody) : tbody;\n    }\n\n    var notifyArgs = {\n      rows: rows,\n      cancel: false,\n      args: args,\n      isMovable: isMovable,\n      isFrozenRows: isFrozenRows,\n      isFrozenRight: isFrozenRows,\n      row: row\n    };\n    this.parent.notify(events.infiniteCrudCancel, notifyArgs);\n\n    if (!notifyArgs.cancel) {\n      for (var i = row.length - 1; i >= 0; i--) {\n        if (this.requestType === 'delete') {\n          tbody.appendChild(rowRenderer.render(row[i], this.parent.getColumns()));\n        } else {\n          tbody.insertBefore(rowRenderer.render(row[i], this.parent.getColumns()), tbody.rows[args.e.index]);\n        }\n      }\n    }\n\n    if (!isFrozenRows && this.parent.frozenRows && (this.parent.selectionModule.index < this.parent.frozenRows || this.requestType === 'add')) {\n      var rowElems = isMovable ? this.parent.getMovableDataRows() : isFrozenRight ? this.parent.getFrozenRightDataRows() : this.parent.getRows();\n      var index = (isMovable || isFrozenRight) && this.requestType === 'add' ? this.parent.frozenRows : this.parent.frozenRows - 1;\n      remove(rowElems[index]);\n      this.createRow([rows[this.parent.frozenRows - 1]], args, isMovable, true, isFrozenRight);\n    }\n\n    if (!this.parent.infiniteScrollSettings.enableCache && !isFrozenRows) {\n      if (isFrozenRight) {\n        setRowElements(this.parent);\n        this.parent.contentModule.rightFreezeRows = this.requestType === 'add' ? row.concat(rows) : rows.concat(row);\n      } else if (!this.parent.isFrozenGrid() || isMovable) {\n        setRowElements(this.parent);\n        this.parent.contentModule.visibleRows = this.requestType === 'add' ? row.concat(rows) : rows.concat(row);\n\n        if (this.parent.getFrozenMode() === literals.leftRight) {\n          args.e.renderMovableContent = true;\n          this.createRow(this.parent.getFrozenRightRowsObject(), args, false, false, true);\n        }\n      } else {\n        this.parent.contentModule.visibleFrozenRows = this.requestType === 'add' ? row.concat(rows) : rows.concat(row);\n        args.e.isFrozen = true;\n        this.createRow(this.parent.getMovableRowsObject(), args, true);\n      }\n    }\n  };\n\n  InfiniteScroll.prototype.ensureRowAvailability = function (rows, data) {\n    var resume = true;\n\n    if (this.parent.frozenRows && !this.parent.infiniteScrollSettings.enableCache && this.parent.sortSettings.columns && this.requestType === 'add') {\n      var key = this.parent.getPrimaryKeyFieldNames()[0];\n\n      for (var i = 0; i < rows.length; i++) {\n        if (rows[i].data[key] === data[key]) {\n          resume = false;\n          break;\n        }\n      }\n    }\n\n    return resume;\n  };\n\n  InfiniteScroll.prototype.generateRows = function (data, args) {\n    return this.rowModelGenerator.generateRows(data, args);\n  };\n\n  InfiniteScroll.prototype.resetRowIndex = function (rows, args, rowElms, isAdd, isFrozen) {\n    var _this = this;\n\n    var keyField = this.parent.getPrimaryKeyFieldNames()[0];\n    var isRemove = !(rowElms.length % this.parent.pageSettings.pageSize);\n\n    if (isAdd) {\n      if (isRemove) {\n        if (isFrozen && !this.parent.groupSettings.columns.length) {\n          this.swapCurrentViewData(1, true);\n        }\n\n        remove(rowElms[rows.length - 1]);\n        rowElms.splice(rows.length - 1, 1);\n        rows.splice(rows.length - 1, 1);\n      }\n    } else {\n      rows.filter(function (e, index) {\n        if (e.data[keyField] === args.data[0][keyField]) {\n          if (isFrozen && !_this.parent.groupSettings.columns.length) {\n            var page = Math.ceil((index + 1) / _this.parent.pageSettings.pageSize);\n\n            _this.resetInfiniteCurrentViewData(page, index);\n          }\n\n          rows.splice(index, 1);\n          remove(rowElms[index]);\n          rowElms.splice(index, 1);\n        }\n      });\n    }\n\n    var startIndex = isAdd ? this.addRowIndex ? this.addRowIndex + 1 : 1 : 0;\n    resetRowIndex(this.parent, rows, rowElms, startIndex, this.addRowIndex ? this.addRowIndex : 0);\n  };\n\n  InfiniteScroll.prototype.resetInfiniteCurrentViewData = function (page, index) {\n    index = index - (page - 1) * this.parent.pageSettings.pageSize;\n    this.infiniteCurrentViewData[page].splice(index, 1);\n    this.swapCurrentViewData(page, false);\n  };\n\n  InfiniteScroll.prototype.swapCurrentViewData = function (page, isAdd) {\n    var keys = Object.keys(this.infiniteCurrentViewData);\n    var end = isAdd ? keys.length + 1 : keys.length;\n\n    for (var i = page; i < end; i++) {\n      if (this.infiniteCurrentViewData[i + 1]) {\n        var pageIndex = isAdd ? i : i + 1;\n        var index = isAdd ? this.infiniteCurrentViewData[i].length - 1 : 0;\n        var data = this.infiniteCurrentViewData[pageIndex].splice(index, 1);\n\n        if (isAdd) {\n          this.infiniteCurrentViewData[i + 1] = data.concat(this.infiniteCurrentViewData[i + 1]);\n\n          if (i + 1 === end - 1) {\n            this.infiniteCurrentViewData[i + 1].splice(this.infiniteCurrentViewData[i + 1].length - 1, 1);\n          }\n        } else {\n          this.infiniteCurrentViewData[i].push(data[0]);\n        }\n      }\n    }\n\n    this.updateCurrentViewData();\n  };\n\n  InfiniteScroll.prototype.setDisplayNone = function (args) {\n    if (this.parent.infiniteScrollSettings.enableCache) {\n      var frozenCols = this.parent.isFrozenGrid();\n      var keys = frozenCols ? Object.keys(this.infiniteFrozenCache) : Object.keys(this.infiniteCache);\n\n      for (var i = 1; i <= keys.length; i++) {\n        var cache = frozenCols ? args.isFreeze ? this.infiniteFrozenCache[i][0] : this.infiniteFrozenCache[i][1] : this.infiniteCache[i];\n        cache.filter(function (e) {\n          e.cells[args.index].visible = args.visible === '';\n        });\n      }\n\n      this.resetContentModuleCache(frozenCols ? this.infiniteFrozenCache : this.infiniteCache);\n    }\n  };\n\n  InfiniteScroll.prototype.refreshInfiniteCache = function (args) {\n    this.getEditedRowObject().data = args.data;\n  };\n\n  InfiniteScroll.prototype.refreshInfiniteCacheRowVisibleLength = function (args, currentPage) {\n    var cPageRowArray = args[currentPage];\n\n    if (this.parent.enableInfiniteScrolling && this.parent.infiniteScrollSettings.enableCache) {\n      var length_1 = 0;\n      var vRowLen = 0;\n      var hRowLen = 0;\n\n      for (var i = 0; i < cPageRowArray.length; i++) {\n        if (cPageRowArray[i].visible || isNullOrUndefined(cPageRowArray[i].visible)) {\n          vRowLen++;\n        } else {\n          hRowLen++;\n        }\n      }\n\n      if (hRowLen > vRowLen) {\n        length_1 = hRowLen - vRowLen;\n\n        if (length_1 > vRowLen) {\n          length_1 = vRowLen;\n        }\n      } else {\n        length_1 = vRowLen - hRowLen;\n\n        if (length_1 > hRowLen) {\n          length_1 = hRowLen;\n        }\n      }\n\n      if (length_1 === 0) {\n        length_1 = 1;\n      }\n\n      return length_1;\n    } else {\n      return cPageRowArray.length;\n    }\n  };\n\n  InfiniteScroll.prototype.refreshInfiniteEditrowindex = function (args) {\n    this.editRowIndex = args.index;\n  };\n\n  InfiniteScroll.prototype.getEditedRowObject = function () {\n    var rowObjects = this.parent.getRowsObject();\n    var editedrow;\n\n    for (var i = 0; i < rowObjects.length; i++) {\n      if (rowObjects[i].index === this.editRowIndex) {\n        editedrow = rowObjects[i];\n      }\n    }\n\n    return editedrow;\n  };\n\n  InfiniteScroll.prototype.infiniteEditSuccess = function (args) {\n    if (this.isNormaledit) {\n      if (!this.isAdd && args.data) {\n        this.updateCurrentViewRecords(args.data);\n      }\n\n      this.isAdd = false;\n    }\n  };\n\n  InfiniteScroll.prototype.updateCurrentViewRecords = function (data) {\n    var index = getEditedDataIndex(this.parent, data);\n\n    if (!isNullOrUndefined(index)) {\n      this.parent.getCurrentViewRecords()[index] = data;\n    }\n  };\n\n  InfiniteScroll.prototype.actionBegin = function (args) {\n    if (args.requestType === 'add' || args.requestType === 'delete') {\n      this.requestType = args.requestType;\n    } else if (args.action === 'add' && args.requestType === 'save') {\n      this.requestType = args.action;\n    }\n\n    if (this.parent.isFrozenGrid() && !args.cancel && args.requestType === 'searching' || args.requestType === 'sorting' || args.requestType === 'filtering') {\n      this.isInitialRender = true;\n    }\n  };\n\n  InfiniteScroll.prototype.actionComplete = function (args) {\n    if (args.requestType === 'delete' || args.requestType === 'save' || args.requestType === 'cancel') {\n      this.requestType = this.empty;\n      this.isCancel = args.requestType === 'cancel' || args.requestType === 'save';\n      this.isAdd = this.isEdit = false;\n\n      if (this.isNormaledit) {\n        this.editRowIndex = this.empty;\n        this.virtualInfiniteData = {};\n        this.parent.editModule.previousVirtualData = {};\n      }\n    }\n  };\n\n  InfiniteScroll.prototype.resetInfiniteEdit = function () {\n    if (this.parent.enableInfiniteScrolling && this.isNormaledit) {\n      if (this.parent.editSettings.allowEditing && this.isEdit || this.parent.editSettings.allowAdding && this.isAdd) {\n        this.parent.isEdit = true;\n      }\n    }\n  };\n\n  InfiniteScroll.prototype.getVirtualInfiniteData = function (data) {\n    this.getVirtualInfiniteEditedData();\n    data.virtualData = this.virtualInfiniteData;\n    data.isAdd = this.isAdd;\n    data.isCancel = this.isCancel;\n  };\n\n  InfiniteScroll.prototype.editActionBegin = function (e) {\n    this.isEdit = true;\n    this.editRowIndex = e.index;\n    var rowObject = extend({}, this.getEditedRowObject().data);\n    e.data = Object.keys(this.virtualInfiniteData).length ? this.virtualInfiniteData : rowObject;\n  };\n\n  InfiniteScroll.prototype.dataSourceModified = function () {\n    this.resetInfiniteBlocks({\n      requestType: this.empty\n    }, true);\n  };\n\n  InfiniteScroll.prototype.onDataReady = function (e) {\n    if (!isNullOrUndefined(e.count) && e.requestType !== 'infiniteScroll') {\n      this.maxPage = Math.ceil(e.count / this.parent.pageSettings.pageSize);\n    }\n  };\n\n  InfiniteScroll.prototype.ensureIntialCollapse = function (isExpand) {\n    this.isInitialCollapse = !isExpand;\n  };\n\n  InfiniteScroll.prototype.infiniteScrollHandler = function (e) {\n    this.restoreInfiniteEdit();\n    this.restoreInfiniteAdd();\n    var targetEle = e.target;\n    var isInfinite = targetEle.classList.contains(literals.content);\n\n    if (isInfinite && this.parent.enableInfiniteScrolling && !e.isLeft) {\n      var scrollEle = this.parent.getContent().firstElementChild;\n      this.prevScrollTop = scrollEle.scrollTop;\n      var rows = this.parent.getRows();\n\n      if (!rows.length) {\n        return;\n      }\n\n      var index = getRowIndexFromElement(rows[rows.length - 1]) + 1;\n      var prevPage = this.parent.pageSettings.currentPage;\n      var args = void 0;\n      var offset = targetEle.scrollHeight - targetEle.scrollTop;\n      var round = Math.round(targetEle.scrollHeight - targetEle.scrollTop);\n      var floor = offset < targetEle.clientHeight ? Math.ceil(offset) : Math.floor(offset);\n\n      if (floor > targetEle.clientHeight) {\n        floor = floor - 1;\n      }\n\n      var isBottom = floor === targetEle.clientHeight || round === targetEle.clientHeight;\n\n      if (!isNullOrUndefined(this.groupCaptionAction)) {\n        return;\n      }\n\n      if (this.isScroll && isBottom && (this.parent.pageSettings.currentPage <= this.maxPage - 1 || this.enableContinuousScroll)) {\n        if (this.parent.infiniteScrollSettings.enableCache) {\n          this.isUpScroll = false;\n          this.isDownScroll = true;\n        }\n\n        var rows_2 = [].slice.call(scrollEle.querySelectorAll('.e-row:not(.e-addedrow)'));\n        var row = rows_2[rows_2.length - 1];\n        var rowIndex = getRowIndexFromElement(row);\n        this.parent.pageSettings.currentPage = Math.ceil(rowIndex / this.parent.pageSettings.pageSize) + 1;\n        args = {\n          requestType: 'infiniteScroll',\n          currentPage: this.parent.pageSettings.currentPage,\n          prevPage: prevPage,\n          startIndex: index,\n          direction: 'down'\n        };\n        this.makeRequest(args);\n      }\n\n      if (this.isScroll && this.parent.infiniteScrollSettings.enableCache && targetEle.scrollTop === 0 && this.parent.pageSettings.currentPage !== 1) {\n        if (this.parent.infiniteScrollSettings.enableCache) {\n          this.isDownScroll = false;\n          this.isUpScroll = true;\n        }\n\n        var row = [].slice.call(scrollEle.getElementsByClassName(literals.row));\n        var rowIndex = getRowIndexFromElement(row[this.parent.pageSettings.pageSize - 1]);\n        var startIndex = getRowIndexFromElement(row[0]) - this.parent.pageSettings.pageSize;\n        this.parent.pageSettings.currentPage = Math.ceil(rowIndex / this.parent.pageSettings.pageSize) - 1;\n\n        if (this.parent.pageSettings.currentPage) {\n          args = {\n            requestType: 'infiniteScroll',\n            currentPage: this.parent.pageSettings.currentPage,\n            prevPage: prevPage,\n            startIndex: startIndex,\n            direction: 'up'\n          };\n          this.makeRequest(args);\n        }\n      }\n\n      if (this.parent.infiniteScrollSettings.enableCache && !this.isScroll && isNullOrUndefined(args)) {\n        if (this.isDownScroll || this.isUpScroll) {\n          scrollEle.scrollTop = this.top;\n        }\n      }\n    }\n  };\n\n  InfiniteScroll.prototype.makeRequest = function (args) {\n    var _this = this;\n\n    if (this.parent.pageSettings.currentPage !== args.prevPage) {\n      var initBlocks = this.parent.infiniteScrollSettings.initialBlocks;\n\n      if (initBlocks < this.maxPage && this.parent.pageSettings.currentPage <= this.maxPage) {\n        this.isInfiniteScroll = true;\n\n        if (isNullOrUndefined(this.infiniteCache[args.currentPage])) {\n          setTimeout(function () {\n            _this.getVirtualInfiniteEditedData();\n\n            _this.parent.notify('model-changed', args);\n          }, 100);\n        } else {\n          setTimeout(function () {\n            _this.getVirtualInfiniteEditedData();\n\n            _this.parent.notify(events.refreshInfiniteModeBlocks, args);\n          }, 100);\n        }\n      } else {\n        this.parent.pageSettings.currentPage = this.maxPage;\n      }\n    }\n  };\n\n  InfiniteScroll.prototype.infinitePageQuery = function (query) {\n    if (this.initialRender) {\n      this.initialRender = false;\n      this.intialPageQuery(query);\n    } else {\n      if (!this.isInfiniteScroll && (this.requestType === 'delete' || this.requestType === 'add')) {\n        this.editPageQuery(query);\n      } else {\n        query.page(this.parent.pageSettings.currentPage, this.parent.pageSettings.pageSize);\n      }\n    }\n  };\n\n  InfiniteScroll.prototype.editPageQuery = function (query) {\n    var initialBlocks = this.parent.infiniteScrollSettings.initialBlocks;\n    var isCache = this.parent.infiniteScrollSettings.enableCache;\n\n    if (isCache) {\n      this.infiniteCache = {};\n      this.infiniteFrozenCache = {};\n      this.infiniteCurrentViewData = {};\n      query.skip(this.firstIndex);\n      query.take(initialBlocks * this.parent.pageSettings.pageSize);\n    } else {\n      if (this.parent.editSettings.mode === 'Dialog') {\n        this.parent.clearSelection();\n      }\n\n      var index = this.requestType === 'delete' ? this.lastIndex : this.addRowIndex ? this.addRowIndex : this.firstIndex;\n      query.skip(index);\n      query.take(1);\n    }\n  };\n\n  InfiniteScroll.prototype.intialPageQuery = function (query) {\n    if (this.parent.infiniteScrollSettings.enableCache && this.parent.infiniteScrollSettings.initialBlocks > this.parent.infiniteScrollSettings.maxBlocks) {\n      this.parent.infiniteScrollSettings.initialBlocks = this.parent.infiniteScrollSettings.maxBlocks;\n    }\n\n    var pageSize = this.parent.pageSettings.pageSize * this.parent.infiniteScrollSettings.initialBlocks;\n    query.page(1, pageSize);\n  };\n\n  InfiniteScroll.prototype.scrollToLastFocusedCell = function (e) {\n    var gObj = this.parent;\n    var rowIdx = this.lastFocusInfo.rowIdx + (e.keyArgs.action === literals.upArrow ? -1 : 1);\n    var cellIdx = this.lastFocusInfo.cellIdx;\n    var row = gObj.getRowByIndex(rowIdx);\n\n    if (!row) {\n      var rowRenderer = new RowRenderer(this.serviceLocator, null, this.parent);\n      var page = Math.floor(rowIdx / this.parent.pageSettings.pageSize) + 1;\n      gObj.pageSettings.currentPage = page;\n      var cols = gObj.getColumns();\n      remove(gObj.getContent().querySelector('tbody'));\n      gObj.getContent().querySelector('table').appendChild(gObj.createElement('tbody', {\n        attrs: {\n          'role': 'rowgroup'\n        }\n      }));\n      var focusRows = []; // eslint-disable-next-line @typescript-eslint/tslint/config\n\n      for (var i = page === 1 || this.maxPage === page ? 0 : -1, k = 0; k < gObj.infiniteScrollSettings.maxBlocks; this.maxPage === page ? i-- : i++, k++) {\n        var rows = this.infiniteCache[page + i];\n\n        if (rows) {\n          focusRows = focusRows.concat(rows);\n\n          for (var j = 0; j < rows.length; j++) {\n            gObj.getContent().querySelector('tbody').appendChild(rowRenderer.render(rows[j], cols));\n          }\n        }\n      }\n\n      gObj.notify(events.contentReady, {\n        rows: focusRows,\n        args: {}\n      });\n      setRowElements(gObj);\n    }\n\n    row = gObj.getRowByIndex(rowIdx);\n    var target = row.cells[cellIdx];\n    gObj.focusModule.isInfiniteScroll = true;\n    gObj.focusModule.onClick({\n      target: target\n    }, true);\n    gObj.selectRow(rowIdx);\n    target.focus();\n    this.isFocusScroll = false;\n    e.cancel = true;\n  };\n\n  InfiniteScroll.prototype.setLastCellFocusInfo = function (e) {\n    var cell = e.byClick && e.clickArgs.target || e.byKey && e.keyArgs.target || (!this.isFocusScroll && e).target;\n\n    if (cell && cell.classList.contains('e-rowcell')) {\n      var cellIdx = parseInt(cell.getAttribute('aria-colindex'), 10);\n      var rowIdx = parseInt(cell.parentElement.getAttribute('aria-rowindex'), 10);\n      this.lastFocusInfo = {\n        rowIdx: rowIdx,\n        cellIdx: cellIdx\n      };\n    }\n  };\n\n  InfiniteScroll.prototype.infiniteCellFocus = function (e) {\n    var gObj = this.parent;\n    var cache = gObj.infiniteScrollSettings.enableCache;\n\n    if (e.byKey) {\n      if (cache && this.isFocusScroll) {\n        this.scrollToLastFocusedCell(e);\n        return;\n      }\n\n      var cell = document.activeElement;\n      var rowIndex = getRowIndexFromElement(cell.parentElement);\n      this.cellIndex = parseInt(cell.getAttribute(literals.ariaColIndex), 10);\n      var content = gObj.getContent().firstElementChild;\n      var totalRowsCount = this.maxPage * gObj.pageSettings.pageSize - 1;\n      var visibleRowCount = Math.floor(content.offsetHeight / this.parent.getRowHeight());\n      var contentRect = content.getBoundingClientRect();\n\n      if (!isNaN(rowIndex)) {\n        if (e.keyArgs.action === literals.downArrow || e.keyArgs.action === literals.enter) {\n          this.rowIndex = rowIndex += 1;\n          var row = gObj.getRowByIndex(rowIndex);\n          var rowRect = row && row.getBoundingClientRect();\n\n          if (cache) {\n            rowIndex = cell.parentElement.rowIndex + 1;\n          }\n\n          if (this.isFocusScroll || !row && rowIndex < totalRowsCount || rowRect && rowRect.bottom >= contentRect.bottom) {\n            if (!this.isFocusScroll) {\n              this.pressedKey = e.keyArgs.action;\n            }\n\n            this.isFocusScroll = false;\n            content.scrollTop = (rowIndex - visibleRowCount + 1) * this.parent.getRowHeight();\n          } else if (!cache && row) {\n            if (rowRect && (rowRect.bottom >= contentRect.bottom || rowRect.top < contentRect.top)) {\n              row.cells[this.cellIndex].scrollIntoView();\n            }\n          }\n        } else if (e.keyArgs.action === literals.upArrow || e.keyArgs.action === literals.shiftEnter) {\n          this.rowIndex = rowIndex -= 1;\n          var row = gObj.getRowByIndex(rowIndex);\n          var rowRect = row && row.getBoundingClientRect();\n\n          if (cache) {\n            rowIndex = cell.parentElement.rowIndex - 1;\n          }\n\n          if (!row || rowRect.top <= contentRect.top) {\n            this.pressedKey = e.keyArgs.action;\n            content.scrollTop = rowIndex * this.parent.getRowHeight();\n          }\n        }\n      }\n    } else if (e.key === 'PageDown' || e.key === 'PageUp') {\n      this.pressedKey = e.key;\n    }\n\n    this.setLastCellFocusInfo(e);\n  };\n\n  InfiniteScroll.prototype.createEmptyRowdata = function () {\n    var _this = this;\n\n    this.parent.getColumns().filter(function (e) {\n      _this.emptyRowData[e.field] = _this.empty;\n    });\n  };\n\n  InfiniteScroll.prototype.getVirtualInfiniteEditedData = function () {\n    var editForm = this.parent.element.querySelector('.' + literals.editedRow);\n    var addForm = this.parent.element.querySelector('.' + literals.addedRow);\n    var gridForm = this.parent.element.querySelector('.e-gridform');\n\n    if (this.parent.infiniteScrollSettings.enableCache && (editForm || addForm)) {\n      var rowData = editForm ? extend({}, this.getEditedRowObject().data) : extend({}, this.emptyRowData);\n      this.virtualInfiniteData = this.parent.editModule.getCurrentEditedData(gridForm, rowData);\n\n      if (this.parent.isFrozenGrid()) {\n        this.virtualInfiniteData = this.parent.editModule.getCurrentEditedData(this.parent.getMovableVirtualContent().querySelector('.e-gridform'), rowData);\n      }\n    }\n  };\n\n  InfiniteScroll.prototype.restoreInfiniteEdit = function () {\n    var content = this.parent.getContent().firstElementChild;\n    var frozenEdit = this.parent.frozenRows ? this.editRowIndex >= this.parent.frozenRows : true;\n\n    if (this.isNormaledit && this.parent.infiniteScrollSettings.enableCache && frozenEdit) {\n      if (this.parent.editSettings.allowEditing && !isNullOrUndefined(this.editRowIndex)) {\n        var row = this.parent.getRowByIndex(this.editRowIndex);\n\n        if (Object.keys(this.virtualInfiniteData).length && row && !this.parent.getContent().querySelector('.' + literals.editedRow)) {\n          var top_1 = row.getBoundingClientRect().top;\n\n          if (top_1 < content.offsetHeight && top_1 > this.parent.getRowHeight()) {\n            this.parent.isEdit = false;\n            this.parent.editModule.startEdit(row);\n          }\n        }\n      }\n    }\n  };\n\n  InfiniteScroll.prototype.restoreInfiniteAdd = function () {\n    var content = this.parent.getContent().firstElementChild;\n\n    if (this.parent.getCurrentViewRecords().length && this.parent.getRowByIndex(0) && this.isNormaledit && this.parent.infiniteScrollSettings.enableCache && this.isAdd && !content.querySelector('.' + literals.addedRow)) {\n      var isTop = content.scrollTop < this.parent.getRowHeight();\n\n      if (isTop) {\n        this.parent.isEdit = false;\n        this.parent.addRecord();\n      }\n    }\n  };\n\n  InfiniteScroll.prototype.appendInfiniteRows = function (e) {\n    var frozenCols = this.parent.isFrozenGrid();\n    var scrollEle = this.parent.getContent().firstElementChild;\n    var isInfiniteScroll = this.parent.enableInfiniteScrolling && e.args.requestType === 'infiniteScroll';\n    var isMovable = this.parent.getFrozenMode() === literals.leftRight && e.tableName === 'movable';\n\n    if (isInfiniteScroll && !e.args.isFrozen && !isMovable || !isInfiniteScroll) {\n      if (isInfiniteScroll && e.args.direction === 'up') {\n        e.tbody.insertBefore(e.frag, e.tbody.firstElementChild);\n      } else {\n        e.tbody.appendChild(e.frag);\n      }\n    }\n\n    if (!frozenCols) {\n      this.parent.contentModule.getTable().appendChild(e.tbody);\n      this.updateCurrentViewData();\n    } else {\n      if (isInfiniteScroll) {\n        if (e.tableName === literals.frozenLeft || this.parent.getFrozenMode() === 'Right' && e.tableName === literals.frozenRight) {\n          this.frozenFrag = e.frag;\n        } else if (this.parent.getFrozenMode() === literals.leftRight && e.tableName === 'movable') {\n          this.movableFrag = e.frag;\n        } else {\n          var tbody = this.parent.getFrozenVirtualContent().querySelector(literals.tbody);\n\n          if (e.args.direction === 'up') {\n            tbody.insertBefore(this.frozenFrag, tbody.firstElementChild);\n          } else {\n            tbody.appendChild(this.frozenFrag);\n          }\n\n          if (e.tableName === literals.frozenRight) {\n            this.parent.getMovableVirtualContent().querySelector(literals.tbody).appendChild(this.movableFrag);\n            this.parent.element.querySelector('.e-frozen-right-content').querySelector(literals.tbody).appendChild(e.frag);\n          } else {\n            this.parent.getMovableVirtualContent().querySelector('.' + literals.table).appendChild(e.tbody);\n          }\n\n          this.parent.contentModule.refreshScrollOffset();\n          this.updateCurrentViewData();\n        }\n      } else {\n        var table = void 0;\n\n        if (e.tableName === literals.frozenLeft) {\n          table = this.parent.getFrozenVirtualContent().querySelector('.' + literals.table);\n        } else if (e.tableName === 'movable') {\n          table = this.parent.getMovableVirtualContent().querySelector('.' + literals.table);\n\n          if (this.parent.getFrozenMode() !== literals.leftRight) {\n            this.parent.contentModule.refreshScrollOffset();\n            this.updateCurrentViewData();\n          }\n        } else {\n          table = this.parent.element.querySelector('.e-frozen-right-content').querySelector('.' + literals.table);\n\n          if (this.parent.getFrozenMode() === literals.leftRight) {\n            this.parent.contentModule.refreshScrollOffset();\n            this.updateCurrentViewData();\n          }\n        }\n\n        table.appendChild(e.tbody);\n        this.widthService.refreshFrozenScrollbar();\n      }\n    }\n\n    if (this.isInitialRender && !e.args.isFrozen) {\n      this.isInitialRender = false;\n      this.parent.scrollModule.setHeight();\n    }\n\n    if (!e.args.isFrozen) {\n      this.rowTop = !this.rowTop ? this.parent.getRows()[0].getBoundingClientRect().top : this.rowTop;\n\n      if (isInfiniteScroll) {\n        if (this.parent.infiniteScrollSettings.enableCache && this.isRemove) {\n          scrollEle.scrollTop = this.top;\n        }\n\n        setRowElements(this.parent);\n      }\n\n      this.restoreInfiniteAdd();\n      this.isScroll = true;\n    }\n\n    this.isInfiniteScroll = false;\n  }; // eslint-disable-next-line @typescript-eslint/no-unused-vars\n\n\n  InfiniteScroll.prototype.selectNewRow = function (args) {\n    var _this = this;\n\n    var gObj = this.parent;\n    var row = gObj.getRowByIndex(this.rowIndex);\n    var cache = gObj.infiniteScrollSettings.enableCache;\n\n    if (row && this.keys.some(function (value) {\n      return value === _this.pressedKey;\n    })) {\n      var content = gObj.getContent().firstElementChild;\n      var rowHeight = gObj.getRowHeight();\n      var target = row.cells[this.cellIndex];\n\n      if (this.pressedKey === literals.downArrow || this.pressedKey === literals.enter || cache && (this.pressedKey === literals.upArrow || this.pressedKey === literals.shiftEnter)) {\n        if (!cache && this.pressedKey !== literals.upArrow && this.pressedKey !== literals.shiftEnter) {\n          content.scrollTop = content.scrollTop + rowHeight;\n        }\n\n        gObj.focusModule.isInfiniteScroll = true;\n        gObj.focusModule.onClick({\n          target: target\n        }, true);\n        gObj.selectRow(this.rowIndex);\n      }\n    } else if (this.lastFocusInfo && (this.pressedKey === literals.pageDown || this.pressedKey === literals.pageUp)) {\n      var idx = cache ? 0 : this.lastFocusInfo.rowIdx;\n\n      if (gObj.getRowByIndex(idx)) {\n        var target = gObj.getCellFromIndex(idx, this.lastFocusInfo.cellIdx);\n\n        if (target) {\n          this.isFocusScroll = true;\n\n          if (!cache) {\n            gObj.focusModule.isInfiniteScroll = true;\n            gObj.focusModule.onClick({\n              target: target\n            }, true);\n          } else {\n            target.focus({\n              preventScroll: true\n            });\n          }\n        }\n      }\n    }\n\n    this.pressedKey = undefined;\n  };\n\n  InfiniteScroll.prototype.removeInfiniteCacheRows = function (e) {\n    var isInfiniteScroll = this.parent.enableInfiniteScrolling && e.args.requestType === 'infiniteScroll';\n\n    if (!e.args.isFrozen && isInfiniteScroll && this.parent.infiniteScrollSettings.enableCache && this.isRemove) {\n      var rows = [].slice.call(this.parent.getContentTable().getElementsByClassName(literals.row));\n\n      if (e.args.direction === 'down') {\n        if (this.parent.allowGrouping && this.parent.groupSettings.columns.length) {\n          var captionRows = [].slice.call(this.parent.getContentTable().querySelectorAll('tr'));\n          this.removeCaptionRows(captionRows, e.args);\n        }\n\n        var addRowCount = this.parent.element.querySelector('.' + literals.addedRow) ? 0 : 1;\n        this.removeTopRows(rows, this.parent.pageSettings.pageSize - addRowCount);\n      }\n\n      if (e.args.direction === 'up') {\n        if (this.parent.allowGrouping && this.parent.groupSettings.columns.length) {\n          var captionRows = [].slice.call(this.parent.getContentTable().querySelectorAll('tr'));\n          this.removeCaptionRows(captionRows, e.args);\n        } else {\n          this.removeBottomRows(rows, rows.length - 1, e.args);\n        }\n      }\n\n      this.isScroll = false;\n      this.top = this.calculateScrollTop(e.args);\n    }\n  };\n\n  InfiniteScroll.prototype.calculateScrollTop = function (args) {\n    var top = 0;\n    var scrollCnt = this.parent.getContent().firstElementChild;\n\n    if (args.direction === 'down') {\n      if (this.parent.allowGrouping && this.parent.groupSettings.columns.length && !this.isInitialCollapse) {\n        top = this.captionRowHeight();\n      }\n\n      var captionRows = [].slice.call(this.parent.getContent().firstElementChild.querySelectorAll('tr:not(.e-row)'));\n      var captionCount = 0;\n\n      if (this.isInitialCollapse && !isNullOrUndefined(captionRows)) {\n        captionCount = Math.round((captionRows.length - 1) / this.parent.groupSettings.columns.length);\n      }\n\n      var value = captionCount ? captionCount : this.parent.pageSettings.pageSize * (this.parent.infiniteScrollSettings.maxBlocks - 1);\n      var currentViewRowCount = 0;\n      var i = 0;\n\n      while (currentViewRowCount < scrollCnt.clientHeight) {\n        i++;\n        currentViewRowCount = i * this.parent.getRowHeight();\n      }\n\n      i = i - 1;\n      top += (value - i) * this.parent.getRowHeight();\n    }\n\n    if (args.direction === 'up') {\n      if (this.parent.allowGrouping && this.parent.groupSettings.columns.length && !this.isInitialCollapse) {\n        var len = this.refreshInfiniteCacheRowVisibleLength(this.infiniteCache, this.parent.pageSettings.currentPage);\n        top = len * this.parent.getRowHeight();\n      } else if (this.isInitialCollapse) {\n        var groupedData = this.infiniteCache[this.parent.pageSettings.currentPage];\n        var count = 0;\n\n        for (var i = 0; i < groupedData.length; i++) {\n          if (groupedData[i].isCaptionRow) {\n            count++;\n          }\n        }\n\n        top += Math.round(count / this.parent.groupSettings.columns.length) * this.parent.getRowHeight();\n      } else {\n        top += this.parent.pageSettings.pageSize * this.parent.getRowHeight() + getScrollBarWidth();\n      }\n    }\n\n    return top;\n  };\n\n  InfiniteScroll.prototype.captionRowHeight = function () {\n    var rows = [].slice.call(this.parent.getContent().querySelectorAll('tr:not(.e-row)'));\n    return rows.length * this.parent.getRowHeight();\n  };\n\n  InfiniteScroll.prototype.removeTopRows = function (rows, maxIndx) {\n    var frozeCols = this.parent.isFrozenGrid();\n    var frRows = this.parent.getFrozenMode() === literals.leftRight ? [].slice.call(this.parent.element.querySelector('.e-frozen-right-content').getElementsByClassName(literals.row)) : null;\n    var movableRows = frozeCols ? [].slice.call(this.parent.getMovableVirtualContent().getElementsByClassName(literals.row)) : null;\n\n    for (var i = 0; i <= maxIndx; i++) {\n      if (this.parent.frozenRows && this.parent.pageSettings.currentPage === this.parent.infiniteScrollSettings.maxBlocks + 1 && i > maxIndx - this.parent.frozenRows) {\n        continue;\n      }\n\n      remove(rows[i]);\n\n      if (movableRows) {\n        remove(movableRows[i]);\n      }\n\n      if (frRows) {\n        remove(frRows[i]);\n      }\n    }\n  };\n\n  InfiniteScroll.prototype.removeBottomRows = function (rows, maxIndx, args) {\n    var cnt = 0;\n    var frozeCols = this.parent.isFrozenGrid();\n    var movableRows = frozeCols ? [].slice.call(this.parent.getMovableVirtualContent().getElementsByClassName(literals.row)) : null;\n    var frRows = this.parent.getFrozenMode() === literals.leftRight ? [].slice.call(this.parent.element.querySelector('.e-frozen-right-content').getElementsByClassName(literals.row)) : null;\n    var pageSize = this.parent.pageSettings.pageSize;\n\n    if (!frozeCols && this.infiniteCache[args.prevPage].length < pageSize) {\n      cnt = this.parent.pageSettings.pageSize - this.infiniteCache[args.prevPage].length;\n    }\n\n    if (frozeCols && this.infiniteFrozenCache[args.prevPage][1].length < pageSize) {\n      cnt = this.parent.pageSettings.pageSize - this.infiniteFrozenCache[args.prevPage][1].length;\n    }\n\n    for (var i = maxIndx; cnt < pageSize; i--) {\n      cnt++;\n      remove(rows[i]);\n\n      if (movableRows) {\n        remove(movableRows[i]);\n      }\n\n      if (frRows) {\n        remove(frRows[i]);\n      }\n    }\n  };\n\n  InfiniteScroll.prototype.removeCaptionRows = function (rows, args) {\n    var rowElements = [].slice.call(this.parent.getContent().getElementsByClassName(literals.row));\n\n    if (args.direction === 'down') {\n      var lastRow = rowElements[this.parent.pageSettings.pageSize - 1];\n      var lastRowIndex = getRowIndexFromElement(lastRow) - 1;\n      var k = 0;\n\n      for (var i = 0; k < lastRowIndex; i++) {\n        if (!rows[i].classList.contains(literals.row)) {\n          remove(rows[i]);\n        } else {\n          k = getRowIndexFromElement(rows[i]);\n        }\n      }\n    }\n\n    if (args.direction === 'up') {\n      var lastIndex = getRowIndexFromElement(rowElements[rowElements.length - 1]);\n      var page = Math.ceil(lastIndex / this.parent.pageSettings.pageSize);\n      var startIndex = 0;\n\n      for (var i = this.parent.pageSettings.currentPage + 1; i < page; i++) {\n        startIndex += this.infiniteCache[i].length;\n      }\n\n      for (var i = startIndex; i < rows.length; i++) {\n        remove(rows[i]);\n      }\n    }\n  };\n\n  InfiniteScroll.prototype.resetInfiniteBlocks = function (args, isDataModified) {\n    var isInfiniteScroll = this.parent.enableInfiniteScrolling && args.requestType !== 'infiniteScroll';\n\n    if (!this.initialRender && !isNullOrUndefined(this.parent.infiniteScrollModule) && isInfiniteScroll) {\n      if (this.actions.some(function (value) {\n        return value === args.requestType;\n      }) || isDataModified || args.requestType === 'save' && (this.parent.sortSettings.columns.length || this.parent.filterSettings.columns.length || this.parent.groupSettings.columns.length || this.parent.searchSettings.key)) {\n        var scrollEle = this.parent.getContent().firstElementChild;\n        this.initialRender = true;\n        scrollEle.scrollTop = 0;\n        this.parent.pageSettings.currentPage = 1;\n        this.infiniteCache = this.infiniteFrozenCache = {};\n        this.infiniteCurrentViewData = {};\n        this.resetContentModuleCache({});\n        this.isRemove = false;\n        this.top = 0;\n        this.isInitialMovableRender = true;\n        this.isInitialCollapse = false;\n        this.parent.contentModule.isRemove = this.isRemove;\n        this.parent.contentModule.isAddRows = this.isRemove;\n        this.parent.contentModule.visibleRows = [];\n        this.parent.contentModule.visibleFrozenRows = [];\n      }\n    }\n  };\n\n  InfiniteScroll.prototype.setCache = function (e) {\n    if (this.parent.enableInfiniteScrolling && this.parent.infiniteScrollSettings.enableCache) {\n      var frozeCols = this.parent.isFrozenGrid();\n      var idx = e.args.isFrozen ? 1 : 0;\n      var isEdit = e.args.requestType !== 'infiniteScroll' && (this.requestType === 'delete' || this.requestType === 'add');\n      var currentPage = this.parent.pageSettings.currentPage;\n\n      if (frozeCols && this.isInitialMovableRender || !frozeCols && !Object.keys(this.infiniteCache).length || isEdit) {\n        this.isInitialMovableRender = !e.args.isFrozen;\n        this.setInitialCache(e.modelData, e.args, isEdit);\n      }\n\n      if (!frozeCols && isNullOrUndefined(this.infiniteCache[this.parent.pageSettings.currentPage])) {\n        this.infiniteCache[this.parent.pageSettings.currentPage] = e.modelData;\n        this.resetContentModuleCache(this.infiniteCache);\n      }\n\n      if (frozeCols) {\n        if (idx === 0 && isNullOrUndefined(this.infiniteFrozenCache[currentPage]) || !this.infiniteFrozenCache[currentPage][idx].length) {\n          this.createFrozenCache(currentPage);\n          this.infiniteFrozenCache[currentPage][idx] = e.modelData;\n\n          if (idx === 1) {\n            this.resetContentModuleCache(this.infiniteFrozenCache);\n          }\n        }\n      }\n\n      if (e.isInfiniteScroll && !this.isRemove) {\n        this.isRemove = (currentPage - 1) % this.parent.infiniteScrollSettings.maxBlocks === 0;\n        this.parent.contentModule.isRemove = this.isRemove;\n      }\n    }\n  };\n\n  InfiniteScroll.prototype.setInitialCache = function (data, args, isEdit, isCurrentViewData) {\n    var frozenCols = this.parent.isFrozenGrid();\n    var idx = args.isFrozen ? 1 : 0;\n    var k = !isEdit ? 1 : this.firstBlock;\n\n    for (var i = 1; i <= this.parent.infiniteScrollSettings.initialBlocks; i++) {\n      var startIndex = (i - 1) * this.parent.pageSettings.pageSize;\n      var endIndex = i * this.parent.pageSettings.pageSize;\n\n      if (this.parent.allowGrouping && this.parent.groupSettings.columns.length && !isCurrentViewData) {\n        this.setInitialGroupCache(data, k, startIndex, endIndex);\n      } else {\n        if (isCurrentViewData) {\n          this.infiniteCurrentViewData[k] = data.slice(startIndex, endIndex);\n        } else {\n          if (frozenCols) {\n            this.createFrozenCache(k);\n            this.infiniteFrozenCache[k][idx] = data.slice(startIndex, endIndex);\n            this.resetContentModuleCache(this.infiniteFrozenCache);\n          } else {\n            this.infiniteCache[k] = data.slice(startIndex, endIndex);\n            this.resetContentModuleCache(this.infiniteCache);\n          }\n        }\n      }\n\n      k++;\n    }\n  };\n\n  InfiniteScroll.prototype.createFrozenCache = function (index) {\n    if (!this.infiniteFrozenCache[index]) {\n      this.infiniteFrozenCache[index] = [[], []];\n    }\n  };\n\n  InfiniteScroll.prototype.setInitialGroupCache = function (data, index, sIndex, eIndex) {\n    var pageData = [];\n    var startIndex = 0;\n\n    for (var i = 1; i <= Object.keys(this.infiniteCache).length; i++) {\n      startIndex += this.infiniteCache[i].length;\n    }\n\n    var k = sIndex;\n\n    for (var i = startIndex; i < data.length && k < eIndex; i++) {\n      if (data[i].index < eIndex || data[i].isCaptionRow) {\n        k = data[i].isCaptionRow ? k : data[i].index;\n        pageData.push(data[i]);\n      }\n\n      if (data[i].index >= eIndex || data[i].index === eIndex - 1) {\n        break;\n      }\n    }\n\n    this.infiniteCache[index] = pageData;\n    this.resetContentModuleCache(this.infiniteCache);\n  };\n\n  InfiniteScroll.prototype.resetContentModuleCache = function (data) {\n    this.parent.contentModule.infiniteCache = data;\n  };\n  /**\n   * @returns {void}\n   * @hidden\n   */\n\n\n  InfiniteScroll.prototype.destroy = function () {\n    this.removeEventListener();\n  };\n\n  return InfiniteScroll;\n}();\n\nexport { InfiniteScroll };","map":{"version":3,"names":["isNullOrUndefined","remove","extend","RowModelGenerator","FreezeRowModelGenerator","RowRenderer","events","getScrollBarWidth","getEditedDataIndex","resetRowIndex","setRowElements","getRowIndexFromElement","getGroupKeysAndFields","getPredicates","generateExpandPredicates","literals","InfiniteScroll","parent","serviceLocator","infiniteCache","infiniteCurrentViewData","infiniteFrozenCache","isDownScroll","isUpScroll","isScroll","enableContinuousScroll","initialRender","isRemove","isInitialCollapse","prevScrollTop","actions","keys","downArrow","upArrow","enter","shiftEnter","rowTop","isInitialMovableRender","virtualInfiniteData","isCancel","emptyRowData","isNormaledit","isInfiniteScroll","isLastPage","isInitialRender","isFocusScroll","isGroupCollapse","editSettings","mode","addEventListener","widthService","getService","rowModelGenerator","isFrozenGrid","prototype","getModuleName","on","dataReady","onDataReady","dataSourceModified","infinitePageQuery","infiniteScrollHandler","beforeCellFocused","infiniteCellFocus","appendInfiniteContent","appendInfiniteRows","removeInfiniteRows","removeInfiniteCacheRows","resetInfiniteBlocks","setInfiniteCache","setCache","initialCollapse","ensureIntialCollapse","keyPressed","infiniteShowHide","setDisplayNone","virtualScrollEditActionBegin","editActionBegin","getVirtualData","getVirtualInfiniteData","editReset","resetInfiniteEdit","virtualScrollEditSuccess","infiniteEditSuccess","refreshVirtualCache","refreshInfiniteCache","refreshInfiniteEditrowindex","infiniteEditHandler","virtualScrollAddActionBegin","infiniteAddActionBegin","modelChanged","refreshInfiniteCurrentViewData","destroy","contentReady","selectNewRow","captionActionComplete","setVirtualPageQuery","setGroupCollapsePageQuery","actionBeginFunction","actionBegin","bind","actionCompleteFunction","actionComplete","dataBoundFunction","dataBound","deleteComplete","deleteComplate","removeEventListener","isDestroyed","off","groupCaptionAction","makeGroupCollapseRequest","hideSpinner","empty","args","gObj","infiniteScrollSettings","enableCache","skipPage","captionRow","getRowObjectFromUID","parentCapUid","rowObjs","getRowsObject","childCount","i","length","indent","isDataRow","key","indexOf","pred","fields","predicateList","and","query","where","skip","rows","getRows","size","pageSettings","pageSize","additionalCnt","take","initialBlocks","isCollapse","contetRect","getContent","firstElementChild","getBoundingClientRect","tableReact","contentModule","getTable","Math","round","bottom","getRowHeight","parentUid","showSpinner","caption","getCaptionChildCount","index","prevPage","currentPage","ceil","maxPage","scrollArg","requestType","startIndex","direction","isCaptionCollapse","notify","rowObj","make","data","isCaptionRow","childCheck","row","uid","count","updateCurrentViewData","groupSettings","columns","Object","currentViewData","page","isCache","blocks","maxBlocks","isMiddlePage","start","end","concat","e","cache","isAdd","sortSettings","filterSettings","searchSettings","isDelete","indexCount","resetCurrentViewData","splice","push","setInitialCache","slice","lastViewData","pop","refreshScrollOffset","addRowIndex","firstIndex","firstBlock","lastIndex","createEmptyRowdata","startEdit","makeRequest","frozenCols","rowElms","ensureRowAvailability","result","rows_1","getMovableRowsObject","getMovableDataRows","getFrozenMode","leftRight","frRows","getFrozenRightRowsObject","getFrozenRightRows","createRow","selectionModule","frozenRows","movableRows","rightRows","getFrozenRightDataRows","refreshInfinitePersistSelection","saveComplete","freezeRender","case","isMovable","isFrozenRows","isFrozenRight","generateRows","rowRenderer","tbody","element","querySelector","getMovableVirtualContent","getFrozenVirtualContent","getHeaderContent","getMovableVirtualHeader","getFrozenVirtualHeader","notifyArgs","cancel","infiniteCrudCancel","appendChild","render","getColumns","insertBefore","rowElems","rightFreezeRows","visibleRows","renderMovableContent","visibleFrozenRows","isFrozen","resume","getPrimaryKeyFieldNames","_this","keyField","swapCurrentViewData","filter","resetInfiniteCurrentViewData","pageIndex","isFreeze","cells","visible","resetContentModuleCache","getEditedRowObject","refreshInfiniteCacheRowVisibleLength","cPageRowArray","enableInfiniteScrolling","length_1","vRowLen","hRowLen","editRowIndex","rowObjects","editedrow","updateCurrentViewRecords","getCurrentViewRecords","action","isEdit","editModule","previousVirtualData","allowEditing","allowAdding","getVirtualInfiniteEditedData","virtualData","rowObject","isExpand","restoreInfiniteEdit","restoreInfiniteAdd","targetEle","target","isInfinite","classList","contains","content","isLeft","scrollEle","scrollTop","offset","scrollHeight","floor","clientHeight","isBottom","rows_2","call","querySelectorAll","rowIndex","getElementsByClassName","top","initBlocks","setTimeout","refreshInfiniteModeBlocks","intialPageQuery","editPageQuery","clearSelection","scrollToLastFocusedCell","rowIdx","lastFocusInfo","keyArgs","cellIdx","getRowByIndex","cols","createElement","attrs","focusRows","k","j","focusModule","onClick","selectRow","focus","setLastCellFocusInfo","cell","byClick","clickArgs","byKey","parseInt","getAttribute","parentElement","document","activeElement","cellIndex","ariaColIndex","totalRowsCount","visibleRowCount","offsetHeight","contentRect","isNaN","rowRect","pressedKey","scrollIntoView","field","editForm","editedRow","addForm","addedRow","gridForm","rowData","getCurrentEditedData","frozenEdit","top_1","isTop","addRecord","tableName","frag","frozenLeft","frozenRight","frozenFrag","movableFrag","table","refreshFrozenScrollbar","scrollModule","setHeight","some","value","rowHeight","pageDown","pageUp","idx","getCellFromIndex","preventScroll","undefined","getContentTable","allowGrouping","captionRows","removeCaptionRows","addRowCount","removeTopRows","removeBottomRows","calculateScrollTop","scrollCnt","captionRowHeight","captionCount","currentViewRowCount","len","groupedData","maxIndx","frozeCols","cnt","rowElements","lastRow","lastRowIndex","isDataModified","infiniteScrollModule","isAddRows","modelData","createFrozenCache","isCurrentViewData","endIndex","setInitialGroupCache","sIndex","eIndex","pageData"],"sources":["/home/morgan/Desktop/Projets/ENT4/Jwt-Auth-pdf/react-jwt-auth/react-jwt-auth/node_modules/@syncfusion/ej2-grids/src/grid/actions/infinite-scroll.js"],"sourcesContent":["import { isNullOrUndefined, remove, extend } from '@syncfusion/ej2-base';\nimport { RowModelGenerator } from '../services/row-model-generator';\nimport { FreezeRowModelGenerator } from '../services/freeze-row-model-generator';\nimport { RowRenderer } from '../renderer/row-renderer';\nimport * as events from '../base/constant';\nimport { getScrollBarWidth, getEditedDataIndex, resetRowIndex, setRowElements, getRowIndexFromElement, getGroupKeysAndFields, getPredicates, generateExpandPredicates } from '../base/util';\nimport * as literals from '../base/string-literals';\n/**\n * Infinite Scrolling class\n *\n * @hidden\n */\nvar InfiniteScroll = /** @class */ (function () {\n    /**\n     * Constructor for the Grid infinite scrolling.\n     *\n     * @param {IGrid} parent - specifies the IGrid\n     * @param {ServiceLocator} serviceLocator - specifies the ServiceLocator\n     * @hidden\n     */\n    function InfiniteScroll(parent, serviceLocator) {\n        this.infiniteCache = {};\n        this.infiniteCurrentViewData = {};\n        this.infiniteFrozenCache = {};\n        this.isDownScroll = false;\n        this.isUpScroll = false;\n        this.isScroll = true;\n        this.enableContinuousScroll = false;\n        this.initialRender = true;\n        this.isRemove = false;\n        this.isInitialCollapse = false;\n        this.prevScrollTop = 0;\n        this.actions = ['filtering', 'searching', 'grouping', 'ungrouping', 'reorder', 'sorting', 'refresh'];\n        this.keys = [literals.downArrow, literals.upArrow, literals.enter, literals.shiftEnter];\n        this.rowTop = 0;\n        this.isInitialMovableRender = true;\n        this.virtualInfiniteData = {};\n        this.isCancel = false;\n        this.emptyRowData = {};\n        this.isNormaledit = false;\n        this.isInfiniteScroll = false;\n        this.isLastPage = false;\n        this.isInitialRender = true;\n        this.isFocusScroll = false;\n        this.isGroupCollapse = false;\n        this.parent = parent;\n        this.serviceLocator = serviceLocator;\n        this.isNormaledit = this.parent.editSettings.mode === 'Normal';\n        this.addEventListener();\n        this.widthService = serviceLocator.getService('widthService');\n        this.rowModelGenerator = this.parent.isFrozenGrid() ? new FreezeRowModelGenerator(this.parent)\n            : new RowModelGenerator(this.parent);\n    }\n    InfiniteScroll.prototype.getModuleName = function () {\n        return 'infiniteScroll';\n    };\n    /**\n     * @returns {void}\n     * @hidden\n     */\n    InfiniteScroll.prototype.addEventListener = function () {\n        this.parent.on(events.dataReady, this.onDataReady, this);\n        this.parent.on(events.dataSourceModified, this.dataSourceModified, this);\n        this.parent.on(events.infinitePageQuery, this.infinitePageQuery, this);\n        this.parent.on(events.infiniteScrollHandler, this.infiniteScrollHandler, this);\n        this.parent.on(events.beforeCellFocused, this.infiniteCellFocus, this);\n        this.parent.on(events.appendInfiniteContent, this.appendInfiniteRows, this);\n        this.parent.on(events.removeInfiniteRows, this.removeInfiniteCacheRows, this);\n        this.parent.on(events.resetInfiniteBlocks, this.resetInfiniteBlocks, this);\n        this.parent.on(events.setInfiniteCache, this.setCache, this);\n        this.parent.on(events.initialCollapse, this.ensureIntialCollapse, this);\n        this.parent.on(events.keyPressed, this.infiniteCellFocus, this);\n        this.parent.on(events.infiniteShowHide, this.setDisplayNone, this);\n        this.parent.on(events.virtualScrollEditActionBegin, this.editActionBegin, this);\n        this.parent.on(events.getVirtualData, this.getVirtualInfiniteData, this);\n        this.parent.on(events.editReset, this.resetInfiniteEdit, this);\n        this.parent.on(events.virtualScrollEditSuccess, this.infiniteEditSuccess, this);\n        this.parent.on(events.refreshVirtualCache, this.refreshInfiniteCache, this);\n        this.parent.on(events.refreshInfiniteEditrowindex, this.refreshInfiniteEditrowindex, this);\n        this.parent.on(events.infiniteEditHandler, this.infiniteEditHandler, this);\n        this.parent.on(events.virtualScrollAddActionBegin, this.infiniteAddActionBegin, this);\n        this.parent.on(events.modelChanged, this.modelChanged, this);\n        this.parent.on(events.refreshInfiniteCurrentViewData, this.refreshInfiniteCurrentViewData, this);\n        this.parent.on(events.destroy, this.destroy, this);\n        this.parent.on(events.contentReady, this.selectNewRow, this);\n        this.parent.on(events.captionActionComplete, this.captionActionComplete, this);\n        this.parent.on(events.setVirtualPageQuery, this.setGroupCollapsePageQuery, this);\n        this.actionBeginFunction = this.actionBegin.bind(this);\n        this.actionCompleteFunction = this.actionComplete.bind(this);\n        this.dataBoundFunction = this.dataBound.bind(this);\n        this.parent.on(events.deleteComplete, this.deleteComplate, this);\n        this.parent.addEventListener(events.actionBegin, this.actionBeginFunction);\n        this.parent.addEventListener(events.actionComplete, this.actionCompleteFunction);\n        this.parent.addEventListener(events.dataBound, this.dataBoundFunction);\n    };\n    /**\n     * @returns {void}\n     * @hidden\n     */\n    InfiniteScroll.prototype.removeEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.off(events.dataReady, this.onDataReady);\n        this.parent.off(events.dataSourceModified, this.dataSourceModified);\n        this.parent.off(events.infinitePageQuery, this.infinitePageQuery);\n        this.parent.off(events.infiniteScrollHandler, this.infiniteScrollHandler);\n        this.parent.off(events.beforeCellFocused, this.infiniteCellFocus);\n        this.parent.off(events.appendInfiniteContent, this.appendInfiniteRows);\n        this.parent.off(events.removeInfiniteRows, this.removeInfiniteCacheRows);\n        this.parent.off(events.resetInfiniteBlocks, this.resetInfiniteBlocks);\n        this.parent.off(events.setInfiniteCache, this.setCache);\n        this.parent.off(events.initialCollapse, this.ensureIntialCollapse);\n        this.parent.off(events.keyPressed, this.infiniteCellFocus);\n        this.parent.off(events.infiniteShowHide, this.setDisplayNone);\n        this.parent.off(events.virtualScrollEditActionBegin, this.editActionBegin);\n        this.parent.off(events.getVirtualData, this.getVirtualInfiniteData);\n        this.parent.off(events.editReset, this.resetInfiniteEdit);\n        this.parent.off(events.virtualScrollEditSuccess, this.infiniteEditSuccess);\n        this.parent.off(events.refreshVirtualCache, this.refreshInfiniteCache);\n        this.parent.on(events.refreshInfiniteEditrowindex, this.refreshInfiniteEditrowindex);\n        this.parent.off(events.infiniteEditHandler, this.infiniteEditHandler);\n        this.parent.off(events.virtualScrollAddActionBegin, this.infiniteAddActionBegin);\n        this.parent.off(events.modelChanged, this.modelChanged);\n        this.parent.off(events.refreshInfiniteCurrentViewData, this.refreshInfiniteCurrentViewData);\n        this.parent.off(events.destroy, this.destroy);\n        this.parent.off(events.contentReady, this.selectNewRow);\n        this.parent.off(events.captionActionComplete, this.captionActionComplete);\n        this.parent.off(events.setVirtualPageQuery, this.setGroupCollapsePageQuery);\n        this.parent.removeEventListener(events.actionBegin, this.actionBeginFunction);\n        this.parent.removeEventListener(events.actionComplete, this.actionCompleteFunction);\n        this.parent.removeEventListener(events.dataBound, this.dataBoundFunction);\n    };\n    InfiniteScroll.prototype.dataBound = function () {\n        if (this.groupCaptionAction === 'collapse') {\n            this.groupCaptionAction = 'refresh';\n            this.makeGroupCollapseRequest();\n        }\n        else if (this.groupCaptionAction === 'refresh') {\n            this.parent.hideSpinner();\n            this.groupCaptionAction = this.empty;\n        }\n    };\n    InfiniteScroll.prototype.setGroupCollapsePageQuery = function (args) {\n        var gObj = this.parent;\n        if (!gObj.infiniteScrollSettings.enableCache && this.isGroupCollapse) {\n            args.skipPage = true;\n            this.isGroupCollapse = false;\n            if (this.groupCaptionAction === 'collapse') {\n                var captionRow = gObj.getRowObjectFromUID(this.parentCapUid);\n                var rowObjs = gObj.getRowsObject();\n                var childCount = 0;\n                for (var i = rowObjs.length - 1; i >= 0; i--) {\n                    if (rowObjs[i].indent === captionRow.indent) {\n                        break;\n                    }\n                    if (rowObjs[i].isDataRow) {\n                        childCount++;\n                    }\n                }\n                var key = getGroupKeysAndFields(rowObjs.indexOf(captionRow), rowObjs);\n                var pred = generateExpandPredicates(key.fields, key.keys, this);\n                var predicateList = getPredicates(pred);\n                pred = predicateList[predicateList.length - 1];\n                for (var i = predicateList.length - 2; i >= 0; i--) {\n                    pred = pred.and(predicateList[i]);\n                }\n                args.query.where(pred);\n                args.query.skip(childCount);\n                this.parentCapUid = this.empty;\n            }\n            else {\n                var rows = gObj.getRows();\n                var size = gObj.pageSettings.pageSize;\n                var skip = getRowIndexFromElement(rows[rows.length - 1]) + 1;\n                var additionalCnt = ((skip - (skip % size)) + size) - skip;\n                if ((skip % size) === 0) {\n                    additionalCnt = 0;\n                }\n                args.query.skip(skip);\n                args.query.take((gObj.infiniteScrollSettings.initialBlocks * gObj.pageSettings.pageSize) + additionalCnt);\n            }\n        }\n    };\n    InfiniteScroll.prototype.captionActionComplete = function (args) {\n        var gObj = this.parent;\n        if (!gObj.infiniteScrollSettings.enableCache && args.isCollapse) {\n            var contetRect = gObj.getContent().firstElementChild.getBoundingClientRect();\n            var tableReact = gObj.contentModule.getTable().getBoundingClientRect();\n            if (Math.round(tableReact.bottom - gObj.getRowHeight()) <= Math.round(contetRect.bottom)) {\n                this.parentCapUid = args.parentUid;\n                this.groupCaptionAction = 'collapse';\n                gObj.showSpinner();\n                var caption = gObj.getRowObjectFromUID(args.parentUid);\n                var childCount = this.getCaptionChildCount(caption);\n                if (!childCount) {\n                    this.groupCaptionAction = 'refresh';\n                    this.makeGroupCollapseRequest();\n                }\n                else {\n                    this.makeGroupCollapseRequest(args.parentUid);\n                }\n            }\n        }\n    };\n    InfiniteScroll.prototype.makeGroupCollapseRequest = function (parentUid) {\n        var gObj = this.parent;\n        var rows = gObj.getRows();\n        var index = getRowIndexFromElement(rows[rows.length - 1]);\n        var prevPage = this.parent.pageSettings.currentPage;\n        this.parent.pageSettings.currentPage = Math.ceil(index / this.parent.pageSettings.pageSize) + 1;\n        if (this.parent.pageSettings.currentPage > this.maxPage) {\n            gObj.hideSpinner();\n            return;\n        }\n        var scrollArg = {\n            requestType: 'infiniteScroll',\n            currentPage: this.parent.pageSettings.currentPage,\n            prevPage: prevPage,\n            startIndex: index + 1,\n            direction: 'down',\n            isCaptionCollapse: true,\n            parentUid: parentUid\n        };\n        this.isGroupCollapse = true;\n        this.parent.notify('model-changed', scrollArg);\n    };\n    InfiniteScroll.prototype.getCaptionChildCount = function (caption) {\n        var rowObj = this.parent.getRowsObject();\n        var index = rowObj.indexOf(caption);\n        var make = false;\n        for (var i = index; i < rowObj.length; i++) {\n            if ((rowObj[i].indent === caption.indent || rowObj[i].indent < caption.indent)\n                && rowObj[i].data.key !== caption.data.key) {\n                break;\n            }\n            if (rowObj[i].isCaptionRow && !this.childCheck(rowObj, rowObj[i], i)) {\n                make = true;\n                break;\n            }\n        }\n        return make;\n    };\n    InfiniteScroll.prototype.childCheck = function (rowObj, row, index) {\n        var childCount = 0;\n        for (var i = index + 1; i < rowObj.length; i++) {\n            if (rowObj[i].indent === row.indent) {\n                break;\n            }\n            if (rowObj[i].indent === (row.indent + 1) && rowObj[i].parentUid === row.uid) {\n                childCount++;\n            }\n        }\n        return row.data.count === childCount;\n    };\n    InfiniteScroll.prototype.updateCurrentViewData = function () {\n        var gObj = this.parent;\n        if (gObj.groupSettings.columns.length) {\n            return;\n        }\n        var keys = Object.keys(this.infiniteCurrentViewData);\n        gObj.currentViewData = [];\n        var page = gObj.pageSettings.currentPage;\n        var isCache = gObj.infiniteScrollSettings.enableCache;\n        var blocks = gObj.infiniteScrollSettings.maxBlocks;\n        var isMiddlePage = isCache && (page > blocks || (this.isUpScroll && page > 1));\n        var start = isMiddlePage ? this.isUpScroll ? page : (page - blocks) + 1 : 1;\n        var end = isMiddlePage ? (start + blocks) - 1 : isCache ? blocks : keys.length;\n        for (var i = start; i <= end; i++) {\n            if (this.infiniteCurrentViewData[i]) {\n                gObj.currentViewData = gObj.currentViewData.concat(this.infiniteCurrentViewData[i]);\n            }\n        }\n    };\n    InfiniteScroll.prototype.refreshInfiniteCurrentViewData = function (e) {\n        var page = this.parent.pageSettings.currentPage;\n        var size = this.parent.pageSettings.pageSize;\n        var blocks = this.parent.infiniteScrollSettings.initialBlocks;\n        var keys = Object.keys(this.infiniteCurrentViewData);\n        var cache = this.parent.infiniteScrollSettings.enableCache;\n        if (!this.parent.groupSettings.columns.length) {\n            var isAdd = e.args.requestType === 'save' && !(this.parent.sortSettings.columns.length\n                || this.parent.filterSettings.columns.length || this.parent.groupSettings.columns.length\n                || this.parent.searchSettings.key);\n            var isDelete = e.args.requestType === 'delete';\n            if (!cache && (isAdd || isDelete)) {\n                if (isAdd) {\n                    var indexCount = 0;\n                    for (var i = 1; i <= keys.length; i++) {\n                        indexCount += this.infiniteCurrentViewData[i].length - 1;\n                        if (e.args.index <= indexCount) {\n                            this.resetCurrentViewData(i);\n                            this.infiniteCurrentViewData[i].splice(e.args.index, 0, e.args.data);\n                            break;\n                        }\n                    }\n                }\n                else {\n                    this.infiniteCurrentViewData[keys[keys.length - 1]].push(e.data[0]);\n                }\n            }\n            else {\n                if (blocks > 1 && e.data.length === (blocks * size)) {\n                    this.setInitialCache(e.data.slice(), {}, cache && e.args.requestType === 'delete', true);\n                }\n                else {\n                    this.infiniteCurrentViewData[page] = e.data.slice();\n                }\n            }\n        }\n    };\n    InfiniteScroll.prototype.resetCurrentViewData = function (startIndex) {\n        var keys = Object.keys(this.infiniteCurrentViewData);\n        for (var i = startIndex; i <= keys.length; i++) {\n            var lastViewData = this.infiniteCurrentViewData[i][this.infiniteCurrentViewData[i].length - 1];\n            if (this.infiniteCurrentViewData[i + 1]) {\n                this.infiniteCurrentViewData[i + 1].splice(0, 0, lastViewData);\n            }\n            this.infiniteCurrentViewData[i].pop();\n        }\n    };\n    InfiniteScroll.prototype.deleteComplate = function () {\n        if (this.parent.isFrozenGrid() && !this.parent.infiniteScrollSettings.enableCache) {\n            this.parent.contentModule.refreshScrollOffset();\n        }\n    };\n    InfiniteScroll.prototype.modelChanged = function (args) {\n        var rows = this.parent.getRows();\n        if (args.requestType === 'save' && args.index && args.data) {\n            this.addRowIndex = args.index;\n        }\n        if (rows && rows.length && args.requestType !== 'infiniteScroll' && (args.requestType === 'delete' || this.requestType === 'add')) {\n            this.firstIndex = getRowIndexFromElement(rows[0]);\n            this.firstBlock = Math.ceil((this.firstIndex + 1) / this.parent.pageSettings.pageSize);\n            this.lastIndex = getRowIndexFromElement(rows[rows.length - 1]);\n            if (args.requestType === 'delete') {\n                var rowObj = this.parent.getRowsObject();\n                args.startIndex = this.parent.infiniteScrollSettings.enableCache\n                    ? (this.firstBlock - 1) * this.parent.pageSettings.pageSize : rowObj[rowObj.length - 1].index;\n            }\n            else {\n                args.startIndex = this.firstIndex;\n            }\n            if (!this.parent.infiniteScrollSettings.enableCache\n                && this.parent.pageSettings.currentPage === this.maxPage && args.requestType === 'delete') {\n                this.isLastPage = true;\n                this.lastIndex = this.lastIndex - 1;\n            }\n        }\n    };\n    InfiniteScroll.prototype.infiniteAddActionBegin = function (args) {\n        if (this.isNormaledit) {\n            this.isAdd = true;\n            if (this.parent.infiniteScrollSettings.enableCache) {\n                if (!Object.keys(this.emptyRowData).length) {\n                    this.createEmptyRowdata();\n                }\n                if (this.parent.pageSettings.currentPage > 1) {\n                    args.startEdit = false;\n                    this.resetInfiniteBlocks({}, true);\n                    this.makeRequest({ currentPage: 1 });\n                }\n            }\n        }\n    };\n    InfiniteScroll.prototype.infiniteEditHandler = function (args) {\n        if (!this.parent.infiniteScrollSettings.enableCache && (args.e.requestType === 'delete'\n            || (args.e.requestType === 'save' && this.requestType === 'add'))) {\n            var frozenCols = this.parent.isFrozenGrid();\n            var rowElms = this.parent.getRows();\n            var rows = this.parent.getRowsObject();\n            if (this.ensureRowAvailability(rows, args.result[0])) {\n                if (rowElms.length && !(this.addRowIndex && this.addRowIndex >= rowElms.length)) {\n                    this.resetRowIndex(rows, args.e, rowElms, this.requestType === 'add', true);\n                    if (frozenCols) {\n                        var rows_1 = this.parent.getMovableRowsObject();\n                        this.resetRowIndex(rows_1, args.e, this.parent.getMovableDataRows(), this.requestType === 'add');\n                        if (this.parent.getFrozenMode() === literals.leftRight) {\n                            var frRows = this.parent.getFrozenRightRowsObject();\n                            this.resetRowIndex(frRows, args.e, this.parent.getFrozenRightRows(), this.requestType === 'add');\n                        }\n                    }\n                }\n                if (!this.isLastPage) {\n                    this.createRow(rows, args);\n                }\n                else {\n                    this.isLastPage = false;\n                    this.parent.pageSettings.currentPage = this.maxPage;\n                    if (this.parent.selectionModule.index < this.parent.frozenRows) {\n                        remove(rowElms[this.parent.frozenRows - 1]);\n                        this.createRow([rows[this.parent.frozenRows - 1]], args, false, true);\n                        if (frozenCols) {\n                            var movableRows = this.parent.getMovableDataRows();\n                            remove(movableRows[this.parent.frozenRows]);\n                            this.createRow([this.parent.getMovableRowsObject()[this.parent.frozenRows - 1]], args, true, true);\n                            if (this.parent.getFrozenMode() === literals.leftRight) {\n                                var rightRows = this.parent.getFrozenRightDataRows();\n                                remove(rightRows[this.parent.frozenRows]);\n                                this.createRow([this.parent.getFrozenRightRowsObject()[this.parent.frozenRows - 1]], args, false, true, true);\n                            }\n                        }\n                        setRowElements(this.parent);\n                    }\n                }\n            }\n            this.parent.hideSpinner();\n            this.parent.notify(events.refreshInfinitePersistSelection, {});\n            if (this.requestType === 'delete') {\n                this.parent.notify(events.deleteComplete, args.e);\n            }\n            else {\n                this.parent.notify(events.saveComplete, args.e);\n            }\n        }\n        this.parent.notify(events.freezeRender, { case: 'refreshHeight' });\n    };\n    InfiniteScroll.prototype.createRow = function (rows, args, isMovable, isFrozenRows, isFrozenRight) {\n        var row = !isFrozenRows ? this.generateRows(args.result, args.e) : rows;\n        var rowRenderer = new RowRenderer(this.serviceLocator, null, this.parent);\n        if (args.e.requestType === 'save' && args.e.index && args.e.data) {\n            row[0].index = this.addRowIndex;\n            this.addRowIndex = null;\n            if (row[0].index >= rows.length) {\n                return;\n            }\n        }\n        var tbody;\n        if (isFrozenRight) {\n            tbody = this.parent.element.querySelector('.e-frozen-right-content').querySelector(literals.tbody);\n        }\n        else {\n            tbody = !this.parent.isFrozenGrid() ? this.parent.getContent().querySelector(literals.tbody) : isMovable\n                ? this.parent.getMovableVirtualContent().querySelector(literals.tbody)\n                : this.parent.getFrozenVirtualContent().querySelector(literals.tbody);\n        }\n        if (this.parent.frozenRows) {\n            tbody = isFrozenRows && this.requestType !== 'add' || !isFrozenRows && this.requestType === 'add'\n                ? !this.parent.isFrozenGrid() ? this.parent.getHeaderContent().querySelector(literals.tbody)\n                    : isMovable ? this.parent.getMovableVirtualHeader().querySelector(literals.tbody)\n                        : isFrozenRight ? this.parent.element.querySelector('.e-frozen-right-header').querySelector(literals.tbody)\n                            : this.parent.getFrozenVirtualHeader().querySelector(literals.tbody) : tbody;\n        }\n        var notifyArgs = {\n            rows: rows, cancel: false, args: args, isMovable: isMovable,\n            isFrozenRows: isFrozenRows, isFrozenRight: isFrozenRows, row: row\n        };\n        this.parent.notify(events.infiniteCrudCancel, notifyArgs);\n        if (!notifyArgs.cancel) {\n            for (var i = row.length - 1; i >= 0; i--) {\n                if (this.requestType === 'delete') {\n                    tbody.appendChild(rowRenderer.render(row[i], this.parent.getColumns()));\n                }\n                else {\n                    tbody.insertBefore(rowRenderer.render(row[i], this.parent.getColumns()), tbody.rows[(args.e.index)]);\n                }\n            }\n        }\n        if (!isFrozenRows && this.parent.frozenRows\n            && (this.parent.selectionModule.index < this.parent.frozenRows || this.requestType === 'add')) {\n            var rowElems = isMovable ? this.parent.getMovableDataRows() : isFrozenRight ? this.parent.getFrozenRightDataRows()\n                : this.parent.getRows();\n            var index = (isMovable || isFrozenRight) && this.requestType === 'add'\n                ? this.parent.frozenRows : this.parent.frozenRows - 1;\n            remove(rowElems[index]);\n            this.createRow([rows[this.parent.frozenRows - 1]], args, isMovable, true, isFrozenRight);\n        }\n        if (!this.parent.infiniteScrollSettings.enableCache && !isFrozenRows) {\n            if (isFrozenRight) {\n                setRowElements(this.parent);\n                this.parent.contentModule.rightFreezeRows = this.requestType === 'add'\n                    ? row.concat(rows) : rows.concat(row);\n            }\n            else if (!this.parent.isFrozenGrid() || isMovable) {\n                setRowElements(this.parent);\n                this.parent.contentModule.visibleRows = this.requestType === 'add'\n                    ? row.concat(rows) : rows.concat(row);\n                if (this.parent.getFrozenMode() === literals.leftRight) {\n                    args.e.renderMovableContent = true;\n                    this.createRow(this.parent.getFrozenRightRowsObject(), args, false, false, true);\n                }\n            }\n            else {\n                this.parent.contentModule.visibleFrozenRows = this.requestType === 'add'\n                    ? row.concat(rows) : rows.concat(row);\n                args.e.isFrozen = true;\n                this.createRow(this.parent.getMovableRowsObject(), args, true);\n            }\n        }\n    };\n    InfiniteScroll.prototype.ensureRowAvailability = function (rows, data) {\n        var resume = true;\n        if (this.parent.frozenRows && !this.parent.infiniteScrollSettings.enableCache\n            && this.parent.sortSettings.columns && this.requestType === 'add') {\n            var key = this.parent.getPrimaryKeyFieldNames()[0];\n            for (var i = 0; i < rows.length; i++) {\n                if (rows[i].data[key] === data[key]) {\n                    resume = false;\n                    break;\n                }\n            }\n        }\n        return resume;\n    };\n    InfiniteScroll.prototype.generateRows = function (data, args) {\n        return this.rowModelGenerator.generateRows(data, args);\n    };\n    InfiniteScroll.prototype.resetRowIndex = function (rows, args, rowElms, isAdd, isFrozen) {\n        var _this = this;\n        var keyField = this.parent.getPrimaryKeyFieldNames()[0];\n        var isRemove = !(rowElms.length % this.parent.pageSettings.pageSize);\n        if (isAdd) {\n            if (isRemove) {\n                if (isFrozen && !this.parent.groupSettings.columns.length) {\n                    this.swapCurrentViewData(1, true);\n                }\n                remove(rowElms[rows.length - 1]);\n                rowElms.splice(rows.length - 1, 1);\n                rows.splice(rows.length - 1, 1);\n            }\n        }\n        else {\n            rows.filter(function (e, index) {\n                if (e.data[keyField] === args.data[0][keyField]) {\n                    if (isFrozen && !_this.parent.groupSettings.columns.length) {\n                        var page = Math.ceil((index + 1) / _this.parent.pageSettings.pageSize);\n                        _this.resetInfiniteCurrentViewData(page, index);\n                    }\n                    rows.splice(index, 1);\n                    remove(rowElms[index]);\n                    rowElms.splice(index, 1);\n                }\n            });\n        }\n        var startIndex = isAdd ? this.addRowIndex ? this.addRowIndex + 1 : 1 : 0;\n        resetRowIndex(this.parent, rows, rowElms, startIndex, this.addRowIndex ? this.addRowIndex : 0);\n    };\n    InfiniteScroll.prototype.resetInfiniteCurrentViewData = function (page, index) {\n        index = index - ((page - 1) * this.parent.pageSettings.pageSize);\n        this.infiniteCurrentViewData[page].splice(index, 1);\n        this.swapCurrentViewData(page, false);\n    };\n    InfiniteScroll.prototype.swapCurrentViewData = function (page, isAdd) {\n        var keys = Object.keys(this.infiniteCurrentViewData);\n        var end = isAdd ? keys.length + 1 : keys.length;\n        for (var i = page; i < end; i++) {\n            if (this.infiniteCurrentViewData[i + 1]) {\n                var pageIndex = isAdd ? i : i + 1;\n                var index = isAdd ? this.infiniteCurrentViewData[i].length - 1 : 0;\n                var data = this.infiniteCurrentViewData[pageIndex].splice(index, 1);\n                if (isAdd) {\n                    this.infiniteCurrentViewData[i + 1] = data.concat(this.infiniteCurrentViewData[i + 1]);\n                    if ((i + 1) === end - 1) {\n                        this.infiniteCurrentViewData[i + 1].splice(this.infiniteCurrentViewData[i + 1].length - 1, 1);\n                    }\n                }\n                else {\n                    this.infiniteCurrentViewData[i].push(data[0]);\n                }\n            }\n        }\n        this.updateCurrentViewData();\n    };\n    InfiniteScroll.prototype.setDisplayNone = function (args) {\n        if (this.parent.infiniteScrollSettings.enableCache) {\n            var frozenCols = this.parent.isFrozenGrid();\n            var keys = frozenCols ? Object.keys(this.infiniteFrozenCache) : Object.keys(this.infiniteCache);\n            for (var i = 1; i <= keys.length; i++) {\n                var cache = frozenCols ? args.isFreeze ? this.infiniteFrozenCache[i][0]\n                    : this.infiniteFrozenCache[i][1] : this.infiniteCache[i];\n                cache.filter(function (e) {\n                    e.cells[args.index].visible = args.visible === '';\n                });\n            }\n            this.resetContentModuleCache(frozenCols ? this.infiniteFrozenCache : this.infiniteCache);\n        }\n    };\n    InfiniteScroll.prototype.refreshInfiniteCache = function (args) {\n        this.getEditedRowObject().data = args.data;\n    };\n    InfiniteScroll.prototype.refreshInfiniteCacheRowVisibleLength = function (args, currentPage) {\n        var cPageRowArray = args[currentPage];\n        if (this.parent.enableInfiniteScrolling && this.parent.infiniteScrollSettings.enableCache) {\n            var length_1 = 0;\n            var vRowLen = 0;\n            var hRowLen = 0;\n            for (var i = 0; i < cPageRowArray.length; i++) {\n                if (cPageRowArray[i].visible || isNullOrUndefined(cPageRowArray[i].visible)) {\n                    vRowLen++;\n                }\n                else {\n                    hRowLen++;\n                }\n            }\n            if (hRowLen > vRowLen) {\n                length_1 = hRowLen - vRowLen;\n                if (length_1 > vRowLen) {\n                    length_1 = vRowLen;\n                }\n            }\n            else {\n                length_1 = vRowLen - hRowLen;\n                if (length_1 > hRowLen) {\n                    length_1 = hRowLen;\n                }\n            }\n            if (length_1 === 0) {\n                length_1 = 1;\n            }\n            return length_1;\n        }\n        else {\n            return cPageRowArray.length;\n        }\n    };\n    InfiniteScroll.prototype.refreshInfiniteEditrowindex = function (args) {\n        this.editRowIndex = args.index;\n    };\n    InfiniteScroll.prototype.getEditedRowObject = function () {\n        var rowObjects = this.parent.getRowsObject();\n        var editedrow;\n        for (var i = 0; i < rowObjects.length; i++) {\n            if (rowObjects[i].index === this.editRowIndex) {\n                editedrow = rowObjects[i];\n            }\n        }\n        return editedrow;\n    };\n    InfiniteScroll.prototype.infiniteEditSuccess = function (args) {\n        if (this.isNormaledit) {\n            if (!this.isAdd && args.data) {\n                this.updateCurrentViewRecords(args.data);\n            }\n            this.isAdd = false;\n        }\n    };\n    InfiniteScroll.prototype.updateCurrentViewRecords = function (data) {\n        var index = getEditedDataIndex(this.parent, data);\n        if (!isNullOrUndefined(index)) {\n            this.parent.getCurrentViewRecords()[index] = data;\n        }\n    };\n    InfiniteScroll.prototype.actionBegin = function (args) {\n        if (args.requestType === 'add' || args.requestType === 'delete') {\n            this.requestType = args.requestType;\n        }\n        else if (args.action === 'add' && args.requestType === 'save') {\n            this.requestType = args.action;\n        }\n        if (this.parent.isFrozenGrid() && !args.cancel && args.requestType === 'searching'\n            || args.requestType === 'sorting' || args.requestType === 'filtering') {\n            this.isInitialRender = true;\n        }\n    };\n    InfiniteScroll.prototype.actionComplete = function (args) {\n        if (args.requestType === 'delete' || args.requestType === 'save' || args.requestType === 'cancel') {\n            this.requestType = this.empty;\n            this.isCancel = args.requestType === 'cancel' || args.requestType === 'save';\n            this.isAdd = this.isEdit = false;\n            if (this.isNormaledit) {\n                this.editRowIndex = this.empty;\n                this.virtualInfiniteData = {};\n                this.parent.editModule.previousVirtualData = {};\n            }\n        }\n    };\n    InfiniteScroll.prototype.resetInfiniteEdit = function () {\n        if (this.parent.enableInfiniteScrolling && this.isNormaledit) {\n            if ((this.parent.editSettings.allowEditing && this.isEdit) || (this.parent.editSettings.allowAdding && this.isAdd)) {\n                this.parent.isEdit = true;\n            }\n        }\n    };\n    InfiniteScroll.prototype.getVirtualInfiniteData = function (data) {\n        this.getVirtualInfiniteEditedData();\n        data.virtualData = this.virtualInfiniteData;\n        data.isAdd = this.isAdd;\n        data.isCancel = this.isCancel;\n    };\n    InfiniteScroll.prototype.editActionBegin = function (e) {\n        this.isEdit = true;\n        this.editRowIndex = e.index;\n        var rowObject = extend({}, this.getEditedRowObject().data);\n        e.data = Object.keys(this.virtualInfiniteData).length ? this.virtualInfiniteData : rowObject;\n    };\n    InfiniteScroll.prototype.dataSourceModified = function () {\n        this.resetInfiniteBlocks({ requestType: this.empty }, true);\n    };\n    InfiniteScroll.prototype.onDataReady = function (e) {\n        if (!isNullOrUndefined(e.count) && e.requestType !== 'infiniteScroll') {\n            this.maxPage = Math.ceil(e.count / this.parent.pageSettings.pageSize);\n        }\n    };\n    InfiniteScroll.prototype.ensureIntialCollapse = function (isExpand) {\n        this.isInitialCollapse = !isExpand;\n    };\n    InfiniteScroll.prototype.infiniteScrollHandler = function (e) {\n        this.restoreInfiniteEdit();\n        this.restoreInfiniteAdd();\n        var targetEle = e.target;\n        var isInfinite = targetEle.classList.contains(literals.content);\n        if (isInfinite && this.parent.enableInfiniteScrolling && !e.isLeft) {\n            var scrollEle = this.parent.getContent().firstElementChild;\n            this.prevScrollTop = scrollEle.scrollTop;\n            var rows = this.parent.getRows();\n            if (!rows.length) {\n                return;\n            }\n            var index = getRowIndexFromElement(rows[rows.length - 1]) + 1;\n            var prevPage = this.parent.pageSettings.currentPage;\n            var args = void 0;\n            var offset = targetEle.scrollHeight - targetEle.scrollTop;\n            var round = Math.round(targetEle.scrollHeight - targetEle.scrollTop);\n            var floor = offset < targetEle.clientHeight ? Math.ceil(offset) : Math.floor(offset);\n            if (floor > targetEle.clientHeight) {\n                floor = floor - 1;\n            }\n            var isBottom = (floor === targetEle.clientHeight || round === targetEle.clientHeight);\n            if (!isNullOrUndefined(this.groupCaptionAction)) {\n                return;\n            }\n            if (this.isScroll && isBottom && (this.parent.pageSettings.currentPage <= this.maxPage - 1 || this.enableContinuousScroll)) {\n                if (this.parent.infiniteScrollSettings.enableCache) {\n                    this.isUpScroll = false;\n                    this.isDownScroll = true;\n                }\n                var rows_2 = [].slice.call(scrollEle.querySelectorAll('.e-row:not(.e-addedrow)'));\n                var row = rows_2[rows_2.length - 1];\n                var rowIndex = getRowIndexFromElement(row);\n                this.parent.pageSettings.currentPage = Math.ceil(rowIndex / this.parent.pageSettings.pageSize) + 1;\n                args = {\n                    requestType: 'infiniteScroll',\n                    currentPage: this.parent.pageSettings.currentPage,\n                    prevPage: prevPage,\n                    startIndex: index,\n                    direction: 'down'\n                };\n                this.makeRequest(args);\n            }\n            if (this.isScroll && this.parent.infiniteScrollSettings.enableCache && targetEle.scrollTop === 0\n                && this.parent.pageSettings.currentPage !== 1) {\n                if (this.parent.infiniteScrollSettings.enableCache) {\n                    this.isDownScroll = false;\n                    this.isUpScroll = true;\n                }\n                var row = [].slice.call(scrollEle.getElementsByClassName(literals.row));\n                var rowIndex = getRowIndexFromElement(row[this.parent.pageSettings.pageSize - 1]);\n                var startIndex = getRowIndexFromElement(row[0]) - this.parent.pageSettings.pageSize;\n                this.parent.pageSettings.currentPage = Math.ceil(rowIndex / this.parent.pageSettings.pageSize) - 1;\n                if (this.parent.pageSettings.currentPage) {\n                    args = {\n                        requestType: 'infiniteScroll',\n                        currentPage: this.parent.pageSettings.currentPage,\n                        prevPage: prevPage,\n                        startIndex: startIndex,\n                        direction: 'up'\n                    };\n                    this.makeRequest(args);\n                }\n            }\n            if (this.parent.infiniteScrollSettings.enableCache && !this.isScroll && isNullOrUndefined(args)) {\n                if (this.isDownScroll || this.isUpScroll) {\n                    scrollEle.scrollTop = this.top;\n                }\n            }\n        }\n    };\n    InfiniteScroll.prototype.makeRequest = function (args) {\n        var _this = this;\n        if (this.parent.pageSettings.currentPage !== args.prevPage) {\n            var initBlocks = this.parent.infiniteScrollSettings.initialBlocks;\n            if (initBlocks < this.maxPage && this.parent.pageSettings.currentPage <= this.maxPage) {\n                this.isInfiniteScroll = true;\n                if (isNullOrUndefined(this.infiniteCache[args.currentPage])) {\n                    setTimeout(function () {\n                        _this.getVirtualInfiniteEditedData();\n                        _this.parent.notify('model-changed', args);\n                    }, 100);\n                }\n                else {\n                    setTimeout(function () {\n                        _this.getVirtualInfiniteEditedData();\n                        _this.parent.notify(events.refreshInfiniteModeBlocks, args);\n                    }, 100);\n                }\n            }\n            else {\n                this.parent.pageSettings.currentPage = this.maxPage;\n            }\n        }\n    };\n    InfiniteScroll.prototype.infinitePageQuery = function (query) {\n        if (this.initialRender) {\n            this.initialRender = false;\n            this.intialPageQuery(query);\n        }\n        else {\n            if (!this.isInfiniteScroll && (this.requestType === 'delete' || this.requestType === 'add')) {\n                this.editPageQuery(query);\n            }\n            else {\n                query.page(this.parent.pageSettings.currentPage, this.parent.pageSettings.pageSize);\n            }\n        }\n    };\n    InfiniteScroll.prototype.editPageQuery = function (query) {\n        var initialBlocks = this.parent.infiniteScrollSettings.initialBlocks;\n        var isCache = this.parent.infiniteScrollSettings.enableCache;\n        if (isCache) {\n            this.infiniteCache = {};\n            this.infiniteFrozenCache = {};\n            this.infiniteCurrentViewData = {};\n            query.skip(this.firstIndex);\n            query.take(initialBlocks * this.parent.pageSettings.pageSize);\n        }\n        else {\n            if (this.parent.editSettings.mode === 'Dialog') {\n                this.parent.clearSelection();\n            }\n            var index = this.requestType === 'delete' ? this.lastIndex : this.addRowIndex ? this.addRowIndex : this.firstIndex;\n            query.skip(index);\n            query.take(1);\n        }\n    };\n    InfiniteScroll.prototype.intialPageQuery = function (query) {\n        if (this.parent.infiniteScrollSettings.enableCache\n            && this.parent.infiniteScrollSettings.initialBlocks > this.parent.infiniteScrollSettings.maxBlocks) {\n            this.parent.infiniteScrollSettings.initialBlocks = this.parent.infiniteScrollSettings.maxBlocks;\n        }\n        var pageSize = this.parent.pageSettings.pageSize * this.parent.infiniteScrollSettings.initialBlocks;\n        query.page(1, pageSize);\n    };\n    InfiniteScroll.prototype.scrollToLastFocusedCell = function (e) {\n        var gObj = this.parent;\n        var rowIdx = this.lastFocusInfo.rowIdx + (e.keyArgs.action === literals.upArrow ? -1 : 1);\n        var cellIdx = this.lastFocusInfo.cellIdx;\n        var row = gObj.getRowByIndex(rowIdx);\n        if (!row) {\n            var rowRenderer = new RowRenderer(this.serviceLocator, null, this.parent);\n            var page = Math.floor(rowIdx / this.parent.pageSettings.pageSize) + 1;\n            gObj.pageSettings.currentPage = page;\n            var cols = gObj.getColumns();\n            remove(gObj.getContent().querySelector('tbody'));\n            gObj.getContent().querySelector('table').appendChild(gObj.createElement('tbody', { attrs: { 'role': 'rowgroup' } }));\n            var focusRows = [];\n            // eslint-disable-next-line @typescript-eslint/tslint/config\n            for (var i = (page === 1 || this.maxPage === page) ? 0 : -1, k = 0; k < gObj.infiniteScrollSettings.maxBlocks; this.maxPage === page ? i-- : i++, k++) {\n                var rows = this.infiniteCache[page + i];\n                if (rows) {\n                    focusRows = focusRows.concat(rows);\n                    for (var j = 0; j < rows.length; j++) {\n                        gObj.getContent().querySelector('tbody').appendChild(rowRenderer.render(rows[j], cols));\n                    }\n                }\n            }\n            gObj.notify(events.contentReady, { rows: focusRows, args: {} });\n            setRowElements(gObj);\n        }\n        row = gObj.getRowByIndex(rowIdx);\n        var target = row.cells[cellIdx];\n        gObj.focusModule.isInfiniteScroll = true;\n        gObj.focusModule.onClick({ target: target }, true);\n        gObj.selectRow(rowIdx);\n        target.focus();\n        this.isFocusScroll = false;\n        e.cancel = true;\n    };\n    InfiniteScroll.prototype.setLastCellFocusInfo = function (e) {\n        var cell = ((e.byClick && e.clickArgs.target) || (e.byKey && e.keyArgs.target)\n            || (!this.isFocusScroll && e).target);\n        if (cell && cell.classList.contains('e-rowcell')) {\n            var cellIdx = parseInt(cell.getAttribute('aria-colindex'), 10);\n            var rowIdx = parseInt(cell.parentElement.getAttribute('aria-rowindex'), 10);\n            this.lastFocusInfo = { rowIdx: rowIdx, cellIdx: cellIdx };\n        }\n    };\n    InfiniteScroll.prototype.infiniteCellFocus = function (e) {\n        var gObj = this.parent;\n        var cache = gObj.infiniteScrollSettings.enableCache;\n        if (e.byKey) {\n            if (cache && this.isFocusScroll) {\n                this.scrollToLastFocusedCell(e);\n                return;\n            }\n            var cell = document.activeElement;\n            var rowIndex = getRowIndexFromElement(cell.parentElement);\n            this.cellIndex = parseInt(cell.getAttribute(literals.ariaColIndex), 10);\n            var content = gObj.getContent().firstElementChild;\n            var totalRowsCount = (this.maxPage * gObj.pageSettings.pageSize) - 1;\n            var visibleRowCount = Math.floor(content.offsetHeight / this.parent.getRowHeight());\n            var contentRect = content.getBoundingClientRect();\n            if (!isNaN(rowIndex)) {\n                if (e.keyArgs.action === literals.downArrow || e.keyArgs.action === literals.enter) {\n                    this.rowIndex = rowIndex += 1;\n                    var row = gObj.getRowByIndex(rowIndex);\n                    var rowRect = row && row.getBoundingClientRect();\n                    if (cache) {\n                        rowIndex = cell.parentElement.rowIndex + 1;\n                    }\n                    if (this.isFocusScroll || (!row && rowIndex < totalRowsCount)\n                        || (rowRect && rowRect.bottom >= contentRect.bottom)) {\n                        if (!this.isFocusScroll) {\n                            this.pressedKey = e.keyArgs.action;\n                        }\n                        this.isFocusScroll = false;\n                        content.scrollTop = ((rowIndex - visibleRowCount) + 1) * this.parent.getRowHeight();\n                    }\n                    else if (!cache && row) {\n                        if (rowRect && (rowRect.bottom >= contentRect.bottom || rowRect.top < contentRect.top)) {\n                            row.cells[this.cellIndex].scrollIntoView();\n                        }\n                    }\n                }\n                else if (e.keyArgs.action === literals.upArrow || e.keyArgs.action === literals.shiftEnter) {\n                    this.rowIndex = rowIndex -= 1;\n                    var row = gObj.getRowByIndex(rowIndex);\n                    var rowRect = row && row.getBoundingClientRect();\n                    if (cache) {\n                        rowIndex = cell.parentElement.rowIndex - 1;\n                    }\n                    if (!row || rowRect.top <= contentRect.top) {\n                        this.pressedKey = e.keyArgs.action;\n                        content.scrollTop = rowIndex * this.parent.getRowHeight();\n                    }\n                }\n            }\n        }\n        else if (e.key === 'PageDown' || e.key === 'PageUp') {\n            this.pressedKey = e.key;\n        }\n        this.setLastCellFocusInfo(e);\n    };\n    InfiniteScroll.prototype.createEmptyRowdata = function () {\n        var _this = this;\n        this.parent.getColumns().filter(function (e) {\n            _this.emptyRowData[e.field] = _this.empty;\n        });\n    };\n    InfiniteScroll.prototype.getVirtualInfiniteEditedData = function () {\n        var editForm = this.parent.element.querySelector('.' + literals.editedRow);\n        var addForm = this.parent.element.querySelector('.' + literals.addedRow);\n        var gridForm = this.parent.element.querySelector('.e-gridform');\n        if (this.parent.infiniteScrollSettings.enableCache && (editForm || addForm)) {\n            var rowData = editForm ? extend({}, this.getEditedRowObject().data)\n                : extend({}, this.emptyRowData);\n            this.virtualInfiniteData = this.parent.editModule.getCurrentEditedData(gridForm, rowData);\n            if (this.parent.isFrozenGrid()) {\n                this.virtualInfiniteData = this.parent.editModule\n                    .getCurrentEditedData(this.parent.getMovableVirtualContent().querySelector('.e-gridform'), rowData);\n            }\n        }\n    };\n    InfiniteScroll.prototype.restoreInfiniteEdit = function () {\n        var content = this.parent.getContent().firstElementChild;\n        var frozenEdit = this.parent.frozenRows ? this.editRowIndex >= this.parent.frozenRows : true;\n        if (this.isNormaledit && this.parent.infiniteScrollSettings.enableCache && frozenEdit) {\n            if (this.parent.editSettings.allowEditing && !isNullOrUndefined(this.editRowIndex)) {\n                var row = this.parent.getRowByIndex(this.editRowIndex);\n                if (Object.keys(this.virtualInfiniteData).length && row && !this.parent.getContent().querySelector('.' + literals.editedRow)) {\n                    var top_1 = row.getBoundingClientRect().top;\n                    if (top_1 < content.offsetHeight && top_1 > this.parent.getRowHeight()) {\n                        this.parent.isEdit = false;\n                        this.parent.editModule.startEdit(row);\n                    }\n                }\n            }\n        }\n    };\n    InfiniteScroll.prototype.restoreInfiniteAdd = function () {\n        var content = this.parent.getContent().firstElementChild;\n        if (this.parent.getCurrentViewRecords().length && this.parent.getRowByIndex(0) && this.isNormaledit &&\n            this.parent.infiniteScrollSettings.enableCache && this.isAdd && !content.querySelector('.' + literals.addedRow)) {\n            var isTop = content.scrollTop < this.parent.getRowHeight();\n            if (isTop) {\n                this.parent.isEdit = false;\n                this.parent.addRecord();\n            }\n        }\n    };\n    InfiniteScroll.prototype.appendInfiniteRows = function (e) {\n        var frozenCols = this.parent.isFrozenGrid();\n        var scrollEle = this.parent.getContent().firstElementChild;\n        var isInfiniteScroll = this.parent.enableInfiniteScrolling && e.args.requestType === 'infiniteScroll';\n        var isMovable = this.parent.getFrozenMode() === literals.leftRight && e.tableName === 'movable';\n        if ((isInfiniteScroll && !e.args.isFrozen && !isMovable) || !isInfiniteScroll) {\n            if (isInfiniteScroll && e.args.direction === 'up') {\n                e.tbody.insertBefore(e.frag, e.tbody.firstElementChild);\n            }\n            else {\n                e.tbody.appendChild(e.frag);\n            }\n        }\n        if (!frozenCols) {\n            this.parent.contentModule.getTable().appendChild(e.tbody);\n            this.updateCurrentViewData();\n        }\n        else {\n            if (isInfiniteScroll) {\n                if (e.tableName === literals.frozenLeft || (this.parent.getFrozenMode() === 'Right' && e.tableName === literals.frozenRight)) {\n                    this.frozenFrag = e.frag;\n                }\n                else if (this.parent.getFrozenMode() === literals.leftRight && e.tableName === 'movable') {\n                    this.movableFrag = e.frag;\n                }\n                else {\n                    var tbody = this.parent.getFrozenVirtualContent().querySelector(literals.tbody);\n                    if (e.args.direction === 'up') {\n                        tbody.insertBefore(this.frozenFrag, tbody.firstElementChild);\n                    }\n                    else {\n                        tbody.appendChild(this.frozenFrag);\n                    }\n                    if (e.tableName === literals.frozenRight) {\n                        this.parent.getMovableVirtualContent().querySelector(literals.tbody).appendChild(this.movableFrag);\n                        this.parent.element.querySelector('.e-frozen-right-content').querySelector(literals.tbody).appendChild(e.frag);\n                    }\n                    else {\n                        this.parent.getMovableVirtualContent().querySelector('.' + literals.table).appendChild(e.tbody);\n                    }\n                    this.parent.contentModule.refreshScrollOffset();\n                    this.updateCurrentViewData();\n                }\n            }\n            else {\n                var table = void 0;\n                if (e.tableName === literals.frozenLeft) {\n                    table = this.parent.getFrozenVirtualContent().querySelector('.' + literals.table);\n                }\n                else if (e.tableName === 'movable') {\n                    table = this.parent.getMovableVirtualContent().querySelector('.' + literals.table);\n                    if (this.parent.getFrozenMode() !== literals.leftRight) {\n                        this.parent.contentModule.refreshScrollOffset();\n                        this.updateCurrentViewData();\n                    }\n                }\n                else {\n                    table = this.parent.element.querySelector('.e-frozen-right-content').querySelector('.' + literals.table);\n                    if (this.parent.getFrozenMode() === literals.leftRight) {\n                        this.parent.contentModule.refreshScrollOffset();\n                        this.updateCurrentViewData();\n                    }\n                }\n                table.appendChild(e.tbody);\n                this.widthService.refreshFrozenScrollbar();\n            }\n        }\n        if (this.isInitialRender && !e.args.isFrozen) {\n            this.isInitialRender = false;\n            this.parent.scrollModule.setHeight();\n        }\n        if (!e.args.isFrozen) {\n            this.rowTop = !this.rowTop ? this.parent.getRows()[0].getBoundingClientRect().top : this.rowTop;\n            if (isInfiniteScroll) {\n                if (this.parent.infiniteScrollSettings.enableCache && this.isRemove) {\n                    scrollEle.scrollTop = this.top;\n                }\n                setRowElements(this.parent);\n            }\n            this.restoreInfiniteAdd();\n            this.isScroll = true;\n        }\n        this.isInfiniteScroll = false;\n    };\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    InfiniteScroll.prototype.selectNewRow = function (args) {\n        var _this = this;\n        var gObj = this.parent;\n        var row = gObj.getRowByIndex(this.rowIndex);\n        var cache = gObj.infiniteScrollSettings.enableCache;\n        if (row && this.keys.some(function (value) { return value === _this.pressedKey; })) {\n            var content = gObj.getContent().firstElementChild;\n            var rowHeight = gObj.getRowHeight();\n            var target = row.cells[this.cellIndex];\n            if ((this.pressedKey === literals.downArrow || this.pressedKey === literals.enter)\n                || (cache && (this.pressedKey === literals.upArrow || this.pressedKey === literals.shiftEnter))) {\n                if (!cache && this.pressedKey !== literals.upArrow && this.pressedKey !== literals.shiftEnter) {\n                    content.scrollTop = content.scrollTop + rowHeight;\n                }\n                gObj.focusModule.isInfiniteScroll = true;\n                gObj.focusModule.onClick({ target: target }, true);\n                gObj.selectRow(this.rowIndex);\n            }\n        }\n        else if (this.lastFocusInfo && (this.pressedKey === literals.pageDown || this.pressedKey === literals.pageUp)) {\n            var idx = cache ? 0 : this.lastFocusInfo.rowIdx;\n            if (gObj.getRowByIndex(idx)) {\n                var target = gObj.getCellFromIndex(idx, this.lastFocusInfo.cellIdx);\n                if (target) {\n                    this.isFocusScroll = true;\n                    if (!cache) {\n                        gObj.focusModule.isInfiniteScroll = true;\n                        gObj.focusModule.onClick({ target: target }, true);\n                    }\n                    else {\n                        target.focus({ preventScroll: true });\n                    }\n                }\n            }\n        }\n        this.pressedKey = undefined;\n    };\n    InfiniteScroll.prototype.removeInfiniteCacheRows = function (e) {\n        var isInfiniteScroll = this.parent.enableInfiniteScrolling && e.args.requestType === 'infiniteScroll';\n        if (!e.args.isFrozen && isInfiniteScroll && this.parent.infiniteScrollSettings.enableCache && this.isRemove) {\n            var rows = [].slice.call(this.parent.getContentTable().getElementsByClassName(literals.row));\n            if (e.args.direction === 'down') {\n                if (this.parent.allowGrouping && this.parent.groupSettings.columns.length) {\n                    var captionRows = [].slice.call(this.parent.getContentTable().querySelectorAll('tr'));\n                    this.removeCaptionRows(captionRows, e.args);\n                }\n                var addRowCount = this.parent.element.querySelector('.' + literals.addedRow) ? 0 : 1;\n                this.removeTopRows(rows, this.parent.pageSettings.pageSize - addRowCount);\n            }\n            if (e.args.direction === 'up') {\n                if (this.parent.allowGrouping && this.parent.groupSettings.columns.length) {\n                    var captionRows = [].slice.call(this.parent.getContentTable().querySelectorAll('tr'));\n                    this.removeCaptionRows(captionRows, e.args);\n                }\n                else {\n                    this.removeBottomRows(rows, rows.length - 1, e.args);\n                }\n            }\n            this.isScroll = false;\n            this.top = this.calculateScrollTop(e.args);\n        }\n    };\n    InfiniteScroll.prototype.calculateScrollTop = function (args) {\n        var top = 0;\n        var scrollCnt = this.parent.getContent().firstElementChild;\n        if (args.direction === 'down') {\n            if (this.parent.allowGrouping && this.parent.groupSettings.columns.length && !this.isInitialCollapse) {\n                top = this.captionRowHeight();\n            }\n            var captionRows = [].slice.call(this.parent.getContent().firstElementChild.querySelectorAll('tr:not(.e-row)'));\n            var captionCount = 0;\n            if (this.isInitialCollapse && !isNullOrUndefined(captionRows)) {\n                captionCount = Math.round((captionRows.length - 1) / this.parent.groupSettings.columns.length);\n            }\n            var value = captionCount ? captionCount\n                : this.parent.pageSettings.pageSize * (this.parent.infiniteScrollSettings.maxBlocks - 1);\n            var currentViewRowCount = 0;\n            var i = 0;\n            while (currentViewRowCount < scrollCnt.clientHeight) {\n                i++;\n                currentViewRowCount = i * this.parent.getRowHeight();\n            }\n            i = i - 1;\n            top += (value - i) * this.parent.getRowHeight();\n        }\n        if (args.direction === 'up') {\n            if (this.parent.allowGrouping && this.parent.groupSettings.columns.length && !this.isInitialCollapse) {\n                var len = this.refreshInfiniteCacheRowVisibleLength(this.infiniteCache, this.parent.pageSettings.currentPage);\n                top = len * this.parent.getRowHeight();\n            }\n            else if (this.isInitialCollapse) {\n                var groupedData = this.infiniteCache[this.parent.pageSettings.currentPage];\n                var count = 0;\n                for (var i = 0; i < groupedData.length; i++) {\n                    if (groupedData[i].isCaptionRow) {\n                        count++;\n                    }\n                }\n                top += Math.round(count / this.parent.groupSettings.columns.length) * this.parent.getRowHeight();\n            }\n            else {\n                top += (this.parent.pageSettings.pageSize * this.parent.getRowHeight() + getScrollBarWidth());\n            }\n        }\n        return top;\n    };\n    InfiniteScroll.prototype.captionRowHeight = function () {\n        var rows = [].slice.call(this.parent.getContent().querySelectorAll('tr:not(.e-row)'));\n        return rows.length * this.parent.getRowHeight();\n    };\n    InfiniteScroll.prototype.removeTopRows = function (rows, maxIndx) {\n        var frozeCols = this.parent.isFrozenGrid();\n        var frRows = this.parent.getFrozenMode() === literals.leftRight\n            ? [].slice.call(this.parent.element.querySelector('.e-frozen-right-content').getElementsByClassName(literals.row)) : null;\n        var movableRows = frozeCols ?\n            [].slice.call(this.parent.getMovableVirtualContent().getElementsByClassName(literals.row)) : null;\n        for (var i = 0; i <= maxIndx; i++) {\n            if (this.parent.frozenRows && this.parent.pageSettings.currentPage === this.parent.infiniteScrollSettings.maxBlocks + 1\n                && i > (maxIndx - this.parent.frozenRows)) {\n                continue;\n            }\n            remove(rows[i]);\n            if (movableRows) {\n                remove(movableRows[i]);\n            }\n            if (frRows) {\n                remove(frRows[i]);\n            }\n        }\n    };\n    InfiniteScroll.prototype.removeBottomRows = function (rows, maxIndx, args) {\n        var cnt = 0;\n        var frozeCols = this.parent.isFrozenGrid();\n        var movableRows = frozeCols ?\n            [].slice.call(this.parent.getMovableVirtualContent().getElementsByClassName(literals.row)) : null;\n        var frRows = this.parent.getFrozenMode() === literals.leftRight ?\n            [].slice.call(this.parent.element.querySelector('.e-frozen-right-content').getElementsByClassName(literals.row)) : null;\n        var pageSize = this.parent.pageSettings.pageSize;\n        if (!frozeCols && this.infiniteCache[args.prevPage].length < pageSize) {\n            cnt = this.parent.pageSettings.pageSize - this.infiniteCache[args.prevPage].length;\n        }\n        if (frozeCols && this.infiniteFrozenCache[args.prevPage][1].length < pageSize) {\n            cnt = this.parent.pageSettings.pageSize - this.infiniteFrozenCache[args.prevPage][1].length;\n        }\n        for (var i = maxIndx; cnt < pageSize; i--) {\n            cnt++;\n            remove(rows[i]);\n            if (movableRows) {\n                remove(movableRows[i]);\n            }\n            if (frRows) {\n                remove(frRows[i]);\n            }\n        }\n    };\n    InfiniteScroll.prototype.removeCaptionRows = function (rows, args) {\n        var rowElements = [].slice.call(this.parent.getContent().getElementsByClassName(literals.row));\n        if (args.direction === 'down') {\n            var lastRow = rowElements[this.parent.pageSettings.pageSize - 1];\n            var lastRowIndex = getRowIndexFromElement(lastRow) - 1;\n            var k = 0;\n            for (var i = 0; k < lastRowIndex; i++) {\n                if (!rows[i].classList.contains(literals.row)) {\n                    remove(rows[i]);\n                }\n                else {\n                    k = getRowIndexFromElement(rows[i]);\n                }\n            }\n        }\n        if (args.direction === 'up') {\n            var lastIndex = getRowIndexFromElement(rowElements[rowElements.length - 1]);\n            var page = Math.ceil(lastIndex / this.parent.pageSettings.pageSize);\n            var startIndex = 0;\n            for (var i = this.parent.pageSettings.currentPage + 1; i < page; i++) {\n                startIndex += this.infiniteCache[i].length;\n            }\n            for (var i = startIndex; i < rows.length; i++) {\n                remove(rows[i]);\n            }\n        }\n    };\n    InfiniteScroll.prototype.resetInfiniteBlocks = function (args, isDataModified) {\n        var isInfiniteScroll = this.parent.enableInfiniteScrolling && args.requestType !== 'infiniteScroll';\n        if (!this.initialRender && !isNullOrUndefined(this.parent.infiniteScrollModule) && isInfiniteScroll) {\n            if (this.actions.some(function (value) { return value === args.requestType; }) || isDataModified || (args.requestType === 'save'\n                && (this.parent.sortSettings.columns.length || this.parent.filterSettings.columns.length\n                    || this.parent.groupSettings.columns.length || this.parent.searchSettings.key))) {\n                var scrollEle = this.parent.getContent().firstElementChild;\n                this.initialRender = true;\n                scrollEle.scrollTop = 0;\n                this.parent.pageSettings.currentPage = 1;\n                this.infiniteCache = this.infiniteFrozenCache = {};\n                this.infiniteCurrentViewData = {};\n                this.resetContentModuleCache({});\n                this.isRemove = false;\n                this.top = 0;\n                this.isInitialMovableRender = true;\n                this.isInitialCollapse = false;\n                this.parent.contentModule.isRemove = this.isRemove;\n                this.parent.contentModule.isAddRows = this.isRemove;\n                this.parent.contentModule.visibleRows = [];\n                this.parent.contentModule.visibleFrozenRows = [];\n            }\n        }\n    };\n    InfiniteScroll.prototype.setCache = function (e) {\n        if (this.parent.enableInfiniteScrolling && this.parent.infiniteScrollSettings.enableCache) {\n            var frozeCols = this.parent.isFrozenGrid();\n            var idx = e.args.isFrozen ? 1 : 0;\n            var isEdit = e.args.requestType !== 'infiniteScroll'\n                && (this.requestType === 'delete' || this.requestType === 'add');\n            var currentPage = this.parent.pageSettings.currentPage;\n            if ((frozeCols && this.isInitialMovableRender) || (!frozeCols && !Object.keys(this.infiniteCache).length) || isEdit) {\n                this.isInitialMovableRender = !e.args.isFrozen;\n                this.setInitialCache(e.modelData, e.args, isEdit);\n            }\n            if (!frozeCols && isNullOrUndefined(this.infiniteCache[this.parent.pageSettings.currentPage])) {\n                this.infiniteCache[this.parent.pageSettings.currentPage] = e.modelData;\n                this.resetContentModuleCache(this.infiniteCache);\n            }\n            if (frozeCols) {\n                if ((idx === 0 && isNullOrUndefined(this.infiniteFrozenCache[currentPage]))\n                    || !this.infiniteFrozenCache[currentPage][idx].length) {\n                    this.createFrozenCache(currentPage);\n                    this.infiniteFrozenCache[currentPage][idx] = e.modelData;\n                    if (idx === 1) {\n                        this.resetContentModuleCache(this.infiniteFrozenCache);\n                    }\n                }\n            }\n            if (e.isInfiniteScroll && !this.isRemove) {\n                this.isRemove = (currentPage - 1) % this.parent.infiniteScrollSettings.maxBlocks === 0;\n                this.parent.contentModule.isRemove = this.isRemove;\n            }\n        }\n    };\n    InfiniteScroll.prototype.setInitialCache = function (data, args, isEdit, isCurrentViewData) {\n        var frozenCols = this.parent.isFrozenGrid();\n        var idx = args.isFrozen ? 1 : 0;\n        var k = !isEdit ? 1 : this.firstBlock;\n        for (var i = 1; i <= this.parent.infiniteScrollSettings.initialBlocks; i++) {\n            var startIndex = (i - 1) * this.parent.pageSettings.pageSize;\n            var endIndex = i * this.parent.pageSettings.pageSize;\n            if (this.parent.allowGrouping && this.parent.groupSettings.columns.length && !isCurrentViewData) {\n                this.setInitialGroupCache(data, k, startIndex, endIndex);\n            }\n            else {\n                if (isCurrentViewData) {\n                    this.infiniteCurrentViewData[k] = data.slice(startIndex, endIndex);\n                }\n                else {\n                    if (frozenCols) {\n                        this.createFrozenCache(k);\n                        this.infiniteFrozenCache[k][idx] = data.slice(startIndex, endIndex);\n                        this.resetContentModuleCache(this.infiniteFrozenCache);\n                    }\n                    else {\n                        this.infiniteCache[k] = data.slice(startIndex, endIndex);\n                        this.resetContentModuleCache(this.infiniteCache);\n                    }\n                }\n            }\n            k++;\n        }\n    };\n    InfiniteScroll.prototype.createFrozenCache = function (index) {\n        if (!this.infiniteFrozenCache[index]) {\n            this.infiniteFrozenCache[index] = [[], []];\n        }\n    };\n    InfiniteScroll.prototype.setInitialGroupCache = function (data, index, sIndex, eIndex) {\n        var pageData = [];\n        var startIndex = 0;\n        for (var i = 1; i <= Object.keys(this.infiniteCache).length; i++) {\n            startIndex += this.infiniteCache[i].length;\n        }\n        var k = sIndex;\n        for (var i = startIndex; i < data.length && k < eIndex; i++) {\n            if (data[i].index < eIndex || data[i].isCaptionRow) {\n                k = data[i].isCaptionRow ? k : data[i].index;\n                pageData.push(data[i]);\n            }\n            if (data[i].index >= eIndex || data[i].index === eIndex - 1) {\n                break;\n            }\n        }\n        this.infiniteCache[index] = pageData;\n        this.resetContentModuleCache(this.infiniteCache);\n    };\n    InfiniteScroll.prototype.resetContentModuleCache = function (data) {\n        this.parent.contentModule\n            .infiniteCache = data;\n    };\n    /**\n     * @returns {void}\n     * @hidden\n     */\n    InfiniteScroll.prototype.destroy = function () {\n        this.removeEventListener();\n    };\n    return InfiniteScroll;\n}());\nexport { InfiniteScroll };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}