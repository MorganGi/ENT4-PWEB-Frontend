{"ast":null,"code":"import { addClass, detach, EventHandler, isNullOrUndefined, select, Ajax, formatUnit } from '@syncfusion/ej2-base';\nimport { Browser, closest, removeClass, isNullOrUndefined as isNOU } from '@syncfusion/ej2-base';\nimport * as events from '../base/constant';\nimport * as classes from '../base/classes';\nimport { Uploader, TextBox } from '@syncfusion/ej2-inputs';\nimport { Popup } from '@syncfusion/ej2-popups';\nimport { Button, CheckBox } from '@syncfusion/ej2-buttons';\nimport { RenderType } from '../base/enum';\nimport { dispatchEvent, parseHtml, hasClass, convertToBlob } from '../base/util';\nimport { isIDevice } from '../../common/util';\n/**\n * `Image` module is used to handle image actions.\n */\n\nvar Image =\n/** @class */\nfunction () {\n  function Image(parent, serviceLocator) {\n    this.isImgUploaded = false;\n    this.isAllowedTypes = true;\n    this.pageX = null;\n    this.pageY = null;\n    this.mousex = null;\n    this.deletedImg = [];\n    this.parent = parent;\n    this.rteID = parent.element.id;\n    this.i10n = serviceLocator.getService('rteLocale');\n    this.rendererFactory = serviceLocator.getService('rendererFactory');\n    this.dialogRenderObj = serviceLocator.getService('dialogRenderObject');\n    this.addEventListener();\n  }\n\n  Image.prototype.addEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.on(events.keyDown, this.onKeyDown, this);\n    this.parent.on(events.keyUp, this.onKeyUp, this);\n    this.parent.on(events.insertImage, this.insertImage, this);\n    this.parent.on(events.showImageDialog, this.showDialog, this);\n    this.parent.on(events.closeImageDialog, this.closeDialog, this);\n    this.parent.on(events.windowResize, this.onWindowResize, this);\n    this.parent.on(events.insertCompleted, this.showImageQuickToolbar, this);\n    this.parent.on(events.clearDialogObj, this.clearDialogObj, this);\n    this.parent.on(events.imageToolbarAction, this.onToolbarAction, this);\n    this.parent.on(events.imageCaption, this.caption, this);\n    this.parent.on(events.imageDelete, this.deleteImg, this);\n    this.parent.on(events.imageLink, this.insertImgLink, this);\n    this.parent.on(events.imageAlt, this.insertAltText, this);\n    this.parent.on(events.editAreaClick, this.editAreaClickHandler, this);\n    this.parent.on(events.iframeMouseDown, this.onIframeMouseDown, this);\n    this.parent.on(events.imageSize, this.imageSize, this);\n    this.parent.on(events.dropDownSelect, this.alignmentSelect, this);\n    this.parent.on(events.initialEnd, this.afterRender, this);\n    this.parent.on(events.dynamicModule, this.afterRender, this);\n    this.parent.on(events.paste, this.imagePaste, this);\n    this.parent.on(events.bindCssClass, this.setCssClass, this);\n    this.parent.on(events.destroy, this.removeEventListener, this);\n  };\n\n  Image.prototype.removeEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.off(events.keyDown, this.onKeyDown);\n    this.parent.off(events.keyUp, this.onKeyUp);\n    this.parent.off(events.windowResize, this.onWindowResize);\n    this.parent.off(events.insertImage, this.insertImage);\n    this.parent.off(events.showImageDialog, this.showDialog);\n    this.parent.off(events.closeImageDialog, this.closeDialog);\n    this.parent.off(events.insertCompleted, this.showImageQuickToolbar);\n    this.parent.off(events.clearDialogObj, this.clearDialogObj);\n    this.parent.off(events.imageCaption, this.caption);\n    this.parent.off(events.imageToolbarAction, this.onToolbarAction);\n    this.parent.off(events.imageDelete, this.deleteImg);\n    this.parent.off(events.imageLink, this.insertImgLink);\n    this.parent.off(events.imageAlt, this.insertAltText);\n    this.parent.off(events.editAreaClick, this.editAreaClickHandler);\n    this.parent.off(events.iframeMouseDown, this.onIframeMouseDown);\n    this.parent.off(events.imageSize, this.imageSize);\n    this.parent.off(events.dropDownSelect, this.alignmentSelect);\n    this.parent.off(events.initialEnd, this.afterRender);\n    this.parent.off(events.dynamicModule, this.afterRender);\n    this.parent.off(events.paste, this.imagePaste);\n    this.parent.off(events.bindCssClass, this.setCssClass);\n    this.parent.off(events.destroy, this.removeEventListener);\n    var dropElement = this.parent.iframeSettings.enable ? this.parent.inputElement.ownerDocument : this.parent.inputElement;\n    dropElement.removeEventListener('drop', this.dragDrop.bind(this), true);\n    dropElement.removeEventListener('dragstart', this.dragStart.bind(this), true);\n    dropElement.removeEventListener('dragenter', this.dragEnter.bind(this), true);\n    dropElement.removeEventListener('dragover', this.dragOver.bind(this), true);\n\n    if (!isNullOrUndefined(this.contentModule)) {\n      EventHandler.remove(this.contentModule.getEditPanel(), Browser.touchEndEvent, this.imageClick);\n      this.parent.formatter.editorManager.observer.off(events.checkUndo, this.undoStack);\n\n      if (this.parent.insertImageSettings.resize) {\n        EventHandler.remove(this.parent.contentModule.getEditPanel(), Browser.touchStartEvent, this.resizeStart);\n        EventHandler.remove(this.parent.element.ownerDocument, 'mousedown', this.onDocumentClick);\n        EventHandler.remove(this.contentModule.getEditPanel(), 'cut', this.onCutHandler);\n      }\n    }\n  };\n\n  Image.prototype.updateCss = function (currentObj, e) {\n    if (currentObj && e.cssClass) {\n      if (isNullOrUndefined(e.oldCssClass)) {\n        currentObj.setProperties({\n          cssClass: (currentObj.cssClass + ' ' + e.cssClass).trim()\n        });\n      } else {\n        currentObj.setProperties({\n          cssClass: (currentObj.cssClass.replace(e.oldCssClass, '').trim() + ' ' + e.cssClass).trim()\n        });\n      }\n    }\n  };\n\n  Image.prototype.setCssClass = function (e) {\n    if (this.popupObj && e.cssClass) {\n      if (isNullOrUndefined(e.oldCssClass)) {\n        addClass([this.popupObj.element], e.cssClass);\n      } else {\n        removeClass([this.popupObj.element], e.oldCssClass);\n        addClass([this.popupObj.element], e.cssClass);\n      }\n    }\n\n    this.updateCss(this.checkBoxObj, e);\n    this.updateCss(this.widthNum, e);\n    this.updateCss(this.heightNum, e);\n    this.updateCss(this.uploadObj, e);\n    this.updateCss(this.dialogObj, e);\n  };\n\n  Image.prototype.onIframeMouseDown = function () {\n    if (this.dialogObj) {\n      this.dialogObj.hide({\n        returnValue: true\n      });\n    }\n  };\n\n  Image.prototype.afterRender = function () {\n    this.contentModule = this.rendererFactory.getRenderer(RenderType.Content);\n    EventHandler.add(this.contentModule.getEditPanel(), Browser.touchEndEvent, this.imageClick, this);\n\n    if (this.parent.insertImageSettings.resize) {\n      EventHandler.add(this.parent.contentModule.getEditPanel(), Browser.touchStartEvent, this.resizeStart, this);\n      EventHandler.add(this.parent.element.ownerDocument, 'mousedown', this.onDocumentClick, this);\n      EventHandler.add(this.contentModule.getEditPanel(), 'cut', this.onCutHandler, this);\n    }\n\n    var dropElement = this.parent.iframeSettings.enable ? this.parent.inputElement.ownerDocument : this.parent.inputElement;\n    dropElement.addEventListener('drop', this.dragDrop.bind(this), true);\n    dropElement.addEventListener('dragstart', this.dragStart.bind(this), true);\n    dropElement.addEventListener('dragenter', this.dragOver.bind(this), true);\n    dropElement.addEventListener('dragover', this.dragOver.bind(this), true);\n  };\n\n  Image.prototype.undoStack = function (args) {\n    if (args.subCommand.toLowerCase() === 'undo' || args.subCommand.toLowerCase() === 'redo') {\n      for (var i = 0; i < this.parent.formatter.getUndoRedoStack().length; i++) {\n        var temp = this.parent.createElement('div');\n        var contentElem = parseHtml(this.parent.formatter.getUndoRedoStack()[i].text);\n        temp.appendChild(contentElem);\n        var img = temp.querySelectorAll('img');\n\n        if (temp.querySelector('.e-img-resize') && img.length > 0) {\n          for (var j = 0; j < img.length; j++) {\n            img[j].style.outline = '';\n          }\n\n          detach(temp.querySelector('.e-img-resize'));\n          this.parent.formatter.getUndoRedoStack()[i].text = temp.innerHTML;\n        }\n      }\n    }\n  };\n\n  Image.prototype.resizeEnd = function (e) {\n    this.resizeBtnInit();\n    this.imgEle.parentElement.style.cursor = 'auto';\n\n    if (Browser.isDevice) {\n      removeClass([e.target.parentElement], 'e-mob-span');\n    }\n\n    var args = {\n      event: e,\n      requestType: 'images'\n    };\n    this.parent.trigger(events.resizeStop, args);\n    /* eslint-disable */\n\n    var pageX = this.getPointX(e);\n    var pageY = this.parent.iframeSettings.enable ? window.pageYOffset + this.parent.element.getBoundingClientRect().top + e.clientY : e.pageY;\n    /* eslint-enable */\n\n    this.parent.formatter.editorManager.observer.on(events.checkUndo, this.undoStack, this);\n    this.parent.formatter.saveData();\n  };\n\n  Image.prototype.resizeStart = function (e, ele) {\n    var _this = this;\n\n    if (this.parent.readonly) {\n      return;\n    }\n\n    var target = ele ? ele : e.target;\n    this.prevSelectedImgEle = this.imgEle;\n\n    if (target.tagName === 'IMG') {\n      this.parent.preventDefaultResize(e);\n      var img = target;\n\n      if (this.imgResizeDiv && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n        detach(this.imgResizeDiv);\n      }\n\n      this.imageResize(img);\n    }\n\n    if (target.classList.contains('e-rte-imageboxmark')) {\n      if (this.parent.formatter.getUndoRedoStack().length === 0) {\n        this.parent.formatter.saveData();\n      }\n\n      this.pageX = this.getPointX(e);\n      this.pageY = this.getPointY(e);\n      e.preventDefault();\n      e.stopImmediatePropagation();\n      this.resizeBtnInit();\n\n      if (this.quickToolObj) {\n        this.quickToolObj.imageQTBar.hidePopup();\n      }\n\n      if (target.classList.contains('e-rte-topLeft')) {\n        this.resizeBtnStat.topLeft = true;\n      }\n\n      if (target.classList.contains('e-rte-topRight')) {\n        this.resizeBtnStat.topRight = true;\n      }\n\n      if (target.classList.contains('e-rte-botLeft')) {\n        this.resizeBtnStat.botLeft = true;\n      }\n\n      if (target.classList.contains('e-rte-botRight')) {\n        this.resizeBtnStat.botRight = true;\n      }\n\n      if (Browser.isDevice && this.contentModule.getEditPanel().contains(this.imgResizeDiv) && !this.imgResizeDiv.classList.contains('e-mob-span')) {\n        addClass([this.imgResizeDiv], 'e-mob-span');\n      } else {\n        var args = {\n          event: e,\n          requestType: 'images'\n        };\n        this.parent.trigger(events.resizeStart, args, function (resizeStartArgs) {\n          if (resizeStartArgs.cancel) {\n            _this.cancelResizeAction();\n          }\n        });\n      }\n\n      EventHandler.add(this.contentModule.getDocument(), Browser.touchEndEvent, this.resizeEnd, this);\n    }\n  };\n\n  Image.prototype.imageClick = function (e) {\n    if (Browser.isDevice) {\n      if (e.target.tagName === 'IMG' && e.target.parentElement.tagName === 'A' || e.target.tagName === 'IMG') {\n        this.contentModule.getEditPanel().setAttribute('contenteditable', 'false');\n        e.target.focus();\n      } else {\n        if (!this.parent.readonly) {\n          this.contentModule.getEditPanel().setAttribute('contenteditable', 'true');\n        }\n      }\n    }\n\n    if (e.target.tagName === 'IMG' && e.target.parentElement.tagName === 'A') {\n      e.preventDefault();\n    }\n  };\n\n  Image.prototype.onCutHandler = function () {\n    if (this.imgResizeDiv && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n      this.cancelResizeAction();\n    }\n  };\n\n  Image.prototype.imageResize = function (e) {\n    this.resizeBtnInit();\n    this.imgEle = e;\n    addClass([this.imgEle], 'e-resize');\n    this.imgResizeDiv = this.parent.createElement('span', {\n      className: 'e-img-resize' + ' ' + this.parent.cssClass,\n      id: this.rteID + '_imgResize'\n    });\n    this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n      className: 'e-rte-imageboxmark e-rte-topLeft' + ' ' + this.parent.cssClass,\n      styles: 'cursor: nwse-resize'\n    }));\n    this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n      className: 'e-rte-imageboxmark e-rte-topRight' + ' ' + this.parent.cssClass,\n      styles: 'cursor: nesw-resize'\n    }));\n    this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n      className: 'e-rte-imageboxmark e-rte-botLeft' + ' ' + this.parent.cssClass,\n      styles: 'cursor: nesw-resize'\n    }));\n    this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n      className: 'e-rte-imageboxmark e-rte-botRight' + ' ' + this.parent.cssClass,\n      styles: 'cursor: nwse-resize'\n    }));\n\n    if (Browser.isDevice) {\n      addClass([this.imgResizeDiv], 'e-mob-rte');\n    }\n\n    e.style.outline = '2px solid #4a90e2';\n    this.imgResizePos(e, this.imgResizeDiv);\n    this.resizeImgDupPos(e);\n    this.contentModule.getEditPanel().appendChild(this.imgResizeDiv);\n    EventHandler.add(this.contentModule.getDocument(), Browser.touchMoveEvent, this.resizing, this);\n  };\n\n  Image.prototype.getPointX = function (e) {\n    if (e.touches && e.touches.length) {\n      return e.touches[0].pageX;\n    } else {\n      return e.pageX;\n    }\n  };\n\n  Image.prototype.getPointY = function (e) {\n    if (e.touches && e.touches.length) {\n      return e.touches[0].pageY;\n    } else {\n      return e.pageY;\n    }\n  };\n\n  Image.prototype.imgResizePos = function (e, imgResizeDiv) {\n    var pos = this.calcPos(e);\n    var top = pos.top;\n    var left = pos.left;\n    var imgWid = e.width;\n    var imgHgt = e.height;\n    var borWid = Browser.isDevice ? 4 * parseInt(e.style.outline.slice(-3), 10) + 2 : 2 * parseInt(e.style.outline.slice(-3), 10) + 2; //span border width + image outline width\n\n    var devWid = Browser.isDevice ? 0 : 2; // span border width\n\n    imgResizeDiv.querySelector('.e-rte-botLeft').style.left = left - borWid + 'px';\n    imgResizeDiv.querySelector('.e-rte-botLeft').style.top = imgHgt - borWid + top + 'px';\n    imgResizeDiv.querySelector('.e-rte-botRight').style.left = imgWid - (borWid - devWid) + left + 'px';\n    imgResizeDiv.querySelector('.e-rte-botRight').style.top = imgHgt - borWid + top + 'px';\n    imgResizeDiv.querySelector('.e-rte-topRight').style.left = imgWid - (borWid - devWid) + left + 'px';\n    imgResizeDiv.querySelector('.e-rte-topRight').style.top = top - borWid + 'px';\n    imgResizeDiv.querySelector('.e-rte-topLeft').style.left = left - borWid + 'px';\n    imgResizeDiv.querySelector('.e-rte-topLeft').style.top = top - borWid + 'px';\n  };\n\n  Image.prototype.calcPos = function (elem) {\n    var ignoreOffset = ['TD', 'TH', 'TABLE', 'A'];\n    var parentOffset = {\n      top: 0,\n      left: 0\n    };\n    var elementOffset;\n    var doc = elem.ownerDocument;\n    var offsetParent = (elem.offsetParent && (elem.offsetParent.classList.contains('e-img-caption') || ignoreOffset.indexOf(elem.offsetParent.tagName) > -1) ? closest(elem, '#' + this.parent.getID() + '_rte-edit-view') : elem.offsetParent) || doc.documentElement;\n\n    while (offsetParent && (offsetParent === doc.body || offsetParent === doc.documentElement) && offsetParent.style.position === 'static') {\n      offsetParent = offsetParent.parentNode;\n    }\n\n    if (offsetParent && offsetParent !== elem && offsetParent.nodeType === 1) {\n      // eslint-disable-next-line\n      parentOffset = offsetParent.getBoundingClientRect();\n    }\n\n    if (elem.offsetParent && elem.offsetParent.classList.contains('e-img-caption')) {\n      elementOffset = elem.getBoundingClientRect();\n      return {\n        top: elementOffset.top - parentOffset.top,\n        left: elementOffset.left - parentOffset.left\n      };\n    } else {\n      return {\n        top: elem.offsetTop,\n        left: elem.offsetLeft\n      };\n    }\n  };\n\n  Image.prototype.setAspectRatio = function (img, expectedX, expectedY, e) {\n    if (isNullOrUndefined(img.width)) {\n      return;\n    }\n\n    var width = img.style.width !== '' ? img.style.width.match(/^\\d+(\\.\\d*)?%$/g) ? parseFloat(img.style.width) : parseInt(img.style.width, 10) : img.width;\n    var height = img.style.height !== '' ? parseInt(img.style.height, 10) : img.height;\n\n    if (width > height) {\n      img.style.minWidth = this.parent.insertImageSettings.minWidth === 0 ? '20px' : formatUnit(this.parent.insertImageSettings.minWidth);\n\n      if (this.parent.insertImageSettings.resizeByPercent) {\n        if (parseInt('' + img.getBoundingClientRect().width + '', 10) !== 0 && parseInt('' + width + '', 10) !== 0) {\n          var original = img.offsetWidth + this.mousex;\n          var finalWidthByPerc = original / img.offsetWidth * (parseFloat(img.style.width).toString() == 'NaN' ? img.offsetWidth / parseFloat(getComputedStyle(this.parent.element).width) * 100 : parseFloat(img.style.width));\n          img.style.width = (finalWidthByPerc > 3 ? finalWidthByPerc : 3) + '%';\n        } else {\n          img.style.width = this.pixToPerc(width / height * expectedY, img.previousElementSibling || img.parentElement) + '%';\n        }\n\n        img.style.height = null;\n        img.removeAttribute('height');\n      } else if (img.style.width === '' && img.style.height !== '') {\n        img.style.height = expectedY + 'px';\n      } else if (img.style.width !== '' && img.style.height === '') {\n        var currentWidth = width / height * expectedY + width / height < this.parent.inputElement.getBoundingClientRect().right - 32 ? width / height * expectedY + width / height : this.parent.inputElement.getBoundingClientRect().right - 32;\n        img.style.width = currentWidth.toString() + 'px';\n      } else if (img.style.width !== '') {\n        var currentWidth = width / height * expectedY < this.parent.inputElement.getBoundingClientRect().right - 32 ? width / height * expectedY : this.parent.inputElement.getBoundingClientRect().right - 32;\n        img.style.width = currentWidth + 'px';\n        img.style.height = expectedY + 'px';\n      } else {\n        if (this.parent.iframeSettings.enable) {\n          img.setAttribute('width', (img.width + this.mousex).toString());\n        } else {\n          img.setAttribute('width', (img.offsetWidth + this.mousex).toString());\n        }\n      }\n    } else if (height > width) {\n      if (this.parent.insertImageSettings.resizeByPercent) {\n        if (parseInt('' + img.getBoundingClientRect().width + '', 10) !== 0 && parseInt('' + width + '', 10) !== 0) {\n          var original = img.offsetWidth + this.mousex;\n          var finalWidthByPerc = original / img.offsetWidth * (parseFloat(img.style.width).toString() == 'NaN' ? img.offsetWidth / parseFloat(getComputedStyle(this.parent.element).width) * 100 : parseFloat(img.style.width));\n          img.style.width = (finalWidthByPerc > 3 ? finalWidthByPerc : 3) + '%';\n        } else {\n          img.style.width = this.pixToPerc(expectedX / height * expectedY, img.previousElementSibling || img.parentElement) + '%';\n        }\n\n        img.style.height = null;\n        img.removeAttribute('height');\n      } else if (img.style.width !== '') {\n        img.style.width = expectedX + 'px';\n        img.style.height = height / width * expectedX + 'px';\n      } else {\n        img.setAttribute('width', this.resizeBtnStat.botRight ? (this.getPointX(e.event) - img.getBoundingClientRect().left).toString() : expectedX.toString());\n      }\n    } else {\n      if (this.parent.insertImageSettings.resizeByPercent) {\n        img.style.width = this.pixToPerc(expectedX, img.previousElementSibling || img.parentElement) + '%';\n        img.style.height = null;\n        img.removeAttribute('height');\n      } else {\n        img.style.width = expectedX + 'px';\n        img.style.height = expectedX + 'px';\n      }\n    }\n  };\n\n  Image.prototype.pixToPerc = function (expected, parentEle) {\n    return expected / parseFloat(getComputedStyle(parentEle).width) * 100;\n  };\n\n  Image.prototype.imgDupMouseMove = function (width, height, e) {\n    var _this = this;\n\n    var args = {\n      event: e,\n      requestType: 'images'\n    };\n    this.parent.trigger(events.onResize, args, function (resizingArgs) {\n      if (resizingArgs.cancel) {\n        _this.cancelResizeAction();\n      } else {\n        if (parseInt(_this.parent.insertImageSettings.minWidth, 10) >= parseInt(width, 10) || parseInt(_this.parent.getInsertImgMaxWidth(), 10) <= parseInt(width, 10) && isNOU(_this.imgEle.style.width)) {\n          return;\n        }\n\n        if (!_this.parent.insertImageSettings.resizeByPercent && (parseInt(_this.parent.insertImageSettings.minHeight, 10) >= parseInt(height, 10) || parseInt(_this.parent.insertImageSettings.maxHeight, 10) <= parseInt(height, 10))) {\n          return;\n        }\n\n        _this.imgEle.parentElement.style.cursor = 'pointer';\n\n        _this.setAspectRatio(_this.imgEle, parseInt(width, 10), parseInt(height, 10), args);\n\n        _this.resizeImgDupPos(_this.imgEle);\n\n        _this.imgResizePos(_this.imgEle, _this.imgResizeDiv);\n\n        _this.parent.setContentHeight('', false);\n      }\n    });\n  };\n\n  Image.prototype.resizing = function (e) {\n    if (this.imgEle.offsetWidth >= this.parent.getInsertImgMaxWidth()) {\n      this.imgEle.style.maxHeight = this.imgEle.offsetHeight + 'px';\n    }\n\n    var pageX = this.getPointX(e);\n    var pageY = this.getPointY(e);\n    var mouseX = this.resizeBtnStat.botLeft || this.resizeBtnStat.topLeft ? -(pageX - this.pageX) : pageX - this.pageX;\n    var mouseY = this.resizeBtnStat.topLeft || this.resizeBtnStat.topRight ? -(pageY - this.pageY) : pageY - this.pageY;\n    var width = parseInt(this.imgDupPos.width, 10) + mouseX;\n    var height = parseInt(this.imgDupPos.height, 10) + mouseY;\n    this.mousex = mouseX;\n    this.pageX = pageX;\n    this.pageY = pageY;\n\n    if (this.resizeBtnStat.botRight) {\n      this.imgDupMouseMove(width + 'px', height + 'px', e);\n    } else if (this.resizeBtnStat.botLeft) {\n      this.imgDupMouseMove(width + 'px', height + 'px', e);\n    } else if (this.resizeBtnStat.topRight) {\n      this.imgDupMouseMove(width + 'px', height + 'px', e);\n    } else if (this.resizeBtnStat.topLeft) {\n      this.imgDupMouseMove(width + 'px', height + 'px', e);\n    }\n  };\n\n  Image.prototype.cancelResizeAction = function () {\n    EventHandler.remove(this.contentModule.getDocument(), Browser.touchMoveEvent, this.resizing);\n    EventHandler.remove(this.contentModule.getDocument(), Browser.touchEndEvent, this.resizeEnd);\n\n    if (this.imgEle && this.imgResizeDiv && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n      detach(this.imgResizeDiv);\n      this.imgEle.style.outline = '';\n      this.imgResizeDiv = null;\n      this.pageX = null;\n      this.pageY = null;\n    }\n  };\n\n  Image.prototype.resizeImgDupPos = function (e) {\n    this.imgDupPos = {\n      width: e.style.width !== '' && this.parent.insertImageSettings && !this.parent.insertImageSettings.resizeByPercent ? this.imgEle.style.width : e.width + 'px',\n      height: e.style.height !== '' ? this.imgEle.style.height : e.height + 'px'\n    };\n  };\n\n  Image.prototype.resizeBtnInit = function () {\n    return this.resizeBtnStat = {\n      botLeft: false,\n      botRight: false,\n      topRight: false,\n      topLeft: false\n    };\n  };\n\n  Image.prototype.onToolbarAction = function (args) {\n    if (isIDevice()) {\n      this.parent.notify(events.selectionRestore, {});\n    }\n\n    var item = args.args.item;\n\n    switch (item.subCommand) {\n      case 'Replace':\n        if (this.parent.fileManagerSettings.enable) {\n          this.parent.notify(events.renderFileManager, args);\n        } else {\n          this.parent.notify(events.insertImage, args);\n        }\n\n        break;\n\n      case 'Caption':\n        this.parent.notify(events.imageCaption, args);\n        break;\n\n      case 'InsertLink':\n        this.parent.notify(events.imageLink, args);\n        break;\n\n      case 'AltText':\n        this.parent.notify(events.imageAlt, args);\n        break;\n\n      case 'Remove':\n        this.parent.notify(events.imageDelete, args);\n        break;\n\n      case 'Dimension':\n        this.parent.notify(events.imageSize, args);\n        break;\n\n      case 'OpenImageLink':\n        this.openImgLink(args);\n        break;\n\n      case 'EditImageLink':\n        this.editImgLink(args);\n        break;\n\n      case 'RemoveImageLink':\n        this.removeImgLink(args);\n        break;\n    }\n  };\n\n  Image.prototype.openImgLink = function (e) {\n    var target = e.selectParent[0].parentNode.target === '' ? '_self' : '_blank';\n    this.parent.formatter.process(this.parent, e.args, e.args, {\n      url: e.selectParent[0].parentNode.href,\n      target: target,\n      selectNode: e.selectNode,\n      subCommand: e.args.item.subCommand\n    });\n  };\n\n  Image.prototype.editImgLink = function (e) {\n    var selectParentEle = e.selectParent[0].parentNode;\n    var linkUpdate = this.i10n.getConstant('dialogUpdate');\n    var inputDetails = {\n      url: selectParentEle.href,\n      target: selectParentEle.target,\n      header: 'Edit Link',\n      btnText: linkUpdate\n    };\n    this.insertImgLink(e, inputDetails);\n  };\n\n  Image.prototype.removeImgLink = function (e) {\n    if (Browser.isIE) {\n      this.contentModule.getEditPanel().focus();\n    }\n\n    e.selection.restore();\n    var isCapLink = this.contentModule.getEditPanel().contains(this.captionEle) && select('a', this.captionEle) ? true : false;\n    var selectParent = isCapLink ? [this.captionEle] : [e.selectNode[0].parentElement];\n    this.parent.formatter.process(this.parent, e.args, e.args, {\n      insertElement: e.selectNode[0],\n      selectParent: selectParent,\n      selection: e.selection,\n      subCommand: e.args.item.subCommand\n    });\n\n    if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n      this.quickToolObj.imageQTBar.hidePopup();\n\n      if (!isNullOrUndefined(e.selectParent)) {\n        removeClass([e.selectParent[0]], 'e-img-focus');\n      }\n    }\n\n    if (isCapLink) {\n      select('.e-img-inner', this.captionEle).focus();\n    }\n  };\n\n  Image.prototype.onKeyDown = function (event) {\n    var originalEvent = event.args;\n    var range;\n    var save;\n    var selectNodeEle;\n    var selectParentEle;\n    this.deletedImg = [];\n    var isCursor;\n    var keyCodeValues = [27, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 44, 45, 9, 16, 17, 18, 19, 20, 33, 34, 35, 36, 37, 38, 39, 40, 91, 92, 93, 144, 145, 182, 183];\n\n    if (this.parent.editorMode === 'HTML') {\n      range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n      isCursor = range.startContainer === range.endContainer && range.startOffset === range.endOffset;\n    }\n\n    if (!isCursor && this.parent.editorMode === 'HTML' && keyCodeValues.indexOf(originalEvent.which) < 0) {\n      var nodes = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n\n      for (var i = 0; i < nodes.length; i++) {\n        if (nodes[i].nodeName === 'IMG') {\n          this.deletedImg.push(nodes[i]);\n        }\n      }\n    }\n\n    if (this.parent.editorMode === 'HTML' && (originalEvent.which === 8 && originalEvent.code === 'Backspace' || originalEvent.which === 46 && originalEvent.code === 'Delete')) {\n      var isCursor_1 = range.startContainer === range.endContainer && range.startOffset === range.endOffset;\n\n      if (originalEvent.which === 8 && originalEvent.code === 'Backspace' && isCursor_1) {\n        this.checkImageBack(range);\n      } else if (originalEvent.which === 46 && originalEvent.code === 'Delete' && isCursor_1) {\n        this.checkImageDel(range);\n      }\n    }\n\n    if (!isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection) && originalEvent.code !== 'KeyK') {\n      range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n      save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n      selectNodeEle = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n      selectParentEle = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n\n      if (!originalEvent.ctrlKey && originalEvent.key && (originalEvent.key.length === 1 || originalEvent.action === 'enter') && selectParentEle[0].tagName === 'IMG' && selectParentEle[0].parentElement) {\n        var prev = selectParentEle[0].parentElement.childNodes[0];\n\n        if (this.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n          this.removeResizeEle();\n        }\n\n        this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(), prev, prev, prev.textContent.length, prev.textContent.length);\n        removeClass([selectParentEle[0]], 'e-img-focus');\n        this.quickToolObj.imageQTBar.hidePopup();\n      }\n    }\n\n    if (originalEvent.ctrlKey && (originalEvent.keyCode === 89 || originalEvent.keyCode === 90)) {\n      this.undoStack({\n        subCommand: originalEvent.keyCode === 90 ? 'undo' : 'redo'\n      });\n    }\n\n    if (originalEvent.keyCode === 8 || originalEvent.keyCode === 46) {\n      if (selectNodeEle && selectNodeEle[0].nodeName === 'IMG' && selectNodeEle.length < 1) {\n        originalEvent.preventDefault();\n        var event_1 = {\n          selectNode: selectNodeEle,\n          selection: save,\n          selectParent: selectParentEle,\n          args: {\n            item: {\n              command: 'Images',\n              subCommand: 'Remove'\n            },\n            originalEvent: originalEvent\n          }\n        };\n        this.deleteImg(event_1, originalEvent.keyCode);\n      }\n\n      if (this.parent.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n        this.removeResizeEle();\n      }\n    }\n\n    if (originalEvent.code === 'Backspace') {\n      originalEvent.action = 'backspace';\n    }\n\n    switch (originalEvent.action) {\n      case 'escape':\n        if (!isNullOrUndefined(this.dialogObj)) {\n          this.dialogObj.close();\n        }\n\n        break;\n\n      case 'backspace':\n      case 'delete':\n        for (var i = 0; i < this.deletedImg.length; i++) {\n          var src = this.deletedImg[i].src;\n          this.imageRemovePost(src);\n        }\n\n        if (this.parent.editorMode !== 'Markdown') {\n          if (range.startContainer.nodeType === 3) {\n            if (originalEvent.code === 'Backspace') {\n              if (range.startContainer.previousElementSibling && range.startOffset === 0 && range.startContainer.previousElementSibling.classList.contains(classes.CLS_CAPTION) && range.startContainer.previousElementSibling.classList.contains(classes.CLS_CAPINLINE)) {\n                detach(range.startContainer.previousElementSibling);\n              }\n            } else {\n              if (range.startContainer.nextElementSibling && range.endContainer.textContent.length === range.endOffset && range.startContainer.nextElementSibling.classList.contains(classes.CLS_CAPTION) && range.startContainer.nextElementSibling.classList.contains(classes.CLS_CAPINLINE)) {\n                detach(range.startContainer.nextElementSibling);\n              }\n            }\n          } else if (range.startContainer.nodeType === 1 && range.startContainer.querySelector('.' + classes.CLS_CAPTION + '.' + classes.CLS_CAPINLINE)) {\n            detach(range.startContainer.querySelector('.' + classes.CLS_CAPTION + '.' + classes.CLS_CAPINLINE));\n          } else if (range.startContainer.nodeType === 1 && range.startContainer.querySelector('.' + classes.CLS_CAPTION + '.' + classes.CLS_IMGBREAK)) {\n            detach(range.startContainer.querySelector('.' + classes.CLS_CAPTION + '.' + classes.CLS_IMGBREAK));\n          }\n        }\n\n        break;\n\n      case 'insert-image':\n        this.openDialog(true, originalEvent, save, selectNodeEle, selectParentEle);\n        originalEvent.preventDefault();\n        break;\n    }\n  };\n\n  Image.prototype.openDialog = function (isInternal, event, selection, ele, parentEle) {\n    var range;\n    var save;\n    var selectNodeEle;\n    var selectParentEle;\n\n    if (!isInternal && !isNOU(this.parent.formatter.editorManager.nodeSelection)) {\n      range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n      save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n      selectNodeEle = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n      selectParentEle = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n    } else {\n      save = selection;\n      selectNodeEle = ele;\n      selectParentEle = parentEle;\n    }\n\n    if (this.parent.editorMode === 'HTML') {\n      this.insertImage({\n        args: {\n          item: {\n            command: 'Images',\n            subCommand: 'Image'\n          },\n          originalEvent: event\n        },\n        selectNode: selectNodeEle,\n        selection: save,\n        selectParent: selectParentEle\n      });\n    } else {\n      this.insertImage({\n        args: {\n          item: {\n            command: 'Images',\n            subCommand: 'Image'\n          },\n          originalEvent: event\n        },\n        member: 'image',\n        text: this.parent.formatter.editorManager.markdownSelection.getSelectedText(this.parent.contentModule.getEditPanel()),\n        module: 'Markdown',\n        name: 'insertImage'\n      });\n    }\n  };\n\n  Image.prototype.showDialog = function () {\n    this.openDialog(false);\n    this.setCssClass({\n      cssClass: this.parent.cssClass\n    });\n  };\n\n  Image.prototype.closeDialog = function () {\n    if (this.dialogObj) {\n      this.dialogObj.hide({\n        returnValue: true\n      });\n    }\n  }; // eslint-disable-next-line\n\n\n  Image.prototype.onKeyUp = function (event) {\n    if (!isNOU(this.deletedImg) && this.deletedImg.length > 0) {\n      for (var i = 0; i < this.deletedImg.length; i++) {\n        var args = {\n          element: this.deletedImg[i],\n          src: this.deletedImg[i].getAttribute('src')\n        };\n        this.parent.trigger(events.afterImageDelete, args);\n      }\n    }\n  };\n\n  Image.prototype.checkImageBack = function (range) {\n    if (range.startContainer.nodeName === '#text' && range.startOffset === 0 && !isNOU(range.startContainer.previousSibling) && range.startContainer.previousSibling.nodeName === 'IMG') {\n      this.deletedImg.push(range.startContainer.previousSibling);\n    } else if (range.startContainer.nodeName !== '#text' && !isNOU(range.startContainer.childNodes[range.startOffset - 1]) && range.startContainer.childNodes[range.startOffset - 1].nodeName === 'IMG') {\n      this.deletedImg.push(range.startContainer.childNodes[range.startOffset - 1]);\n    }\n  };\n\n  Image.prototype.checkImageDel = function (range) {\n    if (range.startContainer.nodeName === '#text' && range.startOffset === range.startContainer.textContent.length && !isNOU(range.startContainer.nextSibling) && range.startContainer.nextSibling.nodeName === 'IMG') {\n      this.deletedImg.push(range.startContainer.nextSibling);\n    } else if (range.startContainer.nodeName !== '#text' && !isNOU(range.startContainer.childNodes[range.startOffset]) && range.startContainer.childNodes[range.startOffset].nodeName === 'IMG') {\n      this.deletedImg.push(range.startContainer.childNodes[range.startOffset]);\n    }\n  };\n\n  Image.prototype.alignmentSelect = function (e) {\n    var item = e.item;\n\n    if (!document.body.contains(document.body.querySelector('.e-rte-quick-toolbar')) || item.command !== 'Images') {\n      return;\n    }\n\n    var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n    var selectNodeEle = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n    selectNodeEle = selectNodeEle[0].nodeName === 'IMG' ? selectNodeEle : [this.imgEle];\n    var args = {\n      args: e,\n      selectNode: selectNodeEle\n    };\n\n    if (this.parent.formatter.getUndoRedoStack().length === 0) {\n      this.parent.formatter.saveData();\n    }\n\n    switch (item.subCommand) {\n      case 'JustifyLeft':\n        this.alignImage(args, 'JustifyLeft');\n        break;\n\n      case 'JustifyCenter':\n        this.alignImage(args, 'JustifyCenter');\n        break;\n\n      case 'JustifyRight':\n        this.alignImage(args, 'JustifyRight');\n        break;\n\n      case 'Inline':\n        this.inline(args);\n        break;\n\n      case 'Break':\n        this.break(args);\n        break;\n    }\n\n    if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n      this.quickToolObj.imageQTBar.hidePopup();\n      removeClass([selectNodeEle[0]], 'e-img-focus');\n    }\n\n    this.cancelResizeAction();\n  };\n\n  Image.prototype.imageWithLinkQTBarItemUpdate = function () {\n    var separator;\n    var items = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item');\n\n    for (var i = 0; i < items.length; i++) {\n      if (items[i].getAttribute('title') === this.i10n.getConstant('openLink') || items[i].getAttribute('title') === this.i10n.getConstant('editLink') || items[i].getAttribute('title') === this.i10n.getConstant('removeLink')) {\n        addClass([items[i]], 'e-link-groups');\n        items[i].style.display = 'none';\n      } else if (items[i].getAttribute('title') === 'Insert Link') {\n        items[i].style.display = '';\n      } else if (items[i].classList.contains('e-rte-horizontal-separator')) {\n        // eslint-disable-next-line\n        separator = items[i];\n        detach(items[i]);\n      }\n    }\n\n    var newItems = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item:not(.e-link-groups)');\n    this.quickToolObj.imageQTBar.addQTBarItem(['-'], Math.round(newItems.length / 2));\n  };\n\n  Image.prototype.showImageQuickToolbar = function (e) {\n    var _this = this;\n\n    if (e.type !== 'Images' || isNullOrUndefined(this.parent.quickToolbarModule) || isNullOrUndefined(this.parent.quickToolbarModule.imageQTBar) || isNullOrUndefined(e.args)) {\n      return;\n    }\n\n    this.quickToolObj = this.parent.quickToolbarModule;\n    var args = e.args;\n    var target = e.elements;\n    [].forEach.call(e.elements, function (element, index) {\n      if (index === 0) {\n        target = element;\n      }\n    });\n\n    if (target && !closest(target, 'a')) {\n      this.imageWithLinkQTBarItemUpdate();\n    }\n\n    if (target.nodeName === 'IMG') {\n      addClass([target], ['e-img-focus']);\n    }\n\n    var pageY = this.parent.iframeSettings.enable ? window.pageYOffset + this.parent.element.getBoundingClientRect().top + args.clientY : args.pageY;\n\n    if (this.parent.quickToolbarModule.imageQTBar) {\n      if (e.isNotify) {\n        setTimeout(function () {\n          _this.parent.formatter.editorManager.nodeSelection.Clear(_this.contentModule.getDocument());\n\n          _this.parent.formatter.editorManager.nodeSelection.setSelectionContents(_this.contentModule.getDocument(), target);\n\n          _this.quickToolObj.imageQTBar.showPopup(args.pageX, pageY, target);\n        }, 400);\n      } else {\n        this.quickToolObj.imageQTBar.showPopup(args.pageX, pageY, target);\n      }\n    }\n  };\n\n  Image.prototype.hideImageQuickToolbar = function () {\n    if (!isNullOrUndefined(this.contentModule.getEditPanel().querySelector('.e-img-focus'))) {\n      removeClass([this.contentModule.getEditPanel().querySelector('.e-img-focus')], 'e-img-focus');\n\n      if (this.quickToolObj && this.quickToolObj.imageQTBar && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n        this.quickToolObj.imageQTBar.hidePopup();\n      }\n    }\n  };\n\n  Image.prototype.editAreaClickHandler = function (e) {\n    if (this.parent.readonly) {\n      this.hideImageQuickToolbar();\n      return;\n    }\n\n    var args = e.args;\n    var showOnRightClick = this.parent.quickToolbarSettings.showOnRightClick;\n\n    if (args.which === 2 || showOnRightClick && args.which === 1 || !showOnRightClick && args.which === 3) {\n      if (showOnRightClick && args.which === 1 && !isNullOrUndefined(args.target) && args.target.tagName === 'IMG') {\n        this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument());\n        this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(), args.target);\n      }\n\n      return;\n    }\n\n    if (this.parent.editorMode === 'HTML' && this.parent.quickToolbarModule && this.parent.quickToolbarModule.imageQTBar) {\n      this.quickToolObj = this.parent.quickToolbarModule;\n      var target = args.target;\n      this.contentModule = this.rendererFactory.getRenderer(RenderType.Content);\n      var isPopupOpen = this.quickToolObj.imageQTBar.element.classList.contains('e-rte-pop');\n\n      if (target.nodeName === 'IMG' && this.parent.quickToolbarModule) {\n        if (isPopupOpen) {\n          return;\n        }\n\n        this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument());\n        this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(), target);\n\n        if (isIDevice()) {\n          this.parent.notify(events.selectionSave, e);\n        }\n\n        addClass([target], 'e-img-focus');\n        var items = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item');\n        var separator = void 0;\n\n        if (closest(target, 'a')) {\n          for (var i = 0; i < items.length; i++) {\n            if (items[i].getAttribute('title') === this.i10n.getConstant('openLink') || items[i].getAttribute('title') === this.i10n.getConstant('editLink') || items[i].getAttribute('title') === this.i10n.getConstant('removeLink')) {\n              items[i].style.display = '';\n              removeClass([items[i]], 'e-link-groups');\n            } else if (items[i].getAttribute('title') === 'Insert Link') {\n              items[i].style.display = 'none';\n            } else if (items[i].classList.contains('e-rte-horizontal-separator')) {\n              // eslint-disable-next-line\n              separator = items[i];\n              detach(items[i]);\n            }\n          }\n\n          var newItems = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item:not(.e-link-groups)');\n          this.quickToolObj.imageQTBar.addQTBarItem(['-'], Math.round(newItems.length / 2));\n        } else if (!closest(target, 'a')) {\n          this.imageWithLinkQTBarItemUpdate();\n        }\n\n        this.showImageQuickToolbar({\n          args: args,\n          type: 'Images',\n          elements: [args.target]\n        });\n      } else {\n        this.hideImageQuickToolbar();\n      }\n    }\n  };\n\n  Image.prototype.insertImgLink = function (e, inputDetails) {\n    var _this = this;\n\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n\n    this.imagDialog(e);\n\n    if (!isNullOrUndefined(this.dialogObj)) {\n      var linkWrap = this.parent.createElement('div', {\n        className: 'e-img-linkwrap' + ' ' + this.parent.cssClass\n      });\n      var linkUrl = this.i10n.getConstant('linkurl');\n      var content = '<div class=\"e-rte-field' + ' ' + this.parent.cssClass + '\">' + '<input type=\"text\" data-role =\"none\" class=\"e-input e-img-link' + ' ' + this.parent.cssClass + '\" spellcheck=\"false\" placeholder=\"' + linkUrl + '\"/></div>' + '<div class=\"e-rte-label\"></div>' + '<div class=\"e-rte-field\">' + '<input type=\"checkbox\" class=\"e-rte-linkTarget' + ' ' + this.parent.cssClass + '\"  data-role =\"none\"></div>';\n      var contentElem = parseHtml(content);\n      linkWrap.appendChild(contentElem);\n      var linkTarget = linkWrap.querySelector('.e-rte-linkTarget');\n      var inputLink = linkWrap.querySelector('.e-img-link');\n      var linkOpenLabel = this.i10n.getConstant('linkOpenInNewWindow');\n      this.checkBoxObj = new CheckBox({\n        label: linkOpenLabel,\n        checked: true,\n        enableRtl: this.parent.enableRtl,\n        cssClass: this.parent.cssClass,\n        change: function (e) {\n          if (e.checked) {\n            target_1 = '_blank';\n          } else {\n            target_1 = null;\n          }\n        }\n      });\n      this.checkBoxObj.isStringTemplate = true;\n      this.checkBoxObj.createElement = this.parent.createElement;\n      this.checkBoxObj.appendTo(linkTarget);\n      var target_1 = this.checkBoxObj.checked ? '_blank' : null;\n      var linkUpdate = this.i10n.getConstant('dialogUpdate');\n      var linkargs_1 = {\n        args: e.args,\n        selfImage: this,\n        selection: e.selection,\n        selectNode: e.selectNode,\n        selectParent: e.selectParent,\n        link: inputLink,\n        target: target_1\n      };\n      this.dialogObj.setProperties({\n        height: 'inherit',\n        width: '290px',\n        header: this.parent.localeObj.getConstant('imageInsertLinkHeader'),\n        content: linkWrap,\n        position: {\n          X: 'center',\n          Y: 'center'\n        },\n        buttons: [{\n          // eslint-disable-next-line\n          click: function (e) {\n            _this.insertlink(linkargs_1);\n          },\n          buttonModel: {\n            content: linkUpdate,\n            cssClass: 'e-flat e-update-link' + ' ' + this.parent.cssClass,\n            isPrimary: true\n          }\n        }],\n        cssClass: this.dialogObj.cssClass + ' e-rte-img-link-dialog'\n      });\n\n      if (!isNOU(this.parent.cssClass)) {\n        this.dialogObj.setProperties({\n          cssClass: this.parent.cssClass\n        });\n      }\n\n      if (!isNullOrUndefined(inputDetails)) {\n        inputLink.value = inputDetails.url; // eslint-disable-next-line\n\n        inputDetails.target ? this.checkBoxObj.checked = true : this.checkBoxObj.checked = false;\n        this.dialogObj.header = inputDetails.header;\n      }\n\n      this.dialogObj.element.style.maxHeight = 'inherit';\n      this.dialogObj.content.querySelector('input').focus();\n    }\n  };\n\n  Image.prototype.insertAltText = function (e) {\n    var _this = this;\n\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n\n    this.imagDialog(e);\n    var altText = this.i10n.getConstant('altText');\n\n    if (!isNullOrUndefined(this.dialogObj)) {\n      var altWrap = this.parent.createElement('div', {\n        className: 'e-img-altwrap' + ' ' + this.parent.cssClass\n      });\n      var altHeader = this.i10n.getConstant('alternateHeader');\n      var linkUpdate = this.i10n.getConstant('dialogUpdate');\n      var getAlt = e.selectNode[0].getAttribute('alt') === null ? '' : e.selectNode[0].getAttribute('alt');\n      var content = '<div class=\"e-rte-field' + ' ' + this.parent.cssClass + '\">' + '<input type=\"text\" spellcheck=\"false\" value=\"' + getAlt + '\" class=\"e-input e-img-alt' + ' ' + this.parent.cssClass + '\" placeholder=\"' + altText + '\"/>' + '</div>';\n      var contentElem = parseHtml(content);\n      altWrap.appendChild(contentElem);\n      var inputAlt = altWrap.querySelector('.e-img-alt');\n      var altArgs_1 = {\n        args: e.args,\n        selfImage: this,\n        selection: e.selection,\n        selectNode: e.selectNode,\n        alt: inputAlt\n      };\n      this.dialogObj.setProperties({\n        height: 'inherit',\n        width: '290px',\n        header: altHeader,\n        content: altWrap,\n        position: {\n          X: 'center',\n          Y: 'center'\n        },\n        buttons: [{\n          // eslint-disable-next-line\n          click: function (e) {\n            _this.insertAlt(altArgs_1);\n          },\n          buttonModel: {\n            content: linkUpdate,\n            cssClass: 'e-flat e-update-alt' + ' ' + this.parent.cssClass,\n            isPrimary: true\n          }\n        }],\n        cssClass: this.dialogObj.cssClass + ' e-rte-img-alt-dialog'\n      });\n\n      if (!isNOU(this.parent.cssClass)) {\n        this.dialogObj.setProperties({\n          cssClass: this.parent.cssClass\n        });\n      }\n\n      this.dialogObj.element.style.maxHeight = 'inherit';\n      this.dialogObj.content.querySelector('input').focus();\n    }\n  };\n\n  Image.prototype.insertAlt = function (e) {\n    if (!isNullOrUndefined(e.alt)) {\n      e.selection.restore();\n\n      if (this.parent.formatter.getUndoRedoStack().length === 0) {\n        this.parent.formatter.saveData();\n      }\n\n      var altText = e.alt.value;\n      this.parent.formatter.process(this.parent, e.args, e.args, {\n        altText: altText,\n        selectNode: e.selectNode,\n        subCommand: e.args.item.subCommand\n      });\n      this.dialogObj.hide({\n        returnValue: false\n      });\n    }\n  };\n\n  Image.prototype.insertlink = function (e) {\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n\n    var url = e.link.value;\n\n    if (url === '') {\n      addClass([e.link], 'e-error');\n      e.link.setSelectionRange(0, url.length);\n      e.link.focus();\n      return;\n    }\n\n    if (!this.isUrl(url)) {\n      url = 'http://' + url;\n    } else {\n      removeClass([e.link], 'e-error');\n    }\n\n    var proxy = e.selfImage;\n\n    if (proxy.parent.editorMode === 'HTML') {\n      e.selection.restore();\n    }\n\n    if (proxy.parent.formatter.getUndoRedoStack().length === 0) {\n      proxy.parent.formatter.saveData();\n    }\n\n    if (e.selectNode[0].parentElement.nodeName === 'A') {\n      proxy.parent.formatter.process(proxy.parent, e.args, e.args, {\n        url: url,\n        target: proxy.checkBoxObj.checked ? '_blank' : null,\n        selectNode: e.selectNode,\n        subCommand: e.args.item.subCommand\n      });\n      proxy.dialogObj.hide({\n        returnValue: true\n      });\n      return;\n    }\n\n    proxy.parent.formatter.process(proxy.parent, e.args, e.args, {\n      url: url,\n      target: proxy.checkBoxObj.checked ? '_blank' : null,\n      selectNode: e.selectNode,\n      subCommand: e.args.item.subCommand,\n      selection: e.selection\n    });\n    var captionEle = closest(e.selectNode[0], '.e-img-caption');\n\n    if (captionEle) {\n      select('.e-img-inner', captionEle).focus();\n    }\n\n    if (captionEle) {\n      select('.e-img-inner', captionEle).focus();\n    }\n\n    proxy.dialogObj.hide({\n      returnValue: false\n    });\n  };\n\n  Image.prototype.isUrl = function (url) {\n    // eslint-disable-next-line\n    var regexp = /(ftp|http|https):\\/\\/(\\w+:{0,1}\\w*@)?(\\S+)(:[0-9]+)?(\\/|\\/([\\w#!:.?+=&%@!\\-\\/]))?/gi;\n    return regexp.test(url);\n  };\n\n  Image.prototype.deleteImg = function (e, keyCode) {\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n\n    var args = {\n      element: e.selectNode[0],\n      src: e.selectNode[0].getAttribute('src')\n    };\n\n    if (this.parent.formatter.getUndoRedoStack().length === 0) {\n      this.parent.formatter.saveData();\n    }\n\n    e.selection.restore();\n\n    if (this.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n      this.removeResizeEle();\n    }\n\n    this.parent.formatter.process(this.parent, e.args, e.args, {\n      selectNode: e.selectNode,\n      captionClass: classes.CLS_CAPTION,\n      subCommand: e.args.item.subCommand\n    });\n    this.imageRemovePost(args.src);\n\n    if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n      this.quickToolObj.imageQTBar.hidePopup();\n    }\n\n    this.cancelResizeAction();\n\n    if (isNullOrUndefined(keyCode)) {\n      this.parent.trigger(events.afterImageDelete, args);\n    }\n  };\n\n  Image.prototype.imageRemovePost = function (src) {\n    var proxy = this;\n    var absoluteUrl = '';\n\n    if (isNOU(this.parent.insertImageSettings.removeUrl) || this.parent.insertImageSettings.removeUrl === '') {\n      return;\n    }\n\n    if (src.indexOf('http://') > -1 || src.indexOf('https://') > -1) {\n      absoluteUrl = src;\n    } else {\n      absoluteUrl = new URL(src, document.baseURI).href;\n    }\n\n    this.removingImgName = absoluteUrl.replace(/^.*[\\\\\\/]/, '');\n    var xhr = new XMLHttpRequest();\n    xhr.addEventListener(\"readystatechange\", function () {\n      if (this.readyState == 4 && this.status == 200) {\n        proxy.triggerPost(this.response);\n      }\n    });\n    xhr.open('GET', absoluteUrl);\n    xhr.responseType = 'blob';\n    xhr.send();\n  };\n\n  Image.prototype.triggerPost = function (response) {\n    var removeUrl = this.parent.insertImageSettings.removeUrl;\n\n    if (isNOU(removeUrl) || removeUrl === '') {\n      return;\n    }\n\n    var file = new File([response], this.removingImgName);\n    var ajax = new Ajax(removeUrl, 'POST', true, null);\n    var formData = new FormData();\n    formData.append('UploadFiles', file);\n    ajax.send(formData);\n  };\n\n  Image.prototype.caption = function (e) {\n    var selectNode = e.selectNode[0];\n\n    if (selectNode.nodeName !== 'IMG') {\n      return;\n    }\n\n    e.selection.restore();\n\n    if (this.parent.formatter.getUndoRedoStack().length === 0) {\n      this.parent.formatter.saveData();\n    }\n\n    this.cancelResizeAction();\n    addClass([selectNode], 'e-rte-image');\n    var subCommand = e.args.item ? e.args.item.subCommand : 'Caption';\n\n    if (!isNullOrUndefined(closest(selectNode, '.' + classes.CLS_CAPTION))) {\n      detach(closest(selectNode, '.' + classes.CLS_CAPTION));\n\n      if (Browser.isIE) {\n        this.contentModule.getEditPanel().focus();\n        e.selection.restore();\n      }\n\n      if (selectNode.parentElement.tagName === 'A') {\n        this.parent.formatter.process(this.parent, e.args, e.args, {\n          insertElement: selectNode.parentElement,\n          selectNode: e.selectNode,\n          subCommand: subCommand\n        });\n      } else {\n        this.parent.formatter.process(this.parent, e.args, e.args, {\n          insertElement: selectNode,\n          selectNode: e.selectNode,\n          subCommand: subCommand\n        });\n      }\n    } else {\n      this.captionEle = this.parent.createElement('span', {\n        className: classes.CLS_CAPTION + ' ' + classes.CLS_RTE_CAPTION + ' ' + this.parent.cssClass,\n        attrs: {\n          contenteditable: 'false',\n          draggable: 'false',\n          style: 'width:' + this.parent.insertImageSettings.width\n        }\n      });\n      var imgWrap = this.parent.createElement('span', {\n        className: 'e-img-wrap' + ' ' + this.parent.cssClass\n      });\n      var imgInner = this.parent.createElement('span', {\n        className: 'e-img-inner' + ' ' + this.parent.cssClass,\n        attrs: {\n          contenteditable: 'true'\n        }\n      });\n      var parent_1 = e.selectNode[0].parentElement;\n\n      if (parent_1.tagName === 'A') {\n        parent_1.setAttribute('contenteditable', 'true');\n      }\n\n      imgWrap.appendChild(parent_1.tagName === 'A' ? parent_1 : e.selectNode[0]);\n      imgWrap.appendChild(imgInner);\n      var imgCaption = this.i10n.getConstant('imageCaption');\n      imgInner.innerHTML = imgCaption;\n      this.captionEle.appendChild(imgWrap);\n\n      if (selectNode.classList.contains(classes.CLS_IMGINLINE)) {\n        addClass([this.captionEle], classes.CLS_CAPINLINE);\n      }\n\n      if (selectNode.classList.contains(classes.CLS_IMGBREAK)) {\n        addClass([this.captionEle], classes.CLS_IMGBREAK);\n      }\n\n      if (selectNode.classList.contains(classes.CLS_IMGLEFT)) {\n        addClass([this.captionEle], classes.CLS_IMGLEFT);\n      }\n\n      if (selectNode.classList.contains(classes.CLS_IMGRIGHT)) {\n        addClass([this.captionEle], classes.CLS_IMGRIGHT);\n      }\n\n      if (selectNode.classList.contains(classes.CLS_IMGCENTER)) {\n        addClass([this.captionEle], classes.CLS_IMGCENTER);\n      }\n\n      this.parent.formatter.process(this.parent, e.args, e.args, {\n        insertElement: this.captionEle,\n        selectNode: e.selectNode,\n        subCommand: subCommand\n      });\n      this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(), imgInner.childNodes[0], imgInner.childNodes[0], 0, imgInner.childNodes[0].textContent.length);\n    }\n\n    if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n      this.quickToolObj.imageQTBar.hidePopup();\n      removeClass([selectNode], 'e-img-focus');\n    }\n  };\n\n  Image.prototype.imageSize = function (e) {\n    var _this = this;\n\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n\n    this.imagDialog(e);\n\n    if (!isNullOrUndefined(this.dialogObj)) {\n      var imgSizeHeader = this.i10n.getConstant('imageSizeHeader');\n      var linkUpdate = this.i10n.getConstant('dialogUpdate');\n      var dialogContent = this.imgsizeInput(e);\n      var selectObj_1 = {\n        args: e.args,\n        selfImage: this,\n        selection: e.selection,\n        selectNode: e.selectNode\n      };\n      this.dialogObj.setProperties({\n        height: 'inherit',\n        width: '290px',\n        header: imgSizeHeader,\n        content: dialogContent,\n        position: {\n          X: 'center',\n          Y: 'center'\n        },\n        buttons: [{\n          // eslint-disable-next-line\n          click: function (e) {\n            _this.insertSize(selectObj_1);\n          },\n          buttonModel: {\n            content: linkUpdate,\n            cssClass: 'e-flat e-update-size' + ' ' + this.parent.cssClass,\n            isPrimary: true\n          }\n        }],\n        cssClass: this.dialogObj.cssClass + ' e-rte-img-size-dialog'\n      });\n\n      if (!isNOU(this.parent.cssClass)) {\n        this.dialogObj.setProperties({\n          cssClass: this.parent.cssClass\n        });\n      }\n\n      this.dialogObj.element.style.maxHeight = 'inherit';\n      this.dialogObj.content.querySelector('input').focus();\n    }\n  };\n\n  Image.prototype.break = function (e) {\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n\n    var subCommand = e.args.item ? e.args.item.subCommand : 'Break';\n    this.parent.formatter.process(this.parent, e.args, e.args, {\n      selectNode: e.selectNode,\n      subCommand: subCommand\n    });\n  };\n\n  Image.prototype.inline = function (e) {\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n\n    var subCommand = e.args.item ? e.args.item.subCommand : 'Inline';\n    this.parent.formatter.process(this.parent, e.args, e.args, {\n      selectNode: e.selectNode,\n      subCommand: subCommand\n    });\n  };\n\n  Image.prototype.alignImage = function (e, type) {\n    var subCommand = e.args.item ? e.args.item.subCommand : type;\n    this.parent.formatter.process(this.parent, e.args, e.args, {\n      selectNode: e.selectNode,\n      subCommand: subCommand\n    });\n  };\n\n  Image.prototype.clearDialogObj = function () {\n    if (this.dialogObj) {\n      this.dialogObj.destroy();\n      detach(this.dialogObj.element);\n      this.dialogObj = null;\n    }\n  };\n\n  Image.prototype.imagDialog = function (e) {\n    var _this = this;\n\n    if (this.dialogObj) {\n      this.dialogObj.hide({\n        returnValue: true\n      });\n      return;\n    }\n\n    var imgDialog = this.parent.createElement('div', {\n      className: 'e-rte-img-dialog' + ' ' + this.parent.cssClass,\n      id: this.rteID + '_image'\n    });\n    this.parent.element.appendChild(imgDialog);\n    var imgInsert = this.i10n.getConstant('dialogInsert');\n    var imglinkCancel = this.i10n.getConstant('dialogCancel');\n    var imgHeader = this.i10n.getConstant('imageHeader');\n    var selection = e.selection;\n    var selectObj = {\n      selfImage: this,\n      selection: e.selection,\n      args: e.args,\n      selectParent: e.selectParent\n    };\n    var dialogModel = {\n      header: imgHeader,\n      cssClass: classes.CLS_RTE_ELEMENTS + ' ' + this.parent.cssClass,\n      enableRtl: this.parent.enableRtl,\n      locale: this.parent.locale,\n      showCloseIcon: true,\n      closeOnEscape: true,\n      width: Browser.isDevice ? '290px' : '340px',\n      height: 'inherit',\n      position: {\n        X: 'center',\n        Y: Browser.isDevice ? 'center' : 'top'\n      },\n      isModal: Browser.isDevice,\n      buttons: [{\n        click: this.insertImageUrl.bind(selectObj),\n        buttonModel: {\n          content: imgInsert,\n          cssClass: 'e-flat e-insertImage' + ' ' + this.parent.cssClass,\n          isPrimary: true,\n          disabled: true\n        }\n      }, {\n        click: function (e) {\n          _this.cancelDialog(e);\n        },\n        buttonModel: {\n          cssClass: 'e-flat e-cancel' + ' ' + this.parent.cssClass,\n          content: imglinkCancel\n        }\n      }],\n      target: Browser.isDevice ? document.body : this.parent.element,\n      animationSettings: {\n        effect: 'None'\n      },\n      close: function (event) {\n        if (_this.isImgUploaded) {\n          _this.uploadObj.removing();\n        }\n\n        _this.parent.isBlur = false;\n\n        if (event && event.event.returnValue) {\n          if (_this.parent.editorMode === 'HTML') {\n            selection.restore();\n          } else {\n            _this.parent.formatter.editorManager.markdownSelection.restore(_this.parent.contentModule.getEditPanel());\n          }\n        }\n\n        _this.dialogObj.destroy();\n\n        detach(_this.dialogObj.element);\n\n        _this.dialogRenderObj.close(event);\n\n        _this.dialogObj = null;\n      }\n    };\n    var dialogContent = this.parent.createElement('div', {\n      className: 'e-img-content' + ' ' + this.parent.cssClass\n    });\n\n    if (!isNullOrUndefined(this.parent.insertImageSettings.path) && this.parent.editorMode === 'Markdown' || this.parent.editorMode === 'HTML') {\n      dialogContent.appendChild(this.imgUpload(e));\n    }\n\n    var linkHeader = this.parent.createElement('div', {\n      className: 'e-linkheader' + ' ' + this.parent.cssClass\n    });\n    var linkHeaderText = this.i10n.getConstant('imageLinkHeader');\n\n    if (this.parent.editorMode === 'HTML') {\n      linkHeader.innerHTML = linkHeaderText;\n    } else {\n      linkHeader.innerHTML = this.i10n.getConstant('mdimageLink');\n    }\n\n    dialogContent.appendChild(linkHeader);\n    dialogContent.appendChild(this.imageUrlPopup(e));\n\n    if (e.selectNode && e.selectNode[0].nodeName === 'IMG') {\n      dialogModel.header = this.parent.localeObj.getConstant('editImageHeader');\n      dialogModel.content = dialogContent;\n    } else {\n      dialogModel.content = dialogContent;\n    }\n\n    this.dialogObj = this.dialogRenderObj.render(dialogModel);\n    this.dialogObj.createElement = this.parent.createElement;\n    this.dialogObj.appendTo(imgDialog);\n\n    if (isNullOrUndefined(this.dialogObj)) {\n      return;\n    }\n\n    if (e.selectNode && e.selectNode[0].nodeName === 'IMG' && e.name === 'insertImage') {\n      this.dialogObj.element.querySelector('.e-insertImage').textContent = this.parent.localeObj.getConstant('dialogUpdate');\n    }\n\n    imgDialog.style.maxHeight = 'inherit';\n\n    if (this.quickToolObj) {\n      if (this.quickToolObj.imageQTBar && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n        this.quickToolObj.imageQTBar.hidePopup();\n\n        if (!isNullOrUndefined(e.selectParent)) {\n          removeClass([e.selectParent[0]], 'e-img-focus');\n        }\n      }\n\n      if (this.quickToolObj.inlineQTBar && document.body.contains(this.quickToolObj.inlineQTBar.element)) {\n        this.quickToolObj.inlineQTBar.hidePopup();\n      }\n    }\n  }; // eslint-disable-next-line\n\n\n  Image.prototype.cancelDialog = function (e) {\n    this.parent.isBlur = false;\n    this.dialogObj.hide({\n      returnValue: true\n    });\n\n    if (this.isImgUploaded) {\n      this.uploadObj.removing();\n    }\n  };\n\n  Image.prototype.onDocumentClick = function (e) {\n    var target = e.target;\n\n    if (target.nodeName === 'IMG') {\n      this.imgEle = target;\n    }\n\n    if (target.nodeName !== '#document') {\n      this.parent.currentTarget = e.target;\n    }\n\n    if (!isNullOrUndefined(this.dialogObj) && ( // eslint-disable-next-line\n    !closest(target, '[id=' + \"'\" + this.dialogObj.element.id + \"'\" + ']') && this.parent.toolbarSettings.enable && this.parent.getToolbarElement() && !this.parent.getToolbarElement().contains(e.target) || this.parent.getToolbarElement() && this.parent.getToolbarElement().contains(e.target) && !closest(target, '#' + this.parent.getID() + '_toolbar_Image') && !target.querySelector('#' + this.parent.getID() + '_toolbar_Image'))) {\n      /* eslint-disable */\n      if (e.offsetX > e.target.clientWidth || e.offsetY > e.target.clientHeight) {} else {\n        this.dialogObj.hide({\n          returnValue: true\n        });\n        this.parent.isBlur = true;\n        dispatchEvent(this.parent.element, 'focusout');\n      }\n      /* eslint-enable */\n\n    }\n\n    if (!(this.parent.iframeSettings.enable && !isNOU(this.parent.currentTarget) && this.parent.currentTarget.nodeName === 'IMG') && e.target.tagName !== 'IMG' && this.imgResizeDiv && !(this.quickToolObj && this.quickToolObj.imageQTBar && this.quickToolObj.imageQTBar.element.contains(e.target)) && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n      this.cancelResizeAction();\n    }\n\n    if (this.contentModule.getEditPanel().querySelector('.e-img-resize') && !(this.parent.iframeSettings.enable && this.parent.currentTarget.nodeName === 'IMG')) {\n      if (target.tagName !== 'IMG') {\n        this.removeResizeEle();\n      }\n\n      if (target.tagName !== 'IMG' && !isNOU(this.imgEle)) {\n        this.imgEle.style.outline = '';\n      } else if (!isNOU(this.prevSelectedImgEle) && this.prevSelectedImgEle !== target) {\n        this.prevSelectedImgEle.style.outline = '';\n      }\n    }\n  };\n\n  Image.prototype.removeResizeEle = function () {\n    EventHandler.remove(this.contentModule.getDocument(), Browser.touchMoveEvent, this.resizing);\n    EventHandler.remove(this.contentModule.getDocument(), Browser.touchEndEvent, this.resizeEnd);\n    detach(this.contentModule.getEditPanel().querySelector('.e-img-resize'));\n  };\n\n  Image.prototype.onWindowResize = function () {\n    if (!isNOU(this.contentModule) && !isNOU(this.contentModule.getEditPanel().querySelector('.e-img-resize'))) {\n      this.cancelResizeAction();\n    }\n  }; // eslint-disable-next-line\n\n\n  Image.prototype.imageUrlPopup = function (e) {\n    var _this = this;\n\n    var imgUrl = this.parent.createElement('div', {\n      className: 'imgUrl' + ' ' + this.parent.cssClass\n    });\n    var placeUrl = this.i10n.getConstant('imageUrl');\n    this.inputUrl = this.parent.createElement('input', {\n      className: 'e-input e-img-url' + ' ' + this.parent.cssClass,\n      attrs: {\n        placeholder: placeUrl,\n        spellcheck: 'false'\n      }\n    });\n    this.inputUrl.addEventListener('input', function () {\n      if (!isNOU(_this.inputUrl)) {\n        if (_this.inputUrl.value.length === 0) {\n          _this.dialogObj.getButtons(0).element.disabled = true;\n        } else {\n          _this.dialogObj.getButtons(0).element.removeAttribute('disabled');\n        }\n      }\n    });\n    imgUrl.appendChild(this.inputUrl);\n    return imgUrl;\n  }; // eslint-disable-next-line\n\n\n  Image.prototype.insertImageUrl = function (e) {\n    var proxy = this.selfImage;\n    proxy.isImgUploaded = false;\n    var url = proxy.inputUrl.value;\n\n    if (proxy.parent.formatter.getUndoRedoStack().length === 0) {\n      proxy.parent.formatter.saveData();\n    }\n\n    if (!isNullOrUndefined(proxy.uploadUrl) && proxy.uploadUrl.url !== '') {\n      proxy.uploadUrl.cssClass = proxy.parent.insertImageSettings.display === 'inline' ? classes.CLS_IMGINLINE : classes.CLS_IMGBREAK;\n      proxy.dialogObj.hide({\n        returnValue: false\n      });\n      proxy.parent.formatter.process(proxy.parent, this.args, this.args.originalEvent, proxy.uploadUrl);\n      proxy.uploadUrl.url = '';\n\n      if (proxy.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n        proxy.imgEle.style.outline = '';\n        proxy.removeResizeEle();\n      }\n    } else if (url !== '') {\n      if (proxy.parent.editorMode === 'HTML' && isNullOrUndefined(closest( // eslint-disable-next-line\n      this.selection.range.startContainer.parentNode, '[id=' + \"'\" + proxy.contentModule.getPanel().id + \"'\" + ']'))) {\n        proxy.contentModule.getEditPanel().focus();\n        var range = proxy.parent.formatter.editorManager.nodeSelection.getRange(proxy.contentModule.getDocument());\n        this.selection = proxy.parent.formatter.editorManager.nodeSelection.save(range, proxy.contentModule.getDocument());\n        this.selectParent = proxy.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n      }\n\n      var regex = /[\\w-]+.(jpg|png|jpeg|gif)/g;\n      var matchUrl = !isNullOrUndefined(url.match(regex)) && proxy.parent.editorMode === 'HTML' ? url.match(regex)[0] : '';\n      var value = {\n        cssClass: proxy.parent.insertImageSettings.display === 'inline' ? classes.CLS_IMGINLINE : classes.CLS_IMGBREAK,\n        url: url,\n        selection: this.selection,\n        altText: matchUrl,\n        selectParent: this.selectParent,\n        width: {\n          width: proxy.parent.insertImageSettings.width,\n          minWidth: proxy.parent.insertImageSettings.minWidth,\n          maxWidth: proxy.parent.getInsertImgMaxWidth()\n        },\n        height: {\n          height: proxy.parent.insertImageSettings.height,\n          minHeight: proxy.parent.insertImageSettings.minHeight,\n          maxHeight: proxy.parent.insertImageSettings.maxHeight\n        }\n      };\n      proxy.parent.formatter.process(proxy.parent, this.args, this.args.originalEvent, value);\n      proxy.dialogObj.hide({\n        returnValue: false\n      });\n    }\n  };\n\n  Image.prototype.imgsizeInput = function (e) {\n    var _this = this;\n\n    var selectNode = e.selectNode[0];\n    var imgHeight = this.i10n.getConstant('imageHeight');\n    var imgWidth = this.i10n.getConstant('imageWidth');\n    var imgSizeWrap = this.parent.createElement('div', {\n      className: 'e-img-sizewrap' + ' ' + this.parent.cssClass\n    });\n    var widthVal = isNullOrUndefined(this.changedWidthValue) && (selectNode.style.width.toString() === 'auto' || selectNode.style.width !== '') ? selectNode.style.width : !isNullOrUndefined(this.changedWidthValue) ? this.changedWidthValue : parseInt(selectNode.getClientRects()[0].width.toString(), 10).toString();\n    var heightVal = isNullOrUndefined(this.changedHeightValue) && (selectNode.style.height.toString() === 'auto' || selectNode.style.height !== '') ? selectNode.style.height : !isNullOrUndefined(this.changedHeightValue) ? this.changedHeightValue : parseInt(selectNode.getClientRects()[0].height.toString(), 10).toString();\n    this.changedWidthValue = null;\n    this.changedHeightValue = null;\n    var content = '<div class=\"e-rte-label' + ' ' + this.parent.cssClass + '\"><label>' + imgWidth + '</label></div><div class=\"e-rte-field' + ' ' + this.parent.cssClass + '\"><input type=\"text\" id=\"imgwidth\" class=\"e-img-width' + ' ' + this.parent.cssClass + '\" value=' + widthVal + ' /></div>' + '<div class=\"e-rte-label' + ' ' + this.parent.cssClass + '\">' + '<label>' + imgHeight + '</label></div><div class=\"e-rte-field' + ' ' + this.parent.cssClass + '\"> ' + '<input type=\"text\" id=\"imgheight\" class=\"e-img-height' + ' ' + this.parent.cssClass + '\" value=' + heightVal + ' /></div>';\n    var contentElem = parseHtml(content);\n    imgSizeWrap.appendChild(contentElem);\n    this.widthNum = new TextBox({\n      value: formatUnit(widthVal),\n      enableRtl: this.parent.enableRtl,\n      cssClass: this.parent.cssClass,\n      input: function (e) {\n        _this.inputWidthValue = formatUnit(_this.inputValue(e.value));\n      }\n    });\n    this.widthNum.createElement = this.parent.createElement;\n    this.widthNum.appendTo(imgSizeWrap.querySelector('#imgwidth'));\n    this.heightNum = new TextBox({\n      value: formatUnit(heightVal),\n      enableRtl: this.parent.enableRtl,\n      cssClass: this.parent.cssClass,\n      input: function (e) {\n        _this.inputHeightValue = formatUnit(_this.inputValue(e.value));\n      }\n    });\n    this.heightNum.createElement = this.parent.createElement;\n    this.heightNum.appendTo(imgSizeWrap.querySelector('#imgheight'));\n    return imgSizeWrap;\n  };\n\n  Image.prototype.inputValue = function (value) {\n    if (value === 'auto' || value.indexOf('%') !== -1 || value.indexOf('px') !== -1 || value.match(/(\\d+)/)) {\n      return value;\n    } else {\n      return 'auto';\n    }\n  };\n\n  Image.prototype.insertSize = function (e) {\n    e.selection.restore();\n    var proxy = e.selfImage;\n\n    if (proxy.parent.formatter.getUndoRedoStack().length === 0) {\n      proxy.parent.formatter.saveData();\n    }\n\n    var dialogEle = proxy.dialogObj.element;\n    this.changedWidthValue = this.inputWidthValue;\n    this.changedHeightValue = this.inputHeightValue;\n    var width = dialogEle.querySelector('.e-img-width').value;\n    var height = dialogEle.parentElement.querySelector('.e-img-height').value;\n    proxy.parent.formatter.process(this.parent, e.args, e.args, {\n      width: width,\n      height: height,\n      selectNode: e.selectNode,\n      subCommand: e.args.item.subCommand\n    });\n\n    if (this.imgResizeDiv) {\n      proxy.imgResizePos(e.selectNode[0], this.imgResizeDiv);\n    }\n\n    proxy.dialogObj.hide({\n      returnValue: true\n    });\n  };\n\n  Image.prototype.insertImage = function (e) {\n    this.imagDialog(e);\n\n    if (!isNullOrUndefined(this.dialogObj)) {\n      this.dialogObj.element.style.maxHeight = 'inherit';\n      var dialogContent = this.dialogObj.element.querySelector('.e-img-content');\n\n      if (!isNullOrUndefined(this.parent.insertImageSettings.path) && this.parent.editorMode === 'Markdown' || this.parent.editorMode === 'HTML') {\n        document.getElementById(this.rteID + '_insertImage').focus();\n      } else {\n        dialogContent.querySelector('.e-img-url').focus();\n      }\n    }\n  };\n\n  Image.prototype.imgUpload = function (e) {\n    var _this = this;\n\n    var save;\n    var selectParent; // eslint-disable-next-line\n\n    var proxy = this;\n    var iframe = proxy.parent.iframeSettings.enable;\n\n    if (proxy.parent.editorMode === 'HTML' && (!iframe && isNullOrUndefined(closest(e.selection.range.startContainer.parentNode, '[id=' // eslint-disable-next-line\n    + \"'\" + this.parent.contentModule.getPanel().id + \"'\" + ']')) || iframe && !hasClass(e.selection.range.startContainer.parentNode.ownerDocument.querySelector('body'), 'e-lib'))) {\n      this.contentModule.getEditPanel().focus();\n      var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n      save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n      selectParent = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n    } else {\n      save = e.selection;\n      selectParent = e.selectParent;\n    }\n\n    var uploadParentEle = this.parent.createElement('div', {\n      className: 'e-img-uploadwrap e-droparea' + ' ' + this.parent.cssClass\n    });\n    var deviceImgUpMsg = this.i10n.getConstant('imageDeviceUploadMessage');\n    var imgUpMsg = this.i10n.getConstant('imageUploadMessage');\n    var span = this.parent.createElement('span', {\n      className: 'e-droptext' + ' ' + this.parent.cssClass\n    });\n    var spanMsg = this.parent.createElement('span', {\n      className: 'e-rte-upload-text' + ' ' + this.parent.cssClass,\n      innerHTML: Browser.isDevice ? deviceImgUpMsg : imgUpMsg\n    });\n    span.appendChild(spanMsg);\n    var btnEle = this.parent.createElement('button', {\n      className: 'e-browsebtn' + ' ' + this.parent.cssClass,\n      id: this.rteID + '_insertImage',\n      attrs: {\n        autofocus: 'true',\n        type: 'button'\n      }\n    });\n    span.appendChild(btnEle);\n    uploadParentEle.appendChild(span);\n    var browserMsg = this.i10n.getConstant('browse');\n    this.browseButton = new Button({\n      content: browserMsg,\n      enableRtl: this.parent.enableRtl\n    });\n    this.browseButton.isStringTemplate = true;\n    this.browseButton.createElement = this.parent.createElement;\n    this.browseButton.appendTo(btnEle);\n    var btnClick = Browser.isDevice ? span : btnEle;\n    EventHandler.add(btnClick, 'click', this.fileSelect, this);\n    var uploadEle = this.parent.createElement('input', {\n      id: this.rteID + '_upload',\n      attrs: {\n        type: 'File',\n        name: 'UploadFiles'\n      },\n      className: this.parent.cssClass\n    });\n    uploadParentEle.appendChild(uploadEle);\n    var altText;\n    var rawFile;\n    var selectArgs;\n    var filesData;\n    var beforeUploadArgs;\n    this.uploadObj = new Uploader({\n      asyncSettings: {\n        saveUrl: this.parent.insertImageSettings.saveUrl,\n        removeUrl: this.parent.insertImageSettings.removeUrl\n      },\n      dropArea: span,\n      multiple: false,\n      enableRtl: this.parent.enableRtl,\n      cssClass: this.parent.cssClass,\n      allowedExtensions: this.parent.insertImageSettings.allowedTypes.toString(),\n      selected: function (e) {\n        proxy.isImgUploaded = true;\n        selectArgs = e;\n        filesData = e.filesData;\n\n        if (_this.parent.isServerRendered) {\n          selectArgs = JSON.parse(JSON.stringify(e));\n          e.cancel = true;\n          rawFile = e.filesData;\n          selectArgs.filesData = rawFile;\n        }\n\n        _this.parent.trigger(events.imageSelected, selectArgs, function (selectArgs) {\n          if (!selectArgs.cancel) {\n            _this.checkExtension(selectArgs.filesData[0]);\n\n            altText = selectArgs.filesData[0].name;\n\n            if (_this.parent.editorMode === 'HTML' && isNullOrUndefined(_this.parent.insertImageSettings.path)) {\n              var reader_1 = new FileReader(); // eslint-disable-next-line\n\n              reader_1.addEventListener('load', function (e) {\n                var url = _this.parent.insertImageSettings.saveFormat === 'Base64' ? reader_1.result : URL.createObjectURL(convertToBlob(reader_1.result));\n                proxy.uploadUrl = {\n                  url: url,\n                  selection: save,\n                  altText: altText,\n                  selectParent: selectParent,\n                  width: {\n                    width: proxy.parent.insertImageSettings.width,\n                    minWidth: proxy.parent.insertImageSettings.minWidth,\n                    maxWidth: proxy.parent.getInsertImgMaxWidth()\n                  },\n                  height: {\n                    height: proxy.parent.insertImageSettings.height,\n                    minHeight: proxy.parent.insertImageSettings.minHeight,\n                    maxHeight: proxy.parent.insertImageSettings.maxHeight\n                  }\n                };\n                proxy.inputUrl.setAttribute('disabled', 'true');\n\n                if (isNullOrUndefined(proxy.parent.insertImageSettings.saveUrl) && _this.isAllowedTypes && !isNullOrUndefined(_this.dialogObj)) {\n                  _this.dialogObj.getButtons(0).element.removeAttribute('disabled');\n                }\n              });\n              reader_1.readAsDataURL(selectArgs.filesData[0].rawFile);\n            }\n\n            if (_this.parent.isServerRendered) {\n              /* eslint-disable */\n              _this.uploadObj._internalRenderSelect(selectArgs, rawFile);\n              /* eslint-enable */\n\n            }\n          }\n        });\n      },\n      beforeUpload: function (args) {\n        if (_this.parent.isServerRendered) {\n          beforeUploadArgs = JSON.parse(JSON.stringify(args));\n          beforeUploadArgs.filesData = filesData;\n          args.cancel = true;\n\n          _this.parent.trigger(events.imageUploading, beforeUploadArgs, function (beforeUploadArgs) {\n            if (beforeUploadArgs.cancel) {\n              return;\n            }\n            /* eslint-disable */\n\n\n            _this.uploadObj.currentRequestHeader = beforeUploadArgs.currentRequest ? beforeUploadArgs.currentRequest : _this.uploadObj.currentRequestHeader;\n            _this.uploadObj.customFormDatas = beforeUploadArgs.customFormData && beforeUploadArgs.customFormData.length > 0 ? beforeUploadArgs.customFormData : _this.uploadObj.customFormDatas;\n\n            _this.uploadObj.uploadFiles(rawFile, null);\n            /* eslint-enable */\n\n          });\n        } else {\n          _this.parent.trigger(events.beforeImageUpload, args);\n        }\n      },\n      uploading: function (e) {\n        if (!_this.parent.isServerRendered) {\n          _this.parent.trigger(events.imageUploading, e);\n        }\n      },\n      success: function (e) {\n        _this.parent.trigger(events.imageUploadSuccess, e, function (e) {\n          if (!isNullOrUndefined(_this.parent.insertImageSettings.path)) {\n            var url = _this.parent.insertImageSettings.path + e.file.name; // eslint-disable-next-line\n\n            var value = {\n              url: url,\n              selection: save\n            };\n            proxy.uploadUrl = {\n              url: url,\n              selection: save,\n              altText: altText,\n              selectParent: selectParent,\n              width: {\n                width: proxy.parent.insertImageSettings.width,\n                minWidth: proxy.parent.insertImageSettings.minWidth,\n                maxWidth: proxy.parent.getInsertImgMaxWidth()\n              },\n              height: {\n                height: proxy.parent.insertImageSettings.height,\n                minHeight: proxy.parent.insertImageSettings.minHeight,\n                maxHeight: proxy.parent.insertImageSettings.maxHeight\n              }\n            };\n            proxy.inputUrl.setAttribute('disabled', 'true');\n          }\n\n          if (e.operation === 'upload' && !isNullOrUndefined(_this.dialogObj)) {\n            _this.dialogObj.getButtons(0).element.removeAttribute('disabled');\n          }\n        });\n      },\n      failure: function (e) {\n        _this.parent.trigger(events.imageUploadFailed, e);\n      },\n      removing: function () {\n        // eslint-disable-next-line\n        _this.parent.trigger(events.imageRemoving, e, function (e) {\n          proxy.isImgUploaded = false;\n          _this.dialogObj.getButtons(0).element.disabled = true;\n          proxy.inputUrl.removeAttribute('disabled');\n\n          if (proxy.uploadUrl) {\n            proxy.uploadUrl.url = '';\n          }\n        });\n      }\n    });\n    this.uploadObj.isStringTemplate = true;\n    this.uploadObj.createElement = this.parent.createElement;\n    this.uploadObj.appendTo(uploadEle);\n    return uploadParentEle;\n  };\n\n  Image.prototype.checkExtension = function (e) {\n    if (this.uploadObj.allowedExtensions) {\n      if (this.uploadObj.allowedExtensions.toLocaleLowerCase().indexOf(('.' + e.type).toLocaleLowerCase()) === -1) {\n        this.dialogObj.getButtons(0).element.setAttribute('disabled', 'disabled');\n        this.isAllowedTypes = false;\n      } else {\n        this.isAllowedTypes = true;\n      }\n    }\n  };\n\n  Image.prototype.fileSelect = function () {\n    this.dialogObj.element.getElementsByClassName('e-file-select-wrap')[0].querySelector('button').click();\n    return false;\n  };\n\n  Image.prototype.dragStart = function (e) {\n    if (e.target.nodeName === 'IMG') {\n      this.parent.trigger(events.actionBegin, e, function (actionBeginArgs) {\n        if (actionBeginArgs.cancel) {\n          e.preventDefault();\n        } else {\n          e.dataTransfer.effectAllowed = 'copyMove';\n          e.target.classList.add(classes.CLS_RTE_DRAG_IMAGE);\n        }\n      });\n    } else {\n      return true;\n    }\n  };\n\n  Image.prototype.dragEnter = function (e) {\n    e.dataTransfer.dropEffect = 'copy';\n    e.preventDefault();\n  };\n\n  Image.prototype.dragOver = function (e) {\n    if (Browser.info.name === 'edge' && e.dataTransfer.items[0].type.split('/')[0].indexOf('image') > -1 || Browser.isIE && e.dataTransfer.types[0] === 'Files') {\n      e.preventDefault();\n    } else {\n      return true;\n    }\n  };\n  /**\n   * Used to set range When drop an image\n   *\n   * @param {ImageDropEventArgs} args - specifies the image arguments.\n   * @returns {void}\n   */\n\n\n  Image.prototype.dragDrop = function (args) {\n    var _this = this;\n\n    this.parent.trigger(events.beforeImageDrop, args, function (e) {\n      var imgElement = _this.parent.inputElement.ownerDocument.querySelector('.' + classes.CLS_RTE_DRAG_IMAGE);\n\n      var isImgOrFileDrop = imgElement && imgElement.tagName === 'IMG' || e.dataTransfer.files.length > 0;\n\n      if (!e.cancel && isImgOrFileDrop) {\n        _this.parent.trigger(events.actionBegin, e, function (actionBeginArgs) {\n          if (actionBeginArgs.cancel) {\n            e.preventDefault();\n          } else {\n            if (closest(e.target, '#' + _this.parent.getID() + '_toolbar') || _this.parent.inputElement.contentEditable === 'false') {\n              e.preventDefault();\n              return;\n            }\n\n            if (_this.parent.element.querySelector('.' + classes.CLS_IMG_RESIZE)) {\n              detach(_this.imgResizeDiv);\n            }\n\n            e.preventDefault();\n            var range = void 0;\n\n            if (_this.contentModule.getDocument().caretRangeFromPoint) {\n              //For chrome\n              range = _this.contentModule.getDocument().caretRangeFromPoint(e.clientX, e.clientY);\n            } else if (e.rangeParent) {\n              //For mozilla firefox\n              range = _this.contentModule.getDocument().createRange();\n              range.setStart(e.rangeParent, e.rangeOffset);\n            } else {\n              range = _this.getDropRange(e.clientX, e.clientY); //For internet explorer\n            }\n\n            _this.parent.notify(events.selectRange, {\n              range: range\n            });\n\n            var uploadArea = _this.parent.element.querySelector('.' + classes.CLS_DROPAREA);\n\n            if (uploadArea) {\n              return;\n            }\n\n            _this.insertDragImage(e);\n          }\n        });\n      } else {\n        if (isImgOrFileDrop) {\n          e.preventDefault();\n        }\n      }\n    });\n  };\n  /**\n   * Used to calculate range on internet explorer\n   *\n   * @param {number} x - specifies the x range.\n   * @param {number} y - specifies the y range.\n   * @returns {void}\n   */\n\n\n  Image.prototype.getDropRange = function (x, y) {\n    var startRange = this.contentModule.getDocument().createRange();\n    this.parent.formatter.editorManager.nodeSelection.setRange(this.contentModule.getDocument(), startRange);\n    var elem = this.contentModule.getDocument().elementFromPoint(x, y);\n    var startNode = elem.childNodes.length > 0 ? elem.childNodes[0] : elem;\n    var startCharIndexCharacter = 0;\n\n    if (this.parent.inputElement.firstChild.innerHTML === '<br>') {\n      startRange.setStart(startNode, startCharIndexCharacter);\n      startRange.setEnd(startNode, startCharIndexCharacter);\n    } else {\n      var rangeRect = void 0;\n\n      do {\n        startCharIndexCharacter++;\n        startRange.setStart(startNode, startCharIndexCharacter);\n        startRange.setEnd(startNode, startCharIndexCharacter + 1);\n        rangeRect = startRange.getBoundingClientRect();\n      } while (rangeRect.left < x && startCharIndexCharacter < startNode.length - 1);\n    }\n\n    return startRange;\n  };\n\n  Image.prototype.insertDragImage = function (e) {\n    var _this = this;\n\n    e.preventDefault();\n    var activePopupElement = this.parent.element.querySelector('' + classes.CLS_POPUP_OPEN);\n    this.parent.notify(events.drop, {\n      args: e\n    });\n\n    if (activePopupElement) {\n      activePopupElement.classList.add(classes.CLS_HIDE);\n    }\n\n    var imgElement = this.parent.inputElement.ownerDocument.querySelector('.' + classes.CLS_RTE_DRAG_IMAGE);\n\n    if (e.dataTransfer.files.length > 0 && imgElement === null) {\n      //For external image drag and drop\n      if (e.dataTransfer.files.length > 1) {\n        return;\n      }\n\n      var imgFiles = e.dataTransfer.files;\n      var fileName = imgFiles[0].name;\n      var imgType = fileName.substring(fileName.lastIndexOf('.'));\n      var allowedTypes = this.parent.insertImageSettings.allowedTypes;\n\n      for (var i = 0; i < allowedTypes.length; i++) {\n        if (imgType.toLocaleLowerCase() === allowedTypes[i].toLowerCase()) {\n          if (this.parent.insertImageSettings.saveUrl) {\n            this.onSelect(e);\n          } else {\n            var args = {\n              args: e,\n              text: '',\n              file: imgFiles[0]\n            };\n            e.preventDefault();\n            this.imagePaste(args);\n          }\n        }\n      }\n    } else {\n      //For internal image drag and drop\n      var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n\n      if (imgElement && imgElement.tagName === 'IMG') {\n        if (imgElement.nextElementSibling) {\n          if (imgElement.nextElementSibling.classList.contains(classes.CLS_IMG_INNER)) {\n            range.insertNode(imgElement.parentElement.parentElement);\n          } else {\n            range.insertNode(imgElement);\n          }\n        } else {\n          range.insertNode(imgElement);\n        }\n\n        imgElement.classList.remove(classes.CLS_RTE_DRAG_IMAGE);\n        var imgArgs_1 = {\n          elements: [imgElement]\n        };\n        imgElement.addEventListener('load', function () {\n          _this.parent.trigger(events.actionComplete, imgArgs_1);\n        });\n        this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument());\n        var args = e;\n        this.resizeStart(args, imgElement);\n        this.hideImageQuickToolbar();\n      }\n    }\n  };\n\n  Image.prototype.onSelect = function (args) {\n    var _this = this; // eslint-disable-next-line\n\n\n    var proxy = this;\n    var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n    var parentElement = this.parent.createElement('ul', {\n      className: classes.CLS_UPLOAD_FILES\n    });\n    this.parent.element.appendChild(parentElement);\n    var validFiles = {\n      name: '',\n      size: 0,\n      status: '',\n      statusCode: '',\n      type: '',\n      rawFile: args.dataTransfer.files[0],\n      validationMessages: {}\n    };\n    var imageTag = this.parent.createElement('IMG');\n    imageTag.style.opacity = '0.5';\n    imageTag.classList.add(classes.CLS_RTE_IMAGE);\n    imageTag.classList.add(classes.CLS_IMGINLINE);\n    imageTag.classList.add(classes.CLS_RESIZE);\n    var file = validFiles.rawFile;\n    var reader = new FileReader();\n    reader.addEventListener('load', function () {\n      var url = URL.createObjectURL(convertToBlob(reader.result));\n      imageTag.src = proxy.parent.insertImageSettings.saveFormat === 'Blob' ? url : reader.result;\n    });\n\n    if (file) {\n      reader.readAsDataURL(file);\n    }\n\n    range.insertNode(imageTag);\n    this.uploadMethod(args, imageTag);\n    var e = {\n      elements: [imageTag]\n    };\n    imageTag.addEventListener('load', function () {\n      _this.parent.trigger(events.actionComplete, e);\n    });\n    detach(parentElement);\n  };\n  /**\n   * Rendering uploader and popup for drag and drop\n   *\n   * @param {DragEvent} dragEvent - specifies the event.\n   * @param {HTMLImageElement} imageElement - specifies the element.\n   * @returns {void}\n   */\n\n\n  Image.prototype.uploadMethod = function (dragEvent, imageElement) {\n    var _this = this;\n\n    var isUploading = false; // eslint-disable-next-line\n\n    var proxy = this;\n    var popupEle = this.parent.createElement('div');\n    this.parent.element.appendChild(popupEle);\n    var uploadEle = this.parent.createElement('input', {\n      id: this.rteID + '_upload',\n      attrs: {\n        type: 'File',\n        name: 'UploadFiles'\n      }\n    });\n    var offsetY = this.parent.iframeSettings.enable ? -50 : -90;\n    this.popupObj = new Popup(popupEle, {\n      relateTo: imageElement,\n      height: '85px',\n      width: '300px',\n      offsetY: offsetY,\n      content: uploadEle,\n      viewPortElement: this.parent.element,\n      position: {\n        X: 'center',\n        Y: 'top'\n      },\n      enableRtl: this.parent.enableRtl,\n      zIndex: 10001,\n      // eslint-disable-next-line\n      close: function (event) {\n        _this.parent.isBlur = false;\n\n        _this.popupObj.destroy();\n\n        detach(_this.popupObj.element);\n        _this.popupObj = null;\n\n        if (!_this.parent.inlineMode.enable) {\n          _this.parent.toolbarModule.baseToolbar.toolbarObj.disable(false);\n        }\n      }\n    });\n    this.popupObj.element.style.display = 'none';\n    addClass([this.popupObj.element], classes.CLS_POPUP_OPEN);\n    addClass([this.popupObj.element], classes.CLS_RTE_UPLOAD_POPUP);\n\n    if (!isNOU(this.parent.cssClass)) {\n      addClass([this.popupObj.element], this.parent.cssClass);\n    }\n\n    var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n    var timeOut = dragEvent.dataTransfer.files[0].size > 1000000 ? 300 : 100;\n    setTimeout(function () {\n      proxy.refreshPopup(imageElement);\n    }, timeOut);\n    var rawFile;\n    var beforeUploadArgs;\n    this.uploadObj = new Uploader({\n      asyncSettings: {\n        saveUrl: this.parent.insertImageSettings.saveUrl,\n        removeUrl: this.parent.insertImageSettings.removeUrl\n      },\n      cssClass: classes.CLS_RTE_DIALOG_UPLOAD + ' ' + this.parent.cssClass,\n      dropArea: this.parent.element,\n      allowedExtensions: this.parent.insertImageSettings.allowedTypes.toString(),\n      removing: function () {\n        _this.parent.inputElement.contentEditable = 'true';\n        isUploading = false;\n        detach(imageElement);\n\n        _this.popupObj.close();\n      },\n      canceling: function () {\n        _this.parent.inputElement.contentEditable = 'true';\n        isUploading = false;\n        detach(imageElement);\n\n        _this.popupObj.close();\n\n        _this.quickToolObj.imageQTBar.hidePopup();\n\n        setTimeout(function () {\n          _this.uploadObj.destroy();\n        }, 900);\n      },\n      beforeUpload: function (args) {\n        if (_this.parent.isServerRendered) {\n          beforeUploadArgs = JSON.parse(JSON.stringify(args));\n          beforeUploadArgs.filesData = rawFile;\n          isUploading = true;\n          args.cancel = true;\n\n          _this.parent.trigger(events.imageUploading, beforeUploadArgs, function (beforeUploadArgs) {\n            if (beforeUploadArgs.cancel) {\n              return;\n            }\n\n            if (!_this.parent.inlineMode.enable) {\n              _this.parent.toolbarModule.baseToolbar.toolbarObj.disable(true);\n            }\n            /* eslint-disable */\n\n\n            _this.uploadObj.currentRequestHeader = beforeUploadArgs.currentRequest ? beforeUploadArgs.currentRequest : _this.uploadObj.currentRequestHeader;\n            _this.uploadObj.customFormDatas = beforeUploadArgs.customFormData && beforeUploadArgs.customFormData.length > 0 ? beforeUploadArgs.customFormData : _this.uploadObj.customFormDatas;\n\n            _this.uploadObj.uploadFiles(rawFile, null);\n\n            _this.parent.inputElement.contentEditable = 'false';\n            /* eslint-enable */\n          });\n        } else {\n          _this.parent.trigger(events.beforeImageUpload, args);\n\n          if (!_this.parent.inlineMode.enable) {\n            _this.parent.toolbarModule.baseToolbar.toolbarObj.disable(true);\n          }\n        }\n      },\n      uploading: function (e) {\n        if (!_this.parent.isServerRendered) {\n          isUploading = true;\n\n          _this.parent.trigger(events.imageUploading, e, function (imageUploadingArgs) {\n            if (imageUploadingArgs.cancel) {\n              if (!isNullOrUndefined(imageElement)) {\n                detach(imageElement);\n              }\n\n              if (!isNullOrUndefined(_this.popupObj.element)) {\n                detach(_this.popupObj.element);\n              }\n            } else {\n              _this.parent.inputElement.contentEditable = 'false';\n            }\n          });\n        }\n      },\n      selected: function (e) {\n        if (isUploading) {\n          e.cancel = true;\n        }\n\n        if (_this.parent.isServerRendered) {\n          rawFile = e.filesData;\n        }\n      },\n      failure: function (e) {\n        isUploading = false;\n        _this.parent.inputElement.contentEditable = 'true';\n        var args = {\n          args: dragEvent,\n          type: 'Images',\n          isNotify: undefined,\n          elements: imageElement\n        };\n        setTimeout(function () {\n          _this.uploadFailure(imageElement, args, e);\n        }, 900);\n      },\n      success: function (e) {\n        if (e.operation === \"cancel\") {\n          return;\n        }\n\n        isUploading = false;\n        _this.parent.inputElement.contentEditable = 'true';\n        var args = {\n          args: dragEvent,\n          type: 'Images',\n          isNotify: undefined,\n          elements: imageElement\n        };\n        setTimeout(function () {\n          _this.uploadSuccess(imageElement, dragEvent, args, e);\n        }, 900);\n      }\n    });\n    this.uploadObj.appendTo(this.popupObj.element.childNodes[0]);\n    this.popupObj.element.querySelector('.e-rte-dialog-upload .e-file-select-wrap').style.display = 'none';\n    range.selectNodeContents(imageElement);\n    this.parent.formatter.editorManager.nodeSelection.setRange(this.contentModule.getDocument(), range);\n  };\n\n  Image.prototype.refreshPopup = function (imageElement) {\n    var imgPosition = this.parent.iframeSettings.enable ? this.parent.element.offsetTop + imageElement.offsetTop : imageElement.offsetTop;\n    var rtePosition = this.parent.element.offsetTop + this.parent.element.offsetHeight;\n\n    if (imgPosition > rtePosition) {\n      this.popupObj.relateTo = this.parent.inputElement;\n      this.popupObj.offsetY = this.parent.iframeSettings.enable ? -30 : -65;\n      this.popupObj.element.style.display = 'block';\n    } else {\n      if (this.popupObj) {\n        this.popupObj.refreshPosition(imageElement);\n        this.popupObj.element.style.display = 'block';\n      }\n    }\n  };\n  /**\n   * Called when drop image upload was failed\n   *\n   * @param {HTMLElement} imgEle - specifies the image element.\n   * @param {IShowPopupArgs} args - specifies the arguments.\n   * @param {Object} e - specfies the object.\n   * @returns {void}\n   */\n\n\n  Image.prototype.uploadFailure = function (imgEle, args, e) {\n    detach(imgEle);\n\n    if (this.popupObj) {\n      this.popupObj.close();\n    }\n\n    this.parent.trigger(events.imageUploadFailed, e);\n    this.uploadObj.destroy();\n  };\n  /**\n   * Called when drop image upload was successful\n   *\n   * @param {HTMLElement} imageElement - specifies the image element.\n   * @param {DragEvent} dragEvent - specifies the drag event.\n   * @param {IShowPopupArgs} args - specifies the arguments.\n   * @param {ImageSuccessEventArgs} e - specifies the success event.\n   * @returns {void}\n   */\n\n\n  Image.prototype.uploadSuccess = function (imageElement, dragEvent, args, e) {\n    var _this = this;\n\n    imageElement.style.opacity = '1';\n    imageElement.classList.add(classes.CLS_IMG_FOCUS);\n    e.element = imageElement;\n    this.parent.trigger(events.imageUploadSuccess, e, function (e) {\n      if (!isNullOrUndefined(_this.parent.insertImageSettings.path)) {\n        var url = _this.parent.insertImageSettings.path + e.file.name;\n        imageElement.src = url;\n        imageElement.setAttribute('alt', e.file.name);\n      }\n    });\n\n    if (this.popupObj) {\n      this.popupObj.close();\n      this.uploadObj.destroy();\n    }\n\n    this.showImageQuickToolbar(args);\n    this.resizeStart(dragEvent, imageElement);\n  };\n\n  Image.prototype.imagePaste = function (args) {\n    var _this = this;\n\n    if (args.text.length === 0 && !isNullOrUndefined(args.file)) {\n      // eslint-disable-next-line\n      var proxy_1 = this;\n      var reader_2 = new FileReader();\n      args.args.preventDefault(); // eslint-disable-next-line\n\n      reader_2.addEventListener('load', function (e) {\n        var url = {\n          cssClass: proxy_1.parent.insertImageSettings.display === 'inline' ? classes.CLS_IMGINLINE : classes.CLS_IMGBREAK,\n          url: _this.parent.insertImageSettings.saveFormat === 'Base64' || !isNullOrUndefined(args.callBack) ? reader_2.result : URL.createObjectURL(convertToBlob(reader_2.result)),\n          width: {\n            width: proxy_1.parent.insertImageSettings.width,\n            minWidth: proxy_1.parent.insertImageSettings.minWidth,\n            maxWidth: proxy_1.parent.getInsertImgMaxWidth()\n          },\n          height: {\n            height: proxy_1.parent.insertImageSettings.height,\n            minHeight: proxy_1.parent.insertImageSettings.minHeight,\n            maxHeight: proxy_1.parent.insertImageSettings.maxHeight\n          }\n        };\n\n        if (!isNullOrUndefined(args.callBack)) {\n          args.callBack(url);\n          return;\n        } else {\n          proxy_1.parent.formatter.process(proxy_1.parent, {\n            item: {\n              command: 'Images',\n              subCommand: 'Image'\n            }\n          }, args.args, url);\n\n          _this.showPopupToolBar(args, url);\n        }\n      });\n      reader_2.readAsDataURL(args.file);\n    }\n  };\n\n  Image.prototype.showPopupToolBar = function (e, url) {\n    var _this = this;\n\n    var imageSrc = 'img[src=\"' + url.url + '\"]';\n    var imageElement = this.parent.inputElement.querySelector(imageSrc);\n    this.parent.quickToolbarModule.createQTBar('Image', 'MultiRow', this.parent.quickToolbarSettings.image, RenderType.ImageToolbar);\n    var args = {\n      args: e.args,\n      type: 'Images',\n      isNotify: undefined,\n      elements: imageElement\n    };\n\n    if (imageElement) {\n      setTimeout(function () {\n        _this.showImageQuickToolbar(args);\n\n        _this.resizeStart(e.args, imageElement);\n      }, 0);\n    }\n  };\n  /* eslint-disable */\n\n  /**\n   * Destroys the ToolBar.\n   *\n   * @method destroy\n   * @returns {void}\n   * @hidden\n    */\n\n  /* eslint-enable */\n\n\n  Image.prototype.destroy = function () {\n    this.prevSelectedImgEle = undefined;\n    this.removeEventListener();\n  };\n  /**\n   * For internal use only - Get the module name.\n   *\n   * @returns {void}\n   */\n\n\n  Image.prototype.getModuleName = function () {\n    return 'image';\n  };\n\n  return Image;\n}();\n\nexport { Image };","map":{"version":3,"names":["addClass","detach","EventHandler","isNullOrUndefined","select","Ajax","formatUnit","Browser","closest","removeClass","isNOU","events","classes","Uploader","TextBox","Popup","Button","CheckBox","RenderType","dispatchEvent","parseHtml","hasClass","convertToBlob","isIDevice","Image","parent","serviceLocator","isImgUploaded","isAllowedTypes","pageX","pageY","mousex","deletedImg","rteID","element","id","i10n","getService","rendererFactory","dialogRenderObj","addEventListener","prototype","isDestroyed","on","keyDown","onKeyDown","keyUp","onKeyUp","insertImage","showImageDialog","showDialog","closeImageDialog","closeDialog","windowResize","onWindowResize","insertCompleted","showImageQuickToolbar","clearDialogObj","imageToolbarAction","onToolbarAction","imageCaption","caption","imageDelete","deleteImg","imageLink","insertImgLink","imageAlt","insertAltText","editAreaClick","editAreaClickHandler","iframeMouseDown","onIframeMouseDown","imageSize","dropDownSelect","alignmentSelect","initialEnd","afterRender","dynamicModule","paste","imagePaste","bindCssClass","setCssClass","destroy","removeEventListener","off","dropElement","iframeSettings","enable","inputElement","ownerDocument","dragDrop","bind","dragStart","dragEnter","dragOver","contentModule","remove","getEditPanel","touchEndEvent","imageClick","formatter","editorManager","observer","checkUndo","undoStack","insertImageSettings","resize","touchStartEvent","resizeStart","onDocumentClick","onCutHandler","updateCss","currentObj","e","cssClass","oldCssClass","setProperties","trim","replace","popupObj","checkBoxObj","widthNum","heightNum","uploadObj","dialogObj","hide","returnValue","getRenderer","Content","add","args","subCommand","toLowerCase","i","getUndoRedoStack","length","temp","createElement","contentElem","text","appendChild","img","querySelectorAll","querySelector","j","style","outline","innerHTML","resizeEnd","resizeBtnInit","imgEle","parentElement","cursor","isDevice","target","event","requestType","trigger","resizeStop","getPointX","window","pageYOffset","getBoundingClientRect","top","clientY","saveData","ele","_this","readonly","prevSelectedImgEle","tagName","preventDefaultResize","imgResizeDiv","contains","imageResize","classList","getPointY","preventDefault","stopImmediatePropagation","quickToolObj","imageQTBar","hidePopup","resizeBtnStat","topLeft","topRight","botLeft","botRight","resizeStartArgs","cancel","cancelResizeAction","getDocument","setAttribute","focus","className","styles","imgResizePos","resizeImgDupPos","touchMoveEvent","resizing","touches","pos","calcPos","left","imgWid","width","imgHgt","height","borWid","parseInt","slice","devWid","elem","ignoreOffset","parentOffset","elementOffset","doc","offsetParent","indexOf","getID","documentElement","body","position","parentNode","nodeType","offsetTop","offsetLeft","setAspectRatio","expectedX","expectedY","match","parseFloat","minWidth","resizeByPercent","original","offsetWidth","finalWidthByPerc","toString","getComputedStyle","pixToPerc","previousElementSibling","removeAttribute","currentWidth","right","expected","parentEle","imgDupMouseMove","onResize","resizingArgs","getInsertImgMaxWidth","minHeight","maxHeight","setContentHeight","offsetHeight","mouseX","mouseY","imgDupPos","notify","selectionRestore","item","fileManagerSettings","renderFileManager","openImgLink","editImgLink","removeImgLink","selectParent","process","url","href","selectNode","selectParentEle","linkUpdate","getConstant","inputDetails","header","btnText","isIE","selection","restore","isCapLink","captionEle","insertElement","document","originalEvent","range","save","selectNodeEle","isCursor","keyCodeValues","editorMode","nodeSelection","getRange","startContainer","endContainer","startOffset","endOffset","which","nodes","getNodeCollection","nodeName","push","code","isCursor_1","checkImageBack","checkImageDel","getParentNodeCollection","ctrlKey","key","action","prev","childNodes","removeResizeEle","setSelectionText","textContent","keyCode","event_1","command","close","src","imageRemovePost","CLS_CAPTION","CLS_CAPINLINE","nextElementSibling","CLS_IMGBREAK","openDialog","isInternal","member","markdownSelection","getSelectedText","module","name","getAttribute","afterImageDelete","previousSibling","nextSibling","alignImage","inline","break","imageWithLinkQTBarItemUpdate","separator","items","toolbarElement","display","newItems","addQTBarItem","Math","round","type","quickToolbarModule","elements","forEach","call","index","isNotify","setTimeout","Clear","setSelectionContents","showPopup","hideImageQuickToolbar","showOnRightClick","quickToolbarSettings","isPopupOpen","selectionSave","imagDialog","linkWrap","linkUrl","content","linkTarget","inputLink","linkOpenLabel","label","checked","enableRtl","change","target_1","isStringTemplate","appendTo","linkargs_1","selfImage","link","localeObj","X","Y","buttons","click","insertlink","buttonModel","isPrimary","value","altText","altWrap","altHeader","getAlt","inputAlt","altArgs_1","alt","insertAlt","setSelectionRange","isUrl","proxy","regexp","test","captionClass","absoluteUrl","removeUrl","URL","baseURI","removingImgName","xhr","XMLHttpRequest","readyState","status","triggerPost","response","open","responseType","send","file","File","ajax","formData","FormData","append","CLS_RTE_CAPTION","attrs","contenteditable","draggable","imgWrap","imgInner","parent_1","imgCaption","CLS_IMGINLINE","CLS_IMGLEFT","CLS_IMGRIGHT","CLS_IMGCENTER","imgSizeHeader","dialogContent","imgsizeInput","selectObj_1","insertSize","imgDialog","imgInsert","imglinkCancel","imgHeader","selectObj","dialogModel","CLS_RTE_ELEMENTS","locale","showCloseIcon","closeOnEscape","isModal","insertImageUrl","disabled","cancelDialog","animationSettings","effect","removing","isBlur","path","imgUpload","linkHeader","linkHeaderText","imageUrlPopup","render","inlineQTBar","currentTarget","toolbarSettings","getToolbarElement","offsetX","clientWidth","offsetY","clientHeight","imgUrl","placeUrl","inputUrl","placeholder","spellcheck","getButtons","uploadUrl","getPanel","regex","matchUrl","maxWidth","imgHeight","imgWidth","imgSizeWrap","widthVal","changedWidthValue","getClientRects","heightVal","changedHeightValue","input","inputWidthValue","inputValue","inputHeightValue","dialogEle","getElementById","iframe","uploadParentEle","deviceImgUpMsg","imgUpMsg","span","spanMsg","btnEle","autofocus","browserMsg","browseButton","btnClick","fileSelect","uploadEle","rawFile","selectArgs","filesData","beforeUploadArgs","asyncSettings","saveUrl","dropArea","multiple","allowedExtensions","allowedTypes","selected","isServerRendered","JSON","parse","stringify","imageSelected","checkExtension","reader_1","FileReader","saveFormat","result","createObjectURL","readAsDataURL","_internalRenderSelect","beforeUpload","imageUploading","currentRequestHeader","currentRequest","customFormDatas","customFormData","uploadFiles","beforeImageUpload","uploading","success","imageUploadSuccess","operation","failure","imageUploadFailed","imageRemoving","toLocaleLowerCase","getElementsByClassName","actionBegin","actionBeginArgs","dataTransfer","effectAllowed","CLS_RTE_DRAG_IMAGE","dropEffect","info","split","types","beforeImageDrop","imgElement","isImgOrFileDrop","files","contentEditable","CLS_IMG_RESIZE","caretRangeFromPoint","clientX","rangeParent","createRange","setStart","rangeOffset","getDropRange","selectRange","uploadArea","CLS_DROPAREA","insertDragImage","x","y","startRange","setRange","elementFromPoint","startNode","startCharIndexCharacter","firstChild","setEnd","rangeRect","activePopupElement","CLS_POPUP_OPEN","drop","CLS_HIDE","imgFiles","fileName","imgType","substring","lastIndexOf","onSelect","CLS_IMG_INNER","insertNode","imgArgs_1","actionComplete","CLS_UPLOAD_FILES","validFiles","size","statusCode","validationMessages","imageTag","opacity","CLS_RTE_IMAGE","CLS_RESIZE","reader","uploadMethod","dragEvent","imageElement","isUploading","popupEle","relateTo","viewPortElement","zIndex","inlineMode","toolbarModule","baseToolbar","toolbarObj","disable","CLS_RTE_UPLOAD_POPUP","timeOut","refreshPopup","CLS_RTE_DIALOG_UPLOAD","canceling","imageUploadingArgs","undefined","uploadFailure","uploadSuccess","selectNodeContents","imgPosition","rtePosition","refreshPosition","CLS_IMG_FOCUS","proxy_1","reader_2","callBack","showPopupToolBar","imageSrc","createQTBar","image","ImageToolbar","getModuleName"],"sources":["/home/morgan/Desktop/Projets/ENT4/Jwt-Auth-pdf/react-jwt-auth/react-jwt-auth/node_modules/@syncfusion/ej2-richtexteditor/src/rich-text-editor/renderer/image-module.js"],"sourcesContent":["import { addClass, detach, EventHandler, isNullOrUndefined, select, Ajax, formatUnit } from '@syncfusion/ej2-base';\nimport { Browser, closest, removeClass, isNullOrUndefined as isNOU } from '@syncfusion/ej2-base';\nimport * as events from '../base/constant';\nimport * as classes from '../base/classes';\nimport { Uploader, TextBox } from '@syncfusion/ej2-inputs';\nimport { Popup } from '@syncfusion/ej2-popups';\nimport { Button, CheckBox } from '@syncfusion/ej2-buttons';\nimport { RenderType } from '../base/enum';\nimport { dispatchEvent, parseHtml, hasClass, convertToBlob } from '../base/util';\nimport { isIDevice } from '../../common/util';\n/**\n * `Image` module is used to handle image actions.\n */\nvar Image = /** @class */ (function () {\n    function Image(parent, serviceLocator) {\n        this.isImgUploaded = false;\n        this.isAllowedTypes = true;\n        this.pageX = null;\n        this.pageY = null;\n        this.mousex = null;\n        this.deletedImg = [];\n        this.parent = parent;\n        this.rteID = parent.element.id;\n        this.i10n = serviceLocator.getService('rteLocale');\n        this.rendererFactory = serviceLocator.getService('rendererFactory');\n        this.dialogRenderObj = serviceLocator.getService('dialogRenderObject');\n        this.addEventListener();\n    }\n    Image.prototype.addEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.on(events.keyDown, this.onKeyDown, this);\n        this.parent.on(events.keyUp, this.onKeyUp, this);\n        this.parent.on(events.insertImage, this.insertImage, this);\n        this.parent.on(events.showImageDialog, this.showDialog, this);\n        this.parent.on(events.closeImageDialog, this.closeDialog, this);\n        this.parent.on(events.windowResize, this.onWindowResize, this);\n        this.parent.on(events.insertCompleted, this.showImageQuickToolbar, this);\n        this.parent.on(events.clearDialogObj, this.clearDialogObj, this);\n        this.parent.on(events.imageToolbarAction, this.onToolbarAction, this);\n        this.parent.on(events.imageCaption, this.caption, this);\n        this.parent.on(events.imageDelete, this.deleteImg, this);\n        this.parent.on(events.imageLink, this.insertImgLink, this);\n        this.parent.on(events.imageAlt, this.insertAltText, this);\n        this.parent.on(events.editAreaClick, this.editAreaClickHandler, this);\n        this.parent.on(events.iframeMouseDown, this.onIframeMouseDown, this);\n        this.parent.on(events.imageSize, this.imageSize, this);\n        this.parent.on(events.dropDownSelect, this.alignmentSelect, this);\n        this.parent.on(events.initialEnd, this.afterRender, this);\n        this.parent.on(events.dynamicModule, this.afterRender, this);\n        this.parent.on(events.paste, this.imagePaste, this);\n        this.parent.on(events.bindCssClass, this.setCssClass, this);\n        this.parent.on(events.destroy, this.removeEventListener, this);\n    };\n    Image.prototype.removeEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.off(events.keyDown, this.onKeyDown);\n        this.parent.off(events.keyUp, this.onKeyUp);\n        this.parent.off(events.windowResize, this.onWindowResize);\n        this.parent.off(events.insertImage, this.insertImage);\n        this.parent.off(events.showImageDialog, this.showDialog);\n        this.parent.off(events.closeImageDialog, this.closeDialog);\n        this.parent.off(events.insertCompleted, this.showImageQuickToolbar);\n        this.parent.off(events.clearDialogObj, this.clearDialogObj);\n        this.parent.off(events.imageCaption, this.caption);\n        this.parent.off(events.imageToolbarAction, this.onToolbarAction);\n        this.parent.off(events.imageDelete, this.deleteImg);\n        this.parent.off(events.imageLink, this.insertImgLink);\n        this.parent.off(events.imageAlt, this.insertAltText);\n        this.parent.off(events.editAreaClick, this.editAreaClickHandler);\n        this.parent.off(events.iframeMouseDown, this.onIframeMouseDown);\n        this.parent.off(events.imageSize, this.imageSize);\n        this.parent.off(events.dropDownSelect, this.alignmentSelect);\n        this.parent.off(events.initialEnd, this.afterRender);\n        this.parent.off(events.dynamicModule, this.afterRender);\n        this.parent.off(events.paste, this.imagePaste);\n        this.parent.off(events.bindCssClass, this.setCssClass);\n        this.parent.off(events.destroy, this.removeEventListener);\n        var dropElement = this.parent.iframeSettings.enable ? this.parent.inputElement.ownerDocument\n            : this.parent.inputElement;\n        dropElement.removeEventListener('drop', this.dragDrop.bind(this), true);\n        dropElement.removeEventListener('dragstart', this.dragStart.bind(this), true);\n        dropElement.removeEventListener('dragenter', this.dragEnter.bind(this), true);\n        dropElement.removeEventListener('dragover', this.dragOver.bind(this), true);\n        if (!isNullOrUndefined(this.contentModule)) {\n            EventHandler.remove(this.contentModule.getEditPanel(), Browser.touchEndEvent, this.imageClick);\n            this.parent.formatter.editorManager.observer.off(events.checkUndo, this.undoStack);\n            if (this.parent.insertImageSettings.resize) {\n                EventHandler.remove(this.parent.contentModule.getEditPanel(), Browser.touchStartEvent, this.resizeStart);\n                EventHandler.remove(this.parent.element.ownerDocument, 'mousedown', this.onDocumentClick);\n                EventHandler.remove(this.contentModule.getEditPanel(), 'cut', this.onCutHandler);\n            }\n        }\n    };\n    Image.prototype.updateCss = function (currentObj, e) {\n        if (currentObj && e.cssClass) {\n            if (isNullOrUndefined(e.oldCssClass)) {\n                currentObj.setProperties({ cssClass: (currentObj.cssClass + ' ' + e.cssClass).trim() });\n            }\n            else {\n                currentObj.setProperties({ cssClass: (currentObj.cssClass.replace(e.oldCssClass, '').trim() + ' ' + e.cssClass).trim() });\n            }\n        }\n    };\n    Image.prototype.setCssClass = function (e) {\n        if (this.popupObj && e.cssClass) {\n            if (isNullOrUndefined(e.oldCssClass)) {\n                addClass([this.popupObj.element], e.cssClass);\n            }\n            else {\n                removeClass([this.popupObj.element], e.oldCssClass);\n                addClass([this.popupObj.element], e.cssClass);\n            }\n        }\n        this.updateCss(this.checkBoxObj, e);\n        this.updateCss(this.widthNum, e);\n        this.updateCss(this.heightNum, e);\n        this.updateCss(this.uploadObj, e);\n        this.updateCss(this.dialogObj, e);\n    };\n    Image.prototype.onIframeMouseDown = function () {\n        if (this.dialogObj) {\n            this.dialogObj.hide({ returnValue: true });\n        }\n    };\n    Image.prototype.afterRender = function () {\n        this.contentModule = this.rendererFactory.getRenderer(RenderType.Content);\n        EventHandler.add(this.contentModule.getEditPanel(), Browser.touchEndEvent, this.imageClick, this);\n        if (this.parent.insertImageSettings.resize) {\n            EventHandler.add(this.parent.contentModule.getEditPanel(), Browser.touchStartEvent, this.resizeStart, this);\n            EventHandler.add(this.parent.element.ownerDocument, 'mousedown', this.onDocumentClick, this);\n            EventHandler.add(this.contentModule.getEditPanel(), 'cut', this.onCutHandler, this);\n        }\n        var dropElement = this.parent.iframeSettings.enable ? this.parent.inputElement.ownerDocument :\n            this.parent.inputElement;\n        dropElement.addEventListener('drop', this.dragDrop.bind(this), true);\n        dropElement.addEventListener('dragstart', this.dragStart.bind(this), true);\n        dropElement.addEventListener('dragenter', this.dragOver.bind(this), true);\n        dropElement.addEventListener('dragover', this.dragOver.bind(this), true);\n    };\n    Image.prototype.undoStack = function (args) {\n        if (args.subCommand.toLowerCase() === 'undo' || args.subCommand.toLowerCase() === 'redo') {\n            for (var i = 0; i < this.parent.formatter.getUndoRedoStack().length; i++) {\n                var temp = this.parent.createElement('div');\n                var contentElem = parseHtml(this.parent.formatter.getUndoRedoStack()[i].text);\n                temp.appendChild(contentElem);\n                var img = temp.querySelectorAll('img');\n                if (temp.querySelector('.e-img-resize') && img.length > 0) {\n                    for (var j = 0; j < img.length; j++) {\n                        img[j].style.outline = '';\n                    }\n                    detach(temp.querySelector('.e-img-resize'));\n                    this.parent.formatter.getUndoRedoStack()[i].text = temp.innerHTML;\n                }\n            }\n        }\n    };\n    Image.prototype.resizeEnd = function (e) {\n        this.resizeBtnInit();\n        this.imgEle.parentElement.style.cursor = 'auto';\n        if (Browser.isDevice) {\n            removeClass([e.target.parentElement], 'e-mob-span');\n        }\n        var args = { event: e, requestType: 'images' };\n        this.parent.trigger(events.resizeStop, args);\n        /* eslint-disable */\n        var pageX = this.getPointX(e);\n        var pageY = (this.parent.iframeSettings.enable) ? window.pageYOffset +\n            this.parent.element.getBoundingClientRect().top + e.clientY : e.pageY;\n        /* eslint-enable */\n        this.parent.formatter.editorManager.observer.on(events.checkUndo, this.undoStack, this);\n        this.parent.formatter.saveData();\n    };\n    Image.prototype.resizeStart = function (e, ele) {\n        var _this = this;\n        if (this.parent.readonly) {\n            return;\n        }\n        var target = ele ? ele : e.target;\n        this.prevSelectedImgEle = this.imgEle;\n        if (target.tagName === 'IMG') {\n            this.parent.preventDefaultResize(e);\n            var img = target;\n            if (this.imgResizeDiv && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n                detach(this.imgResizeDiv);\n            }\n            this.imageResize(img);\n        }\n        if (target.classList.contains('e-rte-imageboxmark')) {\n            if (this.parent.formatter.getUndoRedoStack().length === 0) {\n                this.parent.formatter.saveData();\n            }\n            this.pageX = this.getPointX(e);\n            this.pageY = this.getPointY(e);\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            this.resizeBtnInit();\n            if (this.quickToolObj) {\n                this.quickToolObj.imageQTBar.hidePopup();\n            }\n            if (target.classList.contains('e-rte-topLeft')) {\n                this.resizeBtnStat.topLeft = true;\n            }\n            if (target.classList.contains('e-rte-topRight')) {\n                this.resizeBtnStat.topRight = true;\n            }\n            if (target.classList.contains('e-rte-botLeft')) {\n                this.resizeBtnStat.botLeft = true;\n            }\n            if (target.classList.contains('e-rte-botRight')) {\n                this.resizeBtnStat.botRight = true;\n            }\n            if (Browser.isDevice && this.contentModule.getEditPanel().contains(this.imgResizeDiv) &&\n                !this.imgResizeDiv.classList.contains('e-mob-span')) {\n                addClass([this.imgResizeDiv], 'e-mob-span');\n            }\n            else {\n                var args = { event: e, requestType: 'images' };\n                this.parent.trigger(events.resizeStart, args, function (resizeStartArgs) {\n                    if (resizeStartArgs.cancel) {\n                        _this.cancelResizeAction();\n                    }\n                });\n            }\n            EventHandler.add(this.contentModule.getDocument(), Browser.touchEndEvent, this.resizeEnd, this);\n        }\n    };\n    Image.prototype.imageClick = function (e) {\n        if (Browser.isDevice) {\n            if ((e.target.tagName === 'IMG' &&\n                e.target.parentElement.tagName === 'A') ||\n                (e.target.tagName === 'IMG')) {\n                this.contentModule.getEditPanel().setAttribute('contenteditable', 'false');\n                e.target.focus();\n            }\n            else {\n                if (!this.parent.readonly) {\n                    this.contentModule.getEditPanel().setAttribute('contenteditable', 'true');\n                }\n            }\n        }\n        if (e.target.tagName === 'IMG' &&\n            e.target.parentElement.tagName === 'A') {\n            e.preventDefault();\n        }\n    };\n    Image.prototype.onCutHandler = function () {\n        if (this.imgResizeDiv && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n            this.cancelResizeAction();\n        }\n    };\n    Image.prototype.imageResize = function (e) {\n        this.resizeBtnInit();\n        this.imgEle = e;\n        addClass([this.imgEle], 'e-resize');\n        this.imgResizeDiv = this.parent.createElement('span', { className: 'e-img-resize' + ' ' + this.parent.cssClass, id: this.rteID + '_imgResize' });\n        this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n            className: 'e-rte-imageboxmark e-rte-topLeft' + ' ' + this.parent.cssClass, styles: 'cursor: nwse-resize'\n        }));\n        this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n            className: 'e-rte-imageboxmark e-rte-topRight' + ' ' + this.parent.cssClass, styles: 'cursor: nesw-resize'\n        }));\n        this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n            className: 'e-rte-imageboxmark e-rte-botLeft' + ' ' + this.parent.cssClass, styles: 'cursor: nesw-resize'\n        }));\n        this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n            className: 'e-rte-imageboxmark e-rte-botRight' + ' ' + this.parent.cssClass, styles: 'cursor: nwse-resize'\n        }));\n        if (Browser.isDevice) {\n            addClass([this.imgResizeDiv], 'e-mob-rte');\n        }\n        e.style.outline = '2px solid #4a90e2';\n        this.imgResizePos(e, this.imgResizeDiv);\n        this.resizeImgDupPos(e);\n        this.contentModule.getEditPanel().appendChild(this.imgResizeDiv);\n        EventHandler.add(this.contentModule.getDocument(), Browser.touchMoveEvent, this.resizing, this);\n    };\n    Image.prototype.getPointX = function (e) {\n        if (e.touches && e.touches.length) {\n            return e.touches[0].pageX;\n        }\n        else {\n            return e.pageX;\n        }\n    };\n    Image.prototype.getPointY = function (e) {\n        if (e.touches && e.touches.length) {\n            return e.touches[0].pageY;\n        }\n        else {\n            return e.pageY;\n        }\n    };\n    Image.prototype.imgResizePos = function (e, imgResizeDiv) {\n        var pos = this.calcPos(e);\n        var top = pos.top;\n        var left = pos.left;\n        var imgWid = e.width;\n        var imgHgt = e.height;\n        var borWid = (Browser.isDevice) ? (4 * parseInt((e.style.outline.slice(-3)), 10)) + 2 :\n            (2 * parseInt((e.style.outline.slice(-3)), 10)) + 2; //span border width + image outline width\n        var devWid = ((Browser.isDevice) ? 0 : 2); // span border width\n        imgResizeDiv.querySelector('.e-rte-botLeft').style.left = (left - borWid) + 'px';\n        imgResizeDiv.querySelector('.e-rte-botLeft').style.top = ((imgHgt - borWid) + top) + 'px';\n        imgResizeDiv.querySelector('.e-rte-botRight').style.left = ((imgWid - (borWid - devWid)) + left) + 'px';\n        imgResizeDiv.querySelector('.e-rte-botRight').style.top = ((imgHgt - borWid) + top) + 'px';\n        imgResizeDiv.querySelector('.e-rte-topRight').style.left = ((imgWid - (borWid - devWid)) + left) + 'px';\n        imgResizeDiv.querySelector('.e-rte-topRight').style.top = (top - (borWid)) + 'px';\n        imgResizeDiv.querySelector('.e-rte-topLeft').style.left = (left - borWid) + 'px';\n        imgResizeDiv.querySelector('.e-rte-topLeft').style.top = (top - borWid) + 'px';\n    };\n    Image.prototype.calcPos = function (elem) {\n        var ignoreOffset = ['TD', 'TH', 'TABLE', 'A'];\n        var parentOffset = { top: 0, left: 0 };\n        var elementOffset;\n        var doc = elem.ownerDocument;\n        var offsetParent = ((elem.offsetParent && (elem.offsetParent.classList.contains('e-img-caption') ||\n            ignoreOffset.indexOf(elem.offsetParent.tagName) > -1)) ?\n            closest(elem, '#' + this.parent.getID() + '_rte-edit-view') : elem.offsetParent) || doc.documentElement;\n        while (offsetParent &&\n            (offsetParent === doc.body || offsetParent === doc.documentElement) &&\n            offsetParent.style.position === 'static') {\n            offsetParent = offsetParent.parentNode;\n        }\n        if (offsetParent && offsetParent !== elem && offsetParent.nodeType === 1) {\n            // eslint-disable-next-line\n            parentOffset = offsetParent.getBoundingClientRect();\n        }\n        if (elem.offsetParent && (elem.offsetParent.classList.contains('e-img-caption'))) {\n            elementOffset = elem.getBoundingClientRect();\n            return {\n                top: elementOffset.top - parentOffset.top,\n                left: elementOffset.left - parentOffset.left\n            };\n        }\n        else {\n            return {\n                top: elem.offsetTop,\n                left: elem.offsetLeft\n            };\n        }\n    };\n    Image.prototype.setAspectRatio = function (img, expectedX, expectedY, e) {\n        if (isNullOrUndefined(img.width)) {\n            return;\n        }\n        var width = img.style.width !== '' ? img.style.width.match(/^\\d+(\\.\\d*)?%$/g) ? parseFloat(img.style.width) :\n            parseInt(img.style.width, 10) : img.width;\n        var height = img.style.height !== '' ? parseInt(img.style.height, 10) : img.height;\n        if (width > height) {\n            img.style.minWidth = this.parent.insertImageSettings.minWidth === 0 ? '20px' : formatUnit(this.parent.insertImageSettings.minWidth);\n            if (this.parent.insertImageSettings.resizeByPercent) {\n                if (parseInt('' + img.getBoundingClientRect().width + '', 10) !== 0 && parseInt('' + width + '', 10) !== 0) {\n                    var original = img.offsetWidth + this.mousex;\n                    var finalWidthByPerc = (original / img.offsetWidth) * (parseFloat(img.style.width).toString() == 'NaN' ? (img.offsetWidth / (parseFloat(getComputedStyle(this.parent.element).width)) * 100) : parseFloat(img.style.width));\n                    img.style.width = ((finalWidthByPerc > 3) ? finalWidthByPerc : 3) + '%';\n                }\n                else {\n                    img.style.width = this.pixToPerc((width / height * expectedY), (img.previousElementSibling || img.parentElement)) + '%';\n                }\n                img.style.height = null;\n                img.removeAttribute('height');\n            }\n            else if (img.style.width === '' && img.style.height !== '') {\n                img.style.height = expectedY + 'px';\n            }\n            else if (img.style.width !== '' && img.style.height === '') {\n                var currentWidth = ((width / height * expectedY) + width / height) < (this.parent.inputElement.getBoundingClientRect().right - 32) ?\n                    ((width / height * expectedY) + width / height) : (this.parent.inputElement.getBoundingClientRect().right - 32);\n                img.style.width = currentWidth.toString() + 'px';\n            }\n            else if (img.style.width !== '') {\n                var currentWidth = (width / height * expectedY) < (this.parent.inputElement.getBoundingClientRect().right - 32) ?\n                    (width / height * expectedY) : (this.parent.inputElement.getBoundingClientRect().right - 32);\n                img.style.width = currentWidth + 'px';\n                img.style.height = expectedY + 'px';\n            }\n            else {\n                if (this.parent.iframeSettings.enable) {\n                    img.setAttribute('width', (img.width + this.mousex).toString());\n                }\n                else {\n                    img.setAttribute('width', (img.offsetWidth + this.mousex).toString());\n                }\n            }\n        }\n        else if (height > width) {\n            if (this.parent.insertImageSettings.resizeByPercent) {\n                if (parseInt('' + img.getBoundingClientRect().width + '', 10) !== 0 && parseInt('' + width + '', 10) !== 0) {\n                    var original = img.offsetWidth + this.mousex;\n                    var finalWidthByPerc = (original / img.offsetWidth) * (parseFloat(img.style.width).toString() == 'NaN' ? (img.offsetWidth / (parseFloat(getComputedStyle(this.parent.element).width)) * 100) : parseFloat(img.style.width));\n                    img.style.width = ((finalWidthByPerc > 3) ? finalWidthByPerc : 3) + '%';\n                }\n                else {\n                    img.style.width = this.pixToPerc((expectedX / height * expectedY), (img.previousElementSibling || img.parentElement)) + '%';\n                }\n                img.style.height = null;\n                img.removeAttribute('height');\n            }\n            else if (img.style.width !== '') {\n                img.style.width = expectedX + 'px';\n                img.style.height = (height / width * expectedX) + 'px';\n            }\n            else {\n                img.setAttribute('width', this.resizeBtnStat.botRight ? (this.getPointX(e.event) - img.getBoundingClientRect().left).toString() : expectedX.toString());\n            }\n        }\n        else {\n            if (this.parent.insertImageSettings.resizeByPercent) {\n                img.style.width = this.pixToPerc(expectedX, (img.previousElementSibling || img.parentElement)) + '%';\n                img.style.height = null;\n                img.removeAttribute('height');\n            }\n            else {\n                img.style.width = expectedX + 'px';\n                img.style.height = expectedX + 'px';\n            }\n        }\n    };\n    Image.prototype.pixToPerc = function (expected, parentEle) {\n        return expected / parseFloat(getComputedStyle(parentEle).width) * 100;\n    };\n    Image.prototype.imgDupMouseMove = function (width, height, e) {\n        var _this = this;\n        var args = { event: e, requestType: 'images' };\n        this.parent.trigger(events.onResize, args, function (resizingArgs) {\n            if (resizingArgs.cancel) {\n                _this.cancelResizeAction();\n            }\n            else {\n                if ((parseInt(_this.parent.insertImageSettings.minWidth, 10) >= parseInt(width, 10) ||\n                    (parseInt(_this.parent.getInsertImgMaxWidth(), 10) <= parseInt(width, 10) &&\n                        isNOU(_this.imgEle.style.width)))) {\n                    return;\n                }\n                if (!_this.parent.insertImageSettings.resizeByPercent &&\n                    (parseInt(_this.parent.insertImageSettings.minHeight, 10) >= parseInt(height, 10) ||\n                        parseInt(_this.parent.insertImageSettings.maxHeight, 10) <= parseInt(height, 10))) {\n                    return;\n                }\n                _this.imgEle.parentElement.style.cursor = 'pointer';\n                _this.setAspectRatio(_this.imgEle, parseInt(width, 10), parseInt(height, 10), args);\n                _this.resizeImgDupPos(_this.imgEle);\n                _this.imgResizePos(_this.imgEle, _this.imgResizeDiv);\n                _this.parent.setContentHeight('', false);\n            }\n        });\n    };\n    Image.prototype.resizing = function (e) {\n        if (this.imgEle.offsetWidth >= this.parent.getInsertImgMaxWidth()) {\n            this.imgEle.style.maxHeight = this.imgEle.offsetHeight + 'px';\n        }\n        var pageX = this.getPointX(e);\n        var pageY = this.getPointY(e);\n        var mouseX = (this.resizeBtnStat.botLeft || this.resizeBtnStat.topLeft) ? -(pageX - this.pageX) : (pageX - this.pageX);\n        var mouseY = (this.resizeBtnStat.topLeft || this.resizeBtnStat.topRight) ? -(pageY - this.pageY) : (pageY - this.pageY);\n        var width = parseInt(this.imgDupPos.width, 10) + mouseX;\n        var height = parseInt(this.imgDupPos.height, 10) + mouseY;\n        this.mousex = mouseX;\n        this.pageX = pageX;\n        this.pageY = pageY;\n        if (this.resizeBtnStat.botRight) {\n            this.imgDupMouseMove(width + 'px', height + 'px', e);\n        }\n        else if (this.resizeBtnStat.botLeft) {\n            this.imgDupMouseMove(width + 'px', height + 'px', e);\n        }\n        else if (this.resizeBtnStat.topRight) {\n            this.imgDupMouseMove(width + 'px', height + 'px', e);\n        }\n        else if (this.resizeBtnStat.topLeft) {\n            this.imgDupMouseMove(width + 'px', height + 'px', e);\n        }\n    };\n    Image.prototype.cancelResizeAction = function () {\n        EventHandler.remove(this.contentModule.getDocument(), Browser.touchMoveEvent, this.resizing);\n        EventHandler.remove(this.contentModule.getDocument(), Browser.touchEndEvent, this.resizeEnd);\n        if (this.imgEle && this.imgResizeDiv && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n            detach(this.imgResizeDiv);\n            this.imgEle.style.outline = '';\n            this.imgResizeDiv = null;\n            this.pageX = null;\n            this.pageY = null;\n        }\n    };\n    Image.prototype.resizeImgDupPos = function (e) {\n        this.imgDupPos = {\n            width: (e.style.width !== '' && (this.parent.insertImageSettings &&\n                !this.parent.insertImageSettings.resizeByPercent)) ? this.imgEle.style.width : e.width + 'px',\n            height: (e.style.height !== '') ? this.imgEle.style.height : e.height + 'px'\n        };\n    };\n    Image.prototype.resizeBtnInit = function () {\n        return this.resizeBtnStat = { botLeft: false, botRight: false, topRight: false, topLeft: false };\n    };\n    Image.prototype.onToolbarAction = function (args) {\n        if (isIDevice()) {\n            this.parent.notify(events.selectionRestore, {});\n        }\n        var item = args.args.item;\n        switch (item.subCommand) {\n            case 'Replace':\n                if (this.parent.fileManagerSettings.enable) {\n                    this.parent.notify(events.renderFileManager, args);\n                }\n                else {\n                    this.parent.notify(events.insertImage, args);\n                }\n                break;\n            case 'Caption':\n                this.parent.notify(events.imageCaption, args);\n                break;\n            case 'InsertLink':\n                this.parent.notify(events.imageLink, args);\n                break;\n            case 'AltText':\n                this.parent.notify(events.imageAlt, args);\n                break;\n            case 'Remove':\n                this.parent.notify(events.imageDelete, args);\n                break;\n            case 'Dimension':\n                this.parent.notify(events.imageSize, args);\n                break;\n            case 'OpenImageLink':\n                this.openImgLink(args);\n                break;\n            case 'EditImageLink':\n                this.editImgLink(args);\n                break;\n            case 'RemoveImageLink':\n                this.removeImgLink(args);\n                break;\n        }\n    };\n    Image.prototype.openImgLink = function (e) {\n        var target = e.selectParent[0].parentNode.target === '' ? '_self' : '_blank';\n        this.parent.formatter.process(this.parent, e.args, e.args, {\n            url: e.selectParent[0].parentNode.href, target: target, selectNode: e.selectNode,\n            subCommand: e.args.item.subCommand\n        });\n    };\n    Image.prototype.editImgLink = function (e) {\n        var selectParentEle = e.selectParent[0].parentNode;\n        var linkUpdate = this.i10n.getConstant('dialogUpdate');\n        var inputDetails = {\n            url: selectParentEle.href, target: selectParentEle.target,\n            header: 'Edit Link', btnText: linkUpdate\n        };\n        this.insertImgLink(e, inputDetails);\n    };\n    Image.prototype.removeImgLink = function (e) {\n        if (Browser.isIE) {\n            this.contentModule.getEditPanel().focus();\n        }\n        e.selection.restore();\n        var isCapLink = (this.contentModule.getEditPanel().contains(this.captionEle) && select('a', this.captionEle)) ?\n            true : false;\n        var selectParent = isCapLink ? [this.captionEle] : [e.selectNode[0].parentElement];\n        this.parent.formatter.process(this.parent, e.args, e.args, {\n            insertElement: e.selectNode[0], selectParent: selectParent, selection: e.selection,\n            subCommand: e.args.item.subCommand\n        });\n        if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n            this.quickToolObj.imageQTBar.hidePopup();\n            if (!isNullOrUndefined(e.selectParent)) {\n                removeClass([e.selectParent[0]], 'e-img-focus');\n            }\n        }\n        if (isCapLink) {\n            select('.e-img-inner', this.captionEle).focus();\n        }\n    };\n    Image.prototype.onKeyDown = function (event) {\n        var originalEvent = event.args;\n        var range;\n        var save;\n        var selectNodeEle;\n        var selectParentEle;\n        this.deletedImg = [];\n        var isCursor;\n        var keyCodeValues = [27, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123,\n            44, 45, 9, 16, 17, 18, 19, 20, 33, 34, 35, 36, 37, 38, 39, 40, 91, 92, 93, 144, 145, 182, 183];\n        if (this.parent.editorMode === 'HTML') {\n            range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n            isCursor = range.startContainer === range.endContainer && range.startOffset === range.endOffset;\n        }\n        if (!isCursor && this.parent.editorMode === 'HTML' && keyCodeValues.indexOf(originalEvent.which) < 0) {\n            var nodes = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n            for (var i = 0; i < nodes.length; i++) {\n                if (nodes[i].nodeName === 'IMG') {\n                    this.deletedImg.push(nodes[i]);\n                }\n            }\n        }\n        if (this.parent.editorMode === 'HTML' && ((originalEvent.which === 8 && originalEvent.code === 'Backspace') ||\n            (originalEvent.which === 46 && originalEvent.code === 'Delete'))) {\n            var isCursor_1 = range.startContainer === range.endContainer && range.startOffset === range.endOffset;\n            if ((originalEvent.which === 8 && originalEvent.code === 'Backspace' && isCursor_1)) {\n                this.checkImageBack(range);\n            }\n            else if ((originalEvent.which === 46 && originalEvent.code === 'Delete' && isCursor_1)) {\n                this.checkImageDel(range);\n            }\n        }\n        if (!isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection) &&\n            originalEvent.code !== 'KeyK') {\n            range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n            save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n            selectNodeEle = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n            selectParentEle = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n            if (!originalEvent.ctrlKey && originalEvent.key && (originalEvent.key.length === 1 || originalEvent.action === 'enter') &&\n                (selectParentEle[0].tagName === 'IMG') && selectParentEle[0].parentElement) {\n                var prev = selectParentEle[0].parentElement.childNodes[0];\n                if (this.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n                    this.removeResizeEle();\n                }\n                this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(), prev, prev, prev.textContent.length, prev.textContent.length);\n                removeClass([selectParentEle[0]], 'e-img-focus');\n                this.quickToolObj.imageQTBar.hidePopup();\n            }\n        }\n        if (originalEvent.ctrlKey && (originalEvent.keyCode === 89 || originalEvent.keyCode === 90)) {\n            this.undoStack({ subCommand: (originalEvent.keyCode === 90 ? 'undo' : 'redo') });\n        }\n        if (originalEvent.keyCode === 8 || originalEvent.keyCode === 46) {\n            if (selectNodeEle && selectNodeEle[0].nodeName === 'IMG' && selectNodeEle.length < 1) {\n                originalEvent.preventDefault();\n                var event_1 = {\n                    selectNode: selectNodeEle, selection: save, selectParent: selectParentEle,\n                    args: {\n                        item: { command: 'Images', subCommand: 'Remove' },\n                        originalEvent: originalEvent\n                    }\n                };\n                this.deleteImg(event_1, originalEvent.keyCode);\n            }\n            if (this.parent.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n                this.removeResizeEle();\n            }\n        }\n        if (originalEvent.code === 'Backspace') {\n            originalEvent.action = 'backspace';\n        }\n        switch (originalEvent.action) {\n            case 'escape':\n                if (!isNullOrUndefined(this.dialogObj)) {\n                    this.dialogObj.close();\n                }\n                break;\n            case 'backspace':\n            case 'delete':\n                for (var i = 0; i < this.deletedImg.length; i++) {\n                    var src = this.deletedImg[i].src;\n                    this.imageRemovePost(src);\n                }\n                if (this.parent.editorMode !== 'Markdown') {\n                    if (range.startContainer.nodeType === 3) {\n                        if (originalEvent.code === 'Backspace') {\n                            if (range.startContainer.previousElementSibling && range.startOffset === 0 &&\n                                range.startContainer.previousElementSibling.classList.contains(classes.CLS_CAPTION) &&\n                                range.startContainer.previousElementSibling.classList.contains(classes.CLS_CAPINLINE)) {\n                                detach(range.startContainer.previousElementSibling);\n                            }\n                        }\n                        else {\n                            if (range.startContainer.nextElementSibling &&\n                                range.endContainer.textContent.length === range.endOffset &&\n                                range.startContainer.nextElementSibling.classList.contains(classes.CLS_CAPTION) &&\n                                range.startContainer.nextElementSibling.classList.contains(classes.CLS_CAPINLINE)) {\n                                detach(range.startContainer.nextElementSibling);\n                            }\n                        }\n                    }\n                    else if ((range.startContainer.nodeType === 1 &&\n                        range.startContainer.querySelector('.' + classes.CLS_CAPTION + '.' + classes.CLS_CAPINLINE))) {\n                        detach(range.startContainer.querySelector('.' + classes.CLS_CAPTION + '.' + classes.CLS_CAPINLINE));\n                    }\n                    else if (range.startContainer.nodeType === 1 &&\n                        range.startContainer.querySelector('.' + classes.CLS_CAPTION + '.' + classes.CLS_IMGBREAK)) {\n                        detach(range.startContainer.querySelector('.' + classes.CLS_CAPTION + '.' + classes.CLS_IMGBREAK));\n                    }\n                }\n                break;\n            case 'insert-image':\n                this.openDialog(true, originalEvent, save, selectNodeEle, selectParentEle);\n                originalEvent.preventDefault();\n                break;\n        }\n    };\n    Image.prototype.openDialog = function (isInternal, event, selection, ele, parentEle) {\n        var range;\n        var save;\n        var selectNodeEle;\n        var selectParentEle;\n        if (!isInternal && !isNOU(this.parent.formatter.editorManager.nodeSelection)) {\n            range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n            save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n            selectNodeEle = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n            selectParentEle = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n        }\n        else {\n            save = selection;\n            selectNodeEle = ele;\n            selectParentEle = parentEle;\n        }\n        if (this.parent.editorMode === 'HTML') {\n            this.insertImage({\n                args: {\n                    item: { command: 'Images', subCommand: 'Image' },\n                    originalEvent: event\n                },\n                selectNode: selectNodeEle,\n                selection: save,\n                selectParent: selectParentEle\n            });\n        }\n        else {\n            this.insertImage({\n                args: {\n                    item: { command: 'Images', subCommand: 'Image' },\n                    originalEvent: event\n                },\n                member: 'image',\n                text: this.parent.formatter.editorManager.markdownSelection.getSelectedText(this.parent.contentModule.getEditPanel()),\n                module: 'Markdown',\n                name: 'insertImage'\n            });\n        }\n    };\n    Image.prototype.showDialog = function () {\n        this.openDialog(false);\n        this.setCssClass({ cssClass: this.parent.cssClass });\n    };\n    Image.prototype.closeDialog = function () {\n        if (this.dialogObj) {\n            this.dialogObj.hide({ returnValue: true });\n        }\n    };\n    // eslint-disable-next-line\n    Image.prototype.onKeyUp = function (event) {\n        if (!isNOU(this.deletedImg) && this.deletedImg.length > 0) {\n            for (var i = 0; i < this.deletedImg.length; i++) {\n                var args = {\n                    element: this.deletedImg[i],\n                    src: this.deletedImg[i].getAttribute('src')\n                };\n                this.parent.trigger(events.afterImageDelete, args);\n            }\n        }\n    };\n    Image.prototype.checkImageBack = function (range) {\n        if (range.startContainer.nodeName === '#text' && range.startOffset === 0 &&\n            !isNOU(range.startContainer.previousSibling) && range.startContainer.previousSibling.nodeName === 'IMG') {\n            this.deletedImg.push(range.startContainer.previousSibling);\n        }\n        else if (range.startContainer.nodeName !== '#text' && !isNOU(range.startContainer.childNodes[range.startOffset - 1]) &&\n            range.startContainer.childNodes[range.startOffset - 1].nodeName === 'IMG') {\n            this.deletedImg.push(range.startContainer.childNodes[range.startOffset - 1]);\n        }\n    };\n    Image.prototype.checkImageDel = function (range) {\n        if (range.startContainer.nodeName === '#text' && range.startOffset === range.startContainer.textContent.length &&\n            !isNOU(range.startContainer.nextSibling) && range.startContainer.nextSibling.nodeName === 'IMG') {\n            this.deletedImg.push(range.startContainer.nextSibling);\n        }\n        else if (range.startContainer.nodeName !== '#text' && !isNOU(range.startContainer.childNodes[range.startOffset]) &&\n            range.startContainer.childNodes[range.startOffset].nodeName === 'IMG') {\n            this.deletedImg.push(range.startContainer.childNodes[range.startOffset]);\n        }\n    };\n    Image.prototype.alignmentSelect = function (e) {\n        var item = e.item;\n        if (!document.body.contains(document.body.querySelector('.e-rte-quick-toolbar')) || item.command !== 'Images') {\n            return;\n        }\n        var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n        var selectNodeEle = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n        selectNodeEle = (selectNodeEle[0].nodeName === 'IMG') ? selectNodeEle : [this.imgEle];\n        var args = { args: e, selectNode: selectNodeEle };\n        if (this.parent.formatter.getUndoRedoStack().length === 0) {\n            this.parent.formatter.saveData();\n        }\n        switch (item.subCommand) {\n            case 'JustifyLeft':\n                this.alignImage(args, 'JustifyLeft');\n                break;\n            case 'JustifyCenter':\n                this.alignImage(args, 'JustifyCenter');\n                break;\n            case 'JustifyRight':\n                this.alignImage(args, 'JustifyRight');\n                break;\n            case 'Inline':\n                this.inline(args);\n                break;\n            case 'Break':\n                this.break(args);\n                break;\n        }\n        if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n            this.quickToolObj.imageQTBar.hidePopup();\n            removeClass([selectNodeEle[0]], 'e-img-focus');\n        }\n        this.cancelResizeAction();\n    };\n    Image.prototype.imageWithLinkQTBarItemUpdate = function () {\n        var separator;\n        var items = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item');\n        for (var i = 0; i < items.length; i++) {\n            if (items[i].getAttribute('title') === this.i10n.getConstant('openLink') ||\n                items[i].getAttribute('title') === this.i10n.getConstant('editLink') ||\n                items[i].getAttribute('title') === this.i10n.getConstant('removeLink')) {\n                addClass([items[i]], 'e-link-groups');\n                items[i].style.display = 'none';\n            }\n            else if (items[i].getAttribute('title') === 'Insert Link') {\n                items[i].style.display = '';\n            }\n            else if (items[i].classList.contains('e-rte-horizontal-separator')) {\n                // eslint-disable-next-line\n                separator = items[i];\n                detach(items[i]);\n            }\n        }\n        var newItems = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item:not(.e-link-groups)');\n        this.quickToolObj.imageQTBar.addQTBarItem(['-'], Math.round(newItems.length / 2));\n    };\n    Image.prototype.showImageQuickToolbar = function (e) {\n        var _this = this;\n        if (e.type !== 'Images' || isNullOrUndefined(this.parent.quickToolbarModule)\n            || isNullOrUndefined(this.parent.quickToolbarModule.imageQTBar) || isNullOrUndefined(e.args)) {\n            return;\n        }\n        this.quickToolObj = this.parent.quickToolbarModule;\n        var args = e.args;\n        var target = e.elements;\n        [].forEach.call(e.elements, function (element, index) {\n            if (index === 0) {\n                target = element;\n            }\n        });\n        if (target && !closest(target, 'a')) {\n            this.imageWithLinkQTBarItemUpdate();\n        }\n        if (target.nodeName === 'IMG') {\n            addClass([target], ['e-img-focus']);\n        }\n        var pageY = (this.parent.iframeSettings.enable) ? window.pageYOffset +\n            this.parent.element.getBoundingClientRect().top + args.clientY : args.pageY;\n        if (this.parent.quickToolbarModule.imageQTBar) {\n            if (e.isNotify) {\n                setTimeout(function () {\n                    _this.parent.formatter.editorManager.nodeSelection.Clear(_this.contentModule.getDocument());\n                    _this.parent.formatter.editorManager.nodeSelection.setSelectionContents(_this.contentModule.getDocument(), target);\n                    _this.quickToolObj.imageQTBar.showPopup(args.pageX, pageY, target);\n                }, 400);\n            }\n            else {\n                this.quickToolObj.imageQTBar.showPopup(args.pageX, pageY, target);\n            }\n        }\n    };\n    Image.prototype.hideImageQuickToolbar = function () {\n        if (!isNullOrUndefined(this.contentModule.getEditPanel().querySelector('.e-img-focus'))) {\n            removeClass([this.contentModule.getEditPanel().querySelector('.e-img-focus')], 'e-img-focus');\n            if (this.quickToolObj && this.quickToolObj.imageQTBar && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n                this.quickToolObj.imageQTBar.hidePopup();\n            }\n        }\n    };\n    Image.prototype.editAreaClickHandler = function (e) {\n        if (this.parent.readonly) {\n            this.hideImageQuickToolbar();\n            return;\n        }\n        var args = e.args;\n        var showOnRightClick = this.parent.quickToolbarSettings.showOnRightClick;\n        if (args.which === 2 || (showOnRightClick && args.which === 1) || (!showOnRightClick && args.which === 3)) {\n            if ((showOnRightClick && args.which === 1) && !isNullOrUndefined(args.target) &&\n                args.target.tagName === 'IMG') {\n                this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument());\n                this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(), args.target);\n            }\n            return;\n        }\n        if (this.parent.editorMode === 'HTML' && this.parent.quickToolbarModule && this.parent.quickToolbarModule.imageQTBar) {\n            this.quickToolObj = this.parent.quickToolbarModule;\n            var target = args.target;\n            this.contentModule = this.rendererFactory.getRenderer(RenderType.Content);\n            var isPopupOpen = this.quickToolObj.imageQTBar.element.classList.contains('e-rte-pop');\n            if (target.nodeName === 'IMG' && this.parent.quickToolbarModule) {\n                if (isPopupOpen) {\n                    return;\n                }\n                this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument());\n                this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(), target);\n                if (isIDevice()) {\n                    this.parent.notify(events.selectionSave, e);\n                }\n                addClass([target], 'e-img-focus');\n                var items = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item');\n                var separator = void 0;\n                if (closest(target, 'a')) {\n                    for (var i = 0; i < items.length; i++) {\n                        if (items[i].getAttribute('title') === this.i10n.getConstant('openLink') ||\n                            items[i].getAttribute('title') === this.i10n.getConstant('editLink') ||\n                            items[i].getAttribute('title') === this.i10n.getConstant('removeLink')) {\n                            items[i].style.display = '';\n                            removeClass([items[i]], 'e-link-groups');\n                        }\n                        else if (items[i].getAttribute('title') === 'Insert Link') {\n                            items[i].style.display = 'none';\n                        }\n                        else if (items[i].classList.contains('e-rte-horizontal-separator')) {\n                            // eslint-disable-next-line\n                            separator = items[i];\n                            detach(items[i]);\n                        }\n                    }\n                    var newItems = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item:not(.e-link-groups)');\n                    this.quickToolObj.imageQTBar.addQTBarItem(['-'], Math.round(newItems.length / 2));\n                }\n                else if (!closest(target, 'a')) {\n                    this.imageWithLinkQTBarItemUpdate();\n                }\n                this.showImageQuickToolbar({ args: args, type: 'Images', elements: [args.target] });\n            }\n            else {\n                this.hideImageQuickToolbar();\n            }\n        }\n    };\n    Image.prototype.insertImgLink = function (e, inputDetails) {\n        var _this = this;\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        this.imagDialog(e);\n        if (!isNullOrUndefined(this.dialogObj)) {\n            var linkWrap = this.parent.createElement('div', { className: 'e-img-linkwrap' + ' ' + this.parent.cssClass });\n            var linkUrl = this.i10n.getConstant('linkurl');\n            var content = '<div class=\"e-rte-field' + ' ' + this.parent.cssClass + '\">' +\n                '<input type=\"text\" data-role =\"none\" class=\"e-input e-img-link' + ' ' + this.parent.cssClass + '\" spellcheck=\"false\" placeholder=\"' + linkUrl + '\"/></div>' +\n                '<div class=\"e-rte-label\"></div>' + '<div class=\"e-rte-field\">' +\n                '<input type=\"checkbox\" class=\"e-rte-linkTarget' + ' ' + this.parent.cssClass + '\"  data-role =\"none\"></div>';\n            var contentElem = parseHtml(content);\n            linkWrap.appendChild(contentElem);\n            var linkTarget = linkWrap.querySelector('.e-rte-linkTarget');\n            var inputLink = linkWrap.querySelector('.e-img-link');\n            var linkOpenLabel = this.i10n.getConstant('linkOpenInNewWindow');\n            this.checkBoxObj = new CheckBox({\n                label: linkOpenLabel, checked: true, enableRtl: this.parent.enableRtl, cssClass: this.parent.cssClass,\n                change: function (e) {\n                    if (e.checked) {\n                        target_1 = '_blank';\n                    }\n                    else {\n                        target_1 = null;\n                    }\n                }\n            });\n            this.checkBoxObj.isStringTemplate = true;\n            this.checkBoxObj.createElement = this.parent.createElement;\n            this.checkBoxObj.appendTo(linkTarget);\n            var target_1 = this.checkBoxObj.checked ? '_blank' : null;\n            var linkUpdate = this.i10n.getConstant('dialogUpdate');\n            var linkargs_1 = {\n                args: e.args,\n                selfImage: this, selection: e.selection,\n                selectNode: e.selectNode, selectParent: e.selectParent, link: inputLink, target: target_1\n            };\n            this.dialogObj.setProperties({\n                height: 'inherit',\n                width: '290px',\n                header: this.parent.localeObj.getConstant('imageInsertLinkHeader'),\n                content: linkWrap,\n                position: { X: 'center', Y: 'center' },\n                buttons: [{\n                        // eslint-disable-next-line\n                        click: function (e) {\n                            _this.insertlink(linkargs_1);\n                        },\n                        buttonModel: {\n                            content: linkUpdate, cssClass: 'e-flat e-update-link' + ' ' + this.parent.cssClass, isPrimary: true\n                        }\n                    }],\n                cssClass: this.dialogObj.cssClass + ' e-rte-img-link-dialog'\n            });\n            if (!isNOU(this.parent.cssClass)) {\n                this.dialogObj.setProperties({ cssClass: this.parent.cssClass });\n            }\n            if (!isNullOrUndefined(inputDetails)) {\n                inputLink.value = inputDetails.url;\n                // eslint-disable-next-line\n                (inputDetails.target) ? this.checkBoxObj.checked = true : this.checkBoxObj.checked = false;\n                this.dialogObj.header = inputDetails.header;\n            }\n            this.dialogObj.element.style.maxHeight = 'inherit';\n            this.dialogObj.content.querySelector('input').focus();\n        }\n    };\n    Image.prototype.insertAltText = function (e) {\n        var _this = this;\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        this.imagDialog(e);\n        var altText = this.i10n.getConstant('altText');\n        if (!isNullOrUndefined(this.dialogObj)) {\n            var altWrap = this.parent.createElement('div', { className: 'e-img-altwrap' + ' ' + this.parent.cssClass });\n            var altHeader = this.i10n.getConstant('alternateHeader');\n            var linkUpdate = this.i10n.getConstant('dialogUpdate');\n            var getAlt = (e.selectNode[0].getAttribute('alt') === null) ? '' :\n                e.selectNode[0].getAttribute('alt');\n            var content = '<div class=\"e-rte-field' + ' ' + this.parent.cssClass + '\">' +\n                '<input type=\"text\" spellcheck=\"false\" value=\"' + getAlt + '\" class=\"e-input e-img-alt' + ' ' + this.parent.cssClass + '\" placeholder=\"' + altText + '\"/>' +\n                '</div>';\n            var contentElem = parseHtml(content);\n            altWrap.appendChild(contentElem);\n            var inputAlt = altWrap.querySelector('.e-img-alt');\n            var altArgs_1 = {\n                args: e.args, selfImage: this, selection: e.selection, selectNode: e.selectNode,\n                alt: inputAlt\n            };\n            this.dialogObj.setProperties({\n                height: 'inherit', width: '290px', header: altHeader, content: altWrap, position: { X: 'center', Y: 'center' },\n                buttons: [{\n                        // eslint-disable-next-line\n                        click: function (e) {\n                            _this.insertAlt(altArgs_1);\n                        },\n                        buttonModel: {\n                            content: linkUpdate, cssClass: 'e-flat e-update-alt' + ' ' + this.parent.cssClass, isPrimary: true\n                        }\n                    }],\n                cssClass: this.dialogObj.cssClass + ' e-rte-img-alt-dialog'\n            });\n            if (!isNOU(this.parent.cssClass)) {\n                this.dialogObj.setProperties({ cssClass: this.parent.cssClass });\n            }\n            this.dialogObj.element.style.maxHeight = 'inherit';\n            this.dialogObj.content.querySelector('input').focus();\n        }\n    };\n    Image.prototype.insertAlt = function (e) {\n        if (!isNullOrUndefined(e.alt)) {\n            e.selection.restore();\n            if (this.parent.formatter.getUndoRedoStack().length === 0) {\n                this.parent.formatter.saveData();\n            }\n            var altText = e.alt.value;\n            this.parent.formatter.process(this.parent, e.args, e.args, {\n                altText: altText, selectNode: e.selectNode,\n                subCommand: e.args.item.subCommand\n            });\n            this.dialogObj.hide({ returnValue: false });\n        }\n    };\n    Image.prototype.insertlink = function (e) {\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        var url = e.link.value;\n        if (url === '') {\n            addClass([e.link], 'e-error');\n            e.link.setSelectionRange(0, url.length);\n            e.link.focus();\n            return;\n        }\n        if (!this.isUrl(url)) {\n            url = 'http://' + url;\n        }\n        else {\n            removeClass([e.link], 'e-error');\n        }\n        var proxy = e.selfImage;\n        if (proxy.parent.editorMode === 'HTML') {\n            e.selection.restore();\n        }\n        if (proxy.parent.formatter.getUndoRedoStack().length === 0) {\n            proxy.parent.formatter.saveData();\n        }\n        if (e.selectNode[0].parentElement.nodeName === 'A') {\n            proxy.parent.formatter.process(proxy.parent, e.args, e.args, {\n                url: url, target: proxy.checkBoxObj.checked ? '_blank' : null, selectNode: e.selectNode,\n                subCommand: e.args.item.subCommand\n            });\n            proxy.dialogObj.hide({ returnValue: true });\n            return;\n        }\n        proxy.parent.formatter.process(proxy.parent, e.args, e.args, {\n            url: url, target: proxy.checkBoxObj.checked ? '_blank' : null, selectNode: e.selectNode,\n            subCommand: e.args.item.subCommand, selection: e.selection\n        });\n        var captionEle = closest(e.selectNode[0], '.e-img-caption');\n        if (captionEle) {\n            select('.e-img-inner', captionEle).focus();\n        }\n        if (captionEle) {\n            select('.e-img-inner', captionEle).focus();\n        }\n        proxy.dialogObj.hide({ returnValue: false });\n    };\n    Image.prototype.isUrl = function (url) {\n        // eslint-disable-next-line\n        var regexp = /(ftp|http|https):\\/\\/(\\w+:{0,1}\\w*@)?(\\S+)(:[0-9]+)?(\\/|\\/([\\w#!:.?+=&%@!\\-\\/]))?/gi;\n        return regexp.test(url);\n    };\n    Image.prototype.deleteImg = function (e, keyCode) {\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        var args = {\n            element: e.selectNode[0],\n            src: e.selectNode[0].getAttribute('src')\n        };\n        if (this.parent.formatter.getUndoRedoStack().length === 0) {\n            this.parent.formatter.saveData();\n        }\n        e.selection.restore();\n        if (this.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n            this.removeResizeEle();\n        }\n        this.parent.formatter.process(this.parent, e.args, e.args, {\n            selectNode: e.selectNode,\n            captionClass: classes.CLS_CAPTION,\n            subCommand: e.args.item.subCommand\n        });\n        this.imageRemovePost(args.src);\n        if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n            this.quickToolObj.imageQTBar.hidePopup();\n        }\n        this.cancelResizeAction();\n        if (isNullOrUndefined(keyCode)) {\n            this.parent.trigger(events.afterImageDelete, args);\n        }\n    };\n    Image.prototype.imageRemovePost = function (src) {\n        var proxy = this;\n        var absoluteUrl = '';\n        if (isNOU(this.parent.insertImageSettings.removeUrl) || this.parent.insertImageSettings.removeUrl === '') {\n            return;\n        }\n        if (src.indexOf('http://') > -1 || src.indexOf('https://') > -1) {\n            absoluteUrl = src;\n        }\n        else {\n            absoluteUrl = new URL(src, document.baseURI).href;\n        }\n        this.removingImgName = absoluteUrl.replace(/^.*[\\\\\\/]/, '');\n        var xhr = new XMLHttpRequest();\n        xhr.addEventListener(\"readystatechange\", function () {\n            if (this.readyState == 4 && this.status == 200) {\n                proxy.triggerPost(this.response);\n            }\n        });\n        xhr.open('GET', absoluteUrl);\n        xhr.responseType = 'blob';\n        xhr.send();\n    };\n    Image.prototype.triggerPost = function (response) {\n        var removeUrl = this.parent.insertImageSettings.removeUrl;\n        if (isNOU(removeUrl) || removeUrl === '') {\n            return;\n        }\n        var file = new File([response], this.removingImgName);\n        var ajax = new Ajax(removeUrl, 'POST', true, null);\n        var formData = new FormData();\n        formData.append('UploadFiles', file);\n        ajax.send(formData);\n    };\n    Image.prototype.caption = function (e) {\n        var selectNode = e.selectNode[0];\n        if (selectNode.nodeName !== 'IMG') {\n            return;\n        }\n        e.selection.restore();\n        if (this.parent.formatter.getUndoRedoStack().length === 0) {\n            this.parent.formatter.saveData();\n        }\n        this.cancelResizeAction();\n        addClass([selectNode], 'e-rte-image');\n        var subCommand = (e.args.item) ?\n            e.args.item.subCommand : 'Caption';\n        if (!isNullOrUndefined(closest(selectNode, '.' + classes.CLS_CAPTION))) {\n            detach(closest(selectNode, '.' + classes.CLS_CAPTION));\n            if (Browser.isIE) {\n                this.contentModule.getEditPanel().focus();\n                e.selection.restore();\n            }\n            if (selectNode.parentElement.tagName === 'A') {\n                this.parent.formatter.process(this.parent, e.args, e.args, { insertElement: selectNode.parentElement, selectNode: e.selectNode, subCommand: subCommand });\n            }\n            else {\n                this.parent.formatter.process(this.parent, e.args, e.args, { insertElement: selectNode, selectNode: e.selectNode, subCommand: subCommand });\n            }\n        }\n        else {\n            this.captionEle = this.parent.createElement('span', {\n                className: classes.CLS_CAPTION + ' ' + classes.CLS_RTE_CAPTION + ' ' + this.parent.cssClass,\n                attrs: { contenteditable: 'false', draggable: 'false', style: 'width:' + this.parent.insertImageSettings.width }\n            });\n            var imgWrap = this.parent.createElement('span', { className: 'e-img-wrap' + ' ' + this.parent.cssClass });\n            var imgInner = this.parent.createElement('span', { className: 'e-img-inner' + ' ' + this.parent.cssClass,\n                attrs: { contenteditable: 'true' } });\n            var parent_1 = e.selectNode[0].parentElement;\n            if (parent_1.tagName === 'A') {\n                parent_1.setAttribute('contenteditable', 'true');\n            }\n            imgWrap.appendChild(parent_1.tagName === 'A' ? parent_1 : e.selectNode[0]);\n            imgWrap.appendChild(imgInner);\n            var imgCaption = this.i10n.getConstant('imageCaption');\n            imgInner.innerHTML = imgCaption;\n            this.captionEle.appendChild(imgWrap);\n            if (selectNode.classList.contains(classes.CLS_IMGINLINE)) {\n                addClass([this.captionEle], classes.CLS_CAPINLINE);\n            }\n            if (selectNode.classList.contains(classes.CLS_IMGBREAK)) {\n                addClass([this.captionEle], classes.CLS_IMGBREAK);\n            }\n            if (selectNode.classList.contains(classes.CLS_IMGLEFT)) {\n                addClass([this.captionEle], classes.CLS_IMGLEFT);\n            }\n            if (selectNode.classList.contains(classes.CLS_IMGRIGHT)) {\n                addClass([this.captionEle], classes.CLS_IMGRIGHT);\n            }\n            if (selectNode.classList.contains(classes.CLS_IMGCENTER)) {\n                addClass([this.captionEle], classes.CLS_IMGCENTER);\n            }\n            this.parent.formatter.process(this.parent, e.args, e.args, { insertElement: this.captionEle, selectNode: e.selectNode, subCommand: subCommand });\n            this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(), imgInner.childNodes[0], imgInner.childNodes[0], 0, imgInner.childNodes[0].textContent.length);\n        }\n        if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n            this.quickToolObj.imageQTBar.hidePopup();\n            removeClass([selectNode], 'e-img-focus');\n        }\n    };\n    Image.prototype.imageSize = function (e) {\n        var _this = this;\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        this.imagDialog(e);\n        if (!isNullOrUndefined(this.dialogObj)) {\n            var imgSizeHeader = this.i10n.getConstant('imageSizeHeader');\n            var linkUpdate = this.i10n.getConstant('dialogUpdate');\n            var dialogContent = this.imgsizeInput(e);\n            var selectObj_1 = { args: e.args, selfImage: this, selection: e.selection, selectNode: e.selectNode };\n            this.dialogObj.setProperties({\n                height: 'inherit', width: '290px', header: imgSizeHeader, content: dialogContent, position: { X: 'center', Y: 'center' },\n                buttons: [{\n                        // eslint-disable-next-line\n                        click: function (e) {\n                            _this.insertSize(selectObj_1);\n                        },\n                        buttonModel: {\n                            content: linkUpdate, cssClass: 'e-flat e-update-size' + ' ' + this.parent.cssClass, isPrimary: true\n                        }\n                    }],\n                cssClass: this.dialogObj.cssClass + ' e-rte-img-size-dialog'\n            });\n            if (!isNOU(this.parent.cssClass)) {\n                this.dialogObj.setProperties({ cssClass: this.parent.cssClass });\n            }\n            this.dialogObj.element.style.maxHeight = 'inherit';\n            this.dialogObj.content.querySelector('input').focus();\n        }\n    };\n    Image.prototype.break = function (e) {\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        var subCommand = (e.args.item) ?\n            e.args.item.subCommand : 'Break';\n        this.parent.formatter.process(this.parent, e.args, e.args, { selectNode: e.selectNode, subCommand: subCommand });\n    };\n    Image.prototype.inline = function (e) {\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        var subCommand = (e.args.item) ?\n            e.args.item.subCommand : 'Inline';\n        this.parent.formatter.process(this.parent, e.args, e.args, { selectNode: e.selectNode, subCommand: subCommand });\n    };\n    Image.prototype.alignImage = function (e, type) {\n        var subCommand = (e.args.item) ?\n            e.args.item.subCommand : type;\n        this.parent.formatter.process(this.parent, e.args, e.args, { selectNode: e.selectNode, subCommand: subCommand });\n    };\n    Image.prototype.clearDialogObj = function () {\n        if (this.dialogObj) {\n            this.dialogObj.destroy();\n            detach(this.dialogObj.element);\n            this.dialogObj = null;\n        }\n    };\n    Image.prototype.imagDialog = function (e) {\n        var _this = this;\n        if (this.dialogObj) {\n            this.dialogObj.hide({ returnValue: true });\n            return;\n        }\n        var imgDialog = this.parent.createElement('div', { className: 'e-rte-img-dialog' + ' ' + this.parent.cssClass, id: this.rteID + '_image' });\n        this.parent.element.appendChild(imgDialog);\n        var imgInsert = this.i10n.getConstant('dialogInsert');\n        var imglinkCancel = this.i10n.getConstant('dialogCancel');\n        var imgHeader = this.i10n.getConstant('imageHeader');\n        var selection = e.selection;\n        var selectObj = { selfImage: this, selection: e.selection, args: e.args, selectParent: e.selectParent };\n        var dialogModel = {\n            header: imgHeader,\n            cssClass: classes.CLS_RTE_ELEMENTS + ' ' + this.parent.cssClass,\n            enableRtl: this.parent.enableRtl,\n            locale: this.parent.locale,\n            showCloseIcon: true, closeOnEscape: true, width: (Browser.isDevice) ? '290px' : '340px', height: 'inherit',\n            position: { X: 'center', Y: (Browser.isDevice) ? 'center' : 'top' },\n            isModal: Browser.isDevice,\n            buttons: [{\n                    click: this.insertImageUrl.bind(selectObj),\n                    buttonModel: { content: imgInsert, cssClass: 'e-flat e-insertImage' + ' ' + this.parent.cssClass, isPrimary: true, disabled: true }\n                },\n                {\n                    click: function (e) {\n                        _this.cancelDialog(e);\n                    },\n                    buttonModel: { cssClass: 'e-flat e-cancel' + ' ' + this.parent.cssClass, content: imglinkCancel }\n                }],\n            target: (Browser.isDevice) ? document.body : this.parent.element,\n            animationSettings: { effect: 'None' },\n            close: function (event) {\n                if (_this.isImgUploaded) {\n                    _this.uploadObj.removing();\n                }\n                _this.parent.isBlur = false;\n                if (event && event.event.returnValue) {\n                    if (_this.parent.editorMode === 'HTML') {\n                        selection.restore();\n                    }\n                    else {\n                        _this.parent.formatter.editorManager.markdownSelection.restore(_this.parent.contentModule.getEditPanel());\n                    }\n                }\n                _this.dialogObj.destroy();\n                detach(_this.dialogObj.element);\n                _this.dialogRenderObj.close(event);\n                _this.dialogObj = null;\n            }\n        };\n        var dialogContent = this.parent.createElement('div', { className: 'e-img-content' + ' ' + this.parent.cssClass });\n        if ((!isNullOrUndefined(this.parent.insertImageSettings.path) && this.parent.editorMode === 'Markdown')\n            || this.parent.editorMode === 'HTML') {\n            dialogContent.appendChild(this.imgUpload(e));\n        }\n        var linkHeader = this.parent.createElement('div', { className: 'e-linkheader' + ' ' + this.parent.cssClass });\n        var linkHeaderText = this.i10n.getConstant('imageLinkHeader');\n        if (this.parent.editorMode === 'HTML') {\n            linkHeader.innerHTML = linkHeaderText;\n        }\n        else {\n            linkHeader.innerHTML = this.i10n.getConstant('mdimageLink');\n        }\n        dialogContent.appendChild(linkHeader);\n        dialogContent.appendChild(this.imageUrlPopup(e));\n        if (e.selectNode && e.selectNode[0].nodeName === 'IMG') {\n            dialogModel.header = this.parent.localeObj.getConstant('editImageHeader');\n            dialogModel.content = dialogContent;\n        }\n        else {\n            dialogModel.content = dialogContent;\n        }\n        this.dialogObj = this.dialogRenderObj.render(dialogModel);\n        this.dialogObj.createElement = this.parent.createElement;\n        this.dialogObj.appendTo(imgDialog);\n        if (isNullOrUndefined(this.dialogObj)) {\n            return;\n        }\n        if (e.selectNode && e.selectNode[0].nodeName === 'IMG' && (e.name === 'insertImage')) {\n            this.dialogObj.element.querySelector('.e-insertImage').textContent = this.parent.localeObj.getConstant('dialogUpdate');\n        }\n        imgDialog.style.maxHeight = 'inherit';\n        if (this.quickToolObj) {\n            if (this.quickToolObj.imageQTBar && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n                this.quickToolObj.imageQTBar.hidePopup();\n                if (!isNullOrUndefined(e.selectParent)) {\n                    removeClass([e.selectParent[0]], 'e-img-focus');\n                }\n            }\n            if (this.quickToolObj.inlineQTBar && document.body.contains(this.quickToolObj.inlineQTBar.element)) {\n                this.quickToolObj.inlineQTBar.hidePopup();\n            }\n        }\n    };\n    // eslint-disable-next-line\n    Image.prototype.cancelDialog = function (e) {\n        this.parent.isBlur = false;\n        this.dialogObj.hide({ returnValue: true });\n        if (this.isImgUploaded) {\n            this.uploadObj.removing();\n        }\n    };\n    Image.prototype.onDocumentClick = function (e) {\n        var target = e.target;\n        if (target.nodeName === 'IMG') {\n            this.imgEle = target;\n        }\n        if (target.nodeName !== '#document') {\n            this.parent.currentTarget = e.target;\n        }\n        if (!isNullOrUndefined(this.dialogObj) && ((\n        // eslint-disable-next-line\n        !closest(target, '[id=' + \"'\" + this.dialogObj.element.id + \"'\" + ']') && this.parent.toolbarSettings.enable && this.parent.getToolbarElement() &&\n            !this.parent.getToolbarElement().contains(e.target)) ||\n            (this.parent.getToolbarElement() && this.parent.getToolbarElement().contains(e.target) &&\n                !closest(target, '#' + this.parent.getID() + '_toolbar_Image') &&\n                !target.querySelector('#' + this.parent.getID() + '_toolbar_Image')))) {\n            /* eslint-disable */\n            if (e.offsetX > e.target.clientWidth || e.offsetY > e.target.clientHeight) {\n            }\n            else {\n                this.dialogObj.hide({ returnValue: true });\n                this.parent.isBlur = true;\n                dispatchEvent(this.parent.element, 'focusout');\n            }\n            /* eslint-enable */\n        }\n        if (!(this.parent.iframeSettings.enable && !isNOU(this.parent.currentTarget) && this.parent.currentTarget.nodeName === 'IMG') &&\n            e.target.tagName !== 'IMG' && this.imgResizeDiv && !(this.quickToolObj &&\n            this.quickToolObj.imageQTBar && this.quickToolObj.imageQTBar.element.contains(e.target)) &&\n            this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n            this.cancelResizeAction();\n        }\n        if (this.contentModule.getEditPanel().querySelector('.e-img-resize') && !(this.parent.iframeSettings.enable && this.parent.currentTarget.nodeName === 'IMG')) {\n            if (target.tagName !== 'IMG') {\n                this.removeResizeEle();\n            }\n            if (target.tagName !== 'IMG' && !isNOU(this.imgEle)) {\n                this.imgEle.style.outline = '';\n            }\n            else if (!isNOU(this.prevSelectedImgEle) && this.prevSelectedImgEle !== target) {\n                this.prevSelectedImgEle.style.outline = '';\n            }\n        }\n    };\n    Image.prototype.removeResizeEle = function () {\n        EventHandler.remove(this.contentModule.getDocument(), Browser.touchMoveEvent, this.resizing);\n        EventHandler.remove(this.contentModule.getDocument(), Browser.touchEndEvent, this.resizeEnd);\n        detach(this.contentModule.getEditPanel().querySelector('.e-img-resize'));\n    };\n    Image.prototype.onWindowResize = function () {\n        if (!isNOU(this.contentModule) && !isNOU(this.contentModule.getEditPanel().querySelector('.e-img-resize'))) {\n            this.cancelResizeAction();\n        }\n    };\n    // eslint-disable-next-line\n    Image.prototype.imageUrlPopup = function (e) {\n        var _this = this;\n        var imgUrl = this.parent.createElement('div', { className: 'imgUrl' + ' ' + this.parent.cssClass });\n        var placeUrl = this.i10n.getConstant('imageUrl');\n        this.inputUrl = this.parent.createElement('input', {\n            className: 'e-input e-img-url' + ' ' + this.parent.cssClass,\n            attrs: { placeholder: placeUrl, spellcheck: 'false' }\n        });\n        this.inputUrl.addEventListener('input', function () {\n            if (!isNOU(_this.inputUrl)) {\n                if (_this.inputUrl.value.length === 0) {\n                    _this.dialogObj.getButtons(0).element.disabled = true;\n                }\n                else {\n                    _this.dialogObj.getButtons(0).element.removeAttribute('disabled');\n                }\n            }\n        });\n        imgUrl.appendChild(this.inputUrl);\n        return imgUrl;\n    };\n    // eslint-disable-next-line\n    Image.prototype.insertImageUrl = function (e) {\n        var proxy = this.selfImage;\n        proxy.isImgUploaded = false;\n        var url = proxy.inputUrl.value;\n        if (proxy.parent.formatter.getUndoRedoStack().length === 0) {\n            proxy.parent.formatter.saveData();\n        }\n        if (!isNullOrUndefined(proxy.uploadUrl) && proxy.uploadUrl.url !== '') {\n            proxy.uploadUrl.cssClass = (proxy.parent.insertImageSettings.display === 'inline' ?\n                classes.CLS_IMGINLINE : classes.CLS_IMGBREAK);\n            proxy.dialogObj.hide({ returnValue: false });\n            proxy.parent.formatter.process(proxy.parent, this.args, this.args.originalEvent, proxy.uploadUrl);\n            proxy.uploadUrl.url = '';\n            if (proxy.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n                proxy.imgEle.style.outline = '';\n                proxy.removeResizeEle();\n            }\n        }\n        else if (url !== '') {\n            if (proxy.parent.editorMode === 'HTML' && isNullOrUndefined(closest(\n            // eslint-disable-next-line\n            this.selection.range.startContainer.parentNode, '[id=' + \"'\" + proxy.contentModule.getPanel().id + \"'\" + ']'))) {\n                proxy.contentModule.getEditPanel().focus();\n                var range = proxy.parent.formatter.editorManager.nodeSelection.getRange(proxy.contentModule.getDocument());\n                this.selection = proxy.parent.formatter.editorManager.nodeSelection.save(range, proxy.contentModule.getDocument());\n                this.selectParent = proxy.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n            }\n            var regex = /[\\w-]+.(jpg|png|jpeg|gif)/g;\n            var matchUrl = (!isNullOrUndefined(url.match(regex)) && proxy.parent.editorMode === 'HTML') ? url.match(regex)[0] : '';\n            var value = {\n                cssClass: (proxy.parent.insertImageSettings.display === 'inline' ? classes.CLS_IMGINLINE : classes.CLS_IMGBREAK),\n                url: url, selection: this.selection, altText: matchUrl,\n                selectParent: this.selectParent, width: {\n                    width: proxy.parent.insertImageSettings.width, minWidth: proxy.parent.insertImageSettings.minWidth,\n                    maxWidth: proxy.parent.getInsertImgMaxWidth()\n                },\n                height: {\n                    height: proxy.parent.insertImageSettings.height, minHeight: proxy.parent.insertImageSettings.minHeight,\n                    maxHeight: proxy.parent.insertImageSettings.maxHeight\n                }\n            };\n            proxy.parent.formatter.process(proxy.parent, this.args, this.args.originalEvent, value);\n            proxy.dialogObj.hide({ returnValue: false });\n        }\n    };\n    Image.prototype.imgsizeInput = function (e) {\n        var _this = this;\n        var selectNode = e.selectNode[0];\n        var imgHeight = this.i10n.getConstant('imageHeight');\n        var imgWidth = this.i10n.getConstant('imageWidth');\n        var imgSizeWrap = this.parent.createElement('div', { className: 'e-img-sizewrap' + ' ' + this.parent.cssClass });\n        var widthVal = isNullOrUndefined(this.changedWidthValue) && (selectNode.style.width.toString() === 'auto' ||\n            selectNode.style.width !== '') ? selectNode.style.width : !isNullOrUndefined(this.changedWidthValue) ?\n            this.changedWidthValue : (parseInt(selectNode.getClientRects()[0].width.toString(), 10)).toString();\n        var heightVal = isNullOrUndefined(this.changedHeightValue) && (selectNode.style.height.toString() === 'auto' ||\n            selectNode.style.height !== '') ? selectNode.style.height : !isNullOrUndefined(this.changedHeightValue) ?\n            this.changedHeightValue : (parseInt(selectNode.getClientRects()[0].height.toString(), 10)).toString();\n        this.changedWidthValue = null;\n        this.changedHeightValue = null;\n        var content = '<div class=\"e-rte-label' + ' ' + this.parent.cssClass + '\"><label>' + imgWidth +\n            '</label></div><div class=\"e-rte-field' + ' ' + this.parent.cssClass + '\"><input type=\"text\" id=\"imgwidth\" class=\"e-img-width' + ' ' + this.parent.cssClass + '\" value=' +\n            widthVal\n            + ' /></div>' +\n            '<div class=\"e-rte-label' + ' ' + this.parent.cssClass + '\">' + '<label>' + imgHeight + '</label></div><div class=\"e-rte-field' + ' ' + this.parent.cssClass + '\"> ' +\n            '<input type=\"text\" id=\"imgheight\" class=\"e-img-height' + ' ' + this.parent.cssClass + '\" value=' +\n            heightVal\n            + ' /></div>';\n        var contentElem = parseHtml(content);\n        imgSizeWrap.appendChild(contentElem);\n        this.widthNum = new TextBox({\n            value: formatUnit(widthVal),\n            enableRtl: this.parent.enableRtl,\n            cssClass: this.parent.cssClass,\n            input: function (e) {\n                _this.inputWidthValue = formatUnit(_this.inputValue(e.value));\n            }\n        });\n        this.widthNum.createElement = this.parent.createElement;\n        this.widthNum.appendTo(imgSizeWrap.querySelector('#imgwidth'));\n        this.heightNum = new TextBox({\n            value: formatUnit(heightVal),\n            enableRtl: this.parent.enableRtl,\n            cssClass: this.parent.cssClass,\n            input: function (e) {\n                _this.inputHeightValue = formatUnit(_this.inputValue(e.value));\n            }\n        });\n        this.heightNum.createElement = this.parent.createElement;\n        this.heightNum.appendTo(imgSizeWrap.querySelector('#imgheight'));\n        return imgSizeWrap;\n    };\n    Image.prototype.inputValue = function (value) {\n        if (value === 'auto' || value.indexOf('%') !== -1 || value.indexOf('px') !== -1\n            || value.match(/(\\d+)/)) {\n            return value;\n        }\n        else {\n            return 'auto';\n        }\n    };\n    Image.prototype.insertSize = function (e) {\n        e.selection.restore();\n        var proxy = e.selfImage;\n        if (proxy.parent.formatter.getUndoRedoStack().length === 0) {\n            proxy.parent.formatter.saveData();\n        }\n        var dialogEle = proxy.dialogObj.element;\n        this.changedWidthValue = this.inputWidthValue;\n        this.changedHeightValue = this.inputHeightValue;\n        var width = dialogEle.querySelector('.e-img-width').value;\n        var height = dialogEle.parentElement.querySelector('.e-img-height').value;\n        proxy.parent.formatter.process(this.parent, e.args, e.args, {\n            width: width, height: height, selectNode: e.selectNode,\n            subCommand: e.args.item.subCommand\n        });\n        if (this.imgResizeDiv) {\n            proxy.imgResizePos(e.selectNode[0], this.imgResizeDiv);\n        }\n        proxy.dialogObj.hide({ returnValue: true });\n    };\n    Image.prototype.insertImage = function (e) {\n        this.imagDialog(e);\n        if (!isNullOrUndefined(this.dialogObj)) {\n            this.dialogObj.element.style.maxHeight = 'inherit';\n            var dialogContent = this.dialogObj.element.querySelector('.e-img-content');\n            if (((!isNullOrUndefined(this.parent.insertImageSettings.path) && this.parent.editorMode === 'Markdown')\n                || this.parent.editorMode === 'HTML')) {\n                document.getElementById(this.rteID + '_insertImage').focus();\n            }\n            else {\n                dialogContent.querySelector('.e-img-url').focus();\n            }\n        }\n    };\n    Image.prototype.imgUpload = function (e) {\n        var _this = this;\n        var save;\n        var selectParent;\n        // eslint-disable-next-line\n        var proxy = this;\n        var iframe = proxy.parent.iframeSettings.enable;\n        if (proxy.parent.editorMode === 'HTML' && (!iframe && isNullOrUndefined(closest(e.selection.range.startContainer.parentNode, '[id='\n            // eslint-disable-next-line\n            + \"'\" + this.parent.contentModule.getPanel().id + \"'\" + ']'))\n            || (iframe && !hasClass(e.selection.range.startContainer.parentNode.ownerDocument.querySelector('body'), 'e-lib')))) {\n            this.contentModule.getEditPanel().focus();\n            var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n            save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n            selectParent = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n        }\n        else {\n            save = e.selection;\n            selectParent = e.selectParent;\n        }\n        var uploadParentEle = this.parent.createElement('div', { className: 'e-img-uploadwrap e-droparea' + ' ' + this.parent.cssClass });\n        var deviceImgUpMsg = this.i10n.getConstant('imageDeviceUploadMessage');\n        var imgUpMsg = this.i10n.getConstant('imageUploadMessage');\n        var span = this.parent.createElement('span', { className: 'e-droptext' + ' ' + this.parent.cssClass });\n        var spanMsg = this.parent.createElement('span', {\n            className: 'e-rte-upload-text' + ' ' + this.parent.cssClass, innerHTML: ((Browser.isDevice) ? deviceImgUpMsg : imgUpMsg)\n        });\n        span.appendChild(spanMsg);\n        var btnEle = this.parent.createElement('button', {\n            className: 'e-browsebtn' + ' ' + this.parent.cssClass, id: this.rteID + '_insertImage', attrs: { autofocus: 'true', type: 'button' }\n        });\n        span.appendChild(btnEle);\n        uploadParentEle.appendChild(span);\n        var browserMsg = this.i10n.getConstant('browse');\n        this.browseButton = new Button({ content: browserMsg, enableRtl: this.parent.enableRtl });\n        this.browseButton.isStringTemplate = true;\n        this.browseButton.createElement = this.parent.createElement;\n        this.browseButton.appendTo(btnEle);\n        var btnClick = (Browser.isDevice) ? span : btnEle;\n        EventHandler.add(btnClick, 'click', this.fileSelect, this);\n        var uploadEle = this.parent.createElement('input', {\n            id: this.rteID + '_upload', attrs: { type: 'File', name: 'UploadFiles' }, className: this.parent.cssClass\n        });\n        uploadParentEle.appendChild(uploadEle);\n        var altText;\n        var rawFile;\n        var selectArgs;\n        var filesData;\n        var beforeUploadArgs;\n        this.uploadObj = new Uploader({\n            asyncSettings: { saveUrl: this.parent.insertImageSettings.saveUrl, removeUrl: this.parent.insertImageSettings.removeUrl },\n            dropArea: span, multiple: false, enableRtl: this.parent.enableRtl, cssClass: this.parent.cssClass,\n            allowedExtensions: this.parent.insertImageSettings.allowedTypes.toString(),\n            selected: function (e) {\n                proxy.isImgUploaded = true;\n                selectArgs = e;\n                filesData = e.filesData;\n                if (_this.parent.isServerRendered) {\n                    selectArgs = JSON.parse(JSON.stringify(e));\n                    e.cancel = true;\n                    rawFile = e.filesData;\n                    selectArgs.filesData = rawFile;\n                }\n                _this.parent.trigger(events.imageSelected, selectArgs, function (selectArgs) {\n                    if (!selectArgs.cancel) {\n                        _this.checkExtension(selectArgs.filesData[0]);\n                        altText = selectArgs.filesData[0].name;\n                        if (_this.parent.editorMode === 'HTML' && isNullOrUndefined(_this.parent.insertImageSettings.path)) {\n                            var reader_1 = new FileReader();\n                            // eslint-disable-next-line\n                            reader_1.addEventListener('load', function (e) {\n                                var url = _this.parent.insertImageSettings.saveFormat === 'Base64' ? reader_1.result :\n                                    URL.createObjectURL(convertToBlob(reader_1.result));\n                                proxy.uploadUrl = {\n                                    url: url, selection: save, altText: altText,\n                                    selectParent: selectParent,\n                                    width: {\n                                        width: proxy.parent.insertImageSettings.width, minWidth: proxy.parent.insertImageSettings.minWidth,\n                                        maxWidth: proxy.parent.getInsertImgMaxWidth()\n                                    }, height: {\n                                        height: proxy.parent.insertImageSettings.height,\n                                        minHeight: proxy.parent.insertImageSettings.minHeight,\n                                        maxHeight: proxy.parent.insertImageSettings.maxHeight\n                                    }\n                                };\n                                proxy.inputUrl.setAttribute('disabled', 'true');\n                                if (isNullOrUndefined(proxy.parent.insertImageSettings.saveUrl) && _this.isAllowedTypes\n                                    && !isNullOrUndefined(_this.dialogObj)) {\n                                    _this.dialogObj.getButtons(0).element.removeAttribute('disabled');\n                                }\n                            });\n                            reader_1.readAsDataURL(selectArgs.filesData[0].rawFile);\n                        }\n                        if (_this.parent.isServerRendered) {\n                            /* eslint-disable */\n                            _this.uploadObj._internalRenderSelect(selectArgs, rawFile);\n                            /* eslint-enable */\n                        }\n                    }\n                });\n            },\n            beforeUpload: function (args) {\n                if (_this.parent.isServerRendered) {\n                    beforeUploadArgs = JSON.parse(JSON.stringify(args));\n                    beforeUploadArgs.filesData = filesData;\n                    args.cancel = true;\n                    _this.parent.trigger(events.imageUploading, beforeUploadArgs, function (beforeUploadArgs) {\n                        if (beforeUploadArgs.cancel) {\n                            return;\n                        }\n                        /* eslint-disable */\n                        _this.uploadObj.currentRequestHeader = beforeUploadArgs.currentRequest ?\n                            beforeUploadArgs.currentRequest : _this.uploadObj.currentRequestHeader;\n                        _this.uploadObj.customFormDatas = beforeUploadArgs.customFormData && beforeUploadArgs.customFormData.length > 0 ?\n                            beforeUploadArgs.customFormData : _this.uploadObj.customFormDatas;\n                        _this.uploadObj.uploadFiles(rawFile, null);\n                        /* eslint-enable */\n                    });\n                }\n                else {\n                    _this.parent.trigger(events.beforeImageUpload, args);\n                }\n            },\n            uploading: function (e) {\n                if (!_this.parent.isServerRendered) {\n                    _this.parent.trigger(events.imageUploading, e);\n                }\n            },\n            success: function (e) {\n                _this.parent.trigger(events.imageUploadSuccess, e, function (e) {\n                    if (!isNullOrUndefined(_this.parent.insertImageSettings.path)) {\n                        var url = _this.parent.insertImageSettings.path + e.file.name;\n                        // eslint-disable-next-line\n                        var value = { url: url, selection: save };\n                        proxy.uploadUrl = {\n                            url: url, selection: save, altText: altText, selectParent: selectParent,\n                            width: {\n                                width: proxy.parent.insertImageSettings.width, minWidth: proxy.parent.insertImageSettings.minWidth,\n                                maxWidth: proxy.parent.getInsertImgMaxWidth()\n                            }, height: {\n                                height: proxy.parent.insertImageSettings.height, minHeight: proxy.parent.insertImageSettings.minHeight,\n                                maxHeight: proxy.parent.insertImageSettings.maxHeight\n                            }\n                        };\n                        proxy.inputUrl.setAttribute('disabled', 'true');\n                    }\n                    if (e.operation === 'upload' && !isNullOrUndefined(_this.dialogObj)) {\n                        _this.dialogObj.getButtons(0).element.removeAttribute('disabled');\n                    }\n                });\n            },\n            failure: function (e) {\n                _this.parent.trigger(events.imageUploadFailed, e);\n            },\n            removing: function () {\n                // eslint-disable-next-line\n                _this.parent.trigger(events.imageRemoving, e, function (e) {\n                    proxy.isImgUploaded = false;\n                    _this.dialogObj.getButtons(0).element.disabled = true;\n                    proxy.inputUrl.removeAttribute('disabled');\n                    if (proxy.uploadUrl) {\n                        proxy.uploadUrl.url = '';\n                    }\n                });\n            }\n        });\n        this.uploadObj.isStringTemplate = true;\n        this.uploadObj.createElement = this.parent.createElement;\n        this.uploadObj.appendTo(uploadEle);\n        return uploadParentEle;\n    };\n    Image.prototype.checkExtension = function (e) {\n        if (this.uploadObj.allowedExtensions) {\n            if (this.uploadObj.allowedExtensions.toLocaleLowerCase().indexOf(('.' + e.type).toLocaleLowerCase()) === -1) {\n                this.dialogObj.getButtons(0).element.setAttribute('disabled', 'disabled');\n                this.isAllowedTypes = false;\n            }\n            else {\n                this.isAllowedTypes = true;\n            }\n        }\n    };\n    Image.prototype.fileSelect = function () {\n        this.dialogObj.element.getElementsByClassName('e-file-select-wrap')[0].querySelector('button').click();\n        return false;\n    };\n    Image.prototype.dragStart = function (e) {\n        if (e.target.nodeName === 'IMG') {\n            this.parent.trigger(events.actionBegin, e, function (actionBeginArgs) {\n                if (actionBeginArgs.cancel) {\n                    e.preventDefault();\n                }\n                else {\n                    e.dataTransfer.effectAllowed = 'copyMove';\n                    e.target.classList.add(classes.CLS_RTE_DRAG_IMAGE);\n                }\n            });\n        }\n        else {\n            return true;\n        }\n    };\n    Image.prototype.dragEnter = function (e) {\n        e.dataTransfer.dropEffect = 'copy';\n        e.preventDefault();\n    };\n    Image.prototype.dragOver = function (e) {\n        if ((Browser.info.name === 'edge' && e.dataTransfer.items[0].type.split('/')[0].indexOf('image') > -1) ||\n            (Browser.isIE && e.dataTransfer.types[0] === 'Files')) {\n            e.preventDefault();\n        }\n        else {\n            return true;\n        }\n    };\n    /**\n     * Used to set range When drop an image\n     *\n     * @param {ImageDropEventArgs} args - specifies the image arguments.\n     * @returns {void}\n     */\n    Image.prototype.dragDrop = function (args) {\n        var _this = this;\n        this.parent.trigger(events.beforeImageDrop, args, function (e) {\n            var imgElement = _this.parent.inputElement.ownerDocument.querySelector('.' + classes.CLS_RTE_DRAG_IMAGE);\n            var isImgOrFileDrop = (imgElement && imgElement.tagName === 'IMG') || e.dataTransfer.files.length > 0;\n            if (!e.cancel && isImgOrFileDrop) {\n                _this.parent.trigger(events.actionBegin, e, function (actionBeginArgs) {\n                    if (actionBeginArgs.cancel) {\n                        e.preventDefault();\n                    }\n                    else {\n                        if (closest(e.target, '#' + _this.parent.getID() + '_toolbar') ||\n                            _this.parent.inputElement.contentEditable === 'false') {\n                            e.preventDefault();\n                            return;\n                        }\n                        if (_this.parent.element.querySelector('.' + classes.CLS_IMG_RESIZE)) {\n                            detach(_this.imgResizeDiv);\n                        }\n                        e.preventDefault();\n                        var range = void 0;\n                        if (_this.contentModule.getDocument().caretRangeFromPoint) { //For chrome\n                            range = _this.contentModule.getDocument().caretRangeFromPoint(e.clientX, e.clientY);\n                        }\n                        else if ((e.rangeParent)) { //For mozilla firefox\n                            range = _this.contentModule.getDocument().createRange();\n                            range.setStart(e.rangeParent, e.rangeOffset);\n                        }\n                        else {\n                            range = _this.getDropRange(e.clientX, e.clientY); //For internet explorer\n                        }\n                        _this.parent.notify(events.selectRange, { range: range });\n                        var uploadArea = _this.parent.element.querySelector('.' + classes.CLS_DROPAREA);\n                        if (uploadArea) {\n                            return;\n                        }\n                        _this.insertDragImage(e);\n                    }\n                });\n            }\n            else {\n                if (isImgOrFileDrop) {\n                    e.preventDefault();\n                }\n            }\n        });\n    };\n    /**\n     * Used to calculate range on internet explorer\n     *\n     * @param {number} x - specifies the x range.\n     * @param {number} y - specifies the y range.\n     * @returns {void}\n     */\n    Image.prototype.getDropRange = function (x, y) {\n        var startRange = this.contentModule.getDocument().createRange();\n        this.parent.formatter.editorManager.nodeSelection.setRange(this.contentModule.getDocument(), startRange);\n        var elem = this.contentModule.getDocument().elementFromPoint(x, y);\n        var startNode = (elem.childNodes.length > 0 ? elem.childNodes[0] : elem);\n        var startCharIndexCharacter = 0;\n        if (this.parent.inputElement.firstChild.innerHTML === '<br>') {\n            startRange.setStart(startNode, startCharIndexCharacter);\n            startRange.setEnd(startNode, startCharIndexCharacter);\n        }\n        else {\n            var rangeRect = void 0;\n            do {\n                startCharIndexCharacter++;\n                startRange.setStart(startNode, startCharIndexCharacter);\n                startRange.setEnd(startNode, startCharIndexCharacter + 1);\n                rangeRect = startRange.getBoundingClientRect();\n            } while (rangeRect.left < x && startCharIndexCharacter < startNode.length - 1);\n        }\n        return startRange;\n    };\n    Image.prototype.insertDragImage = function (e) {\n        var _this = this;\n        e.preventDefault();\n        var activePopupElement = this.parent.element.querySelector('' + classes.CLS_POPUP_OPEN);\n        this.parent.notify(events.drop, { args: e });\n        if (activePopupElement) {\n            activePopupElement.classList.add(classes.CLS_HIDE);\n        }\n        var imgElement = this.parent.inputElement.ownerDocument.querySelector('.' + classes.CLS_RTE_DRAG_IMAGE);\n        if (e.dataTransfer.files.length > 0 && imgElement === null) { //For external image drag and drop\n            if (e.dataTransfer.files.length > 1) {\n                return;\n            }\n            var imgFiles = e.dataTransfer.files;\n            var fileName = imgFiles[0].name;\n            var imgType = fileName.substring(fileName.lastIndexOf('.'));\n            var allowedTypes = this.parent.insertImageSettings.allowedTypes;\n            for (var i = 0; i < allowedTypes.length; i++) {\n                if (imgType.toLocaleLowerCase() === allowedTypes[i].toLowerCase()) {\n                    if (this.parent.insertImageSettings.saveUrl) {\n                        this.onSelect(e);\n                    }\n                    else {\n                        var args = { args: e, text: '', file: imgFiles[0] };\n                        e.preventDefault();\n                        this.imagePaste(args);\n                    }\n                }\n            }\n        }\n        else { //For internal image drag and drop\n            var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n            if (imgElement && imgElement.tagName === 'IMG') {\n                if (imgElement.nextElementSibling) {\n                    if (imgElement.nextElementSibling.classList.contains(classes.CLS_IMG_INNER)) {\n                        range.insertNode(imgElement.parentElement.parentElement);\n                    }\n                    else {\n                        range.insertNode(imgElement);\n                    }\n                }\n                else {\n                    range.insertNode(imgElement);\n                }\n                imgElement.classList.remove(classes.CLS_RTE_DRAG_IMAGE);\n                var imgArgs_1 = { elements: [imgElement] };\n                imgElement.addEventListener('load', function () {\n                    _this.parent.trigger(events.actionComplete, imgArgs_1);\n                });\n                this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument());\n                var args = e;\n                this.resizeStart(args, imgElement);\n                this.hideImageQuickToolbar();\n            }\n        }\n    };\n    Image.prototype.onSelect = function (args) {\n        var _this = this;\n        // eslint-disable-next-line\n        var proxy = this;\n        var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n        var parentElement = this.parent.createElement('ul', { className: classes.CLS_UPLOAD_FILES });\n        this.parent.element.appendChild(parentElement);\n        var validFiles = {\n            name: '',\n            size: 0,\n            status: '',\n            statusCode: '',\n            type: '',\n            rawFile: args.dataTransfer.files[0],\n            validationMessages: {}\n        };\n        var imageTag = this.parent.createElement('IMG');\n        imageTag.style.opacity = '0.5';\n        imageTag.classList.add(classes.CLS_RTE_IMAGE);\n        imageTag.classList.add(classes.CLS_IMGINLINE);\n        imageTag.classList.add(classes.CLS_RESIZE);\n        var file = validFiles.rawFile;\n        var reader = new FileReader();\n        reader.addEventListener('load', function () {\n            var url = URL.createObjectURL(convertToBlob(reader.result));\n            imageTag.src = proxy.parent.insertImageSettings.saveFormat === 'Blob' ? url : reader.result;\n        });\n        if (file) {\n            reader.readAsDataURL(file);\n        }\n        range.insertNode(imageTag);\n        this.uploadMethod(args, imageTag);\n        var e = { elements: [imageTag] };\n        imageTag.addEventListener('load', function () {\n            _this.parent.trigger(events.actionComplete, e);\n        });\n        detach(parentElement);\n    };\n    /**\n     * Rendering uploader and popup for drag and drop\n     *\n     * @param {DragEvent} dragEvent - specifies the event.\n     * @param {HTMLImageElement} imageElement - specifies the element.\n     * @returns {void}\n     */\n    Image.prototype.uploadMethod = function (dragEvent, imageElement) {\n        var _this = this;\n        var isUploading = false;\n        // eslint-disable-next-line\n        var proxy = this;\n        var popupEle = this.parent.createElement('div');\n        this.parent.element.appendChild(popupEle);\n        var uploadEle = this.parent.createElement('input', {\n            id: this.rteID + '_upload', attrs: { type: 'File', name: 'UploadFiles' }\n        });\n        var offsetY = this.parent.iframeSettings.enable ? -50 : -90;\n        this.popupObj = new Popup(popupEle, {\n            relateTo: imageElement,\n            height: '85px',\n            width: '300px',\n            offsetY: offsetY,\n            content: uploadEle,\n            viewPortElement: this.parent.element,\n            position: { X: 'center', Y: 'top' },\n            enableRtl: this.parent.enableRtl,\n            zIndex: 10001,\n            // eslint-disable-next-line\n            close: function (event) {\n                _this.parent.isBlur = false;\n                _this.popupObj.destroy();\n                detach(_this.popupObj.element);\n                _this.popupObj = null;\n                if (!_this.parent.inlineMode.enable) {\n                    _this.parent.toolbarModule.baseToolbar.toolbarObj.disable(false);\n                }\n            }\n        });\n        this.popupObj.element.style.display = 'none';\n        addClass([this.popupObj.element], classes.CLS_POPUP_OPEN);\n        addClass([this.popupObj.element], classes.CLS_RTE_UPLOAD_POPUP);\n        if (!isNOU(this.parent.cssClass)) {\n            addClass([this.popupObj.element], this.parent.cssClass);\n        }\n        var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n        var timeOut = dragEvent.dataTransfer.files[0].size > 1000000 ? 300 : 100;\n        setTimeout(function () {\n            proxy.refreshPopup(imageElement);\n        }, timeOut);\n        var rawFile;\n        var beforeUploadArgs;\n        this.uploadObj = new Uploader({\n            asyncSettings: {\n                saveUrl: this.parent.insertImageSettings.saveUrl,\n                removeUrl: this.parent.insertImageSettings.removeUrl\n            },\n            cssClass: classes.CLS_RTE_DIALOG_UPLOAD + ' ' + this.parent.cssClass,\n            dropArea: this.parent.element,\n            allowedExtensions: this.parent.insertImageSettings.allowedTypes.toString(),\n            removing: function () {\n                _this.parent.inputElement.contentEditable = 'true';\n                isUploading = false;\n                detach(imageElement);\n                _this.popupObj.close();\n            },\n            canceling: function () {\n                _this.parent.inputElement.contentEditable = 'true';\n                isUploading = false;\n                detach(imageElement);\n                _this.popupObj.close();\n                _this.quickToolObj.imageQTBar.hidePopup();\n                setTimeout(function () {\n                    _this.uploadObj.destroy();\n                }, 900);\n            },\n            beforeUpload: function (args) {\n                if (_this.parent.isServerRendered) {\n                    beforeUploadArgs = JSON.parse(JSON.stringify(args));\n                    beforeUploadArgs.filesData = rawFile;\n                    isUploading = true;\n                    args.cancel = true;\n                    _this.parent.trigger(events.imageUploading, beforeUploadArgs, function (beforeUploadArgs) {\n                        if (beforeUploadArgs.cancel) {\n                            return;\n                        }\n                        if (!_this.parent.inlineMode.enable) {\n                            _this.parent.toolbarModule.baseToolbar.toolbarObj.disable(true);\n                        }\n                        /* eslint-disable */\n                        _this.uploadObj.currentRequestHeader = beforeUploadArgs.currentRequest ?\n                            beforeUploadArgs.currentRequest : _this.uploadObj.currentRequestHeader;\n                        _this.uploadObj.customFormDatas = beforeUploadArgs.customFormData && beforeUploadArgs.customFormData.length > 0 ?\n                            beforeUploadArgs.customFormData : _this.uploadObj.customFormDatas;\n                        _this.uploadObj.uploadFiles(rawFile, null);\n                        _this.parent.inputElement.contentEditable = 'false';\n                        /* eslint-enable */\n                    });\n                }\n                else {\n                    _this.parent.trigger(events.beforeImageUpload, args);\n                    if (!_this.parent.inlineMode.enable) {\n                        _this.parent.toolbarModule.baseToolbar.toolbarObj.disable(true);\n                    }\n                }\n            },\n            uploading: function (e) {\n                if (!_this.parent.isServerRendered) {\n                    isUploading = true;\n                    _this.parent.trigger(events.imageUploading, e, function (imageUploadingArgs) {\n                        if (imageUploadingArgs.cancel) {\n                            if (!isNullOrUndefined(imageElement)) {\n                                detach(imageElement);\n                            }\n                            if (!isNullOrUndefined(_this.popupObj.element)) {\n                                detach(_this.popupObj.element);\n                            }\n                        }\n                        else {\n                            _this.parent.inputElement.contentEditable = 'false';\n                        }\n                    });\n                }\n            },\n            selected: function (e) {\n                if (isUploading) {\n                    e.cancel = true;\n                }\n                if (_this.parent.isServerRendered) {\n                    rawFile = e.filesData;\n                }\n            },\n            failure: function (e) {\n                isUploading = false;\n                _this.parent.inputElement.contentEditable = 'true';\n                var args = {\n                    args: dragEvent,\n                    type: 'Images',\n                    isNotify: undefined,\n                    elements: imageElement\n                };\n                setTimeout(function () {\n                    _this.uploadFailure(imageElement, args, e);\n                }, 900);\n            },\n            success: function (e) {\n                if (e.operation === \"cancel\") {\n                    return;\n                }\n                isUploading = false;\n                _this.parent.inputElement.contentEditable = 'true';\n                var args = {\n                    args: dragEvent,\n                    type: 'Images',\n                    isNotify: undefined,\n                    elements: imageElement\n                };\n                setTimeout(function () {\n                    _this.uploadSuccess(imageElement, dragEvent, args, e);\n                }, 900);\n            }\n        });\n        this.uploadObj.appendTo(this.popupObj.element.childNodes[0]);\n        this.popupObj.element.querySelector('.e-rte-dialog-upload .e-file-select-wrap').style.display = 'none';\n        range.selectNodeContents(imageElement);\n        this.parent.formatter.editorManager.nodeSelection.setRange(this.contentModule.getDocument(), range);\n    };\n    Image.prototype.refreshPopup = function (imageElement) {\n        var imgPosition = this.parent.iframeSettings.enable ? this.parent.element.offsetTop +\n            imageElement.offsetTop : imageElement.offsetTop;\n        var rtePosition = this.parent.element.offsetTop + this.parent.element.offsetHeight;\n        if (imgPosition > rtePosition) {\n            this.popupObj.relateTo = this.parent.inputElement;\n            this.popupObj.offsetY = this.parent.iframeSettings.enable ? -30 : -65;\n            this.popupObj.element.style.display = 'block';\n        }\n        else {\n            if (this.popupObj) {\n                this.popupObj.refreshPosition(imageElement);\n                this.popupObj.element.style.display = 'block';\n            }\n        }\n    };\n    /**\n     * Called when drop image upload was failed\n     *\n     * @param {HTMLElement} imgEle - specifies the image element.\n     * @param {IShowPopupArgs} args - specifies the arguments.\n     * @param {Object} e - specfies the object.\n     * @returns {void}\n     */\n    Image.prototype.uploadFailure = function (imgEle, args, e) {\n        detach(imgEle);\n        if (this.popupObj) {\n            this.popupObj.close();\n        }\n        this.parent.trigger(events.imageUploadFailed, e);\n        this.uploadObj.destroy();\n    };\n    /**\n     * Called when drop image upload was successful\n     *\n     * @param {HTMLElement} imageElement - specifies the image element.\n     * @param {DragEvent} dragEvent - specifies the drag event.\n     * @param {IShowPopupArgs} args - specifies the arguments.\n     * @param {ImageSuccessEventArgs} e - specifies the success event.\n     * @returns {void}\n     */\n    Image.prototype.uploadSuccess = function (imageElement, dragEvent, args, e) {\n        var _this = this;\n        imageElement.style.opacity = '1';\n        imageElement.classList.add(classes.CLS_IMG_FOCUS);\n        e.element = imageElement;\n        this.parent.trigger(events.imageUploadSuccess, e, function (e) {\n            if (!isNullOrUndefined(_this.parent.insertImageSettings.path)) {\n                var url = _this.parent.insertImageSettings.path + e.file.name;\n                imageElement.src = url;\n                imageElement.setAttribute('alt', e.file.name);\n            }\n        });\n        if (this.popupObj) {\n            this.popupObj.close();\n            this.uploadObj.destroy();\n        }\n        this.showImageQuickToolbar(args);\n        this.resizeStart(dragEvent, imageElement);\n    };\n    Image.prototype.imagePaste = function (args) {\n        var _this = this;\n        if (args.text.length === 0 && !isNullOrUndefined(args.file)) {\n            // eslint-disable-next-line\n            var proxy_1 = this;\n            var reader_2 = new FileReader();\n            args.args.preventDefault();\n            // eslint-disable-next-line\n            reader_2.addEventListener('load', function (e) {\n                var url = {\n                    cssClass: (proxy_1.parent.insertImageSettings.display === 'inline' ? classes.CLS_IMGINLINE : classes.CLS_IMGBREAK),\n                    url: _this.parent.insertImageSettings.saveFormat === 'Base64' || !isNullOrUndefined(args.callBack) ?\n                        reader_2.result : URL.createObjectURL(convertToBlob(reader_2.result)),\n                    width: {\n                        width: proxy_1.parent.insertImageSettings.width, minWidth: proxy_1.parent.insertImageSettings.minWidth,\n                        maxWidth: proxy_1.parent.getInsertImgMaxWidth()\n                    },\n                    height: {\n                        height: proxy_1.parent.insertImageSettings.height, minHeight: proxy_1.parent.insertImageSettings.minHeight,\n                        maxHeight: proxy_1.parent.insertImageSettings.maxHeight\n                    }\n                };\n                if (!isNullOrUndefined(args.callBack)) {\n                    args.callBack(url);\n                    return;\n                }\n                else {\n                    proxy_1.parent.formatter.process(proxy_1.parent, { item: { command: 'Images', subCommand: 'Image' } }, args.args, url);\n                    _this.showPopupToolBar(args, url);\n                }\n            });\n            reader_2.readAsDataURL(args.file);\n        }\n    };\n    Image.prototype.showPopupToolBar = function (e, url) {\n        var _this = this;\n        var imageSrc = 'img[src=\"' + url.url + '\"]';\n        var imageElement = this.parent.inputElement.querySelector(imageSrc);\n        this.parent.quickToolbarModule.createQTBar('Image', 'MultiRow', this.parent.quickToolbarSettings.image, RenderType.ImageToolbar);\n        var args = {\n            args: e.args,\n            type: 'Images',\n            isNotify: undefined,\n            elements: imageElement\n        };\n        if (imageElement) {\n            setTimeout(function () {\n                _this.showImageQuickToolbar(args);\n                _this.resizeStart(e.args, imageElement);\n            }, 0);\n        }\n    };\n    /* eslint-disable */\n    /**\n     * Destroys the ToolBar.\n     *\n     * @method destroy\n     * @returns {void}\n     * @hidden\n\n     */\n    /* eslint-enable */\n    Image.prototype.destroy = function () {\n        this.prevSelectedImgEle = undefined;\n        this.removeEventListener();\n    };\n    /**\n     * For internal use only - Get the module name.\n     *\n     * @returns {void}\n     */\n    Image.prototype.getModuleName = function () {\n        return 'image';\n    };\n    return Image;\n}());\nexport { Image };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}