{"ast":null,"code":"import * as CONSTANT from './../base/constant';\nimport { createElement, detach, prepend, append, attributes, Browser } from '@syncfusion/ej2-base';\nimport { markerClassName } from './dom-node';\nimport * as EVENTS from './../../common/constant';\nimport { setStyleAttribute } from '@syncfusion/ej2-base';\nimport { isIDevice, setEditFrameFocus } from '../../common/util';\nimport { isNullOrUndefined, isNullOrUndefined as isNOU, closest } from '@syncfusion/ej2-base';\n/**\n * Lists internal component\n *\n * @hidden\n\n */\n\nvar Lists =\n/** @class */\nfunction () {\n  /**\n   * Constructor for creating the Lists plugin\n   *\n   * @param {EditorManager} parent - specifies the parent element\n   * @hidden\n    */\n  function Lists(parent) {\n    this.parent = parent;\n    this.domNode = this.parent.domNode;\n    this.addEventListener();\n  }\n\n  Lists.prototype.addEventListener = function () {\n    this.parent.observer.on(EVENTS.LIST_TYPE, this.applyListsHandler, this);\n    this.parent.observer.on(EVENTS.KEY_DOWN_HANDLER, this.keyDownHandler, this);\n    this.parent.observer.on(EVENTS.SPACE_ACTION, this.spaceKeyAction, this);\n  };\n\n  Lists.prototype.testList = function (elem) {\n    var olListRegex = [/^[\\d]+[.]+$/, /^(?=[MDCLXVI])M*(C[MD]|D?C{0,3})(X[CL]|L?X{0,3})(I[XV]|V?I{0,3})[.]$/gi, /^[a-zA-Z][.]+$/];\n    var elementStart = !isNullOrUndefined(elem) ? elem.innerText.trim().split('.')[0] + '.' : null;\n\n    if (!isNullOrUndefined(elementStart)) {\n      for (var i = 0; i < olListRegex.length; i++) {\n        if (olListRegex[i].test(elementStart)) {\n          return true;\n        }\n      }\n    }\n\n    return false;\n  };\n\n  Lists.prototype.testCurrentList = function (range) {\n    var olListStartRegex = [/^[1]+[.]+$/, /^[i]+[.]+$/, /^[a]+[.]+$/];\n\n    if (!isNullOrUndefined(range.startContainer.textContent.slice(0, range.startOffset))) {\n      var currentContent = range.startContainer.textContent.replace(/\\u200B/g, '').slice(0, range.startOffset).trim();\n\n      for (var i = 0; i < olListStartRegex.length; i++) {\n        if (olListStartRegex[i].test(currentContent) && currentContent.length === 2) {\n          return true;\n        }\n      }\n    }\n\n    return false;\n  };\n\n  Lists.prototype.spaceList = function (e) {\n    var range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n    this.saveSelection = this.parent.nodeSelection.save(range, this.parent.currentDocument);\n    var startNode = this.parent.domNode.getSelectedNode(range.startContainer, range.startOffset); // eslint-disable-next-line\n\n    var endNode = this.parent.domNode.getSelectedNode(range.endContainer, range.endOffset);\n    var preElement = startNode.previousElementSibling;\n    var nextElement = startNode.nextElementSibling;\n    var preElemULStart = !isNullOrUndefined(preElement) ? preElement.innerText.trim().substring(0, 1) : null;\n    var nextElemULStart = !isNullOrUndefined(nextElement) ? nextElement.innerText.trim().substring(0, 1) : null;\n    var startElementOLTest = this.testCurrentList(range);\n    var preElementOLTest = this.testList(preElement);\n    var nextElementOLTest = this.testList(nextElement);\n\n    if (!preElementOLTest && !nextElementOLTest && preElemULStart !== '*' && nextElemULStart !== '*') {\n      if (startElementOLTest) {\n        range.startContainer.textContent = range.startContainer.textContent.slice(range.startOffset, range.startContainer.textContent.length);\n        this.applyListsHandler({\n          subCommand: 'OL',\n          callBack: e.callBack\n        });\n        e.event.preventDefault();\n      } else if (range.startContainer.textContent.replace(/\\u200B/g, '').slice(0, range.startOffset).trim() === '*' || range.startContainer.textContent.replace(/\\u200B/g, '').slice(0, range.startOffset).trim() === '-') {\n        range.startContainer.textContent = range.startContainer.textContent.slice(range.startOffset, range.startContainer.textContent.length);\n        this.applyListsHandler({\n          subCommand: 'UL',\n          callBack: e.callBack\n        });\n        e.event.preventDefault();\n      }\n    }\n  };\n\n  Lists.prototype.enterList = function (e) {\n    var range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n    var startNode = range.startContainer.nodeName === 'LI' ? range.startContainer : range.startContainer.parentElement.closest('LI');\n    var endNode = range.endContainer.nodeName === 'LI' ? range.endContainer : range.endContainer.parentElement.closest('LI');\n\n    if (!isNOU(startNode) && !isNOU(endNode) && startNode === endNode && startNode.tagName === 'LI' && startNode.textContent.trim() === '' && startNode.querySelectorAll('IMG').length === 0) {\n      if (startNode.innerHTML.indexOf('&nbsp;') >= 0) {\n        return;\n      }\n\n      if (startNode.textContent.charCodeAt(0) === 65279) {\n        startNode.textContent = '';\n      }\n\n      var startNodeParent = startNode.parentElement;\n\n      if (isNOU(startNodeParent.parentElement.closest('UL')) && isNOU(startNodeParent.parentElement.closest('OL'))) {\n        if (!isNOU(startNode.nextElementSibling)) {\n          var nearBlockNode = this.parent.domNode.blockParentNode(startNode);\n          this.parent.nodeCutter.GetSpliceNode(range, nearBlockNode);\n        }\n\n        var insertTag = void 0;\n\n        if (e.enterAction === 'DIV') {\n          insertTag = createElement('div');\n          insertTag.innerHTML = '<br>';\n        } else if (e.enterAction === 'P') {\n          insertTag = createElement('p');\n          insertTag.innerHTML = '<br>';\n        } else {\n          insertTag = createElement('br');\n        }\n\n        this.parent.domNode.insertAfter(insertTag, startNodeParent);\n        e.event.preventDefault();\n        this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, insertTag, 0);\n\n        if (startNodeParent.textContent === '') {\n          detach(startNodeParent);\n        } else {\n          detach(startNode);\n        }\n      }\n    }\n  }; // eslint-disable-next-line\n\n\n  Lists.prototype.backspaceList = function (e) {\n    var range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n    var startNode = this.parent.domNode.getSelectedNode(range.startContainer, range.startOffset);\n    var endNode = this.parent.domNode.getSelectedNode(range.endContainer, range.endOffset);\n    startNode = startNode.nodeName === 'BR' ? startNode.parentElement : startNode;\n    endNode = endNode.nodeName === 'BR' ? endNode.parentElement : endNode;\n\n    if (startNode === endNode && !isNullOrUndefined(closest(startNode, 'li')) && (startNode.textContent.trim() === '' && startNode.textContent.charCodeAt(0) === 65279 || startNode.textContent.length === 1 && startNode.textContent.charCodeAt(0) === 8203)) {\n      startNode.textContent = '';\n    }\n\n    if (startNode === endNode && startNode.tagName === 'LI' && startNode.textContent.length === 0 && isNOU(startNode.previousElementSibling)) {\n      startNode.removeAttribute('style');\n    }\n\n    if (startNode === endNode && startNode.textContent === '') {\n      if (startNode.parentElement.tagName === 'LI' && endNode.parentElement.tagName === 'LI') {\n        detach(startNode);\n      } else if (startNode.closest('ul') || startNode.closest('ol')) {\n        var parentList = !isNOU(startNode.closest('ul')) ? startNode.closest('ul') : startNode.closest('ol');\n\n        if (parentList.firstElementChild === startNode && !isNOU(parentList.children[1]) && (parentList.children[1].tagName === 'OL' || parentList.children[1].tagName === 'UL')) {\n          if (parentList.tagName === parentList.children[1].tagName) {\n            while (parentList.children[1].lastChild) {\n              this.parent.domNode.insertAfter(parentList.children[1].lastChild, parentList.children[1]);\n            }\n\n            detach(parentList.children[1]);\n          } else {\n            parentList.parentElement.insertBefore(parentList.children[1], parentList);\n          }\n        }\n      }\n    } else if (!isNOU(startNode.firstChild) && startNode.firstChild.nodeName === 'BR' && !isNullOrUndefined(startNode.childNodes[1]) && (startNode.childNodes[1].nodeName === 'UL' || startNode.childNodes[1].nodeName === 'OL')) {\n      var parentList = !isNOU(startNode.closest('ul')) ? startNode.closest('ul') : startNode.closest('ol');\n\n      if (parentList.tagName === startNode.childNodes[1].nodeName) {\n        while (startNode.childNodes[1].lastChild) {\n          this.parent.domNode.insertAfter(startNode.children[1].lastChild, startNode);\n        }\n\n        detach(startNode.childNodes[1]);\n      } else {\n        parentList.parentElement.insertBefore(startNode.children[1], parentList);\n      }\n    }\n\n    this.removeList(range, e);\n  };\n\n  Lists.prototype.removeList = function (range, e) {\n    var startNode = this.parent.domNode.getSelectedNode(range.startContainer, range.startOffset);\n    var endNode = this.parent.domNode.getSelectedNode(range.endContainer, range.endOffset);\n    startNode = startNode.nodeName === 'BR' ? startNode.parentElement : startNode;\n    endNode = endNode.nodeName === 'BR' ? endNode.parentElement : endNode;\n    startNode = startNode.nodeName !== 'LI' && !isNOU(startNode.closest('LI')) ? startNode.closest('LI') : startNode;\n    endNode = endNode.nodeName !== 'LI' && !isNOU(endNode.closest('LI')) ? endNode.closest('LI') : endNode;\n\n    if ((range.commonAncestorContainer.nodeName === 'OL' || range.commonAncestorContainer.nodeName === 'UL' || range.commonAncestorContainer.nodeName === 'LI') && isNOU(endNode.nextElementSibling) && endNode.textContent.length === range.endOffset && isNOU(startNode.previousElementSibling) && range.startOffset === 0 || Browser.userAgent.indexOf('Firefox') != -1 && range.startContainer === range.endContainer && range.startContainer === this.parent.editableElement && range.startOffset === 0 && range.endOffset === 1) {\n      if (Browser.userAgent.indexOf('Firefox') != -1) {\n        detach(range.commonAncestorContainer.childNodes[0]);\n      } else if (range.commonAncestorContainer.nodeName === 'LI') {\n        detach(range.commonAncestorContainer.parentElement);\n      } else {\n        detach(range.commonAncestorContainer);\n      }\n\n      e.event.preventDefault();\n    }\n  };\n\n  Lists.prototype.keyDownHandler = function (e) {\n    if (e.event.which === 13) {\n      this.enterList(e);\n    }\n\n    if (e.event.which === 32) {\n      this.spaceList(e);\n    }\n\n    if (e.event.which === 8) {\n      this.backspaceList(e);\n    }\n\n    if (e.event.which === 46 && e.event.action === 'delete') {\n      var range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n      var commonAncestor = range.commonAncestorContainer;\n      var startEle = range.startContainer;\n      var endEle = range.endContainer;\n      var startNode = startEle.nodeType === 3 ? startEle.parentElement : startEle;\n      var endNode = endEle.nodeType === 3 ? endEle.parentElement : endEle;\n\n      if ((commonAncestor.nodeName === 'UL' || commonAncestor.nodeName === 'OL') && startNode !== endNode && (!isNullOrUndefined(closest(startNode, 'ul')) || !isNullOrUndefined(closest(startNode, 'ol'))) && (!isNullOrUndefined(closest(endNode, 'ul')) || !isNullOrUndefined(closest(endNode, 'ol'))) && commonAncestor.lastElementChild === closest(endNode, 'li') && !range.collapsed) {\n        detach(commonAncestor);\n      }\n\n      this.removeList(range, e);\n    }\n\n    if (e.event.which === 9) {\n      var range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n\n      if (!(e.event.action && e.event.action === 'indent')) {\n        this.saveSelection = this.parent.nodeSelection.save(range, this.parent.currentDocument);\n      }\n\n      var blockNodes = void 0;\n      var startOffset = range.startOffset;\n      var endOffset = range.endOffset;\n      var startNode = this.parent.domNode.getSelectedNode(range.startContainer, range.startOffset);\n      var endNode = this.parent.domNode.getSelectedNode(range.endContainer, range.endOffset);\n\n      if (startNode === endNode && (startNode.nodeName === 'BR' || startNode.nodeName === '#text') && CONSTANT.IGNORE_BLOCK_TAGS.indexOf(startNode.parentNode.tagName.toLocaleLowerCase()) >= 0) {\n        return;\n      } else {\n        if (!(e.event.action && e.event.action === 'indent')) {\n          this.domNode.setMarker(this.saveSelection);\n        }\n\n        blockNodes = this.domNode.blockNodes();\n      }\n\n      var nodes = [];\n      var isNested = true;\n\n      for (var i = 0; i < blockNodes.length; i++) {\n        if (blockNodes[i].parentNode.tagName === 'LI') {\n          nodes.push(blockNodes[i].parentNode);\n        } else if (blockNodes[i].tagName === 'LI' && blockNodes[i].childNodes[0].tagName !== 'P' && blockNodes[i].childNodes[0].tagName !== 'OL' && blockNodes[i].childNodes[0].tagName !== 'UL') {\n          nodes.push(blockNodes[i]);\n        }\n      }\n\n      if (nodes.length > 1 || nodes.length && (startOffset === 0 && endOffset === 0 || e.ignoreDefault)) {\n        e.event.preventDefault();\n        e.event.stopPropagation();\n        this.currentAction = this.getAction(nodes[0]);\n\n        if (e.event.shiftKey) {\n          this.revertList(nodes, e);\n          this.revertClean();\n        } else {\n          isNested = this.nestedList(nodes);\n        }\n\n        if (isNested) {\n          this.cleanNode();\n          this.parent.editableElement.focus();\n        }\n\n        if (!(e.event.action && e.event.action === 'indent')) {\n          this.saveSelection = this.domNode.saveMarker(this.saveSelection);\n          this.saveSelection.restore();\n\n          if (e.callBack) {\n            e.callBack({\n              requestType: this.currentAction,\n              editorMode: 'HTML',\n              range: this.parent.nodeSelection.getRange(this.parent.currentDocument),\n              elements: this.parent.domNode.blockNodes(),\n              event: e.event\n            });\n          }\n        }\n      } else {\n        if (!(e.event.action && e.event.action === 'indent')) {\n          if (e.event && e.event.shiftKey && e.event.key === 'Tab') {\n            e.event.action = 'tab';\n          }\n\n          this.saveSelection = this.domNode.saveMarker(this.saveSelection, e.event.action);\n          this.saveSelection.restore();\n        }\n      }\n    } else {\n      switch (e.event.action) {\n        case 'ordered-list':\n          this.applyListsHandler({\n            subCommand: 'OL',\n            callBack: e.callBack\n          });\n          e.event.preventDefault();\n          break;\n\n        case 'unordered-list':\n          this.applyListsHandler({\n            subCommand: 'UL',\n            callBack: e.callBack\n          });\n          e.event.preventDefault();\n          break;\n      }\n    }\n  };\n\n  Lists.prototype.spaceKeyAction = function (e) {\n    if (e.event.which === 32) {\n      this.spaceList(e);\n    }\n  };\n\n  Lists.prototype.getAction = function (element) {\n    var parentNode = element.parentNode;\n    return parentNode.nodeName === 'OL' ? 'OL' : 'UL';\n  };\n\n  Lists.prototype.revertClean = function () {\n    var collectionNodes = this.parent.editableElement.querySelectorAll('ul, ol');\n\n    for (var i = 0; i < collectionNodes.length; i++) {\n      var listNodes = collectionNodes[i].querySelectorAll('ul, ol');\n\n      if (listNodes.length > 0) {\n        for (var j = 0; j < listNodes.length; j++) {\n          var prevSibling = listNodes[j].previousSibling;\n\n          if (prevSibling && prevSibling.tagName === 'LI') {\n            prevSibling.appendChild(listNodes[j]);\n          }\n        }\n      }\n    }\n  };\n\n  Lists.prototype.noPreviousElement = function (elements) {\n    var firstNode;\n    var firstNodeOL;\n    var siblingListOL = elements.querySelectorAll('ol, ul');\n    var siblingListLI = elements.querySelectorAll('li');\n    var siblingListLIFirst = this.domNode.contents(siblingListLI[0])[0];\n\n    if (siblingListLI.length > 0 && (siblingListLIFirst.nodeName === 'OL' || siblingListLIFirst.nodeName === 'UL')) {\n      firstNode = siblingListLI[0];\n    } else {\n      firstNodeOL = siblingListOL[0];\n    }\n\n    if (firstNode) {\n      for (var h = this.domNode.contents(elements)[0]; h && !this.domNode.isList(h); null) {\n        var nextSibling = h.nextSibling;\n        prepend([h], firstNode);\n        setStyleAttribute(elements, {\n          'list-style-type': 'none'\n        });\n        setStyleAttribute(firstNode, {\n          'list-style-type': ''\n        });\n        h = nextSibling;\n      }\n    } else if (firstNodeOL) {\n      var nestedElement = createElement('li');\n      prepend([nestedElement], firstNodeOL);\n\n      for (var h = this.domNode.contents(elements)[0]; h && !this.domNode.isList(h); null) {\n        var nextSibling = h.nextSibling;\n        nestedElement.appendChild(h);\n        h = nextSibling;\n      }\n\n      prepend([firstNodeOL], elements.parentNode);\n      detach(elements);\n      var nestedElementLI = createElement('li', {\n        styles: 'list-style-type: none;'\n      });\n      prepend([nestedElementLI], firstNodeOL.parentNode);\n      append([firstNodeOL], nestedElementLI);\n    } else {\n      var nestedElementLI = createElement('li', {\n        styles: 'list-style-type: none;'\n      });\n      prepend([nestedElementLI], elements.parentNode);\n      var nestedElement = createElement(elements.parentNode.tagName);\n      prepend([nestedElement], nestedElementLI);\n      append([elements], nestedElement);\n    }\n  };\n\n  Lists.prototype.nestedList = function (elements) {\n    var isNested = false;\n\n    for (var i = 0; i < elements.length; i++) {\n      var prevSibling = this.domNode.getPreviousNode(elements[i]);\n\n      if (prevSibling) {\n        isNested = true;\n        var firstNode = void 0;\n        var firstNodeLI = void 0;\n        var siblingListOL = elements[i].querySelectorAll('ol, ul');\n        var siblingListLI = elements[i].querySelectorAll('li');\n        var siblingListLIFirst = this.domNode.contents(siblingListLI[0])[0];\n\n        if (siblingListLI.length > 0 && (siblingListLIFirst.nodeName === 'OL' || siblingListLIFirst.nodeName === 'UL')) {\n          firstNodeLI = siblingListLI[0];\n        } else {\n          firstNode = siblingListOL[0];\n        }\n\n        if (firstNode) {\n          var nestedElement = createElement('li');\n          prepend([nestedElement], firstNode);\n\n          for (var h = this.domNode.contents(elements[i])[0]; h && !this.domNode.isList(h); null) {\n            var nextSibling = h.nextSibling;\n            nestedElement.appendChild(h);\n            h = nextSibling;\n          }\n\n          append([firstNode], prevSibling);\n          detach(elements[i]);\n        } else if (firstNodeLI) {\n          if (prevSibling.tagName === 'LI') {\n            for (var h = this.domNode.contents(elements[i])[0]; h && !this.domNode.isList(h); null) {\n              var nextSibling = h.nextSibling;\n              prepend([h], firstNodeLI);\n              setStyleAttribute(elements[i], {\n                'list-style-type': 'none'\n              });\n              setStyleAttribute(firstNodeLI, {\n                'list-style-type': ''\n              });\n              h = nextSibling;\n            }\n\n            append([firstNodeLI.parentNode], prevSibling);\n            detach(elements[i]);\n          }\n        } else {\n          if (prevSibling.tagName === 'LI') {\n            var nestedElement = createElement(elements[i].parentNode.tagName);\n            append([nestedElement], prevSibling);\n            append([elements[i]], nestedElement);\n          } else if (prevSibling.tagName === 'OL' || prevSibling.tagName === 'UL') {\n            append([elements[i]], prevSibling);\n          }\n        }\n      } else {\n        var element = elements[i];\n        isNested = true;\n        this.noPreviousElement(element);\n      }\n    }\n\n    return isNested;\n  };\n\n  Lists.prototype.applyListsHandler = function (e) {\n    var range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n\n    if (Browser.userAgent.indexOf('Firefox') != -1 && range.startContainer === range.endContainer && range.startContainer === this.parent.editableElement) {\n      var startChildNodes = range.startContainer.childNodes;\n      var startNode = startChildNodes[range.startOffset > 0 ? range.startOffset - 1 : range.startOffset] || range.startContainer;\n      var endNode = range.endContainer.childNodes[range.endOffset > 0 ? range.endOffset - 1 : range.endOffset] || range.endContainer;\n      var lastSelectionNode = endNode.lastChild.nodeName === 'BR' ? isNOU(endNode.lastChild.previousSibling) ? endNode : endNode.lastChild.previousSibling : endNode.lastChild;\n\n      while (!isNOU(lastSelectionNode) && lastSelectionNode.nodeName !== '#text' && lastSelectionNode.nodeName !== 'IMG' && lastSelectionNode.nodeName !== 'BR' && lastSelectionNode.nodeName !== 'HR') {\n        lastSelectionNode = lastSelectionNode.lastChild;\n      }\n\n      this.parent.nodeSelection.setSelectionText(this.parent.currentDocument, startNode, lastSelectionNode, 0, lastSelectionNode.textContent.length);\n      range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n    }\n\n    if (range.startContainer === range.endContainer && range.startContainer === this.parent.editableElement && range.startOffset === range.endOffset && range.startOffset === 0 && this.parent.editableElement.textContent.length === 0 && this.parent.editableElement.childNodes[0].nodeName != 'TABLE' && this.parent.editableElement.childNodes[0].nodeName != 'IMG') {\n      var focusNode = range.startContainer.childNodes[0];\n      this.parent.nodeSelection.setSelectionText(this.parent.currentDocument, focusNode, focusNode, 0, 0);\n      range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n    }\n\n    this.saveSelection = this.parent.nodeSelection.save(range, this.parent.currentDocument);\n    this.currentAction = e.subCommand;\n    this.currentAction = e.subCommand = this.currentAction === 'NumberFormatList' ? 'OL' : this.currentAction === 'BulletFormatList' ? 'UL' : this.currentAction;\n    this.domNode.setMarker(this.saveSelection);\n    var listsNodes = this.domNode.blockNodes();\n\n    if (e.enterAction === 'BR') {\n      this.setSelectionBRConfig();\n      var allSelectedNode = this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument);\n      var selectedNodes = this.parent.nodeSelection.getSelectionNodes(allSelectedNode);\n      var currentFormatNodes = [];\n\n      if (selectedNodes.length === 0) {\n        selectedNodes.push(listsNodes[0]);\n      }\n\n      for (var i = 0; i < selectedNodes.length; i++) {\n        var currentNode = selectedNodes[i];\n        var previousCurrentNode = void 0;\n\n        while (!this.parent.domNode.isBlockNode(currentNode) && currentNode !== this.parent.editableElement) {\n          previousCurrentNode = currentNode;\n          currentNode = currentNode.parentElement;\n        }\n\n        if (this.parent.domNode.isBlockNode(currentNode) && currentNode === this.parent.editableElement) {\n          currentFormatNodes.push(previousCurrentNode);\n        }\n      }\n\n      for (var i = 0; i < currentFormatNodes.length; i++) {\n        if (!this.parent.domNode.isBlockNode(currentFormatNodes[i])) {\n          var currentNode = currentFormatNodes[i];\n          var previousNode = currentNode;\n\n          while (currentNode === this.parent.editableElement) {\n            previousNode = currentNode;\n            currentNode = currentNode.parentElement;\n          }\n\n          var tempElem = void 0;\n\n          if (this.parent.domNode.isBlockNode(previousNode.parentElement) && previousNode.parentElement === this.parent.editableElement) {\n            tempElem = createElement('p');\n            previousNode.parentElement.insertBefore(tempElem, previousNode);\n            tempElem.appendChild(previousNode);\n          } else {\n            tempElem = previousNode;\n          }\n\n          var preNode = tempElem.previousSibling;\n\n          while (!isNOU(preNode) && preNode.nodeName !== 'BR' && !this.parent.domNode.isBlockNode(preNode)) {\n            tempElem.firstChild.parentElement.insertBefore(preNode, tempElem.firstChild);\n            preNode = tempElem.previousSibling;\n          }\n\n          if (!isNOU(preNode) && preNode.nodeName === 'BR') {\n            detach(preNode);\n          }\n\n          var postNode = tempElem.nextSibling;\n\n          while (!isNOU(postNode) && postNode.nodeName !== 'BR' && !this.parent.domNode.isBlockNode(postNode)) {\n            tempElem.appendChild(postNode);\n            postNode = tempElem.nextSibling;\n          }\n\n          if (!isNOU(postNode) && postNode.nodeName === 'BR') {\n            detach(postNode);\n          }\n        }\n      }\n\n      this.setSelectionBRConfig();\n      listsNodes = this.parent.domNode.blockNodes();\n    }\n\n    for (var i = 0; i < listsNodes.length; i++) {\n      if (listsNodes[i].tagName === 'TABLE' && !range.collapsed) {\n        listsNodes.splice(i, 1);\n      }\n\n      if (listsNodes.length > 0 && listsNodes[i].tagName !== 'LI' && 'LI' === listsNodes[i].parentNode.tagName) {\n        listsNodes[i] = listsNodes[i].parentNode;\n      }\n    }\n\n    this.applyLists(listsNodes, this.currentAction, e.selector, e.item, e);\n\n    if (e.callBack) {\n      e.callBack({\n        requestType: this.currentAction,\n        event: e.event,\n        editorMode: 'HTML',\n        range: this.parent.nodeSelection.getRange(this.parent.currentDocument),\n        elements: this.parent.domNode.blockNodes()\n      });\n    }\n  };\n\n  Lists.prototype.setSelectionBRConfig = function () {\n    var startElem = this.parent.editableElement.querySelector('.' + markerClassName.startSelection);\n    var endElem = this.parent.editableElement.querySelector('.' + markerClassName.endSelection);\n\n    if (isNOU(endElem)) {\n      this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, startElem, 0);\n    } else {\n      this.parent.nodeSelection.setSelectionText(this.parent.currentDocument, startElem, endElem, 0, 0);\n    }\n  };\n\n  Lists.prototype.applyLists = function (elements, type, selector, item, e) {\n    var isReverse = true;\n\n    if (this.isRevert(elements, type, item) && isNOU(item)) {\n      this.revertList(elements, e);\n      this.removeEmptyListElements();\n    } else {\n      this.checkLists(elements, type, item);\n\n      for (var i = 0; i < elements.length; i++) {\n        if (!isNOU(item) && !isNOU(item.listStyle)) {\n          if (item.listStyle === 'listImage') {\n            setStyleAttribute(elements[i], {\n              'list-style-image': item.listImage\n            });\n          } else {\n            setStyleAttribute(elements[i], {\n              'list-style-image': 'none'\n            });\n            setStyleAttribute(elements[i], {\n              'list-style-type': item.listStyle.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase()\n            });\n          }\n        }\n\n        if (elements[i].getAttribute('contenteditable') === 'true' && elements[i].childNodes.length === 1 && elements[i].childNodes[0].nodeName === 'TABLE') {\n          var listEle = document.createElement(type);\n          listEle.innerHTML = '<li><br/></li>';\n          elements[i].appendChild(listEle);\n        } else if ('LI' !== elements[i].tagName && isNOU(item)) {\n          isReverse = false;\n          var elemAtt = elements[i].tagName === 'IMG' ? '' : this.domNode.attributes(elements[i]);\n          var openTag = '<' + type + '>';\n          var closeTag = '</' + type + '>';\n          var newTag = 'li' + elemAtt;\n          var replaceHTML = elements[i].tagName.toLowerCase() === CONSTANT.DEFAULT_TAG ? elements[i].innerHTML : elements[i].outerHTML;\n          var innerHTML = this.domNode.createTagString(newTag, null, replaceHTML);\n          var collectionString = openTag + innerHTML + closeTag;\n          this.domNode.replaceWith(elements[i], collectionString);\n        } else if (!isNOU(item) && 'LI' !== elements[i].tagName) {\n          // eslint-disable-next-line\n          isReverse = false;\n          var elemAtt = elements[i].tagName === 'IMG' ? '' : this.domNode.attributes(elements[i]);\n          var openTag = '<' + type + elemAtt + '>';\n          var closeTag = '</' + type + '>';\n          var newTag = 'li';\n          var replaceHTML = elements[i].tagName.toLowerCase() === CONSTANT.DEFAULT_TAG ? elements[i].innerHTML : elements[i].outerHTML;\n          var innerHTML = this.domNode.createTagString(newTag, null, replaceHTML);\n          var collectionString = openTag + innerHTML + closeTag;\n          this.domNode.replaceWith(elements[i], collectionString);\n        }\n      }\n    }\n\n    this.cleanNode();\n    this.parent.editableElement.focus();\n\n    if (isIDevice()) {\n      setEditFrameFocus(this.parent.editableElement, selector);\n    }\n\n    this.saveSelection = this.domNode.saveMarker(this.saveSelection);\n    this.saveSelection.restore();\n  };\n\n  Lists.prototype.removeEmptyListElements = function () {\n    var listElem = this.parent.editableElement.querySelectorAll('ol, ul');\n\n    for (var i = 0; i < listElem.length; i++) {\n      if (listElem[i].textContent.trim() === '') {\n        detach(listElem[i]);\n      }\n    }\n  };\n\n  Lists.prototype.isRevert = function (nodes, tagName, item) {\n    var isRevert = true;\n\n    for (var i = 0; i < nodes.length; i++) {\n      if (nodes[i].tagName !== 'LI') {\n        return false;\n      }\n\n      if (nodes[i].parentNode.tagName !== tagName || isNOU(item) && nodes[i].parentNode.style.listStyleType !== '') {\n        isRevert = false;\n      }\n    }\n\n    return isRevert;\n  };\n\n  Lists.prototype.checkLists = function (nodes, tagName, item) {\n    var nodesTemp = [];\n\n    for (var i = 0; i < nodes.length; i++) {\n      var node = nodes[i].parentNode;\n\n      if (!isNOU(item) && 'LI' === nodes[i].tagName && !isNOU(item.listStyle)) {\n        if (item.listStyle === 'listImage') {\n          setStyleAttribute(node, {\n            'list-style-image': item.listImage\n          });\n        } else {\n          setStyleAttribute(node, {\n            'list-style-image': 'none'\n          });\n          setStyleAttribute(node, {\n            'list-style-type': item.listStyle.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase()\n          });\n        }\n      }\n\n      if (nodes[i].tagName === 'LI' && node.tagName !== tagName && nodesTemp.indexOf(node) < 0 || nodes[i].tagName === 'LI' && node.tagName === tagName && nodesTemp.indexOf(node) < 0 && item !== null) {\n        nodesTemp.push(node);\n      }\n\n      if (isNOU(item) && (node.tagName === tagName || (node.tagName === 'UL' || node.tagName === 'OL') && node.hasAttribute('style'))) {\n        if (node.hasAttribute('style')) {\n          node.removeAttribute('style');\n        }\n      }\n    }\n\n    for (var j = nodesTemp.length - 1; j >= 0; j--) {\n      var h = nodesTemp[j];\n      var replace = '<' + tagName.toLowerCase() + ' ' + this.domNode.attributes(h) + '>' + h.innerHTML + '</' + tagName.toLowerCase() + '>';\n      this.domNode.replaceWith(nodesTemp[j], replace);\n    }\n  };\n\n  Lists.prototype.cleanNode = function () {\n    var liParents = this.parent.editableElement.querySelectorAll('ol + ol, ul + ul');\n\n    for (var c = 0; c < liParents.length; c++) {\n      var node = liParents[c];\n\n      if (this.domNode.isList(node.previousElementSibling) && this.domNode.openTagString(node) === this.domNode.openTagString(node.previousElementSibling)) {\n        var contentNodes = this.domNode.contents(node);\n\n        for (var f = 0; f < contentNodes.length; f++) {\n          node.previousElementSibling.appendChild(contentNodes[f]);\n        }\n\n        node.parentNode.removeChild(node);\n      }\n    }\n  };\n\n  Lists.prototype.findUnSelected = function (temp, elements) {\n    temp = temp.slice().reverse();\n\n    if (temp.length > 0) {\n      var rightIndent = [];\n      var indentElements = [];\n      var lastElement = elements[elements.length - 1];\n      var lastElementChild = [];\n      var childElements = [];\n      lastElementChild = lastElement.childNodes;\n\n      for (var z = 0; z < lastElementChild.length; z++) {\n        if (lastElementChild[z].tagName === 'OL' || lastElementChild[z].tagName === 'UL') {\n          var childLI = lastElementChild[z].querySelectorAll('li');\n\n          if (childLI.length > 0) {\n            for (var y = 0; y < childLI.length; y++) {\n              childElements.push(childLI[y]);\n            }\n          }\n        }\n      }\n\n      for (var i = 0; i < childElements.length; i++) {\n        var count = 0;\n\n        for (var j = 0; j < temp.length; j++) {\n          if (!childElements[i].contains(temp[j])) {\n            count = count + 1;\n          }\n        }\n\n        if (count === temp.length) {\n          indentElements.push(childElements[i]);\n        }\n      }\n\n      if (indentElements.length > 0) {\n        for (var x = 0; x < indentElements.length; x++) {\n          if (this.domNode.contents(indentElements[x])[0].nodeName !== 'OL' && this.domNode.contents(indentElements[x])[0].nodeName !== 'UL') {\n            rightIndent.push(indentElements[x]);\n          }\n        }\n      }\n\n      if (rightIndent.length > 0) {\n        this.nestedList(rightIndent);\n      }\n    }\n  };\n\n  Lists.prototype.revertList = function (elements, e) {\n    var temp = [];\n\n    for (var i = elements.length - 1; i >= 0; i--) {\n      for (var j = i - 1; j >= 0; j--) {\n        if (elements[j].contains(elements[i]) || elements[j] === elements[i]) {\n          temp.push(elements[i]);\n          elements.splice(i, 1);\n          break;\n        }\n      }\n    }\n\n    this.findUnSelected(temp, elements);\n    var viewNode = [];\n\n    for (var i = 0; i < elements.length; i++) {\n      var element = elements[i];\n\n      if (this.domNode.contents(element)[0].nodeType === 3 && this.domNode.contents(element)[0].textContent.trim().length === 0) {\n        detach(this.domNode.contents(element)[0]);\n      }\n\n      var parentNode = elements[i].parentNode;\n      var className = element.getAttribute('class');\n\n      if (temp.length === 0) {\n        var siblingList = elements[i].querySelectorAll('ul, ol');\n        var firstNode = siblingList[0];\n\n        if (firstNode) {\n          var child = firstNode.querySelectorAll('li');\n\n          if (child) {\n            var nestedElement = createElement(firstNode.tagName);\n            append([nestedElement], firstNode.parentNode);\n            var nestedElementLI = createElement('li', {\n              styles: 'list-style-type: none;'\n            });\n            append([nestedElementLI], nestedElement);\n            append([firstNode], nestedElementLI);\n          }\n        }\n      }\n\n      if (element.parentNode.insertBefore(this.closeTag(parentNode.tagName), element), 'LI' === parentNode.parentNode.tagName || 'OL' === parentNode.parentNode.tagName || 'UL' === parentNode.parentNode.tagName) {\n        element.parentNode.insertBefore(this.closeTag('LI'), element);\n      } else {\n        var classAttr = '';\n\n        if (className) {\n          // eslint-disable-next-line\n          classAttr += ' class=\"' + className + '\"';\n        }\n\n        if (CONSTANT.DEFAULT_TAG && 0 === element.querySelectorAll(CONSTANT.BLOCK_TAGS.join(', ')).length) {\n          var wrapperclass = isNullOrUndefined(className) ? ' class=\"e-rte-wrap-inner\"' : ' class=\"' + className + ' e-rte-wrap-inner\"';\n          var wrapper = '<' + CONSTANT.DEFAULT_TAG + wrapperclass + this.domNode.attributes(parentNode) + '></' + CONSTANT.DEFAULT_TAG + '>';\n\n          if (e.enterAction !== 'BR') {\n            this.domNode.wrapInner(element, this.domNode.parseHTMLFragment(wrapper));\n          }\n        } else if (this.domNode.contents(element)[0].nodeType === 3) {\n          var replace = this.domNode.createTagString(CONSTANT.DEFAULT_TAG, parentNode, this.parent.domNode.encode(this.domNode.contents(element)[0].textContent));\n          this.domNode.replaceWith(this.domNode.contents(element)[0], replace);\n        } else if (this.domNode.contents(element)[0].classList.contains(markerClassName.startSelection) || this.domNode.contents(element)[0].classList.contains(markerClassName.endSelection)) {\n          var replace = this.domNode.createTagString(CONSTANT.DEFAULT_TAG, parentNode, this.domNode.contents(element)[0].outerHTML);\n          this.domNode.replaceWith(this.domNode.contents(element)[0], replace);\n        } else {\n          var childNode = element.firstChild;\n          className = childNode.getAttribute('class');\n          attributes(childNode, this.domNode.rawAttributes(parentNode));\n\n          if (className && childNode.getAttribute('class')) {\n            attributes(childNode, {\n              'class': className + ' ' + childNode.getAttribute('class')\n            });\n          }\n        }\n\n        append([this.openTag('LI')], element);\n        prepend([this.closeTag('LI')], element);\n      }\n\n      this.domNode.insertAfter(this.openTag(parentNode.tagName), element);\n\n      if (parentNode.parentNode.tagName === 'LI') {\n        parentNode = parentNode.parentNode.parentNode;\n      }\n\n      if (viewNode.indexOf(parentNode) < 0) {\n        viewNode.push(parentNode);\n      }\n    }\n\n    for (var i = 0; i < viewNode.length; i++) {\n      var node = viewNode[i];\n      var nodeInnerHtml = node.innerHTML;\n      var closeTag = /<span class=\"e-rte-list-close-([a-z]*)\"><\\/span>/g;\n      var openTag = /<span class=\"e-rte-list-open-([a-z]*)\"><\\/span>/g;\n      nodeInnerHtml = nodeInnerHtml.replace(closeTag, '</$1>');\n      nodeInnerHtml = nodeInnerHtml.replace(openTag, '<$1 ' + this.domNode.attributes(node) + '>');\n      this.domNode.replaceWith(node, this.domNode.openTagString(node) + nodeInnerHtml.trim() + this.domNode.closeTagString(node));\n    }\n\n    var emptyUl = this.parent.editableElement.querySelectorAll('ul:empty, ol:empty');\n\n    for (var i = 0; i < emptyUl.length; i++) {\n      detach(emptyUl[i]);\n    }\n\n    var emptyLi = this.parent.editableElement.querySelectorAll('li:empty');\n\n    for (var i = 0; i < emptyLi.length; i++) {\n      detach(emptyLi[i]);\n    }\n  };\n\n  Lists.prototype.openTag = function (type) {\n    return this.domNode.parseHTMLFragment('<span class=\"e-rte-list-open-' + type.toLowerCase() + '\"></span>');\n  };\n\n  Lists.prototype.closeTag = function (type) {\n    return this.domNode.parseHTMLFragment('<span class=\"e-rte-list-close-' + type.toLowerCase() + '\"></span>');\n  };\n\n  return Lists;\n}();\n\nexport { Lists };","map":{"version":3,"names":["CONSTANT","createElement","detach","prepend","append","attributes","Browser","markerClassName","EVENTS","setStyleAttribute","isIDevice","setEditFrameFocus","isNullOrUndefined","isNOU","closest","Lists","parent","domNode","addEventListener","prototype","observer","on","LIST_TYPE","applyListsHandler","KEY_DOWN_HANDLER","keyDownHandler","SPACE_ACTION","spaceKeyAction","testList","elem","olListRegex","elementStart","innerText","trim","split","i","length","test","testCurrentList","range","olListStartRegex","startContainer","textContent","slice","startOffset","currentContent","replace","spaceList","e","nodeSelection","getRange","currentDocument","saveSelection","save","startNode","getSelectedNode","endNode","endContainer","endOffset","preElement","previousElementSibling","nextElement","nextElementSibling","preElemULStart","substring","nextElemULStart","startElementOLTest","preElementOLTest","nextElementOLTest","subCommand","callBack","event","preventDefault","enterList","nodeName","parentElement","tagName","querySelectorAll","innerHTML","indexOf","charCodeAt","startNodeParent","nearBlockNode","blockParentNode","nodeCutter","GetSpliceNode","insertTag","enterAction","insertAfter","setCursorPoint","backspaceList","removeAttribute","parentList","firstElementChild","children","lastChild","insertBefore","firstChild","childNodes","removeList","commonAncestorContainer","userAgent","editableElement","which","action","commonAncestor","startEle","endEle","nodeType","lastElementChild","collapsed","blockNodes","IGNORE_BLOCK_TAGS","parentNode","toLocaleLowerCase","setMarker","nodes","isNested","push","ignoreDefault","stopPropagation","currentAction","getAction","shiftKey","revertList","revertClean","nestedList","cleanNode","focus","saveMarker","restore","requestType","editorMode","elements","key","element","collectionNodes","listNodes","j","prevSibling","previousSibling","appendChild","noPreviousElement","firstNode","firstNodeOL","siblingListOL","siblingListLI","siblingListLIFirst","contents","h","isList","nextSibling","nestedElement","nestedElementLI","styles","getPreviousNode","firstNodeLI","startChildNodes","lastSelectionNode","setSelectionText","focusNode","listsNodes","setSelectionBRConfig","allSelectedNode","getSelectedNodes","selectedNodes","getSelectionNodes","currentFormatNodes","currentNode","previousCurrentNode","isBlockNode","previousNode","tempElem","preNode","postNode","splice","applyLists","selector","item","startElem","querySelector","startSelection","endElem","endSelection","type","isReverse","isRevert","removeEmptyListElements","checkLists","listStyle","listImage","toLowerCase","getAttribute","listEle","document","elemAtt","openTag","closeTag","newTag","replaceHTML","DEFAULT_TAG","outerHTML","createTagString","collectionString","replaceWith","listElem","style","listStyleType","nodesTemp","node","hasAttribute","liParents","c","openTagString","contentNodes","f","removeChild","findUnSelected","temp","reverse","rightIndent","indentElements","lastElement","childElements","z","childLI","y","count","contains","x","viewNode","className","siblingList","child","classAttr","BLOCK_TAGS","join","wrapperclass","wrapper","wrapInner","parseHTMLFragment","encode","classList","childNode","rawAttributes","nodeInnerHtml","closeTagString","emptyUl","emptyLi"],"sources":["/home/morgan/Desktop/Projets/ENT4/Jwt-Auth-pdf/react-jwt-auth/react-jwt-auth/node_modules/@syncfusion/ej2-richtexteditor/src/editor-manager/plugin/lists.js"],"sourcesContent":["import * as CONSTANT from './../base/constant';\nimport { createElement, detach, prepend, append, attributes, Browser } from '@syncfusion/ej2-base';\nimport { markerClassName } from './dom-node';\nimport * as EVENTS from './../../common/constant';\nimport { setStyleAttribute } from '@syncfusion/ej2-base';\nimport { isIDevice, setEditFrameFocus } from '../../common/util';\nimport { isNullOrUndefined, isNullOrUndefined as isNOU, closest } from '@syncfusion/ej2-base';\n/**\n * Lists internal component\n *\n * @hidden\n\n */\nvar Lists = /** @class */ (function () {\n    /**\n     * Constructor for creating the Lists plugin\n     *\n     * @param {EditorManager} parent - specifies the parent element\n     * @hidden\n\n     */\n    function Lists(parent) {\n        this.parent = parent;\n        this.domNode = this.parent.domNode;\n        this.addEventListener();\n    }\n    Lists.prototype.addEventListener = function () {\n        this.parent.observer.on(EVENTS.LIST_TYPE, this.applyListsHandler, this);\n        this.parent.observer.on(EVENTS.KEY_DOWN_HANDLER, this.keyDownHandler, this);\n        this.parent.observer.on(EVENTS.SPACE_ACTION, this.spaceKeyAction, this);\n    };\n    Lists.prototype.testList = function (elem) {\n        var olListRegex = [/^[\\d]+[.]+$/,\n            /^(?=[MDCLXVI])M*(C[MD]|D?C{0,3})(X[CL]|L?X{0,3})(I[XV]|V?I{0,3})[.]$/gi,\n            /^[a-zA-Z][.]+$/];\n        var elementStart = !isNullOrUndefined(elem) ? elem.innerText.trim().split('.')[0] + '.' : null;\n        if (!isNullOrUndefined(elementStart)) {\n            for (var i = 0; i < olListRegex.length; i++) {\n                if (olListRegex[i].test(elementStart)) {\n                    return true;\n                }\n            }\n        }\n        return false;\n    };\n    Lists.prototype.testCurrentList = function (range) {\n        var olListStartRegex = [/^[1]+[.]+$/, /^[i]+[.]+$/, /^[a]+[.]+$/];\n        if (!isNullOrUndefined(range.startContainer.textContent.slice(0, range.startOffset))) {\n            var currentContent = range.startContainer.textContent.replace(/\\u200B/g, '').slice(0, range.startOffset).trim();\n            for (var i = 0; i < olListStartRegex.length; i++) {\n                if (olListStartRegex[i].test(currentContent) && currentContent.length === 2) {\n                    return true;\n                }\n            }\n        }\n        return false;\n    };\n    Lists.prototype.spaceList = function (e) {\n        var range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n        this.saveSelection = this.parent.nodeSelection.save(range, this.parent.currentDocument);\n        var startNode = this.parent.domNode.getSelectedNode(range.startContainer, range.startOffset);\n        // eslint-disable-next-line\n        var endNode = this.parent.domNode.getSelectedNode(range.endContainer, range.endOffset);\n        var preElement = startNode.previousElementSibling;\n        var nextElement = startNode.nextElementSibling;\n        var preElemULStart = !isNullOrUndefined(preElement) ?\n            preElement.innerText.trim().substring(0, 1) : null;\n        var nextElemULStart = !isNullOrUndefined(nextElement) ?\n            nextElement.innerText.trim().substring(0, 1) : null;\n        var startElementOLTest = this.testCurrentList(range);\n        var preElementOLTest = this.testList(preElement);\n        var nextElementOLTest = this.testList(nextElement);\n        if (!preElementOLTest && !nextElementOLTest && preElemULStart !== '*' && nextElemULStart !== '*') {\n            if (startElementOLTest) {\n                range.startContainer.textContent = range.startContainer.textContent.slice(range.startOffset, range.startContainer.textContent.length);\n                this.applyListsHandler({ subCommand: 'OL', callBack: e.callBack });\n                e.event.preventDefault();\n            }\n            else if (range.startContainer.textContent.replace(/\\u200B/g, '').slice(0, range.startOffset).trim() === '*' ||\n                range.startContainer.textContent.replace(/\\u200B/g, '').slice(0, range.startOffset).trim() === '-') {\n                range.startContainer.textContent = range.startContainer.textContent.slice(range.startOffset, range.startContainer.textContent.length);\n                this.applyListsHandler({ subCommand: 'UL', callBack: e.callBack });\n                e.event.preventDefault();\n            }\n        }\n    };\n    Lists.prototype.enterList = function (e) {\n        var range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n        var startNode = range.startContainer.nodeName === 'LI' ? range.startContainer :\n            range.startContainer.parentElement.closest('LI');\n        var endNode = range.endContainer.nodeName === 'LI' ? range.endContainer :\n            range.endContainer.parentElement.closest('LI');\n        if (!isNOU(startNode) && !isNOU(endNode) && startNode === endNode && startNode.tagName === 'LI' &&\n            startNode.textContent.trim() === '' && startNode.querySelectorAll('IMG').length === 0) {\n            if (startNode.innerHTML.indexOf('&nbsp;') >= 0) {\n                return;\n            }\n            if (startNode.textContent.charCodeAt(0) === 65279) {\n                startNode.textContent = '';\n            }\n            var startNodeParent = startNode.parentElement;\n            if (isNOU(startNodeParent.parentElement.closest('UL')) && isNOU(startNodeParent.parentElement.closest('OL'))) {\n                if (!isNOU(startNode.nextElementSibling)) {\n                    var nearBlockNode = this.parent.domNode.blockParentNode(startNode);\n                    this.parent.nodeCutter.GetSpliceNode(range, nearBlockNode);\n                }\n                var insertTag = void 0;\n                if (e.enterAction === 'DIV') {\n                    insertTag = createElement('div');\n                    insertTag.innerHTML = '<br>';\n                }\n                else if (e.enterAction === 'P') {\n                    insertTag = createElement('p');\n                    insertTag.innerHTML = '<br>';\n                }\n                else {\n                    insertTag = createElement('br');\n                }\n                this.parent.domNode.insertAfter(insertTag, startNodeParent);\n                e.event.preventDefault();\n                this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, insertTag, 0);\n                if (startNodeParent.textContent === '') {\n                    detach(startNodeParent);\n                }\n                else {\n                    detach(startNode);\n                }\n            }\n        }\n    };\n    // eslint-disable-next-line\n    Lists.prototype.backspaceList = function (e) {\n        var range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n        var startNode = this.parent.domNode.getSelectedNode(range.startContainer, range.startOffset);\n        var endNode = this.parent.domNode.getSelectedNode(range.endContainer, range.endOffset);\n        startNode = startNode.nodeName === 'BR' ? startNode.parentElement : startNode;\n        endNode = endNode.nodeName === 'BR' ? endNode.parentElement : endNode;\n        if (startNode === endNode && !isNullOrUndefined(closest(startNode, 'li')) &&\n            ((startNode.textContent.trim() === '' && startNode.textContent.charCodeAt(0) === 65279) ||\n                (startNode.textContent.length === 1 && startNode.textContent.charCodeAt(0) === 8203))) {\n            startNode.textContent = '';\n        }\n        if (startNode === endNode && startNode.tagName === 'LI' && startNode.textContent.length === 0 &&\n            isNOU(startNode.previousElementSibling)) {\n            startNode.removeAttribute('style');\n        }\n        if (startNode === endNode && startNode.textContent === '') {\n            if (startNode.parentElement.tagName === 'LI' && endNode.parentElement.tagName === 'LI') {\n                detach(startNode);\n            }\n            else if (startNode.closest('ul') || startNode.closest('ol')) {\n                var parentList = !isNOU(startNode.closest('ul')) ? startNode.closest('ul') : startNode.closest('ol');\n                if (parentList.firstElementChild === startNode && !isNOU(parentList.children[1]) &&\n                    (parentList.children[1].tagName === 'OL' || parentList.children[1].tagName === 'UL')) {\n                    if (parentList.tagName === parentList.children[1].tagName) {\n                        while (parentList.children[1].lastChild) {\n                            this.parent.domNode.insertAfter(parentList.children[1].lastChild, parentList.children[1]);\n                        }\n                        detach(parentList.children[1]);\n                    }\n                    else {\n                        parentList.parentElement.insertBefore(parentList.children[1], parentList);\n                    }\n                }\n            }\n        }\n        else if (!isNOU(startNode.firstChild) && startNode.firstChild.nodeName === 'BR' &&\n            (!isNullOrUndefined(startNode.childNodes[1]) && (startNode.childNodes[1].nodeName === 'UL' ||\n                startNode.childNodes[1].nodeName === 'OL'))) {\n            var parentList = !isNOU(startNode.closest('ul')) ? startNode.closest('ul') : startNode.closest('ol');\n            if (parentList.tagName === startNode.childNodes[1].nodeName) {\n                while (startNode.childNodes[1].lastChild) {\n                    this.parent.domNode.insertAfter(startNode.children[1].lastChild, startNode);\n                }\n                detach(startNode.childNodes[1]);\n            }\n            else {\n                parentList.parentElement.insertBefore(startNode.children[1], parentList);\n            }\n        }\n        this.removeList(range, e);\n    };\n    Lists.prototype.removeList = function (range, e) {\n        var startNode = this.parent.domNode.getSelectedNode(range.startContainer, range.startOffset);\n        var endNode = this.parent.domNode.getSelectedNode(range.endContainer, range.endOffset);\n        startNode = startNode.nodeName === 'BR' ? startNode.parentElement : startNode;\n        endNode = endNode.nodeName === 'BR' ? endNode.parentElement : endNode;\n        startNode = startNode.nodeName !== 'LI' && !isNOU(startNode.closest('LI')) ? startNode.closest('LI') : startNode;\n        endNode = endNode.nodeName !== 'LI' && !isNOU(endNode.closest('LI')) ? endNode.closest('LI') : endNode;\n        if (((range.commonAncestorContainer.nodeName === 'OL' || range.commonAncestorContainer.nodeName === 'UL' || range.commonAncestorContainer.nodeName === 'LI') &&\n            isNOU(endNode.nextElementSibling) && endNode.textContent.length === range.endOffset &&\n            isNOU(startNode.previousElementSibling) && range.startOffset === 0) ||\n            (Browser.userAgent.indexOf('Firefox') != -1 && range.startContainer === range.endContainer && range.startContainer === this.parent.editableElement &&\n                range.startOffset === 0 && range.endOffset === 1)) {\n            if (Browser.userAgent.indexOf('Firefox') != -1) {\n                detach(range.commonAncestorContainer.childNodes[0]);\n            }\n            else if (range.commonAncestorContainer.nodeName === 'LI') {\n                detach(range.commonAncestorContainer.parentElement);\n            }\n            else {\n                detach(range.commonAncestorContainer);\n            }\n            e.event.preventDefault();\n        }\n    };\n    Lists.prototype.keyDownHandler = function (e) {\n        if (e.event.which === 13) {\n            this.enterList(e);\n        }\n        if (e.event.which === 32) {\n            this.spaceList(e);\n        }\n        if (e.event.which === 8) {\n            this.backspaceList(e);\n        }\n        if (e.event.which === 46 && e.event.action === 'delete') {\n            var range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n            var commonAncestor = range.commonAncestorContainer;\n            var startEle = range.startContainer;\n            var endEle = range.endContainer;\n            var startNode = startEle.nodeType === 3 ? startEle.parentElement : startEle;\n            var endNode = endEle.nodeType === 3 ? endEle.parentElement : endEle;\n            if ((commonAncestor.nodeName === 'UL' || commonAncestor.nodeName === 'OL') && startNode !== endNode\n                && (!isNullOrUndefined(closest(startNode, 'ul')) || !isNullOrUndefined(closest(startNode, 'ol')))\n                && (!isNullOrUndefined(closest(endNode, 'ul')) || !isNullOrUndefined(closest(endNode, 'ol')))\n                && (commonAncestor.lastElementChild === closest(endNode, 'li')) && !range.collapsed) {\n                detach(commonAncestor);\n            }\n            this.removeList(range, e);\n        }\n        if (e.event.which === 9) {\n            var range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n            if (!(e.event.action && e.event.action === 'indent')) {\n                this.saveSelection = this.parent.nodeSelection.save(range, this.parent.currentDocument);\n            }\n            var blockNodes = void 0;\n            var startOffset = range.startOffset;\n            var endOffset = range.endOffset;\n            var startNode = this.parent.domNode.getSelectedNode(range.startContainer, range.startOffset);\n            var endNode = this.parent.domNode.getSelectedNode(range.endContainer, range.endOffset);\n            if ((startNode === endNode && (startNode.nodeName === 'BR' || startNode.nodeName === '#text') &&\n                CONSTANT.IGNORE_BLOCK_TAGS.indexOf(startNode.parentNode.tagName.toLocaleLowerCase()) >= 0)) {\n                return;\n            }\n            else {\n                if (!(e.event.action && e.event.action === 'indent')) {\n                    this.domNode.setMarker(this.saveSelection);\n                }\n                blockNodes = this.domNode.blockNodes();\n            }\n            var nodes = [];\n            var isNested = true;\n            for (var i = 0; i < blockNodes.length; i++) {\n                if (blockNodes[i].parentNode.tagName === 'LI') {\n                    nodes.push(blockNodes[i].parentNode);\n                }\n                else if (blockNodes[i].tagName === 'LI' && blockNodes[i].childNodes[0].tagName !== 'P' &&\n                    (blockNodes[i].childNodes[0].tagName !== 'OL' &&\n                        blockNodes[i].childNodes[0].tagName !== 'UL')) {\n                    nodes.push(blockNodes[i]);\n                }\n            }\n            if (nodes.length > 1 || nodes.length && ((startOffset === 0 && endOffset === 0) || e.ignoreDefault)) {\n                e.event.preventDefault();\n                e.event.stopPropagation();\n                this.currentAction = this.getAction(nodes[0]);\n                if (e.event.shiftKey) {\n                    this.revertList(nodes, e);\n                    this.revertClean();\n                }\n                else {\n                    isNested = this.nestedList(nodes);\n                }\n                if (isNested) {\n                    this.cleanNode();\n                    this.parent.editableElement.focus();\n                }\n                if (!(e.event.action && e.event.action === 'indent')) {\n                    this.saveSelection = this.domNode.saveMarker(this.saveSelection);\n                    this.saveSelection.restore();\n                    if (e.callBack) {\n                        e.callBack({\n                            requestType: this.currentAction,\n                            editorMode: 'HTML',\n                            range: this.parent.nodeSelection.getRange(this.parent.currentDocument),\n                            elements: this.parent.domNode.blockNodes(),\n                            event: e.event\n                        });\n                    }\n                }\n            }\n            else {\n                if (!(e.event.action && e.event.action === 'indent')) {\n                    if (e.event && e.event.shiftKey && e.event.key === 'Tab') {\n                        e.event.action = 'tab';\n                    }\n                    this.saveSelection = this.domNode.saveMarker(this.saveSelection, e.event.action);\n                    this.saveSelection.restore();\n                }\n            }\n        }\n        else {\n            switch (e.event.action) {\n                case 'ordered-list':\n                    this.applyListsHandler({ subCommand: 'OL', callBack: e.callBack });\n                    e.event.preventDefault();\n                    break;\n                case 'unordered-list':\n                    this.applyListsHandler({ subCommand: 'UL', callBack: e.callBack });\n                    e.event.preventDefault();\n                    break;\n            }\n        }\n    };\n    Lists.prototype.spaceKeyAction = function (e) {\n        if (e.event.which === 32) {\n            this.spaceList(e);\n        }\n    };\n    Lists.prototype.getAction = function (element) {\n        var parentNode = element.parentNode;\n        return (parentNode.nodeName === 'OL' ? 'OL' : 'UL');\n    };\n    Lists.prototype.revertClean = function () {\n        var collectionNodes = this.parent.editableElement.querySelectorAll('ul, ol');\n        for (var i = 0; i < collectionNodes.length; i++) {\n            var listNodes = collectionNodes[i].querySelectorAll('ul, ol');\n            if (listNodes.length > 0) {\n                for (var j = 0; j < listNodes.length; j++) {\n                    var prevSibling = listNodes[j].previousSibling;\n                    if (prevSibling && prevSibling.tagName === 'LI') {\n                        prevSibling.appendChild(listNodes[j]);\n                    }\n                }\n            }\n        }\n    };\n    Lists.prototype.noPreviousElement = function (elements) {\n        var firstNode;\n        var firstNodeOL;\n        var siblingListOL = elements.querySelectorAll('ol, ul');\n        var siblingListLI = elements\n            .querySelectorAll('li');\n        var siblingListLIFirst = this.domNode.contents(siblingListLI[0])[0];\n        if (siblingListLI.length > 0 && (siblingListLIFirst.nodeName === 'OL' || siblingListLIFirst.nodeName === 'UL')) {\n            firstNode = siblingListLI[0];\n        }\n        else {\n            firstNodeOL = siblingListOL[0];\n        }\n        if (firstNode) {\n            for (var h = this.domNode.contents(elements)[0]; h && !this.domNode.isList(h); null) {\n                var nextSibling = h.nextSibling;\n                prepend([h], firstNode);\n                setStyleAttribute(elements, { 'list-style-type': 'none' });\n                setStyleAttribute(firstNode, { 'list-style-type': '' });\n                h = nextSibling;\n            }\n        }\n        else if (firstNodeOL) {\n            var nestedElement = createElement('li');\n            prepend([nestedElement], firstNodeOL);\n            for (var h = this.domNode.contents(elements)[0]; h && !this.domNode.isList(h); null) {\n                var nextSibling = h.nextSibling;\n                nestedElement.appendChild(h);\n                h = nextSibling;\n            }\n            prepend([firstNodeOL], elements.parentNode);\n            detach(elements);\n            var nestedElementLI = createElement('li', { styles: 'list-style-type: none;' });\n            prepend([nestedElementLI], firstNodeOL.parentNode);\n            append([firstNodeOL], nestedElementLI);\n        }\n        else {\n            var nestedElementLI = createElement('li', { styles: 'list-style-type: none;' });\n            prepend([nestedElementLI], elements.parentNode);\n            var nestedElement = createElement(elements.parentNode.tagName);\n            prepend([nestedElement], nestedElementLI);\n            append([elements], nestedElement);\n        }\n    };\n    Lists.prototype.nestedList = function (elements) {\n        var isNested = false;\n        for (var i = 0; i < elements.length; i++) {\n            var prevSibling = this.domNode.getPreviousNode(elements[i]);\n            if (prevSibling) {\n                isNested = true;\n                var firstNode = void 0;\n                var firstNodeLI = void 0;\n                var siblingListOL = elements[i].querySelectorAll('ol, ul');\n                var siblingListLI = elements[i]\n                    .querySelectorAll('li');\n                var siblingListLIFirst = this.domNode.contents(siblingListLI[0])[0];\n                if (siblingListLI.length > 0 && (siblingListLIFirst.nodeName === 'OL' || siblingListLIFirst.nodeName === 'UL')) {\n                    firstNodeLI = siblingListLI[0];\n                }\n                else {\n                    firstNode = siblingListOL[0];\n                }\n                if (firstNode) {\n                    var nestedElement = createElement('li');\n                    prepend([nestedElement], firstNode);\n                    for (var h = this.domNode.contents(elements[i])[0]; h && !this.domNode.isList(h); null) {\n                        var nextSibling = h.nextSibling;\n                        nestedElement.appendChild(h);\n                        h = nextSibling;\n                    }\n                    append([firstNode], prevSibling);\n                    detach(elements[i]);\n                }\n                else if (firstNodeLI) {\n                    if (prevSibling.tagName === 'LI') {\n                        for (var h = this.domNode.contents(elements[i])[0]; h && !this.domNode.isList(h); null) {\n                            var nextSibling = h.nextSibling;\n                            prepend([h], firstNodeLI);\n                            setStyleAttribute(elements[i], { 'list-style-type': 'none' });\n                            setStyleAttribute(firstNodeLI, { 'list-style-type': '' });\n                            h = nextSibling;\n                        }\n                        append([firstNodeLI.parentNode], prevSibling);\n                        detach(elements[i]);\n                    }\n                }\n                else {\n                    if (prevSibling.tagName === 'LI') {\n                        var nestedElement = createElement(elements[i].parentNode.tagName);\n                        append([nestedElement], prevSibling);\n                        append([elements[i]], nestedElement);\n                    }\n                    else if (prevSibling.tagName === 'OL' || prevSibling.tagName === 'UL') {\n                        append([elements[i]], prevSibling);\n                    }\n                }\n            }\n            else {\n                var element = elements[i];\n                isNested = true;\n                this.noPreviousElement(element);\n            }\n        }\n        return isNested;\n    };\n    Lists.prototype.applyListsHandler = function (e) {\n        var range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n        if (Browser.userAgent.indexOf('Firefox') != -1 && range.startContainer === range.endContainer && range.startContainer === this.parent.editableElement) {\n            var startChildNodes = range.startContainer.childNodes;\n            var startNode = ((startChildNodes[(range.startOffset > 0) ? (range.startOffset - 1) : range.startOffset]) || range.startContainer);\n            var endNode = (range.endContainer.childNodes[(range.endOffset > 0) ? (range.endOffset - 1) : range.endOffset] || range.endContainer);\n            var lastSelectionNode = endNode.lastChild.nodeName === 'BR' ? (isNOU(endNode.lastChild.previousSibling) ? endNode\n                : endNode.lastChild.previousSibling) : endNode.lastChild;\n            while (!isNOU(lastSelectionNode) && lastSelectionNode.nodeName !== '#text' && lastSelectionNode.nodeName !== 'IMG' &&\n                lastSelectionNode.nodeName !== 'BR' && lastSelectionNode.nodeName !== 'HR') {\n                lastSelectionNode = lastSelectionNode.lastChild;\n            }\n            this.parent.nodeSelection.setSelectionText(this.parent.currentDocument, startNode, lastSelectionNode, 0, lastSelectionNode.textContent.length);\n            range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n        }\n        if (range.startContainer === range.endContainer && range.startContainer === this.parent.editableElement &&\n            range.startOffset === range.endOffset && range.startOffset === 0 &&\n            this.parent.editableElement.textContent.length === 0 && (this.parent.editableElement.childNodes[0].nodeName != 'TABLE' &&\n            this.parent.editableElement.childNodes[0].nodeName != 'IMG')) {\n            var focusNode = range.startContainer.childNodes[0];\n            this.parent.nodeSelection.setSelectionText(this.parent.currentDocument, focusNode, focusNode, 0, 0);\n            range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n        }\n        this.saveSelection = this.parent.nodeSelection.save(range, this.parent.currentDocument);\n        this.currentAction = e.subCommand;\n        this.currentAction = e.subCommand = this.currentAction === 'NumberFormatList' ? 'OL' : this.currentAction === 'BulletFormatList' ? 'UL' : this.currentAction;\n        this.domNode.setMarker(this.saveSelection);\n        var listsNodes = this.domNode.blockNodes();\n        if (e.enterAction === 'BR') {\n            this.setSelectionBRConfig();\n            var allSelectedNode = this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument);\n            var selectedNodes = this.parent.nodeSelection.getSelectionNodes(allSelectedNode);\n            var currentFormatNodes = [];\n            if (selectedNodes.length === 0) {\n                selectedNodes.push(listsNodes[0]);\n            }\n            for (var i = 0; i < selectedNodes.length; i++) {\n                var currentNode = selectedNodes[i];\n                var previousCurrentNode = void 0;\n                while (!this.parent.domNode.isBlockNode(currentNode) && currentNode !== this.parent.editableElement) {\n                    previousCurrentNode = currentNode;\n                    currentNode = currentNode.parentElement;\n                }\n                if (this.parent.domNode.isBlockNode(currentNode) && currentNode === this.parent.editableElement) {\n                    currentFormatNodes.push(previousCurrentNode);\n                }\n            }\n            for (var i = 0; i < currentFormatNodes.length; i++) {\n                if (!this.parent.domNode.isBlockNode(currentFormatNodes[i])) {\n                    var currentNode = currentFormatNodes[i];\n                    var previousNode = currentNode;\n                    while (currentNode === this.parent.editableElement) {\n                        previousNode = currentNode;\n                        currentNode = currentNode.parentElement;\n                    }\n                    var tempElem = void 0;\n                    if (this.parent.domNode.isBlockNode(previousNode.parentElement) &&\n                        previousNode.parentElement === this.parent.editableElement) {\n                        tempElem = createElement('p');\n                        previousNode.parentElement.insertBefore(tempElem, previousNode);\n                        tempElem.appendChild(previousNode);\n                    }\n                    else {\n                        tempElem = previousNode;\n                    }\n                    var preNode = tempElem.previousSibling;\n                    while (!isNOU(preNode) && preNode.nodeName !== 'BR' &&\n                        !this.parent.domNode.isBlockNode(preNode)) {\n                        tempElem.firstChild.parentElement.insertBefore(preNode, tempElem.firstChild);\n                        preNode = tempElem.previousSibling;\n                    }\n                    if (!isNOU(preNode) && preNode.nodeName === 'BR') {\n                        detach(preNode);\n                    }\n                    var postNode = tempElem.nextSibling;\n                    while (!isNOU(postNode) && postNode.nodeName !== 'BR' &&\n                        !this.parent.domNode.isBlockNode(postNode)) {\n                        tempElem.appendChild(postNode);\n                        postNode = tempElem.nextSibling;\n                    }\n                    if (!isNOU(postNode) && postNode.nodeName === 'BR') {\n                        detach(postNode);\n                    }\n                }\n            }\n            this.setSelectionBRConfig();\n            listsNodes = this.parent.domNode.blockNodes();\n        }\n        for (var i = 0; i < listsNodes.length; i++) {\n            if (listsNodes[i].tagName === 'TABLE' && !range.collapsed) {\n                listsNodes.splice(i, 1);\n            }\n            if (listsNodes.length > 0 && listsNodes[i].tagName !== 'LI'\n                && 'LI' === listsNodes[i].parentNode.tagName) {\n                listsNodes[i] = listsNodes[i].parentNode;\n            }\n        }\n        this.applyLists(listsNodes, this.currentAction, e.selector, e.item, e);\n        if (e.callBack) {\n            e.callBack({\n                requestType: this.currentAction,\n                event: e.event,\n                editorMode: 'HTML',\n                range: this.parent.nodeSelection.getRange(this.parent.currentDocument),\n                elements: this.parent.domNode.blockNodes()\n            });\n        }\n    };\n    Lists.prototype.setSelectionBRConfig = function () {\n        var startElem = this.parent.editableElement.querySelector('.' + markerClassName.startSelection);\n        var endElem = this.parent.editableElement.querySelector('.' + markerClassName.endSelection);\n        if (isNOU(endElem)) {\n            this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, startElem, 0);\n        }\n        else {\n            this.parent.nodeSelection.setSelectionText(this.parent.currentDocument, startElem, endElem, 0, 0);\n        }\n    };\n    Lists.prototype.applyLists = function (elements, type, selector, item, e) {\n        var isReverse = true;\n        if (this.isRevert(elements, type, item) && isNOU(item)) {\n            this.revertList(elements, e);\n            this.removeEmptyListElements();\n        }\n        else {\n            this.checkLists(elements, type, item);\n            for (var i = 0; i < elements.length; i++) {\n                if (!isNOU(item) && !isNOU(item.listStyle)) {\n                    if (item.listStyle === 'listImage') {\n                        setStyleAttribute(elements[i], { 'list-style-image': item.listImage });\n                    }\n                    else {\n                        setStyleAttribute(elements[i], { 'list-style-image': 'none' });\n                        setStyleAttribute(elements[i], { 'list-style-type': item.listStyle.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase() });\n                    }\n                }\n                if (elements[i].getAttribute('contenteditable') === 'true'\n                    && elements[i].childNodes.length === 1 && elements[i].childNodes[0].nodeName === 'TABLE') {\n                    var listEle = document.createElement(type);\n                    listEle.innerHTML = '<li><br/></li>';\n                    elements[i].appendChild(listEle);\n                }\n                else if ('LI' !== elements[i].tagName && isNOU(item)) {\n                    isReverse = false;\n                    var elemAtt = elements[i].tagName === 'IMG' ? '' : this.domNode.attributes(elements[i]);\n                    var openTag = '<' + type + '>';\n                    var closeTag = '</' + type + '>';\n                    var newTag = 'li' + elemAtt;\n                    var replaceHTML = (elements[i].tagName.toLowerCase() === CONSTANT.DEFAULT_TAG ? elements[i].innerHTML :\n                        elements[i].outerHTML);\n                    var innerHTML = this.domNode.createTagString(newTag, null, replaceHTML);\n                    var collectionString = openTag + innerHTML + closeTag;\n                    this.domNode.replaceWith(elements[i], collectionString);\n                }\n                else if (!isNOU(item) && 'LI' !== elements[i].tagName) {\n                    // eslint-disable-next-line\n                    isReverse = false;\n                    var elemAtt = elements[i].tagName === 'IMG' ? '' : this.domNode.attributes(elements[i]);\n                    var openTag = '<' + type + elemAtt + '>';\n                    var closeTag = '</' + type + '>';\n                    var newTag = 'li';\n                    var replaceHTML = (elements[i].tagName.toLowerCase() === CONSTANT.DEFAULT_TAG ? elements[i].innerHTML :\n                        elements[i].outerHTML);\n                    var innerHTML = this.domNode.createTagString(newTag, null, replaceHTML);\n                    var collectionString = openTag + innerHTML + closeTag;\n                    this.domNode.replaceWith(elements[i], collectionString);\n                }\n            }\n        }\n        this.cleanNode();\n        this.parent.editableElement.focus();\n        if (isIDevice()) {\n            setEditFrameFocus(this.parent.editableElement, selector);\n        }\n        this.saveSelection = this.domNode.saveMarker(this.saveSelection);\n        this.saveSelection.restore();\n    };\n    Lists.prototype.removeEmptyListElements = function () {\n        var listElem = this.parent.editableElement.querySelectorAll('ol, ul');\n        for (var i = 0; i < listElem.length; i++) {\n            if (listElem[i].textContent.trim() === '') {\n                detach(listElem[i]);\n            }\n        }\n    };\n    Lists.prototype.isRevert = function (nodes, tagName, item) {\n        var isRevert = true;\n        for (var i = 0; i < nodes.length; i++) {\n            if (nodes[i].tagName !== 'LI') {\n                return false;\n            }\n            if (nodes[i].parentNode.tagName !== tagName ||\n                isNOU(item) && nodes[i].parentNode.style.listStyleType !== '') {\n                isRevert = false;\n            }\n        }\n        return isRevert;\n    };\n    Lists.prototype.checkLists = function (nodes, tagName, item) {\n        var nodesTemp = [];\n        for (var i = 0; i < nodes.length; i++) {\n            var node = nodes[i].parentNode;\n            if (!isNOU(item) && 'LI' === nodes[i].tagName && !isNOU(item.listStyle)) {\n                if (item.listStyle === 'listImage') {\n                    setStyleAttribute(node, { 'list-style-image': item.listImage });\n                }\n                else {\n                    setStyleAttribute(node, { 'list-style-image': 'none' });\n                    setStyleAttribute(node, { 'list-style-type': item.listStyle.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase() });\n                }\n            }\n            if ((nodes[i].tagName === 'LI' && node.tagName !== tagName && nodesTemp.indexOf(node) < 0) ||\n                (nodes[i].tagName === 'LI' && node.tagName === tagName && nodesTemp.indexOf(node) < 0 && item !== null)) {\n                nodesTemp.push(node);\n            }\n            if (isNOU(item) && (node.tagName === tagName ||\n                ((node.tagName === 'UL' || node.tagName === 'OL') && node.hasAttribute('style')))) {\n                if (node.hasAttribute('style')) {\n                    node.removeAttribute('style');\n                }\n            }\n        }\n        for (var j = nodesTemp.length - 1; j >= 0; j--) {\n            var h = nodesTemp[j];\n            var replace = '<' + tagName.toLowerCase() + ' '\n                + this.domNode.attributes(h) + '>' + h.innerHTML + '</' + tagName.toLowerCase() + '>';\n            this.domNode.replaceWith(nodesTemp[j], replace);\n        }\n    };\n    Lists.prototype.cleanNode = function () {\n        var liParents = this.parent.editableElement.querySelectorAll('ol + ol, ul + ul');\n        for (var c = 0; c < liParents.length; c++) {\n            var node = liParents[c];\n            if (this.domNode.isList(node.previousElementSibling) &&\n                this.domNode.openTagString(node) === this.domNode.openTagString(node.previousElementSibling)) {\n                var contentNodes = this.domNode.contents(node);\n                for (var f = 0; f < contentNodes.length; f++) {\n                    node.previousElementSibling.appendChild(contentNodes[f]);\n                }\n                node.parentNode.removeChild(node);\n            }\n        }\n    };\n    Lists.prototype.findUnSelected = function (temp, elements) {\n        temp = temp.slice().reverse();\n        if (temp.length > 0) {\n            var rightIndent = [];\n            var indentElements = [];\n            var lastElement = elements[elements.length - 1];\n            var lastElementChild = [];\n            var childElements = [];\n            lastElementChild = (lastElement.childNodes);\n            for (var z = 0; z < lastElementChild.length; z++) {\n                if (lastElementChild[z].tagName === 'OL' || lastElementChild[z].tagName === 'UL') {\n                    var childLI = lastElementChild[z]\n                        .querySelectorAll('li');\n                    if (childLI.length > 0) {\n                        for (var y = 0; y < childLI.length; y++) {\n                            childElements.push(childLI[y]);\n                        }\n                    }\n                }\n            }\n            for (var i = 0; i < childElements.length; i++) {\n                var count = 0;\n                for (var j = 0; j < temp.length; j++) {\n                    if (!childElements[i].contains((temp[j]))) {\n                        count = count + 1;\n                    }\n                }\n                if (count === temp.length) {\n                    indentElements.push(childElements[i]);\n                }\n            }\n            if (indentElements.length > 0) {\n                for (var x = 0; x < indentElements.length; x++) {\n                    if (this.domNode.contents(indentElements[x])[0].nodeName !== 'OL' &&\n                        this.domNode.contents(indentElements[x])[0].nodeName !== 'UL') {\n                        rightIndent.push(indentElements[x]);\n                    }\n                }\n            }\n            if (rightIndent.length > 0) {\n                this.nestedList(rightIndent);\n            }\n        }\n    };\n    Lists.prototype.revertList = function (elements, e) {\n        var temp = [];\n        for (var i = elements.length - 1; i >= 0; i--) {\n            for (var j = i - 1; j >= 0; j--) {\n                if (elements[j].contains((elements[i])) || elements[j] === elements[i]) {\n                    temp.push(elements[i]);\n                    elements.splice(i, 1);\n                    break;\n                }\n            }\n        }\n        this.findUnSelected(temp, elements);\n        var viewNode = [];\n        for (var i = 0; i < elements.length; i++) {\n            var element = elements[i];\n            if (this.domNode.contents(element)[0].nodeType === 3 && this.domNode.contents(element)[0].textContent.trim().length === 0) {\n                detach(this.domNode.contents(element)[0]);\n            }\n            var parentNode = elements[i].parentNode;\n            var className = element.getAttribute('class');\n            if (temp.length === 0) {\n                var siblingList = elements[i].querySelectorAll('ul, ol');\n                var firstNode = siblingList[0];\n                if (firstNode) {\n                    var child = firstNode\n                        .querySelectorAll('li');\n                    if (child) {\n                        var nestedElement = createElement(firstNode.tagName);\n                        append([nestedElement], firstNode.parentNode);\n                        var nestedElementLI = createElement('li', { styles: 'list-style-type: none;' });\n                        append([nestedElementLI], nestedElement);\n                        append([firstNode], nestedElementLI);\n                    }\n                }\n            }\n            if (element.parentNode.insertBefore(this.closeTag(parentNode.tagName), element),\n                'LI' === parentNode.parentNode.tagName || 'OL' === parentNode.parentNode.tagName ||\n                    'UL' === parentNode.parentNode.tagName) {\n                element.parentNode.insertBefore(this.closeTag('LI'), element);\n            }\n            else {\n                var classAttr = '';\n                if (className) {\n                    // eslint-disable-next-line\n                    classAttr += ' class=\"' + className + '\"';\n                }\n                if (CONSTANT.DEFAULT_TAG && 0 === element.querySelectorAll(CONSTANT.BLOCK_TAGS.join(', ')).length) {\n                    var wrapperclass = isNullOrUndefined(className) ? ' class=\"e-rte-wrap-inner\"' :\n                        ' class=\"' + className + ' e-rte-wrap-inner\"';\n                    var wrapper = '<' + CONSTANT.DEFAULT_TAG + wrapperclass +\n                        this.domNode.attributes(parentNode) + '></' + CONSTANT.DEFAULT_TAG + '>';\n                    if (e.enterAction !== 'BR') {\n                        this.domNode.wrapInner(element, this.domNode.parseHTMLFragment(wrapper));\n                    }\n                }\n                else if (this.domNode.contents(element)[0].nodeType === 3) {\n                    var replace = this.domNode.createTagString(CONSTANT.DEFAULT_TAG, parentNode, this.parent.domNode.encode(this.domNode.contents(element)[0].textContent));\n                    this.domNode.replaceWith(this.domNode.contents(element)[0], replace);\n                }\n                else if (this.domNode.contents(element)[0].classList.contains(markerClassName.startSelection) ||\n                    this.domNode.contents(element)[0].classList.contains(markerClassName.endSelection)) {\n                    var replace = this.domNode.createTagString(CONSTANT.DEFAULT_TAG, parentNode, this.domNode.contents(element)[0].outerHTML);\n                    this.domNode.replaceWith(this.domNode.contents(element)[0], replace);\n                }\n                else {\n                    var childNode = element.firstChild;\n                    className = childNode.getAttribute('class');\n                    attributes(childNode, this.domNode.rawAttributes(parentNode));\n                    if (className && childNode.getAttribute('class')) {\n                        attributes(childNode, { 'class': className + ' ' + childNode.getAttribute('class') });\n                    }\n                }\n                append([this.openTag('LI')], element);\n                prepend([this.closeTag('LI')], element);\n            }\n            this.domNode.insertAfter(this.openTag(parentNode.tagName), element);\n            if (parentNode.parentNode.tagName === 'LI') {\n                parentNode = parentNode.parentNode.parentNode;\n            }\n            if (viewNode.indexOf(parentNode) < 0) {\n                viewNode.push(parentNode);\n            }\n        }\n        for (var i = 0; i < viewNode.length; i++) {\n            var node = viewNode[i];\n            var nodeInnerHtml = node.innerHTML;\n            var closeTag = /<span class=\"e-rte-list-close-([a-z]*)\"><\\/span>/g;\n            var openTag = /<span class=\"e-rte-list-open-([a-z]*)\"><\\/span>/g;\n            nodeInnerHtml = nodeInnerHtml.replace(closeTag, '</$1>');\n            nodeInnerHtml = nodeInnerHtml.replace(openTag, '<$1 ' + this.domNode.attributes(node) + '>');\n            this.domNode.replaceWith(node, this.domNode.openTagString(node) + nodeInnerHtml.trim() + this.domNode.closeTagString(node));\n        }\n        var emptyUl = this.parent.editableElement.querySelectorAll('ul:empty, ol:empty');\n        for (var i = 0; i < emptyUl.length; i++) {\n            detach(emptyUl[i]);\n        }\n        var emptyLi = this.parent.editableElement.querySelectorAll('li:empty');\n        for (var i = 0; i < emptyLi.length; i++) {\n            detach(emptyLi[i]);\n        }\n    };\n    Lists.prototype.openTag = function (type) {\n        return this.domNode.parseHTMLFragment('<span class=\"e-rte-list-open-' + type.toLowerCase() + '\"></span>');\n    };\n    Lists.prototype.closeTag = function (type) {\n        return this.domNode.parseHTMLFragment('<span class=\"e-rte-list-close-' + type.toLowerCase() + '\"></span>');\n    };\n    return Lists;\n}());\nexport { Lists };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}