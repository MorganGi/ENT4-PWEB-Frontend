{"ast":null,"code":"import * as events from '../base/constant';\nimport { Popup } from '@syncfusion/ej2-popups';\nimport { RadioButton } from '@syncfusion/ej2-buttons';\nimport { isNullOrUndefined as isNOU, isNullOrUndefined, detach, extend, addClass, removeClass } from '@syncfusion/ej2-base';\nimport { getUniqueID, Browser } from '@syncfusion/ej2-base';\nimport { CLS_RTE_PASTE_KEEP_FORMAT, CLS_RTE_PASTE_REMOVE_FORMAT, CLS_RTE_PASTE_PLAIN_FORMAT } from '../base/classes';\nimport { CLS_RTE_PASTE_OK, CLS_RTE_PASTE_CANCEL, CLS_RTE_DIALOG_MIN_HEIGHT } from '../base/classes';\nimport { pasteCleanupGroupingTags } from '../../common/config';\nimport { NodeSelection } from '../../selection/selection';\nimport * as EVENTS from './../../common/constant';\nimport { RenderType } from '../base/enum';\nimport { Uploader } from '@syncfusion/ej2-inputs';\nimport * as classes from '../base/classes';\nimport { sanitizeHelper, convertToBlob, getDefaultValue } from '../base/util';\n/**\n * PasteCleanup module called when pasting content in RichTextEditor\n */\n\nvar PasteCleanup =\n/** @class */\nfunction () {\n  function PasteCleanup(parent, serviceLocator) {\n    this.inlineNode = ['a', 'abbr', 'acronym', 'audio', 'b', 'bdi', 'bdo', 'big', 'br', 'button', 'canvas', 'cite', 'code', 'data', 'datalist', 'del', 'dfn', 'em', 'embed', 'font', 'i', 'iframe', 'img', 'input', 'ins', 'kbd', 'label', 'map', 'mark', 'meter', 'noscript', 'object', 'output', 'picture', 'progress', 'q', 'ruby', 's', 'samp', 'script', 'select', 'slot', 'small', 'span', 'strong', 'sub', 'sup', 'svg', 'template', 'textarea', 'time', 'u', 'tt', 'var', 'video', 'wbr'];\n    this.blockNode = ['div', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'address', 'blockquote', 'button', 'center', 'dd', 'dir', 'dl', 'dt', 'fieldset', 'frameset', 'hr', 'iframe', 'isindex', 'li', 'map', 'menu', 'noframes', 'noscript', 'object', 'ol', 'pre', 'td', 'tr', 'th', 'tbody', 'tfoot', 'thead', 'table', 'ul', 'header', 'article', 'nav', 'footer', 'section', 'aside', 'main', 'figure', 'figcaption'];\n    this.isNotFromHtml = false;\n    this.containsHtml = false;\n    this.parent = parent;\n    this.locator = serviceLocator;\n    this.renderFactory = this.locator.getService('rendererFactory');\n    this.i10n = serviceLocator.getService('rteLocale');\n    this.dialogRenderObj = serviceLocator.getService('dialogRenderObject');\n    this.addEventListener();\n  }\n\n  PasteCleanup.prototype.addEventListener = function () {\n    this.nodeSelectionObj = new NodeSelection();\n\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.on(events.pasteClean, this.pasteClean, this);\n    this.parent.on(events.bindCssClass, this.setCssClass, this);\n    this.parent.on(events.destroy, this.destroy, this);\n  };\n\n  PasteCleanup.prototype.destroy = function () {\n    this.removeEventListener();\n  };\n\n  PasteCleanup.prototype.removeEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.off(events.pasteClean, this.pasteClean);\n    this.parent.off(events.bindCssClass, this.setCssClass);\n    this.parent.off(events.destroy, this.destroy);\n  };\n\n  PasteCleanup.prototype.pasteClean = function (e) {\n    var _this = this;\n\n    var args = {\n      requestType: 'Paste',\n      editorMode: this.parent.editorMode,\n      event: e\n    };\n    var value = null;\n    var imageproperties;\n\n    if (e.args && !isNOU(e.args.clipboardData)) {\n      value = e.args.clipboardData.getData('text/html');\n    }\n\n    this.parent.trigger(events.beforePasteCleanup, {\n      value: value\n    });\n\n    if (e.args && value !== null && this.parent.editorMode === 'HTML') {\n      if (value.length === 0) {\n        var htmlRegex = new RegExp(/<\\/[a-z][\\s\\S]*>/i);\n        value = e.args.clipboardData.getData('text/plain');\n        this.isNotFromHtml = value !== '' ? true : false;\n        value = value.replace(/</g, '&lt;');\n        value = value.replace(/>/g, '&gt;');\n        this.containsHtml = htmlRegex.test(value);\n        var file = e && e.args.clipboardData && e.args.clipboardData.items.length > 0 ? e.args.clipboardData.items[0].getAsFile() === null ? !isNOU(e.args.clipboardData.items[1]) ? e.args.clipboardData.items[1].getAsFile() : null : e.args.clipboardData.items[0].getAsFile() : null;\n        this.parent.notify(events.paste, {\n          file: file,\n          args: e.args,\n          text: value,\n          callBack: function (b) {\n            imageproperties = b;\n\n            if (typeof imageproperties === 'object') {\n              _this.parent.formatter.editorManager.execCommand('Images', 'Image', e.args, _this.imageFormatting.bind(_this, args), 'pasteCleanup', imageproperties, 'pasteCleanupModule');\n            } else {\n              value = imageproperties;\n            }\n          }\n        });\n\n        if (!htmlRegex.test(value)) {\n          var divElement = this.parent.createElement('div');\n          divElement.innerHTML = this.splitBreakLine(value);\n          value = divElement.innerHTML;\n        }\n      } else if (value.length > 0) {\n        this.parent.formatter.editorManager.observer.notify(EVENTS.MS_WORD_CLEANUP, {\n          args: e.args,\n          text: e.text,\n          allowedStylePropertiesArray: this.parent.pasteCleanupSettings.allowedStyleProps,\n          callBack: function (a) {\n            value = a.trim();\n          }\n        });\n      }\n\n      this.contentRenderer = this.renderFactory.getRenderer(RenderType.Content);\n      var currentDocument = this.contentRenderer.getDocument();\n      var range = this.nodeSelectionObj.getRange(currentDocument);\n      this.saveSelection = this.nodeSelectionObj.save(range, currentDocument);\n      this.parent.trigger(events.afterPasteCleanup, {\n        value: value\n      }, function (updatedArgs) {\n        value = updatedArgs.value;\n      });\n\n      if (this.parent.pasteCleanupSettings.prompt) {\n        e.args.preventDefault();\n        var tempDivElem = this.parent.createElement('div');\n        tempDivElem.innerHTML = value;\n\n        if (tempDivElem.textContent !== '' || !isNOU(tempDivElem.querySelector('img')) || !isNOU(tempDivElem.querySelector('table'))) {\n          this.pasteDialog(value, args);\n        }\n      } else if (this.parent.pasteCleanupSettings.plainText) {\n        e.args.preventDefault();\n        this.plainFormatting(value, args);\n      } else if (this.parent.pasteCleanupSettings.keepFormat) {\n        e.args.preventDefault();\n        this.formatting(value, false, args);\n      } else {\n        e.args.preventDefault();\n        this.formatting(value, true, args);\n      }\n    }\n  };\n\n  PasteCleanup.prototype.splitBreakLine = function (value) {\n    var enterSplitText = value.split('\\n');\n    var contentInnerElem = '';\n\n    for (var i = 0; i < enterSplitText.length; i++) {\n      if (enterSplitText[i].trim() === '') {\n        contentInnerElem += getDefaultValue(this.parent);\n      } else {\n        var contentWithSpace = this.makeSpace(enterSplitText[i]);\n        contentInnerElem += '<p>' + contentWithSpace.trim() + '</p>';\n      }\n    }\n\n    return contentInnerElem;\n  };\n\n  PasteCleanup.prototype.makeSpace = function (enterSplitText) {\n    var contentWithSpace = '';\n    var spaceBetweenContent = true;\n    var spaceSplit = enterSplitText.split(' ');\n\n    for (var j = 0; j < spaceSplit.length; j++) {\n      if (spaceSplit[j].trim() === '') {\n        contentWithSpace += spaceBetweenContent ? '&nbsp;' : ' ';\n      } else {\n        spaceBetweenContent = false;\n        contentWithSpace += spaceSplit[j] + ' ';\n      }\n    }\n\n    return contentWithSpace;\n  };\n\n  PasteCleanup.prototype.imgUploading = function (elm) {\n    var allImgElm = elm.querySelectorAll('.pasteContent_Img');\n\n    if (this.parent.insertImageSettings.saveUrl && allImgElm.length > 0) {\n      var base64Src = [];\n      var imgName = [];\n      var uploadImg = [];\n\n      for (var i = 0; i < allImgElm.length; i++) {\n        if (allImgElm[i].getAttribute('src').split(',')[0].indexOf('base64') >= 0) {\n          base64Src.push(allImgElm[i].getAttribute('src'));\n          imgName.push(getUniqueID('rte_image'));\n          uploadImg.push(allImgElm[i]);\n        }\n      }\n\n      var fileList = [];\n\n      for (var i = 0; i < base64Src.length; i++) {\n        fileList.push(this.base64ToFile(base64Src[i], imgName[i]));\n      }\n\n      for (var i = 0; i < fileList.length; i++) {\n        this.uploadMethod(fileList[i], uploadImg[i]);\n      }\n\n      if (isNOU(this.parent.insertImageSettings.path) && this.parent.insertImageSettings.saveFormat === 'Blob') {\n        this.getBlob(allImgElm);\n      }\n    } else if (this.parent.insertImageSettings.saveFormat === 'Blob') {\n      this.getBlob(allImgElm);\n    }\n\n    var allImgElmId = elm.querySelectorAll('.pasteContent_Img');\n\n    for (var i = 0; i < allImgElmId.length; i++) {\n      allImgElmId[i].classList.remove('pasteContent_Img');\n\n      if (allImgElmId[i].getAttribute('class').trim() === '') {\n        allImgElm[i].removeAttribute('class');\n      }\n    }\n  };\n\n  PasteCleanup.prototype.getBlob = function (allImgElm) {\n    for (var i = 0; i < allImgElm.length; i++) {\n      if (!isNOU(allImgElm[i].getAttribute('src')) && allImgElm[i].getAttribute('src').split(',')[0].indexOf('base64') >= 0) {\n        var blopUrl = URL.createObjectURL(convertToBlob(allImgElm[i].getAttribute('src')));\n        allImgElm[i].setAttribute('src', blopUrl);\n      }\n    }\n  };\n\n  PasteCleanup.prototype.toolbarEnableDisable = function (state) {\n    if (!this.parent.inlineMode.enable) {\n      this.parent.toolbarModule.baseToolbar.toolbarObj.disable(state);\n    }\n  };\n\n  PasteCleanup.prototype.uploadMethod = function (fileList, imgElem) {\n    var _this = this;\n\n    var uploadEle = document.createElement('div');\n    document.body.appendChild(uploadEle);\n    uploadEle.setAttribute('display', 'none');\n    imgElem.style.opacity = '0.5';\n    var popupEle = this.parent.createElement('div');\n    this.parent.element.appendChild(popupEle);\n    var contentEle = this.parent.createElement('input', {\n      id: this.parent.element.id + '_upload',\n      attrs: {\n        type: 'File',\n        name: 'UploadFiles'\n      }\n    });\n    var offsetY = this.parent.iframeSettings.enable ? -50 : -90;\n    this.popupObj = new Popup(popupEle, {\n      relateTo: imgElem,\n      height: '85px',\n      width: '300px',\n      offsetY: offsetY,\n      content: contentEle,\n      viewPortElement: this.parent.element,\n      position: {\n        X: 'center',\n        Y: 'top'\n      },\n      enableRtl: this.parent.enableRtl,\n      zIndex: 10001,\n      // eslint-disable-next-line\n      close: function (event) {\n        _this.parent.isBlur = false;\n\n        _this.popupObj.destroy();\n\n        detach(_this.popupObj.element);\n      }\n    });\n    this.popupObj.element.style.display = 'none';\n    addClass([this.popupObj.element], [classes.CLS_POPUP_OPEN, classes.CLS_RTE_UPLOAD_POPUP]);\n\n    if (!isNOU(this.parent.cssClass)) {\n      addClass([this.popupObj.element], this.parent.cssClass);\n    }\n\n    var timeOut = fileList.size > 1000000 ? 300 : 100;\n    setTimeout(function () {\n      _this.refreshPopup(imgElem, _this.popupObj);\n    }, timeOut);\n    var rawFile;\n    var beforeUploadArgs;\n    this.uploadObj = new Uploader({\n      asyncSettings: {\n        saveUrl: this.parent.insertImageSettings.saveUrl,\n        removeUrl: this.parent.insertImageSettings.removeUrl\n      },\n      cssClass: classes.CLS_RTE_DIALOG_UPLOAD,\n      dropArea: this.parent.inputElement,\n      allowedExtensions: this.parent.insertImageSettings.allowedTypes.toString(),\n      success: function (e) {\n        setTimeout(function () {\n          _this.popupClose(_this.popupObj, _this.uploadObj, imgElem, e);\n        }, 900);\n      },\n      uploading: function (e) {\n        if (!_this.parent.isServerRendered) {\n          _this.parent.trigger(events.imageUploading, e, function (imageUploadingArgs) {\n            if (imageUploadingArgs.cancel) {\n              if (!isNullOrUndefined(imgElem)) {\n                detach(imgElem);\n              }\n\n              if (!isNullOrUndefined(_this.popupObj.element)) {\n                detach(_this.popupObj.element);\n              }\n            } else {\n              _this.parent.inputElement.contentEditable = 'false';\n            }\n          });\n        }\n      },\n      beforeUpload: function (args) {\n        if (_this.parent.isServerRendered) {\n          beforeUploadArgs = JSON.parse(JSON.stringify(args));\n          beforeUploadArgs.filesData = rawFile;\n          args.cancel = true;\n\n          _this.parent.trigger(events.imageUploading, beforeUploadArgs, function (beforeUploadArgs) {\n            if (beforeUploadArgs.cancel) {\n              return;\n            }\n\n            _this.toolbarEnableDisable(true);\n            /* eslint-disable */\n\n\n            _this.uploadObj.currentRequestHeader = beforeUploadArgs.currentRequest ? beforeUploadArgs.currentRequest : _this.uploadObj.currentRequestHeader;\n            _this.uploadObj.customFormDatas = beforeUploadArgs.customFormData && beforeUploadArgs.customFormData.length > 0 ? beforeUploadArgs.customFormData : _this.uploadObj.customFormDatas;\n\n            _this.uploadObj.uploadFiles(rawFile, null);\n            /* eslint-enable */\n\n          });\n        } else {\n          _this.parent.trigger(events.beforeImageUpload, args);\n\n          _this.toolbarEnableDisable(true);\n        }\n      },\n      // eslint-disable-next-line\n      failure: function (e) {\n        setTimeout(function () {\n          _this.uploadFailure(imgElem, _this.uploadObj, _this.popupObj, e);\n        }, 900);\n      },\n      canceling: function () {\n        _this.parent.inputElement.contentEditable = 'true';\n\n        if (imgElem.nextSibling.textContent === ' ') {\n          detach(imgElem.nextSibling);\n        }\n\n        detach(imgElem);\n\n        _this.popupObj.close();\n      },\n      selected: function (e) {\n        e.cancel = true;\n\n        if (_this.parent.isServerRendered) {\n          rawFile = e.filesData;\n        }\n      },\n      removing: function () {\n        _this.parent.inputElement.contentEditable = 'true';\n\n        if (imgElem.nextSibling.textContent === ' ') {\n          detach(imgElem.nextSibling);\n        }\n\n        detach(imgElem);\n\n        _this.popupObj.close();\n      }\n    });\n    this.uploadObj.appendTo(this.popupObj.element.childNodes[0]);\n    /* eslint-disable */\n\n    var fileData = [{\n      name: fileList.name,\n      rawFile: fileList,\n      size: fileList.size,\n      type: fileList.type,\n      validationMessages: {\n        minSize: \"\",\n        maxSize: \"\"\n      },\n      statusCode: '1'\n    }];\n    this.uploadObj.createFileList(fileData);\n    this.uploadObj.filesData.push(fileData[0]);\n    /* eslint-enable */\n\n    rawFile = fileData;\n    this.uploadObj.upload(fileData);\n    this.popupObj.element.getElementsByClassName('e-file-select-wrap')[0].style.display = 'none';\n    detach(this.popupObj.element.querySelector('.e-rte-dialog-upload .e-file-select-wrap'));\n  };\n\n  PasteCleanup.prototype.uploadFailure = function (imgElem, uploadObj, popupObj, e) {\n    this.parent.inputElement.contentEditable = 'true';\n    detach(imgElem);\n\n    if (popupObj) {\n      popupObj.close();\n    }\n\n    this.parent.trigger(events.imageUploadFailed, e);\n    uploadObj.destroy();\n  };\n\n  PasteCleanup.prototype.popupClose = function (popupObj, uploadObj, imgElem, e) {\n    var _this = this;\n\n    this.parent.inputElement.contentEditable = 'true';\n    e.element = imgElem;\n    this.parent.trigger(events.imageUploadSuccess, e, function (e) {\n      if (!isNullOrUndefined(_this.parent.insertImageSettings.path)) {\n        var url = _this.parent.insertImageSettings.path + e.file.name;\n        imgElem.src = url;\n        imgElem.setAttribute('alt', e.file.name);\n      }\n    });\n    popupObj.close();\n    imgElem.style.opacity = '1';\n    uploadObj.destroy();\n    this.toolbarEnableDisable(false);\n  };\n\n  PasteCleanup.prototype.refreshPopup = function (imageElement, popupObj) {\n    var imgPosition = this.parent.iframeSettings.enable ? this.parent.element.offsetTop + imageElement.offsetTop : imageElement.offsetTop;\n    var rtePosition = this.parent.element.offsetTop + this.parent.element.offsetHeight;\n\n    if (imgPosition > rtePosition) {\n      popupObj.relateTo = this.parent.inputElement;\n      popupObj.offsetY = this.parent.iframeSettings.enable ? -30 : -65;\n      popupObj.element.style.display = 'block';\n    } else {\n      if (popupObj) {\n        popupObj.refreshPosition(imageElement);\n        popupObj.element.style.display = 'block';\n      }\n    }\n  };\n\n  PasteCleanup.prototype.base64ToFile = function (base64, filename) {\n    var baseStr = base64.split(',');\n    var typeStr = baseStr[0].match(/:(.*?);/)[1];\n    var extension = typeStr.split('/')[1];\n    var decodeStr = atob(baseStr[1]);\n    var strLen = decodeStr.length;\n    var decodeArr = new Uint8Array(strLen);\n\n    while (strLen--) {\n      decodeArr[strLen] = decodeStr.charCodeAt(strLen);\n    }\n\n    if (Browser.isIE || navigator.appVersion.indexOf('Edge') > -1) {\n      var blob = new Blob([decodeArr], {\n        type: extension\n      });\n      extend(blob, {\n        name: filename + '.' + (!isNOU(extension) ? extension : '')\n      });\n      return blob;\n    } else {\n      return new File([decodeArr], filename + '.' + (!isNOU(extension) ? extension : ''), {\n        type: extension\n      });\n    }\n  };\n  /**\n   * Method for image formatting when pasting\n   *\n   * @param {Object} pasteArgs - specifies the paste arguments.\n   * @param {Element []} imgElement - specifies the array elements.\n   * @returns {void}\n   * @hidden\n    */\n\n\n  PasteCleanup.prototype.imageFormatting = function (pasteArgs, imgElement) {\n    var imageElement = this.parent.createElement('span');\n    imageElement.appendChild(imgElement.elements[0]);\n    var imageValue = imageElement.innerHTML;\n    this.contentRenderer = this.renderFactory.getRenderer(RenderType.Content);\n    var currentDocument = this.contentRenderer.getDocument();\n    var range = this.nodeSelectionObj.getRange(currentDocument);\n    this.saveSelection = this.nodeSelectionObj.save(range, currentDocument);\n\n    if (this.parent.pasteCleanupSettings.prompt) {\n      this.pasteDialog(imageValue, pasteArgs);\n    } else if (this.parent.pasteCleanupSettings.plainText) {\n      this.plainFormatting(imageValue, pasteArgs);\n    } else if (this.parent.pasteCleanupSettings.keepFormat) {\n      this.formatting(imageValue, false, pasteArgs);\n    } else {\n      this.formatting(imageValue, true, pasteArgs);\n    }\n  };\n\n  PasteCleanup.prototype.radioRender = function () {\n    this.keepRadioButton = new RadioButton({\n      label: this.i10n.getConstant('keepFormat'),\n      name: 'pasteOption',\n      checked: true\n    });\n    this.keepRadioButton.isStringTemplate = true;\n    var keepFormatElement = this.parent.element.querySelector('#keepFormating');\n    this.keepRadioButton.appendTo(keepFormatElement);\n    this.cleanRadioButton = new RadioButton({\n      label: this.i10n.getConstant('cleanFormat'),\n      name: 'pasteOption'\n    });\n    this.cleanRadioButton.isStringTemplate = true;\n    var cleanFormatElement = this.parent.element.querySelector('#cleanFormat');\n    this.cleanRadioButton.appendTo(cleanFormatElement);\n    this.plainTextRadioButton = new RadioButton({\n      label: this.i10n.getConstant('plainText'),\n      name: 'pasteOption'\n    });\n    this.plainTextRadioButton.isStringTemplate = true;\n    var plainTextElement = this.parent.element.querySelector('#plainTextFormat');\n    this.plainTextRadioButton.appendTo(plainTextElement);\n  };\n\n  PasteCleanup.prototype.selectFormatting = function (value, args, keepChecked, cleanChecked) {\n    if (keepChecked) {\n      this.formatting(value, false, args);\n    } else if (cleanChecked) {\n      this.formatting(value, true, args);\n    } else {\n      this.plainFormatting(value, args);\n    }\n  };\n\n  PasteCleanup.prototype.pasteDialog = function (value, args) {\n    var _this = this;\n\n    var isHeight = false;\n    var preRTEHeight = this.parent.height;\n    var dialogModel = {\n      buttons: [{\n        click: function () {\n          if (!_this.dialogObj.isDestroyed) {\n            var keepChecked = _this.parent.element.querySelector('#keepFormating').checked;\n\n            var cleanChecked = _this.parent.element.querySelector('#cleanFormat').checked;\n\n            _this.dialogObj.hide();\n\n            _this.parent.height = isHeight ? preRTEHeight : _this.parent.height;\n            isHeight = false;\n            var argument = _this.dialogObj;\n\n            _this.dialogRenderObj.close(argument);\n\n            _this.dialogObj.destroy();\n\n            _this.selectFormatting(value, args, keepChecked, cleanChecked);\n          }\n        },\n        buttonModel: {\n          isPrimary: true,\n          cssClass: 'e-flat ' + CLS_RTE_PASTE_OK,\n          content: this.i10n.getConstant('pasteDialogOk')\n        }\n      }, {\n        click: function () {\n          if (!_this.dialogObj.isDestroyed) {\n            _this.dialogObj.hide();\n\n            _this.parent.height = isHeight ? preRTEHeight : _this.parent.height;\n            isHeight = false;\n            var args_1 = _this.dialogObj;\n\n            _this.dialogRenderObj.close(args_1);\n\n            _this.dialogObj.destroy();\n          }\n        },\n        buttonModel: {\n          cssClass: 'e-flat ' + CLS_RTE_PASTE_CANCEL,\n          content: this.i10n.getConstant('pasteDialogCancel')\n        }\n      }],\n      header: this.i10n.getConstant('pasteFormat'),\n      content: this.i10n.getConstant('pasteFormatContent') + '<br/><div><div style=\"padding-top:24px;\">' + '<input type=\"radio\" class=\"' + CLS_RTE_PASTE_KEEP_FORMAT + '\" id=\"keepFormating\"/>' + '</div><div style=\"padding-top:20px;\"><input type=\"radio\" class=\"' + CLS_RTE_PASTE_REMOVE_FORMAT + '\" id=\"cleanFormat\"/></div>' + '<div style=\"padding-top:20px;\"><input type=\"radio\" class=\"' + CLS_RTE_PASTE_PLAIN_FORMAT + '\" id=\"plainTextFormat\"/></div></div>',\n      target: this.parent.element,\n      width: '300px',\n      height: '265px',\n      cssClass: CLS_RTE_DIALOG_MIN_HEIGHT,\n      isModal: true,\n      visible: false\n    };\n    this.dialogObj = this.dialogRenderObj.render(dialogModel);\n    var rteDialogWrapper = this.parent.element.querySelector('#' + this.parent.getID() + '_pasteCleanupDialog');\n\n    if (rteDialogWrapper !== null && rteDialogWrapper.innerHTML !== '') {\n      this.destroyDialog(rteDialogWrapper);\n    }\n\n    if (rteDialogWrapper === null) {\n      rteDialogWrapper = this.parent.createElement('div', {\n        id: this.parent.getID() + '_pasteCleanupDialog'\n      });\n      this.parent.element.appendChild(rteDialogWrapper);\n    }\n\n    this.dialogObj.appendTo(rteDialogWrapper);\n    this.radioRender();\n    /* eslint-disable */\n\n    if (this.parent.element.offsetHeight < parseInt(this.dialogObj.height.split('px')[0], null)) {\n      this.parent.height = parseInt(this.dialogObj.height.split('px')[0], null) + 40;\n      /* eslint-enable */\n\n      isHeight = true;\n    }\n\n    this.dialogObj.show();\n    this.setCssClass({\n      cssClass: this.parent.cssClass\n    });\n  };\n\n  PasteCleanup.prototype.updateCss = function (currentObj, e) {\n    if (currentObj && e.cssClass) {\n      if (isNullOrUndefined(e.oldCssClass)) {\n        currentObj.setProperties({\n          cssClass: (currentObj.cssClass + ' ' + e.cssClass).trim()\n        });\n      } else {\n        currentObj.setProperties({\n          cssClass: (currentObj.cssClass.replace(e.oldCssClass, '').trim() + ' ' + e.cssClass).trim()\n        });\n      }\n    }\n  };\n\n  PasteCleanup.prototype.setCssClass = function (e) {\n    if (this.popupObj && e.cssClass) {\n      if (isNullOrUndefined(e.oldCssClass)) {\n        addClass([this.popupObj.element], e.cssClass);\n      } else {\n        removeClass([this.popupObj.element], e.oldCssClass);\n        addClass([this.popupObj.element], e.cssClass);\n      }\n    }\n\n    this.updateCss(this.dialogObj, e);\n    this.updateCss(this.uploadObj, e);\n    this.updateCss(this.plainTextRadioButton, e);\n    this.updateCss(this.cleanRadioButton, e);\n    this.updateCss(this.keepRadioButton, e);\n  };\n\n  PasteCleanup.prototype.destroyDialog = function (rteDialogWrapper) {\n    var rteDialogContainer = this.parent.element.querySelector('.e-dlg-container');\n    detach(rteDialogContainer);\n    var rteDialogWrapperChildLength = rteDialogWrapper.children.length;\n\n    for (var i = 0; i < rteDialogWrapperChildLength; i++) {\n      detach(rteDialogWrapper.children[0]);\n    }\n  };\n\n  PasteCleanup.prototype.cleanAppleClass = function (elem) {\n    var appleClassElem = elem.querySelectorAll('br.Apple-interchange-newline');\n\n    for (var i = 0; i < appleClassElem.length; i++) {\n      detach(appleClassElem[i]);\n    }\n\n    return elem;\n  };\n\n  PasteCleanup.prototype.formatting = function (value, clean, args) {\n    var _this = this;\n\n    var clipBoardElem = this.parent.createElement('div', {\n      className: 'pasteContent',\n      styles: 'display:inline;'\n    });\n\n    if (this.isNotFromHtml && this.containsHtml) {\n      value = this.splitBreakLine(value);\n    }\n\n    clipBoardElem.innerHTML = value;\n    clipBoardElem = this.cleanAppleClass(clipBoardElem);\n\n    if (this.parent.pasteCleanupSettings.deniedTags !== null) {\n      clipBoardElem = this.deniedTags(clipBoardElem);\n    }\n\n    if (clean) {\n      clipBoardElem = this.deniedAttributes(clipBoardElem, clean);\n    } else if (this.parent.pasteCleanupSettings.deniedAttrs !== null) {\n      clipBoardElem = this.deniedAttributes(clipBoardElem, clean);\n    }\n\n    if (this.parent.pasteCleanupSettings.allowedStyleProps !== null) {\n      clipBoardElem = this.allowedStyle(clipBoardElem);\n    }\n\n    this.saveSelection.restore();\n    clipBoardElem.innerHTML = this.sanitizeHelper(clipBoardElem.innerHTML);\n    var allImg = clipBoardElem.querySelectorAll('img');\n\n    for (var i = 0; i < allImg.length; i++) {\n      allImg[i].classList.add('pasteContent_Img');\n\n      if (this.parent.insertImageSettings.width !== 'auto') {\n        allImg[i].setAttribute('width', this.parent.insertImageSettings.width);\n      }\n\n      if (this.parent.insertImageSettings.minWidth !== '0' && this.parent.insertImageSettings.minWidth !== 0) {\n        allImg[i].style.minWidth = this.parent.insertImageSettings.minWidth.toString();\n      }\n\n      if (this.parent.insertImageSettings.maxWidth !== null) {\n        allImg[i].style.maxWidth = this.parent.getInsertImgMaxWidth().toString();\n      }\n\n      if (this.parent.insertImageSettings.height !== 'auto') {\n        allImg[i].setAttribute('height', this.parent.insertImageSettings.height);\n      }\n\n      if (this.parent.insertImageSettings.minHeight !== '0' && this.parent.insertImageSettings.minHeight !== 0) {\n        allImg[i].style.minHeight = this.parent.insertImageSettings.minHeight.toString();\n      }\n\n      if (this.parent.insertImageSettings.maxHeight !== null) {\n        allImg[i].style.maxHeight = this.parent.insertImageSettings.maxHeight.toString();\n      }\n    }\n\n    this.addTempClass(clipBoardElem);\n\n    if (clipBoardElem.textContent !== '' || !isNOU(clipBoardElem.querySelector('img')) || !isNOU(clipBoardElem.querySelector('table'))) {\n      this.parent.formatter.editorManager.execCommand('inserthtml', 'pasteCleanup', args, function (returnArgs) {\n        extend(args, {\n          elements: returnArgs.elements,\n          imageElements: returnArgs.imgElem\n        }, true);\n\n        _this.parent.formatter.onSuccess(_this.parent, args);\n      }, clipBoardElem);\n      this.removeTempClass();\n      this.parent.notify(events.toolbarRefresh, {});\n      this.imgUploading(this.parent.inputElement);\n\n      if (this.parent.iframeSettings.enable) {\n        this.parent.updateValue();\n      }\n    }\n  };\n\n  PasteCleanup.prototype.addTempClass = function (clipBoardElem) {\n    var allChild = clipBoardElem.children;\n\n    for (var i = 0; i < allChild.length; i++) {\n      allChild[i].classList.add('pasteContent_RTE');\n    }\n  };\n\n  PasteCleanup.prototype.removeTempClass = function () {\n    var classElm = this.parent.inputElement.querySelectorAll('.pasteContent_RTE');\n\n    for (var i = 0; i < classElm.length; i++) {\n      classElm[i].classList.remove('pasteContent_RTE');\n\n      if (classElm[i].getAttribute('class') === '') {\n        classElm[i].removeAttribute('class');\n      }\n    }\n  };\n\n  PasteCleanup.prototype.sanitizeHelper = function (value) {\n    value = sanitizeHelper(value, this.parent);\n    return value;\n  }; //Plain Formatting\n\n\n  PasteCleanup.prototype.plainFormatting = function (value, args) {\n    var _this = this;\n\n    var clipBoardElem = this.parent.createElement('div', {\n      className: 'pasteContent',\n      styles: 'display:inline;'\n    });\n    clipBoardElem.innerHTML = value;\n    this.detachInlineElements(clipBoardElem);\n    this.getTextContent(clipBoardElem);\n\n    if (clipBoardElem.textContent.trim() !== '') {\n      if (!isNOU(clipBoardElem.firstElementChild) && clipBoardElem.firstElementChild.tagName !== 'BR') {\n        var firstElm = clipBoardElem.firstElementChild;\n\n        if (!isNOU(clipBoardElem.firstElementChild)) {\n          var spanElm = this.parent.createElement('span');\n\n          for (var i = 0, j = 0; i < firstElm.childNodes.length; i++, j++) {\n            if (firstElm.childNodes[i].nodeName === '#text') {\n              spanElm.appendChild(firstElm.childNodes[i]);\n              clipBoardElem.insertBefore(spanElm, clipBoardElem.firstElementChild);\n              i--;\n            } else if (firstElm.childNodes[i].nodeName !== '#text' && j === 0) {\n              for (var k = 0; k < firstElm.childNodes[i].childNodes.length; k++) {\n                spanElm.appendChild(firstElm.childNodes[i].childNodes[k]);\n                clipBoardElem.insertBefore(spanElm, clipBoardElem.firstElementChild);\n                k--;\n              }\n\n              i--;\n            } else {\n              break;\n            }\n          }\n\n          if (!firstElm.hasChildNodes()) {\n            detach(firstElm);\n          }\n        }\n      }\n\n      this.removeEmptyElements(clipBoardElem);\n      this.saveSelection.restore();\n      clipBoardElem.innerHTML = this.sanitizeHelper(clipBoardElem.innerHTML);\n      this.addTempClass(clipBoardElem);\n      this.parent.formatter.editorManager.execCommand('inserthtml', 'pasteCleanup', args, function (returnArgs) {\n        extend(args, {\n          elements: returnArgs.elements,\n          imageElements: returnArgs.imgElem\n        }, true);\n\n        _this.parent.formatter.onSuccess(_this.parent, args);\n      }, clipBoardElem);\n      this.removeTempClass();\n    } else {\n      this.saveSelection.restore();\n      extend(args, {\n        elements: []\n      }, true);\n      this.parent.formatter.onSuccess(this.parent, args);\n    }\n  };\n\n  PasteCleanup.prototype.getTextContent = function (clipBoardElem) {\n    for (var i = 0; i < this.blockNode.length; i++) {\n      var inElem = clipBoardElem.querySelectorAll(this.blockNode[i]);\n\n      for (var j = 0; j < inElem.length; j++) {\n        var parElem = void 0;\n\n        for (var k = 0, l = 0, preNode = void 0; k < inElem[j].childNodes.length; k++, l++) {\n          if (inElem[j].childNodes[k].nodeName === 'DIV' || inElem[j].childNodes[k].nodeName === 'P' || inElem[j].childNodes[k].nodeName === '#text' && inElem[j].childNodes[k].nodeValue.replace(/\\u00a0/g, '&nbsp;') !== '&nbsp;' && inElem[j].childNodes[k].textContent.trim() === '') {\n            parElem = inElem[j].childNodes[k].parentElement;\n            inElem[j].childNodes[k].parentElement.parentElement.insertBefore(inElem[j].childNodes[k], inElem[j].childNodes[k].parentElement);\n            k--;\n          } else {\n            parElem = inElem[j].childNodes[k].parentElement;\n\n            if (preNode === 'text') {\n              var previousElem = parElem.previousElementSibling;\n              previousElem.appendChild(inElem[j].childNodes[k]);\n            } else {\n              var divElement = this.parent.createElement('div', {\n                id: 'newDiv'\n              });\n              divElement.appendChild(inElem[j].childNodes[k]);\n              parElem.parentElement.insertBefore(divElement, parElem);\n            }\n\n            k--;\n            preNode = 'text';\n          }\n        }\n\n        if (!isNOU(parElem)) {\n          detach(parElem);\n        }\n      }\n    }\n\n    var allElems = clipBoardElem.querySelectorAll('*');\n\n    for (var i = 0; i < allElems.length; i++) {\n      var allAtr = allElems[i].attributes;\n\n      for (var j = 0; j < allAtr.length; j++) {\n        allElems[i].removeAttribute(allAtr[j].name);\n        j--;\n      }\n    }\n  };\n\n  PasteCleanup.prototype.detachInlineElements = function (clipBoardElem) {\n    for (var i = 0; i < this.inlineNode.length; i++) {\n      var inElem = clipBoardElem.querySelectorAll(this.inlineNode[i]);\n\n      for (var j = 0; j < inElem.length; j++) {\n        var parElem = void 0;\n\n        for (var k = 0; k < inElem[j].childNodes.length; k++) {\n          parElem = inElem[j].childNodes[k].parentElement;\n          inElem[j].childNodes[k].parentElement.parentElement.insertBefore(inElem[j].childNodes[k], inElem[j].childNodes[k].parentElement);\n          k--;\n        }\n\n        if (!isNOU(parElem)) {\n          detach(parElem);\n        }\n      }\n    }\n  };\n\n  PasteCleanup.prototype.findDetachEmptyElem = function (element) {\n    var removableElement;\n\n    if (!isNOU(element.parentElement)) {\n      if (element.parentElement.textContent.trim() === '' && element.parentElement.getAttribute('class') !== 'pasteContent') {\n        removableElement = this.findDetachEmptyElem(element.parentElement);\n      } else {\n        removableElement = element;\n      }\n    } else {\n      removableElement = null;\n    }\n\n    return removableElement;\n  };\n\n  PasteCleanup.prototype.removeEmptyElements = function (element) {\n    var emptyElements = element.querySelectorAll(':empty');\n\n    for (var i = 0; i < emptyElements.length; i++) {\n      if (emptyElements[i].tagName !== 'BR') {\n        var detachableElement = this.findDetachEmptyElem(emptyElements[i]);\n\n        if (!isNOU(detachableElement)) {\n          detach(detachableElement);\n        }\n      }\n    }\n  }; //GroupingTags\n\n\n  PasteCleanup.prototype.tagGrouping = function (deniedTags) {\n    var groupingTags = deniedTags.slice();\n    var keys = Object.keys(pasteCleanupGroupingTags);\n    var values = keys.map(function (key) {\n      return pasteCleanupGroupingTags[key];\n    });\n    var addTags = [];\n\n    for (var i = 0; i < groupingTags.length; i++) {\n      //The value split using '[' because to retrieve the tag name from the user given format which may contain tag with attributes\n      if (groupingTags[i].split('[').length > 1) {\n        groupingTags[i] = groupingTags[i].split('[')[0].trim();\n      }\n\n      if (keys.indexOf(groupingTags[i]) > -1) {\n        for (var j = 0; j < values[keys.indexOf(groupingTags[i])].length; j++) {\n          if (groupingTags.indexOf(values[keys.indexOf(groupingTags[i])][j]) < 0 && addTags.indexOf(values[keys.indexOf(groupingTags[i])][j]) < 0) {\n            addTags.push(values[keys.indexOf(groupingTags[i])][j]);\n          }\n        }\n      }\n    }\n\n    return deniedTags = deniedTags.concat(addTags);\n  }; //Filter Attributes in Denied Tags\n\n\n  PasteCleanup.prototype.attributesfilter = function (deniedTags) {\n    for (var i = 0; i < deniedTags.length; i++) {\n      if (deniedTags[i].split('[').length > 1) {\n        var userAttributes = deniedTags[i].split('[')[1].split(']')[0].split(',');\n        var allowedAttributeArray = [];\n        var deniedAttributeArray = [];\n\n        for (var j = 0; j < userAttributes.length; j++) {\n          // eslint-disable-next-line\n          userAttributes[j].indexOf('!') < 0 ? allowedAttributeArray.push(userAttributes[j].trim()) : deniedAttributeArray.push(userAttributes[j].split('!')[1].trim());\n        }\n\n        var allowedAttribute = allowedAttributeArray.length > 1 ? allowedAttributeArray.join('][') : allowedAttributeArray.join();\n        var deniedAttribute = deniedAttributeArray.length > 1 ? deniedAttributeArray.join('][') : deniedAttributeArray.join();\n\n        if (deniedAttribute.length > 0) {\n          var select = allowedAttribute !== '' ? deniedTags[i].split('[')[0] + '[' + allowedAttribute + ']' : deniedTags[i].split('[')[0];\n          deniedTags[i] = select + ':not([' + deniedAttribute + '])';\n        } else {\n          deniedTags[i] = deniedTags[i].split('[')[0] + '[' + allowedAttribute + ']';\n        }\n      }\n    }\n\n    return deniedTags;\n  }; //Denied Tags\n\n\n  PasteCleanup.prototype.deniedTags = function (clipBoardElem) {\n    var deniedTags = isNullOrUndefined(this.parent.pasteCleanupSettings.deniedTags) ? [] : this.parent.pasteCleanupSettings.deniedTags.slice();\n    deniedTags = this.attributesfilter(deniedTags);\n    deniedTags = this.tagGrouping(deniedTags);\n\n    for (var i = 0; i < deniedTags.length; i++) {\n      var removableElement = clipBoardElem.querySelectorAll(deniedTags[i]);\n\n      for (var j = removableElement.length - 1; j >= 0; j--) {\n        var parentElem = removableElement[j].parentNode;\n\n        while (removableElement[j].firstChild) {\n          parentElem.insertBefore(removableElement[j].firstChild, removableElement[j]);\n        }\n\n        parentElem.removeChild(removableElement[j]);\n      }\n    }\n\n    return clipBoardElem;\n  }; //Denied Attributes\n\n\n  PasteCleanup.prototype.deniedAttributes = function (clipBoardElem, clean) {\n    var deniedAttrs = isNullOrUndefined(this.parent.pasteCleanupSettings.deniedAttrs) ? [] : this.parent.pasteCleanupSettings.deniedAttrs.slice();\n\n    if (clean) {\n      deniedAttrs.push('style');\n    }\n\n    for (var i = 0; i < deniedAttrs.length; i++) {\n      var removableAttrElement = clipBoardElem.querySelectorAll('[' + deniedAttrs[i] + ']');\n\n      for (var j = 0; j < removableAttrElement.length; j++) {\n        removableAttrElement[j].removeAttribute(deniedAttrs[i]);\n      }\n    }\n\n    return clipBoardElem;\n  }; //Allowed Style Properties\n\n\n  PasteCleanup.prototype.allowedStyle = function (clipBoardElem) {\n    var allowedStyleProps = isNullOrUndefined(this.parent.pasteCleanupSettings.allowedStyleProps) ? [] : this.parent.pasteCleanupSettings.allowedStyleProps.slice();\n    allowedStyleProps.push('list-style-type', 'list-style');\n    var styleElement = clipBoardElem.querySelectorAll('[style]');\n\n    for (var i = 0; i < styleElement.length; i++) {\n      var allowedStyleValue = '';\n      var allowedStyleValueArray = [];\n      var styleValue = styleElement[i].getAttribute('style').split(';');\n\n      for (var k = 0; k < styleValue.length; k++) {\n        if (allowedStyleProps.indexOf(styleValue[k].split(':')[0].trim()) >= 0) {\n          allowedStyleValueArray.push(styleValue[k]);\n        }\n      }\n\n      styleElement[i].removeAttribute('style');\n      allowedStyleValue = allowedStyleValueArray.join(';').trim() === '' ? allowedStyleValueArray.join(';') : allowedStyleValueArray.join(';') + ';';\n\n      if (allowedStyleValue) {\n        styleElement[i].setAttribute('style', allowedStyleValue);\n      }\n    }\n\n    return clipBoardElem;\n  };\n  /**\n   * For internal use only - Get the module name.\n   *\n   * @returns {void}\n   * @hidden\n   */\n\n\n  PasteCleanup.prototype.getModuleName = function () {\n    return 'pasteCleanup';\n  };\n\n  return PasteCleanup;\n}();\n\nexport { PasteCleanup };","map":{"version":3,"names":["events","Popup","RadioButton","isNullOrUndefined","isNOU","detach","extend","addClass","removeClass","getUniqueID","Browser","CLS_RTE_PASTE_KEEP_FORMAT","CLS_RTE_PASTE_REMOVE_FORMAT","CLS_RTE_PASTE_PLAIN_FORMAT","CLS_RTE_PASTE_OK","CLS_RTE_PASTE_CANCEL","CLS_RTE_DIALOG_MIN_HEIGHT","pasteCleanupGroupingTags","NodeSelection","EVENTS","RenderType","Uploader","classes","sanitizeHelper","convertToBlob","getDefaultValue","PasteCleanup","parent","serviceLocator","inlineNode","blockNode","isNotFromHtml","containsHtml","locator","renderFactory","getService","i10n","dialogRenderObj","addEventListener","prototype","nodeSelectionObj","isDestroyed","on","pasteClean","bindCssClass","setCssClass","destroy","removeEventListener","off","e","_this","args","requestType","editorMode","event","value","imageproperties","clipboardData","getData","trigger","beforePasteCleanup","length","htmlRegex","RegExp","replace","test","file","items","getAsFile","notify","paste","text","callBack","b","formatter","editorManager","execCommand","imageFormatting","bind","divElement","createElement","innerHTML","splitBreakLine","observer","MS_WORD_CLEANUP","allowedStylePropertiesArray","pasteCleanupSettings","allowedStyleProps","a","trim","contentRenderer","getRenderer","Content","currentDocument","getDocument","range","getRange","saveSelection","save","afterPasteCleanup","updatedArgs","prompt","preventDefault","tempDivElem","textContent","querySelector","pasteDialog","plainText","plainFormatting","keepFormat","formatting","enterSplitText","split","contentInnerElem","i","contentWithSpace","makeSpace","spaceBetweenContent","spaceSplit","j","imgUploading","elm","allImgElm","querySelectorAll","insertImageSettings","saveUrl","base64Src","imgName","uploadImg","getAttribute","indexOf","push","fileList","base64ToFile","uploadMethod","path","saveFormat","getBlob","allImgElmId","classList","remove","removeAttribute","blopUrl","URL","createObjectURL","setAttribute","toolbarEnableDisable","state","inlineMode","enable","toolbarModule","baseToolbar","toolbarObj","disable","imgElem","uploadEle","document","body","appendChild","style","opacity","popupEle","element","contentEle","id","attrs","type","name","offsetY","iframeSettings","popupObj","relateTo","height","width","content","viewPortElement","position","X","Y","enableRtl","zIndex","close","isBlur","display","CLS_POPUP_OPEN","CLS_RTE_UPLOAD_POPUP","cssClass","timeOut","size","setTimeout","refreshPopup","rawFile","beforeUploadArgs","uploadObj","asyncSettings","removeUrl","CLS_RTE_DIALOG_UPLOAD","dropArea","inputElement","allowedExtensions","allowedTypes","toString","success","popupClose","uploading","isServerRendered","imageUploading","imageUploadingArgs","cancel","contentEditable","beforeUpload","JSON","parse","stringify","filesData","currentRequestHeader","currentRequest","customFormDatas","customFormData","uploadFiles","beforeImageUpload","failure","uploadFailure","canceling","nextSibling","selected","removing","appendTo","childNodes","fileData","validationMessages","minSize","maxSize","statusCode","createFileList","upload","getElementsByClassName","imageUploadFailed","imageUploadSuccess","url","src","imageElement","imgPosition","offsetTop","rtePosition","offsetHeight","refreshPosition","base64","filename","baseStr","typeStr","match","extension","decodeStr","atob","strLen","decodeArr","Uint8Array","charCodeAt","isIE","navigator","appVersion","blob","Blob","File","pasteArgs","imgElement","elements","imageValue","radioRender","keepRadioButton","label","getConstant","checked","isStringTemplate","keepFormatElement","cleanRadioButton","cleanFormatElement","plainTextRadioButton","plainTextElement","selectFormatting","keepChecked","cleanChecked","isHeight","preRTEHeight","dialogModel","buttons","click","dialogObj","hide","argument","buttonModel","isPrimary","args_1","header","target","isModal","visible","render","rteDialogWrapper","getID","destroyDialog","parseInt","show","updateCss","currentObj","oldCssClass","setProperties","rteDialogContainer","rteDialogWrapperChildLength","children","cleanAppleClass","elem","appleClassElem","clean","clipBoardElem","className","styles","deniedTags","deniedAttributes","deniedAttrs","allowedStyle","restore","allImg","add","minWidth","maxWidth","getInsertImgMaxWidth","minHeight","maxHeight","addTempClass","returnArgs","imageElements","onSuccess","removeTempClass","toolbarRefresh","updateValue","allChild","classElm","detachInlineElements","getTextContent","firstElementChild","tagName","firstElm","spanElm","nodeName","insertBefore","k","hasChildNodes","removeEmptyElements","inElem","parElem","l","preNode","nodeValue","parentElement","previousElem","previousElementSibling","allElems","allAtr","attributes","findDetachEmptyElem","removableElement","emptyElements","detachableElement","tagGrouping","groupingTags","slice","keys","Object","values","map","key","addTags","concat","attributesfilter","userAttributes","allowedAttributeArray","deniedAttributeArray","allowedAttribute","join","deniedAttribute","select","parentElem","parentNode","firstChild","removeChild","removableAttrElement","styleElement","allowedStyleValue","allowedStyleValueArray","styleValue","getModuleName"],"sources":["/home/morgan/Desktop/Projets/ENT4/Jwt-Auth-pdf/react-jwt-auth/react-jwt-auth/node_modules/@syncfusion/ej2-richtexteditor/src/rich-text-editor/actions/paste-clean-up.js"],"sourcesContent":["import * as events from '../base/constant';\nimport { Popup } from '@syncfusion/ej2-popups';\nimport { RadioButton } from '@syncfusion/ej2-buttons';\nimport { isNullOrUndefined as isNOU, isNullOrUndefined, detach, extend, addClass, removeClass } from '@syncfusion/ej2-base';\nimport { getUniqueID, Browser } from '@syncfusion/ej2-base';\nimport { CLS_RTE_PASTE_KEEP_FORMAT, CLS_RTE_PASTE_REMOVE_FORMAT, CLS_RTE_PASTE_PLAIN_FORMAT } from '../base/classes';\nimport { CLS_RTE_PASTE_OK, CLS_RTE_PASTE_CANCEL, CLS_RTE_DIALOG_MIN_HEIGHT } from '../base/classes';\nimport { pasteCleanupGroupingTags } from '../../common/config';\nimport { NodeSelection } from '../../selection/selection';\nimport * as EVENTS from './../../common/constant';\nimport { RenderType } from '../base/enum';\nimport { Uploader } from '@syncfusion/ej2-inputs';\nimport * as classes from '../base/classes';\nimport { sanitizeHelper, convertToBlob, getDefaultValue } from '../base/util';\n/**\n * PasteCleanup module called when pasting content in RichTextEditor\n */\nvar PasteCleanup = /** @class */ (function () {\n    function PasteCleanup(parent, serviceLocator) {\n        this.inlineNode = ['a', 'abbr', 'acronym', 'audio', 'b', 'bdi', 'bdo', 'big', 'br', 'button',\n            'canvas', 'cite', 'code', 'data', 'datalist', 'del', 'dfn', 'em', 'embed', 'font', 'i', 'iframe', 'img', 'input',\n            'ins', 'kbd', 'label', 'map', 'mark', 'meter', 'noscript', 'object', 'output', 'picture', 'progress',\n            'q', 'ruby', 's', 'samp', 'script', 'select', 'slot', 'small', 'span', 'strong', 'sub', 'sup', 'svg',\n            'template', 'textarea', 'time', 'u', 'tt', 'var', 'video', 'wbr'];\n        this.blockNode = ['div', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6',\n            'address', 'blockquote', 'button', 'center', 'dd', 'dir', 'dl', 'dt', 'fieldset',\n            'frameset', 'hr', 'iframe', 'isindex', 'li', 'map', 'menu', 'noframes', 'noscript',\n            'object', 'ol', 'pre', 'td', 'tr', 'th', 'tbody', 'tfoot', 'thead', 'table', 'ul',\n            'header', 'article', 'nav', 'footer', 'section', 'aside', 'main', 'figure', 'figcaption'];\n        this.isNotFromHtml = false;\n        this.containsHtml = false;\n        this.parent = parent;\n        this.locator = serviceLocator;\n        this.renderFactory = this.locator.getService('rendererFactory');\n        this.i10n = serviceLocator.getService('rteLocale');\n        this.dialogRenderObj = serviceLocator.getService('dialogRenderObject');\n        this.addEventListener();\n    }\n    PasteCleanup.prototype.addEventListener = function () {\n        this.nodeSelectionObj = new NodeSelection();\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.on(events.pasteClean, this.pasteClean, this);\n        this.parent.on(events.bindCssClass, this.setCssClass, this);\n        this.parent.on(events.destroy, this.destroy, this);\n    };\n    PasteCleanup.prototype.destroy = function () {\n        this.removeEventListener();\n    };\n    PasteCleanup.prototype.removeEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.off(events.pasteClean, this.pasteClean);\n        this.parent.off(events.bindCssClass, this.setCssClass);\n        this.parent.off(events.destroy, this.destroy);\n    };\n    PasteCleanup.prototype.pasteClean = function (e) {\n        var _this = this;\n        var args = {\n            requestType: 'Paste',\n            editorMode: this.parent.editorMode,\n            event: e\n        };\n        var value = null;\n        var imageproperties;\n        if (e.args && !isNOU(e.args.clipboardData)) {\n            value = e.args.clipboardData.getData('text/html');\n        }\n        this.parent.trigger(events.beforePasteCleanup, { value: value });\n        if (e.args && value !== null && this.parent.editorMode === 'HTML') {\n            if (value.length === 0) {\n                var htmlRegex = new RegExp(/<\\/[a-z][\\s\\S]*>/i);\n                value = e.args.clipboardData.getData('text/plain');\n                this.isNotFromHtml = value !== '' ? true : false;\n                value = value.replace(/</g, '&lt;');\n                value = value.replace(/>/g, '&gt;');\n                this.containsHtml = htmlRegex.test(value);\n                var file = e && e.args.clipboardData &&\n                    e.args.clipboardData.items.length > 0 ?\n                    (e.args.clipboardData.items[0].getAsFile() === null ?\n                        (!isNOU(e.args.clipboardData.items[1]) ? e.args.clipboardData.items[1].getAsFile() : null) :\n                        e.args.clipboardData.items[0].getAsFile()) : null;\n                this.parent.notify(events.paste, {\n                    file: file,\n                    args: e.args,\n                    text: value,\n                    callBack: function (b) {\n                        imageproperties = b;\n                        if (typeof (imageproperties) === 'object') {\n                            _this.parent.formatter.editorManager.execCommand('Images', 'Image', e.args, _this.imageFormatting.bind(_this, args), 'pasteCleanup', imageproperties, 'pasteCleanupModule');\n                        }\n                        else {\n                            value = imageproperties;\n                        }\n                    }\n                });\n                if (!htmlRegex.test(value)) {\n                    var divElement = this.parent.createElement('div');\n                    divElement.innerHTML = this.splitBreakLine(value);\n                    value = divElement.innerHTML;\n                }\n            }\n            else if (value.length > 0) {\n                this.parent.formatter.editorManager.observer.notify(EVENTS.MS_WORD_CLEANUP, {\n                    args: e.args,\n                    text: e.text,\n                    allowedStylePropertiesArray: this.parent.pasteCleanupSettings.allowedStyleProps,\n                    callBack: function (a) {\n                        value = a.trim();\n                    }\n                });\n            }\n            this.contentRenderer = this.renderFactory.getRenderer(RenderType.Content);\n            var currentDocument = this.contentRenderer.getDocument();\n            var range = this.nodeSelectionObj.getRange(currentDocument);\n            this.saveSelection = this.nodeSelectionObj.save(range, currentDocument);\n            this.parent.trigger(events.afterPasteCleanup, { value: value }, function (updatedArgs) {\n                value = updatedArgs.value;\n            });\n            if (this.parent.pasteCleanupSettings.prompt) {\n                e.args.preventDefault();\n                var tempDivElem = this.parent.createElement('div');\n                tempDivElem.innerHTML = value;\n                if (tempDivElem.textContent !== '' || !isNOU(tempDivElem.querySelector('img')) ||\n                    !isNOU(tempDivElem.querySelector('table'))) {\n                    this.pasteDialog(value, args);\n                }\n            }\n            else if (this.parent.pasteCleanupSettings.plainText) {\n                e.args.preventDefault();\n                this.plainFormatting(value, args);\n            }\n            else if (this.parent.pasteCleanupSettings.keepFormat) {\n                e.args.preventDefault();\n                this.formatting(value, false, args);\n            }\n            else {\n                e.args.preventDefault();\n                this.formatting(value, true, args);\n            }\n        }\n    };\n    PasteCleanup.prototype.splitBreakLine = function (value) {\n        var enterSplitText = value.split('\\n');\n        var contentInnerElem = '';\n        for (var i = 0; i < enterSplitText.length; i++) {\n            if (enterSplitText[i].trim() === '') {\n                contentInnerElem += getDefaultValue(this.parent);\n            }\n            else {\n                var contentWithSpace = this.makeSpace(enterSplitText[i]);\n                contentInnerElem += '<p>' + contentWithSpace.trim() + '</p>';\n            }\n        }\n        return contentInnerElem;\n    };\n    PasteCleanup.prototype.makeSpace = function (enterSplitText) {\n        var contentWithSpace = '';\n        var spaceBetweenContent = true;\n        var spaceSplit = enterSplitText.split(' ');\n        for (var j = 0; j < spaceSplit.length; j++) {\n            if (spaceSplit[j].trim() === '') {\n                contentWithSpace += spaceBetweenContent ? '&nbsp;' : ' ';\n            }\n            else {\n                spaceBetweenContent = false;\n                contentWithSpace += spaceSplit[j] + ' ';\n            }\n        }\n        return contentWithSpace;\n    };\n    PasteCleanup.prototype.imgUploading = function (elm) {\n        var allImgElm = elm.querySelectorAll('.pasteContent_Img');\n        if (this.parent.insertImageSettings.saveUrl && allImgElm.length > 0) {\n            var base64Src = [];\n            var imgName = [];\n            var uploadImg = [];\n            for (var i = 0; i < allImgElm.length; i++) {\n                if (allImgElm[i].getAttribute('src').split(',')[0].indexOf('base64') >= 0) {\n                    base64Src.push(allImgElm[i].getAttribute('src'));\n                    imgName.push(getUniqueID('rte_image'));\n                    uploadImg.push(allImgElm[i]);\n                }\n            }\n            var fileList = [];\n            for (var i = 0; i < base64Src.length; i++) {\n                fileList.push(this.base64ToFile(base64Src[i], imgName[i]));\n            }\n            for (var i = 0; i < fileList.length; i++) {\n                this.uploadMethod(fileList[i], uploadImg[i]);\n            }\n            if (isNOU(this.parent.insertImageSettings.path) &&\n                this.parent.insertImageSettings.saveFormat === 'Blob') {\n                this.getBlob(allImgElm);\n            }\n        }\n        else if (this.parent.insertImageSettings.saveFormat === 'Blob') {\n            this.getBlob(allImgElm);\n        }\n        var allImgElmId = elm.querySelectorAll('.pasteContent_Img');\n        for (var i = 0; i < allImgElmId.length; i++) {\n            allImgElmId[i].classList.remove('pasteContent_Img');\n            if (allImgElmId[i].getAttribute('class').trim() === '') {\n                allImgElm[i].removeAttribute('class');\n            }\n        }\n    };\n    PasteCleanup.prototype.getBlob = function (allImgElm) {\n        for (var i = 0; i < allImgElm.length; i++) {\n            if (!isNOU(allImgElm[i].getAttribute('src')) &&\n                allImgElm[i].getAttribute('src').split(',')[0].indexOf('base64') >= 0) {\n                var blopUrl = URL.createObjectURL(convertToBlob(allImgElm[i].getAttribute('src')));\n                allImgElm[i].setAttribute('src', blopUrl);\n            }\n        }\n    };\n    PasteCleanup.prototype.toolbarEnableDisable = function (state) {\n        if (!this.parent.inlineMode.enable) {\n            this.parent.toolbarModule.baseToolbar.toolbarObj.disable(state);\n        }\n    };\n    PasteCleanup.prototype.uploadMethod = function (fileList, imgElem) {\n        var _this = this;\n        var uploadEle = document.createElement('div');\n        document.body.appendChild(uploadEle);\n        uploadEle.setAttribute('display', 'none');\n        imgElem.style.opacity = '0.5';\n        var popupEle = this.parent.createElement('div');\n        this.parent.element.appendChild(popupEle);\n        var contentEle = this.parent.createElement('input', {\n            id: this.parent.element.id + '_upload', attrs: { type: 'File', name: 'UploadFiles' }\n        });\n        var offsetY = this.parent.iframeSettings.enable ? -50 : -90;\n        this.popupObj = new Popup(popupEle, {\n            relateTo: imgElem,\n            height: '85px',\n            width: '300px',\n            offsetY: offsetY,\n            content: contentEle,\n            viewPortElement: this.parent.element,\n            position: { X: 'center', Y: 'top' },\n            enableRtl: this.parent.enableRtl,\n            zIndex: 10001,\n            // eslint-disable-next-line\n            close: function (event) {\n                _this.parent.isBlur = false;\n                _this.popupObj.destroy();\n                detach(_this.popupObj.element);\n            }\n        });\n        this.popupObj.element.style.display = 'none';\n        addClass([this.popupObj.element], [classes.CLS_POPUP_OPEN, classes.CLS_RTE_UPLOAD_POPUP]);\n        if (!isNOU(this.parent.cssClass)) {\n            addClass([this.popupObj.element], this.parent.cssClass);\n        }\n        var timeOut = fileList.size > 1000000 ? 300 : 100;\n        setTimeout(function () {\n            _this.refreshPopup(imgElem, _this.popupObj);\n        }, timeOut);\n        var rawFile;\n        var beforeUploadArgs;\n        this.uploadObj = new Uploader({\n            asyncSettings: {\n                saveUrl: this.parent.insertImageSettings.saveUrl,\n                removeUrl: this.parent.insertImageSettings.removeUrl\n            },\n            cssClass: classes.CLS_RTE_DIALOG_UPLOAD,\n            dropArea: this.parent.inputElement,\n            allowedExtensions: this.parent.insertImageSettings.allowedTypes.toString(),\n            success: function (e) {\n                setTimeout(function () {\n                    _this.popupClose(_this.popupObj, _this.uploadObj, imgElem, e);\n                }, 900);\n            },\n            uploading: function (e) {\n                if (!_this.parent.isServerRendered) {\n                    _this.parent.trigger(events.imageUploading, e, function (imageUploadingArgs) {\n                        if (imageUploadingArgs.cancel) {\n                            if (!isNullOrUndefined(imgElem)) {\n                                detach(imgElem);\n                            }\n                            if (!isNullOrUndefined(_this.popupObj.element)) {\n                                detach(_this.popupObj.element);\n                            }\n                        }\n                        else {\n                            _this.parent.inputElement.contentEditable = 'false';\n                        }\n                    });\n                }\n            },\n            beforeUpload: function (args) {\n                if (_this.parent.isServerRendered) {\n                    beforeUploadArgs = JSON.parse(JSON.stringify(args));\n                    beforeUploadArgs.filesData = rawFile;\n                    args.cancel = true;\n                    _this.parent.trigger(events.imageUploading, beforeUploadArgs, function (beforeUploadArgs) {\n                        if (beforeUploadArgs.cancel) {\n                            return;\n                        }\n                        _this.toolbarEnableDisable(true);\n                        /* eslint-disable */\n                        _this.uploadObj.currentRequestHeader = beforeUploadArgs.currentRequest ?\n                            beforeUploadArgs.currentRequest : _this.uploadObj.currentRequestHeader;\n                        _this.uploadObj.customFormDatas = beforeUploadArgs.customFormData && beforeUploadArgs.customFormData.length > 0 ?\n                            beforeUploadArgs.customFormData : _this.uploadObj.customFormDatas;\n                        _this.uploadObj.uploadFiles(rawFile, null);\n                        /* eslint-enable */\n                    });\n                }\n                else {\n                    _this.parent.trigger(events.beforeImageUpload, args);\n                    _this.toolbarEnableDisable(true);\n                }\n            },\n            // eslint-disable-next-line\n            failure: function (e) {\n                setTimeout(function () {\n                    _this.uploadFailure(imgElem, _this.uploadObj, _this.popupObj, e);\n                }, 900);\n            },\n            canceling: function () {\n                _this.parent.inputElement.contentEditable = 'true';\n                if (imgElem.nextSibling.textContent === ' ') {\n                    detach(imgElem.nextSibling);\n                }\n                detach(imgElem);\n                _this.popupObj.close();\n            },\n            selected: function (e) {\n                e.cancel = true;\n                if (_this.parent.isServerRendered) {\n                    rawFile = e.filesData;\n                }\n            },\n            removing: function () {\n                _this.parent.inputElement.contentEditable = 'true';\n                if (imgElem.nextSibling.textContent === ' ') {\n                    detach(imgElem.nextSibling);\n                }\n                detach(imgElem);\n                _this.popupObj.close();\n            }\n        });\n        this.uploadObj.appendTo(this.popupObj.element.childNodes[0]);\n        /* eslint-disable */\n        var fileData = [{\n                name: fileList.name,\n                rawFile: fileList,\n                size: fileList.size,\n                type: fileList.type,\n                validationMessages: { minSize: \"\", maxSize: \"\" },\n                statusCode: '1'\n            }];\n        this.uploadObj.createFileList(fileData);\n        this.uploadObj.filesData.push(fileData[0]);\n        /* eslint-enable */\n        rawFile = fileData;\n        this.uploadObj.upload(fileData);\n        this.popupObj.element.getElementsByClassName('e-file-select-wrap')[0].style.display = 'none';\n        detach(this.popupObj.element.querySelector('.e-rte-dialog-upload .e-file-select-wrap'));\n    };\n    PasteCleanup.prototype.uploadFailure = function (imgElem, uploadObj, popupObj, e) {\n        this.parent.inputElement.contentEditable = 'true';\n        detach(imgElem);\n        if (popupObj) {\n            popupObj.close();\n        }\n        this.parent.trigger(events.imageUploadFailed, e);\n        uploadObj.destroy();\n    };\n    PasteCleanup.prototype.popupClose = function (popupObj, uploadObj, imgElem, e) {\n        var _this = this;\n        this.parent.inputElement.contentEditable = 'true';\n        e.element = imgElem;\n        this.parent.trigger(events.imageUploadSuccess, e, function (e) {\n            if (!isNullOrUndefined(_this.parent.insertImageSettings.path)) {\n                var url = _this.parent.insertImageSettings.path + e.file.name;\n                imgElem.src = url;\n                imgElem.setAttribute('alt', e.file.name);\n            }\n        });\n        popupObj.close();\n        imgElem.style.opacity = '1';\n        uploadObj.destroy();\n        this.toolbarEnableDisable(false);\n    };\n    PasteCleanup.prototype.refreshPopup = function (imageElement, popupObj) {\n        var imgPosition = this.parent.iframeSettings.enable ? this.parent.element.offsetTop +\n            imageElement.offsetTop : imageElement.offsetTop;\n        var rtePosition = this.parent.element.offsetTop + this.parent.element.offsetHeight;\n        if (imgPosition > rtePosition) {\n            popupObj.relateTo = this.parent.inputElement;\n            popupObj.offsetY = this.parent.iframeSettings.enable ? -30 : -65;\n            popupObj.element.style.display = 'block';\n        }\n        else {\n            if (popupObj) {\n                popupObj.refreshPosition(imageElement);\n                popupObj.element.style.display = 'block';\n            }\n        }\n    };\n    PasteCleanup.prototype.base64ToFile = function (base64, filename) {\n        var baseStr = base64.split(',');\n        var typeStr = baseStr[0].match(/:(.*?);/)[1];\n        var extension = typeStr.split('/')[1];\n        var decodeStr = atob(baseStr[1]);\n        var strLen = decodeStr.length;\n        var decodeArr = new Uint8Array(strLen);\n        while (strLen--) {\n            decodeArr[strLen] = decodeStr.charCodeAt(strLen);\n        }\n        if (Browser.isIE || navigator.appVersion.indexOf('Edge') > -1) {\n            var blob = new Blob([decodeArr], { type: extension });\n            extend(blob, { name: filename + '.' + (!isNOU(extension) ? extension : '') });\n            return blob;\n        }\n        else {\n            return new File([decodeArr], filename + '.' + (!isNOU(extension) ? extension : ''), { type: extension });\n        }\n    };\n    /**\n     * Method for image formatting when pasting\n     *\n     * @param {Object} pasteArgs - specifies the paste arguments.\n     * @param {Element []} imgElement - specifies the array elements.\n     * @returns {void}\n     * @hidden\n\n     */\n    PasteCleanup.prototype.imageFormatting = function (pasteArgs, imgElement) {\n        var imageElement = this.parent.createElement('span');\n        imageElement.appendChild(imgElement.elements[0]);\n        var imageValue = imageElement.innerHTML;\n        this.contentRenderer = this.renderFactory.getRenderer(RenderType.Content);\n        var currentDocument = this.contentRenderer.getDocument();\n        var range = this.nodeSelectionObj.getRange(currentDocument);\n        this.saveSelection = this.nodeSelectionObj.save(range, currentDocument);\n        if (this.parent.pasteCleanupSettings.prompt) {\n            this.pasteDialog(imageValue, pasteArgs);\n        }\n        else if (this.parent.pasteCleanupSettings.plainText) {\n            this.plainFormatting(imageValue, pasteArgs);\n        }\n        else if (this.parent.pasteCleanupSettings.keepFormat) {\n            this.formatting(imageValue, false, pasteArgs);\n        }\n        else {\n            this.formatting(imageValue, true, pasteArgs);\n        }\n    };\n    PasteCleanup.prototype.radioRender = function () {\n        this.keepRadioButton = new RadioButton({ label: this.i10n.getConstant('keepFormat'),\n            name: 'pasteOption', checked: true });\n        this.keepRadioButton.isStringTemplate = true;\n        var keepFormatElement = this.parent.element.querySelector('#keepFormating');\n        this.keepRadioButton.appendTo(keepFormatElement);\n        this.cleanRadioButton = new RadioButton({ label: this.i10n.getConstant('cleanFormat'), name: 'pasteOption' });\n        this.cleanRadioButton.isStringTemplate = true;\n        var cleanFormatElement = this.parent.element.querySelector('#cleanFormat');\n        this.cleanRadioButton.appendTo(cleanFormatElement);\n        this.plainTextRadioButton = new RadioButton({ label: this.i10n.getConstant('plainText'), name: 'pasteOption' });\n        this.plainTextRadioButton.isStringTemplate = true;\n        var plainTextElement = this.parent.element.querySelector('#plainTextFormat');\n        this.plainTextRadioButton.appendTo(plainTextElement);\n    };\n    PasteCleanup.prototype.selectFormatting = function (value, args, keepChecked, cleanChecked) {\n        if (keepChecked) {\n            this.formatting(value, false, args);\n        }\n        else if (cleanChecked) {\n            this.formatting(value, true, args);\n        }\n        else {\n            this.plainFormatting(value, args);\n        }\n    };\n    PasteCleanup.prototype.pasteDialog = function (value, args) {\n        var _this = this;\n        var isHeight = false;\n        var preRTEHeight = this.parent.height;\n        var dialogModel = {\n            buttons: [\n                {\n                    click: function () {\n                        if (!_this.dialogObj.isDestroyed) {\n                            var keepChecked = _this.parent.element.querySelector('#keepFormating').checked;\n                            var cleanChecked = _this.parent.element.querySelector('#cleanFormat').checked;\n                            _this.dialogObj.hide();\n                            _this.parent.height = isHeight ? preRTEHeight : _this.parent.height;\n                            isHeight = false;\n                            var argument = _this.dialogObj;\n                            _this.dialogRenderObj.close(argument);\n                            _this.dialogObj.destroy();\n                            _this.selectFormatting(value, args, keepChecked, cleanChecked);\n                        }\n                    },\n                    buttonModel: {\n                        isPrimary: true,\n                        cssClass: 'e-flat ' + CLS_RTE_PASTE_OK,\n                        content: this.i10n.getConstant('pasteDialogOk')\n                    }\n                },\n                {\n                    click: function () {\n                        if (!_this.dialogObj.isDestroyed) {\n                            _this.dialogObj.hide();\n                            _this.parent.height = isHeight ? preRTEHeight : _this.parent.height;\n                            isHeight = false;\n                            var args_1 = _this.dialogObj;\n                            _this.dialogRenderObj.close(args_1);\n                            _this.dialogObj.destroy();\n                        }\n                    },\n                    buttonModel: {\n                        cssClass: 'e-flat ' + CLS_RTE_PASTE_CANCEL,\n                        content: this.i10n.getConstant('pasteDialogCancel')\n                    }\n                }\n            ],\n            header: this.i10n.getConstant('pasteFormat'),\n            content: this.i10n.getConstant('pasteFormatContent') + '<br/><div><div style=\"padding-top:24px;\">' +\n                '<input type=\"radio\" class=\"' + CLS_RTE_PASTE_KEEP_FORMAT + '\" id=\"keepFormating\"/>' +\n                '</div><div style=\"padding-top:20px;\"><input type=\"radio\" class=\"' +\n                CLS_RTE_PASTE_REMOVE_FORMAT + '\" id=\"cleanFormat\"/></div>' +\n                '<div style=\"padding-top:20px;\"><input type=\"radio\" class=\"' +\n                CLS_RTE_PASTE_PLAIN_FORMAT + '\" id=\"plainTextFormat\"/></div></div>',\n            target: this.parent.element,\n            width: '300px',\n            height: '265px',\n            cssClass: CLS_RTE_DIALOG_MIN_HEIGHT,\n            isModal: true,\n            visible: false\n        };\n        this.dialogObj = this.dialogRenderObj.render(dialogModel);\n        var rteDialogWrapper = this.parent.element.querySelector('#' + this.parent.getID()\n            + '_pasteCleanupDialog');\n        if (rteDialogWrapper !== null && rteDialogWrapper.innerHTML !== '') {\n            this.destroyDialog(rteDialogWrapper);\n        }\n        if (rteDialogWrapper === null) {\n            rteDialogWrapper = this.parent.createElement('div', {\n                id: this.parent.getID() + '_pasteCleanupDialog'\n            });\n            this.parent.element.appendChild(rteDialogWrapper);\n        }\n        this.dialogObj.appendTo(rteDialogWrapper);\n        this.radioRender();\n        /* eslint-disable */\n        if (this.parent.element.offsetHeight < parseInt(this.dialogObj.height.split('px')[0], null)) {\n            this.parent.height = parseInt(this.dialogObj.height.split('px')[0], null) + 40;\n            /* eslint-enable */\n            isHeight = true;\n        }\n        this.dialogObj.show();\n        this.setCssClass({ cssClass: this.parent.cssClass });\n    };\n    PasteCleanup.prototype.updateCss = function (currentObj, e) {\n        if (currentObj && e.cssClass) {\n            if (isNullOrUndefined(e.oldCssClass)) {\n                currentObj.setProperties({ cssClass: (currentObj.cssClass + ' ' + e.cssClass).trim() });\n            }\n            else {\n                currentObj.setProperties({ cssClass: (currentObj.cssClass.replace(e.oldCssClass, '').trim() + ' ' + e.cssClass).trim() });\n            }\n        }\n    };\n    PasteCleanup.prototype.setCssClass = function (e) {\n        if (this.popupObj && e.cssClass) {\n            if (isNullOrUndefined(e.oldCssClass)) {\n                addClass([this.popupObj.element], e.cssClass);\n            }\n            else {\n                removeClass([this.popupObj.element], e.oldCssClass);\n                addClass([this.popupObj.element], e.cssClass);\n            }\n        }\n        this.updateCss(this.dialogObj, e);\n        this.updateCss(this.uploadObj, e);\n        this.updateCss(this.plainTextRadioButton, e);\n        this.updateCss(this.cleanRadioButton, e);\n        this.updateCss(this.keepRadioButton, e);\n    };\n    PasteCleanup.prototype.destroyDialog = function (rteDialogWrapper) {\n        var rteDialogContainer = this.parent.element.querySelector('.e-dlg-container');\n        detach(rteDialogContainer);\n        var rteDialogWrapperChildLength = rteDialogWrapper.children.length;\n        for (var i = 0; i < rteDialogWrapperChildLength; i++) {\n            detach(rteDialogWrapper.children[0]);\n        }\n    };\n    PasteCleanup.prototype.cleanAppleClass = function (elem) {\n        var appleClassElem = elem.querySelectorAll('br.Apple-interchange-newline');\n        for (var i = 0; i < appleClassElem.length; i++) {\n            detach(appleClassElem[i]);\n        }\n        return elem;\n    };\n    PasteCleanup.prototype.formatting = function (value, clean, args) {\n        var _this = this;\n        var clipBoardElem = this.parent.createElement('div', { className: 'pasteContent', styles: 'display:inline;' });\n        if (this.isNotFromHtml && this.containsHtml) {\n            value = this.splitBreakLine(value);\n        }\n        clipBoardElem.innerHTML = value;\n        clipBoardElem = this.cleanAppleClass(clipBoardElem);\n        if (this.parent.pasteCleanupSettings.deniedTags !== null) {\n            clipBoardElem = this.deniedTags(clipBoardElem);\n        }\n        if (clean) {\n            clipBoardElem = this.deniedAttributes(clipBoardElem, clean);\n        }\n        else if (this.parent.pasteCleanupSettings.deniedAttrs !== null) {\n            clipBoardElem = this.deniedAttributes(clipBoardElem, clean);\n        }\n        if (this.parent.pasteCleanupSettings.allowedStyleProps !== null) {\n            clipBoardElem = this.allowedStyle(clipBoardElem);\n        }\n        this.saveSelection.restore();\n        clipBoardElem.innerHTML = this.sanitizeHelper(clipBoardElem.innerHTML);\n        var allImg = clipBoardElem.querySelectorAll('img');\n        for (var i = 0; i < allImg.length; i++) {\n            allImg[i].classList.add('pasteContent_Img');\n            if (this.parent.insertImageSettings.width !== 'auto') {\n                allImg[i].setAttribute('width', this.parent.insertImageSettings.width);\n            }\n            if (this.parent.insertImageSettings.minWidth !== '0' && this.parent.insertImageSettings.minWidth !== 0) {\n                allImg[i].style.minWidth = this.parent.insertImageSettings.minWidth.toString();\n            }\n            if (this.parent.insertImageSettings.maxWidth !== null) {\n                allImg[i].style.maxWidth = this.parent.getInsertImgMaxWidth().toString();\n            }\n            if (this.parent.insertImageSettings.height !== 'auto') {\n                allImg[i].setAttribute('height', this.parent.insertImageSettings.height);\n            }\n            if (this.parent.insertImageSettings.minHeight !== '0' && this.parent.insertImageSettings.minHeight !== 0) {\n                allImg[i].style.minHeight = this.parent.insertImageSettings.minHeight.toString();\n            }\n            if (this.parent.insertImageSettings.maxHeight !== null) {\n                allImg[i].style.maxHeight = this.parent.insertImageSettings.maxHeight.toString();\n            }\n        }\n        this.addTempClass(clipBoardElem);\n        if (clipBoardElem.textContent !== '' || !isNOU(clipBoardElem.querySelector('img')) ||\n            !isNOU(clipBoardElem.querySelector('table'))) {\n            this.parent.formatter.editorManager.execCommand('inserthtml', 'pasteCleanup', args, function (returnArgs) {\n                extend(args, { elements: returnArgs.elements, imageElements: returnArgs.imgElem }, true);\n                _this.parent.formatter.onSuccess(_this.parent, args);\n            }, clipBoardElem);\n            this.removeTempClass();\n            this.parent.notify(events.toolbarRefresh, {});\n            this.imgUploading(this.parent.inputElement);\n            if (this.parent.iframeSettings.enable) {\n                this.parent.updateValue();\n            }\n        }\n    };\n    PasteCleanup.prototype.addTempClass = function (clipBoardElem) {\n        var allChild = clipBoardElem.children;\n        for (var i = 0; i < allChild.length; i++) {\n            allChild[i].classList.add('pasteContent_RTE');\n        }\n    };\n    PasteCleanup.prototype.removeTempClass = function () {\n        var classElm = this.parent.inputElement.querySelectorAll('.pasteContent_RTE');\n        for (var i = 0; i < classElm.length; i++) {\n            classElm[i].classList.remove('pasteContent_RTE');\n            if (classElm[i].getAttribute('class') === '') {\n                classElm[i].removeAttribute('class');\n            }\n        }\n    };\n    PasteCleanup.prototype.sanitizeHelper = function (value) {\n        value = sanitizeHelper(value, this.parent);\n        return value;\n    };\n    //Plain Formatting\n    PasteCleanup.prototype.plainFormatting = function (value, args) {\n        var _this = this;\n        var clipBoardElem = this.parent.createElement('div', { className: 'pasteContent', styles: 'display:inline;' });\n        clipBoardElem.innerHTML = value;\n        this.detachInlineElements(clipBoardElem);\n        this.getTextContent(clipBoardElem);\n        if (clipBoardElem.textContent.trim() !== '') {\n            if (!isNOU(clipBoardElem.firstElementChild) && clipBoardElem.firstElementChild.tagName !== 'BR') {\n                var firstElm = clipBoardElem.firstElementChild;\n                if (!isNOU(clipBoardElem.firstElementChild)) {\n                    var spanElm = this.parent.createElement('span');\n                    for (var i = 0, j = 0; i < firstElm.childNodes.length; i++, j++) {\n                        if (firstElm.childNodes[i].nodeName === '#text') {\n                            spanElm.appendChild(firstElm.childNodes[i]);\n                            clipBoardElem.insertBefore(spanElm, clipBoardElem.firstElementChild);\n                            i--;\n                        }\n                        else if (firstElm.childNodes[i].nodeName !== '#text' && j === 0) {\n                            for (var k = 0; k < firstElm.childNodes[i].childNodes.length; k++) {\n                                spanElm.appendChild(firstElm.childNodes[i].childNodes[k]);\n                                clipBoardElem.insertBefore(spanElm, clipBoardElem.firstElementChild);\n                                k--;\n                            }\n                            i--;\n                        }\n                        else {\n                            break;\n                        }\n                    }\n                    if (!firstElm.hasChildNodes()) {\n                        detach(firstElm);\n                    }\n                }\n            }\n            this.removeEmptyElements(clipBoardElem);\n            this.saveSelection.restore();\n            clipBoardElem.innerHTML = this.sanitizeHelper(clipBoardElem.innerHTML);\n            this.addTempClass(clipBoardElem);\n            this.parent.formatter.editorManager.execCommand('inserthtml', 'pasteCleanup', args, function (returnArgs) {\n                extend(args, { elements: returnArgs.elements, imageElements: returnArgs.imgElem }, true);\n                _this.parent.formatter.onSuccess(_this.parent, args);\n            }, clipBoardElem);\n            this.removeTempClass();\n        }\n        else {\n            this.saveSelection.restore();\n            extend(args, { elements: [] }, true);\n            this.parent.formatter.onSuccess(this.parent, args);\n        }\n    };\n    PasteCleanup.prototype.getTextContent = function (clipBoardElem) {\n        for (var i = 0; i < this.blockNode.length; i++) {\n            var inElem = clipBoardElem.querySelectorAll(this.blockNode[i]);\n            for (var j = 0; j < inElem.length; j++) {\n                var parElem = void 0;\n                for (var k = 0, l = 0, preNode = void 0; k < inElem[j].childNodes.length; k++, l++) {\n                    if (inElem[j].childNodes[k].nodeName === 'DIV' || inElem[j].childNodes[k].nodeName === 'P' ||\n                        (inElem[j].childNodes[k].nodeName === '#text' &&\n                            (inElem[j].childNodes[k].nodeValue.replace(/\\u00a0/g, '&nbsp;') !== '&nbsp;') &&\n                            inElem[j].childNodes[k].textContent.trim() === '')) {\n                        parElem = inElem[j].childNodes[k].parentElement;\n                        inElem[j].childNodes[k].parentElement.parentElement.insertBefore(inElem[j].childNodes[k], inElem[j].childNodes[k].parentElement);\n                        k--;\n                    }\n                    else {\n                        parElem = inElem[j].childNodes[k].parentElement;\n                        if (preNode === 'text') {\n                            var previousElem = parElem.previousElementSibling;\n                            previousElem.appendChild(inElem[j].childNodes[k]);\n                        }\n                        else {\n                            var divElement = this.parent.createElement('div', { id: 'newDiv' });\n                            divElement.appendChild(inElem[j].childNodes[k]);\n                            parElem.parentElement.insertBefore(divElement, parElem);\n                        }\n                        k--;\n                        preNode = 'text';\n                    }\n                }\n                if (!isNOU(parElem)) {\n                    detach(parElem);\n                }\n            }\n        }\n        var allElems = clipBoardElem.querySelectorAll('*');\n        for (var i = 0; i < allElems.length; i++) {\n            var allAtr = allElems[i].attributes;\n            for (var j = 0; j < allAtr.length; j++) {\n                allElems[i].removeAttribute(allAtr[j].name);\n                j--;\n            }\n        }\n    };\n    PasteCleanup.prototype.detachInlineElements = function (clipBoardElem) {\n        for (var i = 0; i < this.inlineNode.length; i++) {\n            var inElem = clipBoardElem.querySelectorAll(this.inlineNode[i]);\n            for (var j = 0; j < inElem.length; j++) {\n                var parElem = void 0;\n                for (var k = 0; k < inElem[j].childNodes.length; k++) {\n                    parElem = inElem[j].childNodes[k].parentElement;\n                    inElem[j].childNodes[k].parentElement.parentElement.insertBefore(inElem[j].childNodes[k], inElem[j].childNodes[k].parentElement);\n                    k--;\n                }\n                if (!isNOU(parElem)) {\n                    detach(parElem);\n                }\n            }\n        }\n    };\n    PasteCleanup.prototype.findDetachEmptyElem = function (element) {\n        var removableElement;\n        if (!isNOU(element.parentElement)) {\n            if (element.parentElement.textContent.trim() === '' &&\n                element.parentElement.getAttribute('class') !== 'pasteContent') {\n                removableElement = this.findDetachEmptyElem(element.parentElement);\n            }\n            else {\n                removableElement = element;\n            }\n        }\n        else {\n            removableElement = null;\n        }\n        return removableElement;\n    };\n    PasteCleanup.prototype.removeEmptyElements = function (element) {\n        var emptyElements = element.querySelectorAll(':empty');\n        for (var i = 0; i < emptyElements.length; i++) {\n            if (emptyElements[i].tagName !== 'BR') {\n                var detachableElement = this.findDetachEmptyElem(emptyElements[i]);\n                if (!isNOU(detachableElement)) {\n                    detach(detachableElement);\n                }\n            }\n        }\n    };\n    //GroupingTags\n    PasteCleanup.prototype.tagGrouping = function (deniedTags) {\n        var groupingTags = deniedTags.slice();\n        var keys = Object.keys(pasteCleanupGroupingTags);\n        var values = keys.map(function (key) {\n            return pasteCleanupGroupingTags[key];\n        });\n        var addTags = [];\n        for (var i = 0; i < groupingTags.length; i++) {\n            //The value split using '[' because to retrieve the tag name from the user given format which may contain tag with attributes\n            if (groupingTags[i].split('[').length > 1) {\n                groupingTags[i] = groupingTags[i].split('[')[0].trim();\n            }\n            if (keys.indexOf(groupingTags[i]) > -1) {\n                for (var j = 0; j < values[keys.indexOf(groupingTags[i])].length; j++) {\n                    if (groupingTags.indexOf(values[keys.indexOf(groupingTags[i])][j]) < 0 &&\n                        addTags.indexOf(values[keys.indexOf(groupingTags[i])][j]) < 0) {\n                        addTags.push(values[keys.indexOf(groupingTags[i])][j]);\n                    }\n                }\n            }\n        }\n        return deniedTags = deniedTags.concat(addTags);\n    };\n    //Filter Attributes in Denied Tags\n    PasteCleanup.prototype.attributesfilter = function (deniedTags) {\n        for (var i = 0; i < deniedTags.length; i++) {\n            if (deniedTags[i].split('[').length > 1) {\n                var userAttributes = deniedTags[i].split('[')[1].split(']')[0].split(',');\n                var allowedAttributeArray = [];\n                var deniedAttributeArray = [];\n                for (var j = 0; j < userAttributes.length; j++) {\n                    // eslint-disable-next-line\n                    userAttributes[j].indexOf('!') < 0 ? allowedAttributeArray.push(userAttributes[j].trim())\n                        : deniedAttributeArray.push(userAttributes[j].split('!')[1].trim());\n                }\n                var allowedAttribute = allowedAttributeArray.length > 1 ?\n                    (allowedAttributeArray.join('][')) : (allowedAttributeArray.join());\n                var deniedAttribute = deniedAttributeArray.length > 1 ?\n                    deniedAttributeArray.join('][') : (deniedAttributeArray.join());\n                if (deniedAttribute.length > 0) {\n                    var select = allowedAttribute !== '' ? deniedTags[i].split('[')[0] +\n                        '[' + allowedAttribute + ']' : deniedTags[i].split('[')[0];\n                    deniedTags[i] = select + ':not([' + deniedAttribute + '])';\n                }\n                else {\n                    deniedTags[i] = deniedTags[i].split('[')[0] + '[' + allowedAttribute + ']';\n                }\n            }\n        }\n        return deniedTags;\n    };\n    //Denied Tags\n    PasteCleanup.prototype.deniedTags = function (clipBoardElem) {\n        var deniedTags = isNullOrUndefined(this.parent.pasteCleanupSettings.deniedTags) ? [] : this.parent.pasteCleanupSettings.deniedTags.slice();\n        deniedTags = this.attributesfilter(deniedTags);\n        deniedTags = this.tagGrouping(deniedTags);\n        for (var i = 0; i < deniedTags.length; i++) {\n            var removableElement = clipBoardElem.querySelectorAll(deniedTags[i]);\n            for (var j = removableElement.length - 1; j >= 0; j--) {\n                var parentElem = removableElement[j].parentNode;\n                while (removableElement[j].firstChild) {\n                    parentElem.insertBefore(removableElement[j].firstChild, removableElement[j]);\n                }\n                parentElem.removeChild(removableElement[j]);\n            }\n        }\n        return clipBoardElem;\n    };\n    //Denied Attributes\n    PasteCleanup.prototype.deniedAttributes = function (clipBoardElem, clean) {\n        var deniedAttrs = isNullOrUndefined(this.parent.pasteCleanupSettings.deniedAttrs) ? [] : this.parent.pasteCleanupSettings.deniedAttrs.slice();\n        if (clean) {\n            deniedAttrs.push('style');\n        }\n        for (var i = 0; i < deniedAttrs.length; i++) {\n            var removableAttrElement = clipBoardElem.\n                querySelectorAll('[' + deniedAttrs[i] + ']');\n            for (var j = 0; j < removableAttrElement.length; j++) {\n                removableAttrElement[j].removeAttribute(deniedAttrs[i]);\n            }\n        }\n        return clipBoardElem;\n    };\n    //Allowed Style Properties\n    PasteCleanup.prototype.allowedStyle = function (clipBoardElem) {\n        var allowedStyleProps = isNullOrUndefined(this.parent.pasteCleanupSettings.allowedStyleProps) ? [] : this.parent.pasteCleanupSettings.allowedStyleProps.slice();\n        allowedStyleProps.push('list-style-type', 'list-style');\n        var styleElement = clipBoardElem.querySelectorAll('[style]');\n        for (var i = 0; i < styleElement.length; i++) {\n            var allowedStyleValue = '';\n            var allowedStyleValueArray = [];\n            var styleValue = styleElement[i].getAttribute('style').split(';');\n            for (var k = 0; k < styleValue.length; k++) {\n                if (allowedStyleProps.indexOf(styleValue[k].split(':')[0].trim()) >= 0) {\n                    allowedStyleValueArray.push(styleValue[k]);\n                }\n            }\n            styleElement[i].removeAttribute('style');\n            allowedStyleValue = allowedStyleValueArray.join(';').trim() === '' ?\n                allowedStyleValueArray.join(';') : allowedStyleValueArray.join(';') + ';';\n            if (allowedStyleValue) {\n                styleElement[i].setAttribute('style', allowedStyleValue);\n            }\n        }\n        return clipBoardElem;\n    };\n    /**\n     * For internal use only - Get the module name.\n     *\n     * @returns {void}\n     * @hidden\n     */\n    PasteCleanup.prototype.getModuleName = function () {\n        return 'pasteCleanup';\n    };\n    return PasteCleanup;\n}());\nexport { PasteCleanup };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}