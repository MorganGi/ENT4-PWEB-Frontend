{"ast":null,"code":"import { EventHandler, detach, isNullOrUndefined, select, extend, isNullOrUndefined as isNOU } from '@syncfusion/ej2-base';\nimport { closest, addClass, removeClass, Browser } from '@syncfusion/ej2-base';\nimport * as events from '../base/constant';\nimport { CLS_RTE_ELEMENTS } from '../base/classes';\nimport { CheckBox } from '@syncfusion/ej2-buttons';\nimport { RenderType } from '../base/enum';\nimport { dispatchEvent, parseHtml } from '../base/util';\nimport { isIDevice } from '../../common/util';\n/**\n * `Link` module is used to handle undo actions.\n */\n\nvar Link =\n/** @class */\nfunction () {\n  function Link(parent, serviceLocator) {\n    this.parent = parent;\n    this.rteID = parent.element.id;\n    this.i10n = serviceLocator.getService('rteLocale');\n    this.addEventListener();\n    this.serviceLocator = serviceLocator;\n    this.rendererFactory = serviceLocator.getService('rendererFactory');\n    this.dialogRenderObj = serviceLocator.getService('dialogRenderObject');\n  }\n\n  Link.prototype.addEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.on(events.insertLink, this.linkDialog, this);\n    this.parent.on(events.showLinkDialog, this.showDialog, this);\n    this.parent.on(events.closeLinkDialog, this.closeDialog, this);\n    this.parent.on(events.keyDown, this.onKeyDown, this);\n    this.parent.on(events.insertCompleted, this.showLinkQuickToolbar, this);\n    this.parent.on(events.clearDialogObj, this.clearDialogObj, this);\n    this.parent.on(events.linkToolbarAction, this.onToolbarAction, this);\n    this.parent.on(events.iframeMouseDown, this.onIframeMouseDown, this);\n    this.parent.on(events.unLink, this.removeLink, this);\n    this.parent.on(events.editLink, this.editLink, this);\n    this.parent.on(events.openLink, this.openLink, this);\n    this.parent.on(events.editAreaClick, this.editAreaClickHandler, this);\n    this.parent.on(events.bindCssClass, this.setCssClass, this);\n    this.parent.on(events.destroy, this.destroy, this);\n  };\n\n  Link.prototype.onToolbarAction = function (args) {\n    var item = args.args.item;\n\n    switch (item.subCommand) {\n      case 'OpenLink':\n        this.parent.notify(events.openLink, args);\n        break;\n\n      case 'EditLink':\n        this.parent.notify(events.editLink, args);\n        break;\n\n      case 'RemoveLink':\n        this.parent.notify(events.unLink, args);\n        break;\n    }\n  };\n\n  Link.prototype.removeEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.off(events.insertLink, this.linkDialog);\n    this.parent.off(events.showLinkDialog, this.showDialog);\n    this.parent.off(events.closeLinkDialog, this.closeDialog);\n    this.parent.off(events.keyDown, this.onKeyDown);\n    this.parent.off(events.insertCompleted, this.showLinkQuickToolbar);\n    this.parent.off(events.clearDialogObj, this.clearDialogObj);\n    this.parent.off(events.linkToolbarAction, this.onToolbarAction);\n    this.parent.off(events.unLink, this.removeLink);\n    this.parent.off(events.iframeMouseDown, this.onIframeMouseDown);\n    this.parent.off(events.editLink, this.editLink);\n    this.parent.off(events.openLink, this.openLink);\n    this.parent.off(events.editAreaClick, this.editAreaClickHandler);\n    this.parent.off(events.bindCssClass, this.setCssClass);\n    this.parent.off(events.destroy, this.destroy);\n  };\n\n  Link.prototype.onIframeMouseDown = function () {\n    if (this.dialogObj) {\n      this.dialogObj.hide({\n        returnValue: true\n      });\n    }\n  };\n\n  Link.prototype.updateCss = function (currentObj, e) {\n    if (currentObj && e.cssClass) {\n      if (isNullOrUndefined(e.oldCssClass)) {\n        currentObj.setProperties({\n          cssClass: (currentObj.cssClass + ' ' + e.cssClass).trim()\n        });\n      } else {\n        currentObj.setProperties({\n          cssClass: (currentObj.cssClass.replace(e.oldCssClass, '').trim() + ' ' + e.cssClass).trim()\n        });\n      }\n    }\n  };\n\n  Link.prototype.setCssClass = function (e) {\n    this.updateCss(this.checkBoxObj, e);\n    this.updateCss(this.dialogObj, e);\n  };\n\n  Link.prototype.showLinkQuickToolbar = function (e) {\n    if (!isNullOrUndefined(e.args) && e.args.action !== 'enter' && e.args.action !== 'space') {\n      var pageX = void 0;\n      var pageY = void 0;\n\n      if (e.type !== 'Links' || isNullOrUndefined(this.parent.quickToolbarModule) || isNullOrUndefined(this.parent.quickToolbarModule.linkQTBar)) {\n        return;\n      }\n\n      this.quickToolObj = this.parent.quickToolbarModule;\n      var parentTop = this.parent.element.getBoundingClientRect().top;\n      var parentLeft = this.parent.element.getBoundingClientRect().left;\n      var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n      var target_1;\n      [].forEach.call(e.elements, function (element, index) {\n        if (index === 0) {\n          target_1 = element.nodeName === '#text' ? element.parentNode : element;\n        }\n      });\n\n      if (e.isNotify) {\n        var tbElement = this.parent.toolbarModule.getToolbarElement();\n        var linkTop = target_1.getBoundingClientRect().top;\n        var linkLeft = target_1.getBoundingClientRect().left;\n        var linkPos = linkTop - parentTop;\n        var tbHeight = tbElement ? tbElement.offsetHeight + this.parent.toolbarModule.getExpandTBarPopHeight() : 0;\n        pageX = this.parent.iframeSettings.enable ? parentLeft + linkLeft : target_1.getBoundingClientRect().left;\n        pageY = window.pageYOffset + (this.parent.iframeSettings.enable ? parentTop + tbHeight + linkTop : parentTop + linkPos);\n      } else {\n        var args = void 0;\n        args = e.args.touches ? e.args.changedTouches[0] : args = e.args;\n        pageX = this.parent.iframeSettings.enable ? window.pageXOffset + parentLeft + args.clientX : args.pageX;\n        pageY = this.parent.iframeSettings.enable ? window.pageYOffset + parentTop + args.clientY : args.pageY;\n      }\n\n      if (this.quickToolObj.linkQTBar) {\n        this.quickToolObj.linkQTBar.showPopup(pageX, pageY, range.endContainer);\n      }\n    }\n  };\n\n  Link.prototype.hideLinkQuickToolbar = function () {\n    if (this.quickToolObj && this.quickToolObj.linkQTBar && document.body.contains(this.quickToolObj.linkQTBar.element)) {\n      this.quickToolObj.linkQTBar.hidePopup();\n    }\n  };\n\n  Link.prototype.editAreaClickHandler = function (e) {\n    if (this.parent.readonly) {\n      this.hideLinkQuickToolbar();\n      return;\n    }\n\n    var args = e.args;\n    var showOnRightClick = this.parent.quickToolbarSettings.showOnRightClick;\n\n    if (args.which === 2 || showOnRightClick && args.which === 1 || !showOnRightClick && args.which === 3) {\n      return;\n    }\n\n    if (this.parent.editorMode === 'HTML' && this.parent.quickToolbarModule && this.parent.quickToolbarModule.linkQTBar) {\n      this.quickToolObj = this.parent.quickToolbarModule;\n      var target = args.target;\n      target = this.getAnchorNode(target);\n      this.contentModule = this.rendererFactory.getRenderer(RenderType.Content);\n      var isPopupOpen = this.quickToolObj.linkQTBar.element.classList.contains('e-rte-pop');\n\n      if (target.nodeName === 'A' && target.childNodes.length > 0 && target.childNodes[0].nodeName !== 'IMG' && e.args.target.nodeName !== 'IMG' && !isNOU(closest(this.parent.getRange().startContainer.parentElement, 'A')) && !isNOU(closest(this.parent.getRange().endContainer.parentElement, 'A'))) {\n        if (isPopupOpen) {\n          return;\n        }\n\n        this.showLinkQuickToolbar({\n          args: args,\n          isNotify: false,\n          type: 'Links',\n          elements: [args.target]\n        });\n      } else {\n        this.hideLinkQuickToolbar();\n      }\n    }\n  };\n\n  Link.prototype.onKeyDown = function (event) {\n    var originalEvent = event.args;\n\n    switch (originalEvent.action) {\n      case 'escape':\n        if (!isNullOrUndefined(this.dialogObj)) {\n          this.dialogObj.close();\n        }\n\n        break;\n\n      case 'insert-link':\n        this.openDialog(true, event);\n        originalEvent.preventDefault();\n        break;\n    }\n  };\n\n  Link.prototype.openDialog = function (isInternal, event) {\n    if (!isInternal) {\n      this.parent.contentModule.getEditPanel().focus();\n    }\n\n    if (this.parent.editorMode === 'HTML') {\n      var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n      var save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n      var selectNodeEle = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n      var selectParentEle = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n      var eventArgs = {\n        args: event ? event.args : {\n          item: {\n            command: 'Links',\n            subCommand: 'CreateLink'\n          },\n          originalEvent: undefined\n        },\n        selectNode: selectNodeEle,\n        selection: save,\n        selectParent: selectParentEle\n      };\n      this.linkDialog(eventArgs);\n    } else {\n      var textArea = this.parent.contentModule.getEditPanel();\n      this.parent.formatter.editorManager.markdownSelection.save(textArea.selectionStart, textArea.selectionEnd);\n      this.linkDialog({\n        args: {\n          item: {\n            command: 'Links',\n            subCommand: 'Link'\n          },\n          originalEvent: event && event.args\n        },\n        member: 'link',\n        text: this.parent.formatter.editorManager.markdownSelection.getSelectedText(this.parent.contentModule.getEditPanel()),\n        module: 'Markdown',\n        name: 'insertLink'\n      });\n    }\n  };\n\n  Link.prototype.showDialog = function () {\n    this.openDialog(false);\n    this.setCssClass({\n      cssClass: this.parent.cssClass\n    });\n  };\n\n  Link.prototype.closeDialog = function () {\n    if (this.dialogObj) {\n      this.dialogObj.hide({\n        returnValue: true\n      });\n    }\n  };\n\n  Link.prototype.clearDialogObj = function () {\n    if (this.dialogObj) {\n      this.dialogObj.destroy();\n      detach(this.dialogObj.element);\n      this.dialogObj = null;\n    }\n  };\n\n  Link.prototype.linkDialog = function (e, inputDetails) {\n    var _this = this;\n\n    if (this.dialogObj) {\n      this.dialogObj.hide({\n        returnValue: true\n      });\n      return;\n    }\n\n    if (this.parent.editorMode === 'HTML' && e.selectParent.length > 0 && !isNullOrUndefined(e.selectParent[0].classList) && e.selectParent[0].classList.contains('e-rte-anchor') && isNullOrUndefined(inputDetails)) {\n      this.editLink(e);\n      return;\n    }\n\n    var linkWebAddress = this.i10n.getConstant('linkWebUrl');\n    var linkDisplayText = this.i10n.getConstant('linkText');\n    var linkTooltip = this.i10n.getConstant('linkTooltipLabel');\n    var urlPlace = this.i10n.getConstant('linkurl');\n    var textPlace = this.i10n.getConstant('textPlaceholder');\n    var title = this.i10n.getConstant('linkTitle');\n    var linkDialogEle = this.parent.createElement('div', {\n      className: 'e-rte-link-dialog' + ' ' + this.parent.cssClass,\n      id: this.rteID + '_rtelink'\n    });\n    this.parent.element.appendChild(linkDialogEle);\n    var linkContent = this.parent.createElement('div', {\n      className: 'e-rte-linkcontent' + ' ' + this.parent.cssClass,\n      id: this.rteID + '_linkContent'\n    });\n    var htmlTextbox = this.parent.editorMode === 'HTML' ? '<label>' + linkTooltip + '</label></div><div class=\"e-rte-field' + ' ' + this.parent.cssClass + '\">' + '<input type=\"text\" data-role =\"none\" spellcheck=\"false\" placeholder = \"' + title + '\" class=\"e-input e-rte-linkTitle' + ' ' + this.parent.cssClass + '\"></div>' + '<div class=\"e-rte-label' + ' ' + this.parent.cssClass + '\"></div>' + '<div class=\"e-rte-field' + ' ' + this.parent.cssClass + '\">' + '<input type=\"checkbox\" class=\"e-rte-linkTarget' + ' ' + this.parent.cssClass + '\"  data-role =\"none\"></div>' : '';\n    var content = '<div class=\"e-rte-label' + ' ' + this.parent.cssClass + '\"><label>' + linkWebAddress + '</label></div>' + '<div class=\"e-rte-field' + ' ' + this.parent.cssClass + '\">' + '<input type=\"text\" data-role =\"none\" spellcheck=\"false\" placeholder=\"' + urlPlace + '\" class=\"e-input e-rte-linkurl' + ' ' + this.parent.cssClass + '\"/></div>' + '<div class=\"e-rte-label' + ' ' + this.parent.cssClass + '\">' + '<label>' + linkDisplayText + '</label></div><div class=\"e-rte-field' + ' ' + this.parent.cssClass + '\"> ' + '<input type=\"text\" data-role =\"none\" spellcheck=\"false\" class=\"e-input e-rte-linkText' + ' ' + this.parent.cssClass + '\" placeholder=\"' + textPlace + '\">' + '</div><div class=\"e-rte-label' + ' ' + this.parent.cssClass + '\">' + htmlTextbox;\n    var contentElem = parseHtml(content);\n    linkContent.appendChild(contentElem);\n    var linkTarget = linkContent.querySelector('.e-rte-linkTarget');\n    var linkUrl = linkContent.querySelector('.e-rte-linkurl');\n    var linkText = linkContent.querySelector('.e-rte-linkText');\n    var linkTitle = linkContent.querySelector('.e-rte-linkTitle');\n    var linkOpenLabel = this.i10n.getConstant('linkOpenInNewWindow');\n    this.checkBoxObj = new CheckBox({\n      label: linkOpenLabel,\n      checked: true,\n      enableRtl: this.parent.enableRtl,\n      cssClass: this.parent.cssClass\n    });\n    this.checkBoxObj.isStringTemplate = true;\n    this.checkBoxObj.createElement = this.parent.createElement;\n    this.checkBoxObj.appendTo(linkTarget);\n    var selectText = this.parent.editorMode === 'HTML' ? e.selection.getRange(this.parent.contentModule.getDocument()).toString() : e.text;\n    var linkInsert = this.i10n.getConstant('dialogInsert');\n    var linkCancel = this.i10n.getConstant('dialogCancel');\n    var selection = e.selection;\n    var selectObj = {\n      selfLink: this,\n      selection: e.selection,\n      selectParent: e.selectParent,\n      args: e.args\n    };\n    var dialogModel = {\n      header: this.i10n.getConstant('linkHeader'),\n      content: linkContent,\n      cssClass: CLS_RTE_ELEMENTS + ' ' + this.parent.cssClass,\n      enableRtl: this.parent.enableRtl,\n      locale: this.parent.locale,\n      showCloseIcon: true,\n      closeOnEscape: true,\n      width: Browser.isDevice ? '290px' : '310px',\n      height: 'inherit',\n      isModal: Browser.isDevice,\n      buttons: [{\n        click: this.insertlink.bind(selectObj),\n        buttonModel: {\n          content: linkInsert,\n          cssClass: 'e-flat e-insertLink' + ' ' + this.parent.cssClass,\n          isPrimary: true\n        }\n      }, {\n        click: this.cancelDialog.bind(selectObj),\n        buttonModel: {\n          cssClass: 'e-flat' + ' ' + this.parent.cssClass,\n          content: linkCancel\n        }\n      }],\n      target: Browser.isDevice ? document.body : this.parent.element,\n      animationSettings: {\n        effect: 'None'\n      },\n      close: function (event) {\n        _this.parent.isBlur = false;\n\n        if (event && event.event.returnValue) {\n          if (_this.parent.editorMode === 'HTML') {\n            selection.restore();\n          } else {\n            _this.parent.formatter.editorManager.markdownSelection.restore(_this.parent.contentModule.getEditPanel());\n          }\n        }\n\n        _this.dialogObj.destroy();\n\n        detach(_this.dialogObj.element);\n        var args = _this.dialogObj;\n\n        _this.dialogRenderObj.close(args);\n\n        _this.dialogObj = null;\n      }\n    }; // eslint-disable-next-line\n\n    this.dialogObj = this.dialogRenderObj.render(dialogModel);\n    this.dialogObj.createElement = this.parent.createElement;\n    this.dialogObj.appendTo(linkDialogEle);\n    linkDialogEle.style.maxHeight = 'inherit';\n\n    if (isNullOrUndefined(this.dialogObj)) {\n      return;\n    }\n\n    if (!isNullOrUndefined(inputDetails)) {\n      linkUrl.value = inputDetails.url;\n      linkText.value = inputDetails.text;\n      linkTitle.value = inputDetails.title; // eslint-disable-next-line\n\n      inputDetails.target ? this.checkBoxObj.checked = true : this.checkBoxObj.checked = false;\n      this.dialogObj.header = inputDetails.header;\n      this.dialogObj.element.querySelector('.e-insertLink').textContent = inputDetails.btnText;\n    }\n\n    this.checkUrl(false);\n\n    if (this.parent.editorMode === 'HTML' && isNullOrUndefined(inputDetails) && (!isNullOrUndefined(selectText) && selectText !== '' && e.selection.range.startOffset === 0 || e.selection.range.startOffset !== e.selection.range.endOffset) || e.module === 'Markdown') {\n      linkText.value = selectText;\n    }\n\n    EventHandler.add(this.parent.element.ownerDocument, 'mousedown', this.onDocumentClick, this);\n\n    if (this.quickToolObj) {\n      this.hideLinkQuickToolbar();\n\n      if (this.quickToolObj.inlineQTBar && document.body.contains(this.quickToolObj.inlineQTBar.element)) {\n        this.quickToolObj.inlineQTBar.hidePopup();\n      }\n    }\n  }; // eslint-disable-next-line\n\n\n  Link.prototype.insertlink = function (e) {\n    var linkEle = this.selfLink.dialogObj.element;\n    var linkUrl = linkEle.querySelector('.e-rte-linkurl').value;\n    var linkText = linkEle.querySelector('.e-rte-linkText').value;\n    var linkTitle;\n\n    if (this.selfLink.parent.editorMode === 'HTML') {\n      linkTitle = linkEle.querySelector('.e-rte-linkTitle').value;\n    }\n\n    var target = this.selfLink.checkBoxObj.checked ? '_blank' : null;\n\n    if (linkUrl === '') {\n      this.selfLink.checkUrl(true);\n      return;\n    }\n\n    if (!this.selfLink.isUrl(linkUrl)) {\n      linkText = linkText === '' ? linkUrl : linkText;\n\n      if (!this.selfLink.parent.enableAutoUrl) {\n        linkUrl = linkUrl.indexOf('http') > -1 ? linkUrl : 'http://' + linkUrl;\n      } else {\n        // eslint-disable-next-line\n        linkUrl = linkUrl;\n      }\n    } else {\n      this.selfLink.checkUrl(false);\n    }\n\n    var proxy = this.selfLink;\n\n    if (proxy.parent.editorMode === 'HTML' && isNullOrUndefined(closest(this.selection.range.startContainer.parentNode, '[id=' // eslint-disable-next-line\n    + \"'\" + proxy.parent.contentModule.getPanel().id + \"'\" + ']'))) {\n      proxy.parent.contentModule.getEditPanel().focus();\n\n      if (Browser.isIE && proxy.parent.iframeSettings.enable) {\n        this.selection.restore();\n      }\n\n      var range = proxy.parent.formatter.editorManager.nodeSelection.getRange(proxy.parent.contentModule.getDocument());\n      this.selection = proxy.parent.formatter.editorManager.nodeSelection.save(range, proxy.parent.contentModule.getDocument());\n      this.selectParent = proxy.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n    }\n\n    var value = {\n      url: linkUrl,\n      text: linkText,\n      title: linkTitle,\n      target: target,\n      selection: this.selection,\n      selectParent: this.selectParent\n    };\n\n    if (document.body.contains(proxy.dialogObj.element)) {\n      this.selfLink.dialogObj.hide({\n        returnValue: false\n      });\n    }\n\n    if (isIDevice() && proxy.parent.iframeSettings.enable) {\n      select('iframe', proxy.parent.element).contentWindow.focus();\n    }\n\n    if (proxy.parent.editorMode === 'HTML') {\n      this.selection.restore();\n    }\n\n    if (proxy.parent.formatter.getUndoRedoStack().length === 0) {\n      proxy.parent.formatter.saveData();\n    }\n\n    var argsValue;\n\n    if (!isNullOrUndefined(this.args) && this.args.code === 'KeyK') {\n      var originalEvent = this.args;\n      extend(this.args, {\n        item: {\n          command: 'Links',\n          subCommand: 'CreateLink'\n        },\n        originalEvent: originalEvent\n      }, true);\n      var argsVal = {\n        item: {\n          command: 'Links',\n          subCommand: 'CreateLink'\n        },\n        originalEvent: originalEvent\n      };\n      argsValue = argsVal;\n    } else {\n      argsValue = this.args;\n    }\n\n    this.selfLink.parent.formatter.process(this.selfLink.parent, argsValue, !isNullOrUndefined(this.args) && this.args.originalEvent, value);\n    this.selfLink.parent.contentModule.getEditPanel().focus();\n  };\n\n  Link.prototype.isUrl = function (url) {\n    // eslint-disable-next-line\n    var regexp = /(ftp|http|https):\\/\\/(\\w+:{0,1}\\w*@)?(\\S+)(:[0-9]+)?(\\/|\\/([\\w#!:.?+=&%@!\\-\\/]))?/gi;\n    return regexp.test(url);\n  };\n\n  Link.prototype.checkUrl = function (e) {\n    var linkEle = this.dialogObj.element;\n    var linkUrl = linkEle.querySelector('.e-rte-linkurl');\n\n    if (e) {\n      addClass([linkUrl], 'e-error');\n      linkUrl.setSelectionRange(0, linkUrl.value.length);\n      linkUrl.focus();\n    } else {\n      removeClass([linkUrl], 'e-error');\n    }\n  };\n\n  Link.prototype.removeLink = function (e) {\n    if (this.parent.formatter.getUndoRedoStack().length === 0) {\n      this.parent.formatter.saveData();\n    }\n\n    var selectParentEle = this.getAnchorNode(e.selectParent[0]);\n    this.parent.formatter.process(this.parent, e.args, e.args, {\n      selectNode: e.selectNode,\n      selectParent: e.selectParent,\n      selection: e.selection,\n      text: selectParentEle.innerText,\n      subCommand: e.args.item.subCommand\n    });\n\n    if (isIDevice() && this.parent.iframeSettings.enable) {\n      select('iframe', this.parent.element).contentWindow.focus();\n    } else {\n      this.parent.contentModule.getEditPanel().focus();\n    }\n\n    this.hideLinkQuickToolbar();\n  };\n\n  Link.prototype.openLink = function (e) {\n    var selectParentEle = this.getAnchorNode(e.selectParent[0]);\n\n    if (selectParentEle.classList.contains('e-rte-anchor') || selectParentEle.tagName === 'A') {\n      this.parent.formatter.process(this.parent, e.args, e.args, {\n        url: selectParentEle.href,\n        text: selectParentEle.innerText,\n        target: selectParentEle.target === '' ? '_self' : '_blank',\n        selectNode: e.selectNode,\n        subCommand: e.args.item.subCommand\n      });\n    }\n  };\n\n  Link.prototype.getAnchorNode = function (element) {\n    var selectParent = closest(element, 'a');\n    return selectParent ? selectParent : element;\n  };\n\n  Link.prototype.editLink = function (e) {\n    var selectedNode = this.getAnchorNode(e.selectNode[0]);\n    var selectParentEle = this.getAnchorNode(e.selectParent[0]);\n    selectParentEle = selectedNode.nodeName === 'A' ? selectedNode : selectParentEle;\n\n    if (selectParentEle.classList.contains('e-rte-anchor') || selectParentEle.tagName === 'A') {\n      var linkUpdate = this.i10n.getConstant('dialogUpdate');\n      var inputDetails = {\n        url: selectParentEle.getAttribute('href'),\n        text: selectParentEle.innerText,\n        title: selectParentEle.title,\n        target: selectParentEle.target,\n        header: this.i10n.getConstant('editLink'),\n        btnText: linkUpdate\n      };\n      this.linkDialog(e, inputDetails);\n    }\n  }; // eslint-disable-next-line\n\n\n  Link.prototype.cancelDialog = function (e) {\n    this.selfLink.parent.isBlur = false;\n    this.selfLink.dialogObj.hide({\n      returnValue: true\n    });\n\n    if (isIDevice()) {\n      this.selection.restore();\n    } else {\n      this.selfLink.parent.contentModule.getEditPanel().focus();\n    }\n  };\n\n  Link.prototype.onDocumentClick = function (e) {\n    var target = e.target;\n\n    if (!isNullOrUndefined(this.dialogObj) && ( // eslint-disable-next-line\n    !closest(target, '[id=' + \"'\" + this.dialogObj.element.id + \"'\" + ']') && this.parent.toolbarSettings.enable && this.parent.getToolbarElement() && !this.parent.getToolbarElement().contains(e.target) || (this.parent.getToolbarElement() && this.parent.getToolbarElement().contains(e.target) || this.parent.inlineMode.enable && !closest(target, '#' + this.dialogObj.element.id)) && !closest(target, '#' + this.parent.getID() + '_toolbar_CreateLink') && !target.querySelector('#' + this.parent.getID() + '_toolbar_CreateLink'))) {\n      this.dialogObj.hide({\n        returnValue: true\n      });\n      EventHandler.remove(this.parent.element.ownerDocument, 'mousedown', this.onDocumentClick);\n      this.parent.isBlur = true;\n      dispatchEvent(this.parent.element, 'focusout');\n    }\n  };\n  /**\n   * Destroys the ToolBar.\n   *\n   * @function destroy\n   * @returns {void}\n   * @hidden\n    */\n\n\n  Link.prototype.destroy = function () {\n    this.removeEventListener();\n  };\n  /**\n   * For internal use only - Get the module name.\n   *\n   * @returns {void}\n   */\n\n\n  Link.prototype.getModuleName = function () {\n    return 'link';\n  };\n\n  return Link;\n}();\n\nexport { Link };","map":{"version":3,"names":["EventHandler","detach","isNullOrUndefined","select","extend","isNOU","closest","addClass","removeClass","Browser","events","CLS_RTE_ELEMENTS","CheckBox","RenderType","dispatchEvent","parseHtml","isIDevice","Link","parent","serviceLocator","rteID","element","id","i10n","getService","addEventListener","rendererFactory","dialogRenderObj","prototype","isDestroyed","on","insertLink","linkDialog","showLinkDialog","showDialog","closeLinkDialog","closeDialog","keyDown","onKeyDown","insertCompleted","showLinkQuickToolbar","clearDialogObj","linkToolbarAction","onToolbarAction","iframeMouseDown","onIframeMouseDown","unLink","removeLink","editLink","openLink","editAreaClick","editAreaClickHandler","bindCssClass","setCssClass","destroy","args","item","subCommand","notify","removeEventListener","off","dialogObj","hide","returnValue","updateCss","currentObj","e","cssClass","oldCssClass","setProperties","trim","replace","checkBoxObj","action","pageX","pageY","type","quickToolbarModule","linkQTBar","quickToolObj","parentTop","getBoundingClientRect","top","parentLeft","left","range","formatter","editorManager","nodeSelection","getRange","contentModule","getDocument","target_1","forEach","call","elements","index","nodeName","parentNode","isNotify","tbElement","toolbarModule","getToolbarElement","linkTop","linkLeft","linkPos","tbHeight","offsetHeight","getExpandTBarPopHeight","iframeSettings","enable","window","pageYOffset","touches","changedTouches","pageXOffset","clientX","clientY","showPopup","endContainer","hideLinkQuickToolbar","document","body","contains","hidePopup","readonly","showOnRightClick","quickToolbarSettings","which","editorMode","target","getAnchorNode","getRenderer","Content","isPopupOpen","classList","childNodes","length","startContainer","parentElement","event","originalEvent","close","openDialog","preventDefault","isInternal","getEditPanel","focus","save","selectNodeEle","getNodeCollection","selectParentEle","getParentNodeCollection","eventArgs","command","undefined","selectNode","selection","selectParent","textArea","markdownSelection","selectionStart","selectionEnd","member","text","getSelectedText","module","name","inputDetails","_this","linkWebAddress","getConstant","linkDisplayText","linkTooltip","urlPlace","textPlace","title","linkDialogEle","createElement","className","appendChild","linkContent","htmlTextbox","content","contentElem","linkTarget","querySelector","linkUrl","linkText","linkTitle","linkOpenLabel","label","checked","enableRtl","isStringTemplate","appendTo","selectText","toString","linkInsert","linkCancel","selectObj","selfLink","dialogModel","header","locale","showCloseIcon","closeOnEscape","width","isDevice","height","isModal","buttons","click","insertlink","bind","buttonModel","isPrimary","cancelDialog","animationSettings","effect","isBlur","restore","render","style","maxHeight","value","url","textContent","btnText","checkUrl","startOffset","endOffset","add","ownerDocument","onDocumentClick","inlineQTBar","linkEle","isUrl","enableAutoUrl","indexOf","proxy","getPanel","isIE","contentWindow","getUndoRedoStack","saveData","argsValue","code","argsVal","process","regexp","test","setSelectionRange","innerText","tagName","href","selectedNode","linkUpdate","getAttribute","toolbarSettings","inlineMode","getID","remove","getModuleName"],"sources":["/home/morgan/Desktop/Projets/ENT4/Jwt-Auth-pdf/react-jwt-auth/react-jwt-auth/node_modules/@syncfusion/ej2-richtexteditor/src/rich-text-editor/renderer/link-module.js"],"sourcesContent":["import { EventHandler, detach, isNullOrUndefined, select, extend, isNullOrUndefined as isNOU } from '@syncfusion/ej2-base';\nimport { closest, addClass, removeClass, Browser } from '@syncfusion/ej2-base';\nimport * as events from '../base/constant';\nimport { CLS_RTE_ELEMENTS } from '../base/classes';\nimport { CheckBox } from '@syncfusion/ej2-buttons';\nimport { RenderType } from '../base/enum';\nimport { dispatchEvent, parseHtml } from '../base/util';\nimport { isIDevice } from '../../common/util';\n/**\n * `Link` module is used to handle undo actions.\n */\nvar Link = /** @class */ (function () {\n    function Link(parent, serviceLocator) {\n        this.parent = parent;\n        this.rteID = parent.element.id;\n        this.i10n = serviceLocator.getService('rteLocale');\n        this.addEventListener();\n        this.serviceLocator = serviceLocator;\n        this.rendererFactory = serviceLocator.getService('rendererFactory');\n        this.dialogRenderObj = serviceLocator.getService('dialogRenderObject');\n    }\n    Link.prototype.addEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.on(events.insertLink, this.linkDialog, this);\n        this.parent.on(events.showLinkDialog, this.showDialog, this);\n        this.parent.on(events.closeLinkDialog, this.closeDialog, this);\n        this.parent.on(events.keyDown, this.onKeyDown, this);\n        this.parent.on(events.insertCompleted, this.showLinkQuickToolbar, this);\n        this.parent.on(events.clearDialogObj, this.clearDialogObj, this);\n        this.parent.on(events.linkToolbarAction, this.onToolbarAction, this);\n        this.parent.on(events.iframeMouseDown, this.onIframeMouseDown, this);\n        this.parent.on(events.unLink, this.removeLink, this);\n        this.parent.on(events.editLink, this.editLink, this);\n        this.parent.on(events.openLink, this.openLink, this);\n        this.parent.on(events.editAreaClick, this.editAreaClickHandler, this);\n        this.parent.on(events.bindCssClass, this.setCssClass, this);\n        this.parent.on(events.destroy, this.destroy, this);\n    };\n    Link.prototype.onToolbarAction = function (args) {\n        var item = args.args.item;\n        switch (item.subCommand) {\n            case 'OpenLink':\n                this.parent.notify(events.openLink, args);\n                break;\n            case 'EditLink':\n                this.parent.notify(events.editLink, args);\n                break;\n            case 'RemoveLink':\n                this.parent.notify(events.unLink, args);\n                break;\n        }\n    };\n    Link.prototype.removeEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.off(events.insertLink, this.linkDialog);\n        this.parent.off(events.showLinkDialog, this.showDialog);\n        this.parent.off(events.closeLinkDialog, this.closeDialog);\n        this.parent.off(events.keyDown, this.onKeyDown);\n        this.parent.off(events.insertCompleted, this.showLinkQuickToolbar);\n        this.parent.off(events.clearDialogObj, this.clearDialogObj);\n        this.parent.off(events.linkToolbarAction, this.onToolbarAction);\n        this.parent.off(events.unLink, this.removeLink);\n        this.parent.off(events.iframeMouseDown, this.onIframeMouseDown);\n        this.parent.off(events.editLink, this.editLink);\n        this.parent.off(events.openLink, this.openLink);\n        this.parent.off(events.editAreaClick, this.editAreaClickHandler);\n        this.parent.off(events.bindCssClass, this.setCssClass);\n        this.parent.off(events.destroy, this.destroy);\n    };\n    Link.prototype.onIframeMouseDown = function () {\n        if (this.dialogObj) {\n            this.dialogObj.hide({ returnValue: true });\n        }\n    };\n    Link.prototype.updateCss = function (currentObj, e) {\n        if (currentObj && e.cssClass) {\n            if (isNullOrUndefined(e.oldCssClass)) {\n                currentObj.setProperties({ cssClass: (currentObj.cssClass + ' ' + e.cssClass).trim() });\n            }\n            else {\n                currentObj.setProperties({ cssClass: (currentObj.cssClass.replace(e.oldCssClass, '').trim() + ' ' + e.cssClass).trim() });\n            }\n        }\n    };\n    Link.prototype.setCssClass = function (e) {\n        this.updateCss(this.checkBoxObj, e);\n        this.updateCss(this.dialogObj, e);\n    };\n    Link.prototype.showLinkQuickToolbar = function (e) {\n        if (!isNullOrUndefined(e.args) && e.args.action !== 'enter' &&\n            e.args.action !== 'space') {\n            var pageX = void 0;\n            var pageY = void 0;\n            if (e.type !== 'Links' || isNullOrUndefined(this.parent.quickToolbarModule) ||\n                isNullOrUndefined(this.parent.quickToolbarModule.linkQTBar)) {\n                return;\n            }\n            this.quickToolObj = this.parent.quickToolbarModule;\n            var parentTop = this.parent.element.getBoundingClientRect().top;\n            var parentLeft = this.parent.element.getBoundingClientRect().left;\n            var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n            var target_1;\n            [].forEach.call(e.elements, function (element, index) {\n                if (index === 0) {\n                    target_1 = ((element.nodeName === '#text') ? (element.parentNode) : element);\n                }\n            });\n            if (e.isNotify) {\n                var tbElement = this.parent.toolbarModule.getToolbarElement();\n                var linkTop = target_1.getBoundingClientRect().top;\n                var linkLeft = target_1.getBoundingClientRect().left;\n                var linkPos = linkTop - parentTop;\n                var tbHeight = (tbElement) ? (tbElement.offsetHeight + this.parent.toolbarModule.getExpandTBarPopHeight()) : 0;\n                pageX = (this.parent.iframeSettings.enable) ? parentLeft + linkLeft : target_1.getBoundingClientRect().left;\n                pageY = window.pageYOffset + ((this.parent.iframeSettings.enable) ?\n                    (parentTop + tbHeight + linkTop) : (parentTop + linkPos));\n            }\n            else {\n                var args = void 0;\n                args = e.args.touches ? e.args.changedTouches[0] : args = e.args;\n                pageX = (this.parent.iframeSettings.enable) ? window.pageXOffset + parentLeft + args.clientX : args.pageX;\n                pageY = (this.parent.iframeSettings.enable) ? window.pageYOffset + parentTop + args.clientY : args.pageY;\n            }\n            if (this.quickToolObj.linkQTBar) {\n                this.quickToolObj.linkQTBar.showPopup(pageX, pageY, range.endContainer);\n            }\n        }\n    };\n    Link.prototype.hideLinkQuickToolbar = function () {\n        if (this.quickToolObj && this.quickToolObj.linkQTBar && document.body.contains(this.quickToolObj.linkQTBar.element)) {\n            this.quickToolObj.linkQTBar.hidePopup();\n        }\n    };\n    Link.prototype.editAreaClickHandler = function (e) {\n        if (this.parent.readonly) {\n            this.hideLinkQuickToolbar();\n            return;\n        }\n        var args = e.args;\n        var showOnRightClick = this.parent.quickToolbarSettings.showOnRightClick;\n        if (args.which === 2 || (showOnRightClick && args.which === 1) || (!showOnRightClick && args.which === 3)) {\n            return;\n        }\n        if (this.parent.editorMode === 'HTML' && this.parent.quickToolbarModule && this.parent.quickToolbarModule.linkQTBar) {\n            this.quickToolObj = this.parent.quickToolbarModule;\n            var target = args.target;\n            target = this.getAnchorNode(target);\n            this.contentModule = this.rendererFactory.getRenderer(RenderType.Content);\n            var isPopupOpen = this.quickToolObj.linkQTBar.element.classList.contains('e-rte-pop');\n            if (target.nodeName === 'A' && (target.childNodes.length > 0 && target.childNodes[0].nodeName !== 'IMG') &&\n                e.args.target.nodeName !== 'IMG' &&\n                !isNOU(closest(this.parent.getRange().startContainer.parentElement, 'A')) && !isNOU(closest(this.parent.getRange().endContainer.parentElement, 'A'))) {\n                if (isPopupOpen) {\n                    return;\n                }\n                this.showLinkQuickToolbar({\n                    args: args,\n                    isNotify: false,\n                    type: 'Links',\n                    elements: [args.target]\n                });\n            }\n            else {\n                this.hideLinkQuickToolbar();\n            }\n        }\n    };\n    Link.prototype.onKeyDown = function (event) {\n        var originalEvent = event.args;\n        switch (originalEvent.action) {\n            case 'escape':\n                if (!isNullOrUndefined(this.dialogObj)) {\n                    this.dialogObj.close();\n                }\n                break;\n            case 'insert-link':\n                this.openDialog(true, event);\n                originalEvent.preventDefault();\n                break;\n        }\n    };\n    Link.prototype.openDialog = function (isInternal, event) {\n        if (!isInternal) {\n            this.parent.contentModule.getEditPanel().focus();\n        }\n        if (this.parent.editorMode === 'HTML') {\n            var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n            var save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n            var selectNodeEle = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n            var selectParentEle = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n            var eventArgs = {\n                args: event ? event.args : {\n                    item: { command: 'Links', subCommand: 'CreateLink' },\n                    originalEvent: undefined\n                },\n                selectNode: selectNodeEle, selection: save, selectParent: selectParentEle\n            };\n            this.linkDialog(eventArgs);\n        }\n        else {\n            var textArea = this.parent.contentModule.getEditPanel();\n            this.parent.formatter.editorManager.markdownSelection.save(textArea.selectionStart, textArea.selectionEnd);\n            this.linkDialog({\n                args: {\n                    item: { command: 'Links', subCommand: 'Link' },\n                    originalEvent: event && event.args\n                },\n                member: 'link',\n                text: this.parent.formatter.editorManager.markdownSelection.getSelectedText(this.parent.contentModule.getEditPanel()),\n                module: 'Markdown',\n                name: 'insertLink'\n            });\n        }\n    };\n    Link.prototype.showDialog = function () {\n        this.openDialog(false);\n        this.setCssClass({ cssClass: this.parent.cssClass });\n    };\n    Link.prototype.closeDialog = function () {\n        if (this.dialogObj) {\n            this.dialogObj.hide({ returnValue: true });\n        }\n    };\n    Link.prototype.clearDialogObj = function () {\n        if (this.dialogObj) {\n            this.dialogObj.destroy();\n            detach(this.dialogObj.element);\n            this.dialogObj = null;\n        }\n    };\n    Link.prototype.linkDialog = function (e, inputDetails) {\n        var _this = this;\n        if (this.dialogObj) {\n            this.dialogObj.hide({ returnValue: true });\n            return;\n        }\n        if (this.parent.editorMode === 'HTML' && (e.selectParent.length > 0 &&\n            !isNullOrUndefined(e.selectParent[0].classList) &&\n            e.selectParent[0].classList.contains('e-rte-anchor')) && isNullOrUndefined(inputDetails)) {\n            this.editLink(e);\n            return;\n        }\n        var linkWebAddress = this.i10n.getConstant('linkWebUrl');\n        var linkDisplayText = this.i10n.getConstant('linkText');\n        var linkTooltip = this.i10n.getConstant('linkTooltipLabel');\n        var urlPlace = this.i10n.getConstant('linkurl');\n        var textPlace = this.i10n.getConstant('textPlaceholder');\n        var title = this.i10n.getConstant('linkTitle');\n        var linkDialogEle = this.parent.createElement('div', {\n            className: 'e-rte-link-dialog' + ' ' + this.parent.cssClass, id: this.rteID + '_rtelink'\n        });\n        this.parent.element.appendChild(linkDialogEle);\n        var linkContent = this.parent.createElement('div', {\n            className: 'e-rte-linkcontent' + ' ' + this.parent.cssClass, id: this.rteID + '_linkContent'\n        });\n        var htmlTextbox = (this.parent.editorMode === 'HTML') ? '<label>' + linkTooltip +\n            '</label></div><div class=\"e-rte-field' + ' ' + this.parent.cssClass + '\">' +\n            '<input type=\"text\" data-role =\"none\" spellcheck=\"false\" placeholder = \"' + title + '\" class=\"e-input e-rte-linkTitle' + ' ' + this.parent.cssClass + '\"></div>' +\n            '<div class=\"e-rte-label' + ' ' + this.parent.cssClass + '\"></div>' + '<div class=\"e-rte-field' + ' ' + this.parent.cssClass + '\">' +\n            '<input type=\"checkbox\" class=\"e-rte-linkTarget' + ' ' + this.parent.cssClass + '\"  data-role =\"none\"></div>' : '';\n        var content = '<div class=\"e-rte-label' + ' ' + this.parent.cssClass + '\"><label>' + linkWebAddress + '</label></div>' + '<div class=\"e-rte-field' + ' ' + this.parent.cssClass + '\">' +\n            '<input type=\"text\" data-role =\"none\" spellcheck=\"false\" placeholder=\"' + urlPlace + '\" class=\"e-input e-rte-linkurl' + ' ' + this.parent.cssClass + '\"/></div>' +\n            '<div class=\"e-rte-label' + ' ' + this.parent.cssClass + '\">' + '<label>' + linkDisplayText + '</label></div><div class=\"e-rte-field' + ' ' + this.parent.cssClass + '\"> ' +\n            '<input type=\"text\" data-role =\"none\" spellcheck=\"false\" class=\"e-input e-rte-linkText' + ' ' + this.parent.cssClass + '\" placeholder=\"' + textPlace + '\">' +\n            '</div><div class=\"e-rte-label' + ' ' + this.parent.cssClass + '\">' + htmlTextbox;\n        var contentElem = parseHtml(content);\n        linkContent.appendChild(contentElem);\n        var linkTarget = linkContent.querySelector('.e-rte-linkTarget');\n        var linkUrl = linkContent.querySelector('.e-rte-linkurl');\n        var linkText = linkContent.querySelector('.e-rte-linkText');\n        var linkTitle = linkContent.querySelector('.e-rte-linkTitle');\n        var linkOpenLabel = this.i10n.getConstant('linkOpenInNewWindow');\n        this.checkBoxObj = new CheckBox({ label: linkOpenLabel, checked: true, enableRtl: this.parent.enableRtl, cssClass: this.parent.cssClass });\n        this.checkBoxObj.isStringTemplate = true;\n        this.checkBoxObj.createElement = this.parent.createElement;\n        this.checkBoxObj.appendTo(linkTarget);\n        var selectText = (this.parent.editorMode === 'HTML') ?\n            e.selection.getRange(this.parent.contentModule.getDocument()).toString() : e.text;\n        var linkInsert = this.i10n.getConstant('dialogInsert');\n        var linkCancel = this.i10n.getConstant('dialogCancel');\n        var selection = e.selection;\n        var selectObj = { selfLink: this, selection: e.selection, selectParent: e.selectParent, args: e.args };\n        var dialogModel = {\n            header: this.i10n.getConstant('linkHeader'),\n            content: linkContent,\n            cssClass: CLS_RTE_ELEMENTS + ' ' + this.parent.cssClass,\n            enableRtl: this.parent.enableRtl,\n            locale: this.parent.locale,\n            showCloseIcon: true, closeOnEscape: true, width: (Browser.isDevice) ? '290px' : '310px', height: 'inherit',\n            isModal: Browser.isDevice,\n            buttons: [{\n                    click: this.insertlink.bind(selectObj),\n                    buttonModel: { content: linkInsert, cssClass: 'e-flat e-insertLink' + ' ' + this.parent.cssClass, isPrimary: true }\n                },\n                { click: this.cancelDialog.bind(selectObj), buttonModel: { cssClass: 'e-flat' + ' ' + this.parent.cssClass, content: linkCancel } }],\n            target: (Browser.isDevice) ? document.body : this.parent.element,\n            animationSettings: { effect: 'None' },\n            close: function (event) {\n                _this.parent.isBlur = false;\n                if (event && event.event.returnValue) {\n                    if (_this.parent.editorMode === 'HTML') {\n                        selection.restore();\n                    }\n                    else {\n                        _this.parent.formatter.editorManager.markdownSelection.restore(_this.parent.contentModule.getEditPanel());\n                    }\n                }\n                _this.dialogObj.destroy();\n                detach(_this.dialogObj.element);\n                var args = _this.dialogObj;\n                _this.dialogRenderObj.close(args);\n                _this.dialogObj = null;\n            }\n        };\n        // eslint-disable-next-line\n        this.dialogObj = this.dialogRenderObj.render(dialogModel);\n        this.dialogObj.createElement = this.parent.createElement;\n        this.dialogObj.appendTo(linkDialogEle);\n        linkDialogEle.style.maxHeight = 'inherit';\n        if (isNullOrUndefined(this.dialogObj)) {\n            return;\n        }\n        if (!isNullOrUndefined(inputDetails)) {\n            linkUrl.value = inputDetails.url;\n            linkText.value = inputDetails.text;\n            linkTitle.value = inputDetails.title;\n            // eslint-disable-next-line\n            (inputDetails.target) ? this.checkBoxObj.checked = true : this.checkBoxObj.checked = false;\n            this.dialogObj.header = inputDetails.header;\n            this.dialogObj.element.querySelector('.e-insertLink').textContent = inputDetails.btnText;\n        }\n        this.checkUrl(false);\n        if ((this.parent.editorMode === 'HTML' && isNullOrUndefined(inputDetails) && ((!isNullOrUndefined(selectText)\n            && selectText !== '') && (e.selection.range.startOffset === 0) || e.selection.range.startOffset !==\n            e.selection.range.endOffset)) || e.module === 'Markdown') {\n            linkText.value = selectText;\n        }\n        EventHandler.add(this.parent.element.ownerDocument, 'mousedown', this.onDocumentClick, this);\n        if (this.quickToolObj) {\n            this.hideLinkQuickToolbar();\n            if (this.quickToolObj.inlineQTBar && document.body.contains(this.quickToolObj.inlineQTBar.element)) {\n                this.quickToolObj.inlineQTBar.hidePopup();\n            }\n        }\n    };\n    // eslint-disable-next-line\n    Link.prototype.insertlink = function (e) {\n        var linkEle = this.selfLink.dialogObj.element;\n        var linkUrl = linkEle.querySelector('.e-rte-linkurl').value;\n        var linkText = linkEle.querySelector('.e-rte-linkText').value;\n        var linkTitle;\n        if (this.selfLink.parent.editorMode === 'HTML') {\n            linkTitle = linkEle.querySelector('.e-rte-linkTitle').value;\n        }\n        var target = (this.selfLink.checkBoxObj.checked) ? '_blank' : null;\n        if (linkUrl === '') {\n            this.selfLink.checkUrl(true);\n            return;\n        }\n        if (!this.selfLink.isUrl(linkUrl)) {\n            linkText = (linkText === '') ? linkUrl : linkText;\n            if (!this.selfLink.parent.enableAutoUrl) {\n                linkUrl = linkUrl.indexOf('http') > -1 ? linkUrl : 'http://' + linkUrl;\n            }\n            else {\n                // eslint-disable-next-line\n                linkUrl = linkUrl;\n            }\n        }\n        else {\n            this.selfLink.checkUrl(false);\n        }\n        var proxy = this.selfLink;\n        if (proxy.parent.editorMode === 'HTML' && isNullOrUndefined(closest(this.selection.range.startContainer.parentNode, '[id='\n            // eslint-disable-next-line\n            + \"'\" + proxy.parent.contentModule.getPanel().id + \"'\" + ']'))) {\n            proxy.parent.contentModule.getEditPanel().focus();\n            if (Browser.isIE && proxy.parent.iframeSettings.enable) {\n                this.selection.restore();\n            }\n            var range = proxy.parent.formatter.editorManager.nodeSelection.getRange(proxy.parent.contentModule.getDocument());\n            this.selection = proxy.parent.formatter.editorManager.nodeSelection.save(range, proxy.parent.contentModule.getDocument());\n            this.selectParent = proxy.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n        }\n        var value = {\n            url: linkUrl, text: linkText, title: linkTitle, target: target,\n            selection: this.selection, selectParent: this.selectParent\n        };\n        if (document.body.contains(proxy.dialogObj.element)) {\n            this.selfLink.dialogObj.hide({ returnValue: false });\n        }\n        if (isIDevice() && proxy.parent.iframeSettings.enable) {\n            select('iframe', proxy.parent.element).contentWindow.focus();\n        }\n        if (proxy.parent.editorMode === 'HTML') {\n            this.selection.restore();\n        }\n        if (proxy.parent.formatter.getUndoRedoStack().length === 0) {\n            proxy.parent.formatter.saveData();\n        }\n        var argsValue;\n        if (!isNullOrUndefined(this.args) &&\n            this.args.code === 'KeyK') {\n            var originalEvent = this.args;\n            extend(this.args, { item: { command: 'Links', subCommand: 'CreateLink' }, originalEvent: originalEvent }, true);\n            var argsVal = {\n                item: { command: 'Links', subCommand: 'CreateLink' }, originalEvent: originalEvent\n            };\n            argsValue = argsVal;\n        }\n        else {\n            argsValue = this.args;\n        }\n        this.selfLink.parent.formatter.process(this.selfLink.parent, argsValue, (!isNullOrUndefined(this.args) &&\n            this.args.originalEvent), value);\n        this.selfLink.parent.contentModule.getEditPanel().focus();\n    };\n    Link.prototype.isUrl = function (url) {\n        // eslint-disable-next-line\n        var regexp = /(ftp|http|https):\\/\\/(\\w+:{0,1}\\w*@)?(\\S+)(:[0-9]+)?(\\/|\\/([\\w#!:.?+=&%@!\\-\\/]))?/gi;\n        return regexp.test(url);\n    };\n    Link.prototype.checkUrl = function (e) {\n        var linkEle = this.dialogObj.element;\n        var linkUrl = linkEle.querySelector('.e-rte-linkurl');\n        if (e) {\n            addClass([linkUrl], 'e-error');\n            linkUrl.setSelectionRange(0, linkUrl.value.length);\n            linkUrl.focus();\n        }\n        else {\n            removeClass([linkUrl], 'e-error');\n        }\n    };\n    Link.prototype.removeLink = function (e) {\n        if (this.parent.formatter.getUndoRedoStack().length === 0) {\n            this.parent.formatter.saveData();\n        }\n        var selectParentEle = this.getAnchorNode(e.selectParent[0]);\n        this.parent.formatter.process(this.parent, e.args, e.args, {\n            selectNode: e.selectNode, selectParent: e.selectParent, selection: e.selection,\n            text: selectParentEle.innerText,\n            subCommand: e.args.item.subCommand\n        });\n        if (isIDevice() && this.parent.iframeSettings.enable) {\n            select('iframe', this.parent.element).contentWindow.focus();\n        }\n        else {\n            this.parent.contentModule.getEditPanel().focus();\n        }\n        this.hideLinkQuickToolbar();\n    };\n    Link.prototype.openLink = function (e) {\n        var selectParentEle = this.getAnchorNode(e.selectParent[0]);\n        if (selectParentEle.classList.contains('e-rte-anchor') || selectParentEle.tagName === 'A') {\n            this.parent.formatter.process(this.parent, e.args, e.args, {\n                url: selectParentEle.href, text: selectParentEle.innerText,\n                target: selectParentEle.target === '' ? '_self' : '_blank', selectNode: e.selectNode,\n                subCommand: e.args.item.subCommand\n            });\n        }\n    };\n    Link.prototype.getAnchorNode = function (element) {\n        var selectParent = closest(element, 'a');\n        return (selectParent ? selectParent : element);\n    };\n    Link.prototype.editLink = function (e) {\n        var selectedNode = this.getAnchorNode(e.selectNode[0]);\n        var selectParentEle = this.getAnchorNode(e.selectParent[0]);\n        selectParentEle = selectedNode.nodeName === 'A' ? selectedNode : selectParentEle;\n        if (selectParentEle.classList.contains('e-rte-anchor') || selectParentEle.tagName === 'A') {\n            var linkUpdate = this.i10n.getConstant('dialogUpdate');\n            var inputDetails = {\n                url: selectParentEle.getAttribute('href'), text: selectParentEle.innerText,\n                title: selectParentEle.title, target: selectParentEle.target,\n                header: this.i10n.getConstant('editLink'), btnText: linkUpdate\n            };\n            this.linkDialog(e, inputDetails);\n        }\n    };\n    // eslint-disable-next-line\n    Link.prototype.cancelDialog = function (e) {\n        this.selfLink.parent.isBlur = false;\n        this.selfLink.dialogObj.hide({ returnValue: true });\n        if (isIDevice()) {\n            this.selection.restore();\n        }\n        else {\n            this.selfLink.parent.contentModule.getEditPanel().focus();\n        }\n    };\n    Link.prototype.onDocumentClick = function (e) {\n        var target = e.target;\n        if (!isNullOrUndefined(this.dialogObj) && ((\n        // eslint-disable-next-line\n        !closest(target, '[id=' + \"'\" + this.dialogObj.element.id + \"'\" + ']') && this.parent.toolbarSettings.enable &&\n            this.parent.getToolbarElement() && !this.parent.getToolbarElement().contains(e.target)) ||\n            (((this.parent.getToolbarElement() && this.parent.getToolbarElement().contains(e.target)) ||\n                this.parent.inlineMode.enable && !closest(target, '#' + this.dialogObj.element.id)) &&\n                !closest(target, '#' + this.parent.getID() + '_toolbar_CreateLink') &&\n                !target.querySelector('#' + this.parent.getID() + '_toolbar_CreateLink')))) {\n            this.dialogObj.hide({ returnValue: true });\n            EventHandler.remove(this.parent.element.ownerDocument, 'mousedown', this.onDocumentClick);\n            this.parent.isBlur = true;\n            dispatchEvent(this.parent.element, 'focusout');\n        }\n    };\n    /**\n     * Destroys the ToolBar.\n     *\n     * @function destroy\n     * @returns {void}\n     * @hidden\n\n     */\n    Link.prototype.destroy = function () {\n        this.removeEventListener();\n    };\n    /**\n     * For internal use only - Get the module name.\n     *\n     * @returns {void}\n     */\n    Link.prototype.getModuleName = function () {\n        return 'link';\n    };\n    return Link;\n}());\nexport { Link };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}