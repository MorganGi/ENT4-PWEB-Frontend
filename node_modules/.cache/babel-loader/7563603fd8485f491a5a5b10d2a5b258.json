{"ast":null,"code":"import { Draggable, Droppable, EventHandler } from '@syncfusion/ej2-base';\nimport { createElement, closest, remove, classList, addClass, removeClass } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined, extend } from '@syncfusion/ej2-base';\nimport { parentsUntil, isActionPrevent, isGroupAdaptive, updatecloneRow, getComplexFieldID, isComplexField } from '../base/util';\nimport * as events from '../base/constant';\nimport { AriaService } from '../services/aria-service';\nimport { GroupModelGenerator } from '../services/group-model-generator';\nimport { DataUtil } from '@syncfusion/ej2-data';\nimport * as literals from '../base/string-literals'; // eslint-disable-next-line valid-jsdoc\n\n/**\n *\n * The `Group` module is used to handle group action.\n */\n\nvar Group =\n/** @class */\nfunction () {\n  /**\n   * Constructor for Grid group module\n   *\n   * @param {IGrid} parent - specifies the IGrid\n   * @param {GroupSettingsModel} groupSettings - specifies the GroupSettingsModel\n   * @param {string[]} sortedColumns - specifies the sortedColumns\n   * @param {ServiceLocator} serviceLocator - specifies the serviceLocator\n   * @hidden\n   */\n  function Group(parent, groupSettings, sortedColumns, serviceLocator) {\n    var _this = this; //Internal variables\n\n\n    this.sortRequired = true;\n    /** @hidden */\n\n    this.groupSortFocus = false;\n    /** @hidden */\n\n    this.groupCancelFocus = false;\n    this.isAppliedGroup = false;\n    this.isAppliedUnGroup = false;\n    this.reorderingColumns = [];\n    this.visualElement = createElement('div', {\n      className: 'e-cloneproperties e-dragclone e-gdclone',\n      styles: 'line-height:23px',\n      attrs: {\n        action: 'grouping'\n      }\n    });\n\n    this.helper = function (e) {\n      var gObj = _this.parent;\n      var target = e.sender.target;\n      var element = target.classList.contains('e-groupheadercell') ? target : parentsUntil(target, 'e-groupheadercell');\n\n      if (!element || !target.classList.contains('e-drag') && _this.groupSettings.allowReordering) {\n        return false;\n      }\n\n      _this.column = gObj.getColumnByField(element.firstElementChild.getAttribute('ej-mappingname'));\n      _this.visualElement.textContent = element.textContent;\n      _this.visualElement.style.width = element.offsetWidth + 2 + 'px';\n      _this.visualElement.style.height = element.offsetHeight + 2 + 'px';\n\n      _this.visualElement.setAttribute('e-mappinguid', _this.column.uid);\n\n      gObj.element.appendChild(_this.visualElement);\n      return _this.visualElement;\n    }; // eslint-disable-next-line @typescript-eslint/no-unused-vars\n\n\n    this.dragStart = function (e) {\n      _this.parent.element.classList.add('e-ungroupdrag');\n    };\n\n    this.drag = function (e) {\n      if (_this.groupSettings.allowReordering) {\n        _this.animateDropper(e);\n      }\n\n      var target = e.target;\n\n      var cloneElement = _this.parent.element.querySelector('.e-cloneproperties');\n\n      _this.parent.trigger(events.columnDrag, {\n        target: target,\n        draggableType: 'headercell',\n        column: _this.column\n      });\n\n      if (!_this.groupSettings.allowReordering) {\n        classList(cloneElement, ['e-defaultcur'], ['e-notallowedcur']);\n\n        if (!(parentsUntil(target, literals.gridContent) || parentsUntil(target, 'e-headercell'))) {\n          classList(cloneElement, ['e-notallowedcur'], ['e-defaultcur']);\n        }\n      }\n    };\n\n    this.dragStop = function (e) {\n      _this.parent.element.classList.remove('e-ungroupdrag');\n\n      var preventDrop = !(parentsUntil(e.target, literals.gridContent) || parentsUntil(e.target, 'e-gridheader'));\n\n      if (_this.groupSettings.allowReordering && preventDrop) {\n        remove(e.helper);\n\n        if (parentsUntil(e.target, 'e-groupdroparea')) {\n          _this.rearrangeGroup();\n        } else if (!parentsUntil(e.target, 'e-grid')) {\n          var field = _this.parent.getColumnByUid(e.helper.getAttribute('e-mappinguid')).field;\n\n          if (_this.groupSettings.columns.indexOf(field) !== -1) {\n            _this.ungroupColumn(field);\n          }\n        }\n\n        return;\n      } else if (preventDrop) {\n        remove(e.helper);\n        return;\n      }\n    };\n\n    this.animateDropper = function (e) {\n      var uid = _this.parent.element.querySelector('.e-cloneproperties').getAttribute('e-mappinguid');\n\n      var dragField = _this.parent.getColumnByUid(uid).field;\n\n      var parent = parentsUntil(e.target, 'e-groupdroparea');\n      var dropTarget = parentsUntil(e.target, 'e-group-animator');\n      var grouped = [].slice.call(_this.element.getElementsByClassName('e-groupheadercell')).map(function (e) {\n        return e.querySelector('div').getAttribute('ej-mappingname');\n      });\n      var cols = JSON.parse(JSON.stringify(grouped));\n\n      if (dropTarget || parent) {\n        if (dropTarget) {\n          var dropField = dropTarget.querySelector('div[ej-mappingname]').getAttribute('ej-mappingname');\n          var dropIndex = +dropTarget.getAttribute('index');\n\n          if (dropField !== dragField) {\n            var dragIndex = cols.indexOf(dragField);\n\n            if (dragIndex !== -1) {\n              cols.splice(dragIndex, 1);\n            }\n\n            var flag = dropIndex !== -1 && dragIndex === dropIndex;\n            cols.splice(dropIndex + (flag ? 1 : 0), 0, dragField);\n          }\n        } else if (parent && cols.indexOf(dragField) === -1) {\n          cols.push(dragField);\n        }\n\n        _this.element.innerHTML = '';\n\n        if (cols.length && !_this.element.classList.contains('e-grouped')) {\n          _this.element.classList.add('e-grouped');\n        }\n\n        _this.reorderingColumns = cols;\n\n        for (var c = 0; c < cols.length; c++) {\n          _this.addColToGroupDrop(cols[c]);\n        }\n      } else {\n        _this.addLabel();\n\n        _this.removeColFromGroupDrop(dragField);\n      }\n    };\n\n    this.drop = function (e) {\n      var gObj = _this.parent;\n      var column = gObj.getColumnByUid(e.droppedElement.getAttribute('e-mappinguid'));\n\n      _this.element.classList.remove('e-hover');\n\n      remove(e.droppedElement);\n\n      _this.aria.setDropTarget(_this.parent.element.querySelector('.e-groupdroparea'), false);\n\n      _this.aria.setGrabbed(_this.parent.getHeaderTable().querySelector('[aria-grabbed=true]'), false);\n\n      if (isNullOrUndefined(column) || column.allowGrouping === false || parentsUntil(gObj.getColumnHeaderByUid(column.uid), 'e-grid').getAttribute('id') !== gObj.element.getAttribute('id')) {\n        _this.parent.log('action_disabled_column', {\n          moduleName: _this.getModuleName(),\n          columnName: column.headerText\n        });\n\n        return;\n      }\n\n      _this.groupColumn(column.field);\n    };\n\n    this.contentRefresh = true;\n    this.aria = new AriaService();\n    this.parent = parent;\n    this.groupSettings = groupSettings;\n    this.serviceLocator = serviceLocator;\n    this.sortedColumns = sortedColumns;\n    this.focus = serviceLocator.getService('focus');\n    this.addEventListener();\n    this.groupGenerator = new GroupModelGenerator(this.parent);\n  }\n\n  Group.prototype.addLabel = function () {\n    if (!this.element.getElementsByClassName('e-group-animator').length) {\n      var dragLabel = this.l10n.getConstant('GroupDropArea');\n      this.element.innerHTML = dragLabel;\n      this.element.classList.remove('e-grouped');\n    }\n  };\n\n  Group.prototype.rearrangeGroup = function () {\n    this.sortRequired = false;\n    this.updateModel();\n  };\n\n  Group.prototype.columnDrag = function (e) {\n    if (this.groupSettings.allowReordering && e.column.allowGrouping) {\n      this.animateDropper(e);\n    }\n\n    var cloneElement = this.parent.element.querySelector('.e-cloneproperties');\n    classList(cloneElement, ['e-defaultcur'], ['e-notallowedcur']);\n\n    if (!parentsUntil(e.target, 'e-groupdroparea') && !(this.parent.allowReordering && parentsUntil(e.target, 'e-headercell'))) {\n      classList(cloneElement, ['e-notallowedcur'], ['e-defaultcur']);\n    }\n\n    if (e.target.classList.contains('e-groupdroparea')) {\n      this.element.classList.add('e-hover');\n    } else {\n      this.element.classList.remove('e-hover');\n    }\n  };\n\n  Group.prototype.columnDragStart = function (e) {\n    if (e.target.classList.contains('e-stackedheadercell')) {\n      return;\n    }\n\n    var dropArea = this.parent.element.querySelector('.e-groupdroparea');\n    this.aria.setDropTarget(dropArea, e.column.allowGrouping);\n    var element = e.target.classList.contains('e-headercell') ? e.target : parentsUntil(e.target, 'e-headercell');\n    this.aria.setGrabbed(element, true, !e.column.allowGrouping);\n  };\n\n  Group.prototype.columnDrop = function (e) {\n    var gObj = this.parent;\n\n    if (e.droppedElement.getAttribute('action') === 'grouping') {\n      var column = gObj.getColumnByUid(e.droppedElement.getAttribute('e-mappinguid'));\n\n      if (isNullOrUndefined(column) || column.allowGrouping === false || parentsUntil(gObj.getColumnHeaderByUid(column.uid), 'e-grid').getAttribute('id') !== gObj.element.getAttribute('id')) {\n        return;\n      }\n\n      this.ungroupColumn(column.field);\n    }\n  };\n  /**\n   * @returns {void}\n   * @hidden\n   */\n\n\n  Group.prototype.addEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.on(events.uiUpdate, this.enableAfterRender, this);\n    this.parent.on(events.groupComplete, this.onActionComplete, this);\n    this.parent.on(events.ungroupComplete, this.onActionComplete, this);\n    this.parent.on(events.inBoundModelChanged, this.onPropertyChanged, this);\n    this.parent.on(events.click, this.clickHandler, this);\n    this.parent.on(events.columnDrag, this.columnDrag, this);\n    this.parent.on(events.columnDragStart, this.columnDragStart, this);\n    this.parent.on(events.headerDrop, this.columnDrop, this);\n    this.parent.on(events.columnDrop, this.columnDrop, this);\n    this.parent.on(events.headerRefreshed, this.refreshSortIcons, this);\n    this.parent.on(events.sortComplete, this.refreshSortIcons, this);\n    this.parent.on(events.keyPressed, this.keyPressHandler, this);\n    this.parent.on(events.contentReady, this.initialEnd, this);\n    this.parent.on(events.onEmpty, this.initialEnd, this);\n    this.parent.on(events.initialEnd, this.render, this);\n    this.parent.on(events.groupAggregates, this.onGroupAggregates, this);\n    this.parent.on(events.destroy, this.destroy, this);\n    this.parent.on('group-expand-collapse', this.updateExpand, this);\n    this.parent.on('persist-data-changed', this.initialEnd, this);\n  };\n  /**\n   * @returns {void}\n   * @hidden\n   */\n\n\n  Group.prototype.removeEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.off(events.initialEnd, this.render);\n    this.parent.off(events.uiUpdate, this.enableAfterRender);\n    this.parent.off(events.groupComplete, this.onActionComplete);\n    this.parent.off(events.ungroupComplete, this.onActionComplete);\n    this.parent.off(events.inBoundModelChanged, this.onPropertyChanged);\n    this.parent.off(events.click, this.clickHandler);\n    this.parent.off(events.columnDrag, this.columnDrag);\n    this.parent.off(events.columnDragStart, this.columnDragStart);\n    this.parent.off(events.columnDrop, this.columnDrop);\n    this.parent.off(events.headerDrop, this.columnDrop);\n    this.parent.off(events.headerRefreshed, this.refreshSortIcons);\n    this.parent.off(events.sortComplete, this.refreshSortIcons);\n    this.parent.off(events.keyPressed, this.keyPressHandler);\n    this.parent.off(events.groupAggregates, this.onGroupAggregates);\n    this.parent.off(events.destroy, this.destroy);\n    this.parent.off('group-expand-collapse', this.updateExpand);\n  };\n\n  Group.prototype.initialEnd = function () {\n    var gObj = this.parent;\n    this.parent.off(events.contentReady, this.initialEnd);\n    this.parent.off(events.onEmpty, this.initialEnd);\n\n    if (this.parent.getColumns().length && this.groupSettings.columns.length) {\n      this.contentRefresh = false;\n\n      for (var _i = 0, _a = gObj.groupSettings.columns; _i < _a.length; _i++) {\n        var col = _a[_i];\n        this.groupColumn(col);\n      }\n\n      this.contentRefresh = true;\n    }\n  };\n\n  Group.prototype.keyPressHandler = function (e) {\n    var gObj = this.parent;\n\n    if (e.target && parentsUntil(e.target, 'e-groupheadercell') && (e.action === 'tab' || e.action === 'shiftTab')) {\n      var focusableGroupedItems = this.getFocusableGroupedItems();\n\n      if (e.action === 'tab' && e.target === focusableGroupedItems[focusableGroupedItems.length - 1] || e.action === 'shiftTab' && e.target === focusableGroupedItems[0]) {\n        return;\n      }\n\n      for (var i = 0; i < focusableGroupedItems.length; i++) {\n        if (e.target === focusableGroupedItems[i]) {\n          e.preventDefault();\n          var index = e.action === 'tab' ? i + 1 : i - 1;\n          focusableGroupedItems[index].focus();\n          return;\n        }\n      }\n    }\n\n    if (e.action !== 'ctrlSpace' && (!this.groupSettings.columns.length || ['altDownArrow', 'altUpArrow', 'ctrlDownArrow', 'ctrlUpArrow', 'enter'].indexOf(e.action) === -1)) {\n      return;\n    }\n\n    e.preventDefault();\n\n    switch (e.action) {\n      case 'altDownArrow':\n      case 'altUpArrow':\n        // eslint-disable-next-line no-case-declarations\n        var selected = gObj.allowSelection ? gObj.getSelectedRowIndexes() : [];\n\n        if (selected.length) {\n          var rows = gObj.getContentTable().querySelector(literals.tbody).children;\n          var dataRow = gObj.getDataRows()[selected[selected.length - 1]];\n          var grpRow = void 0;\n\n          for (var i = dataRow.rowIndex; i >= 0; i--) {\n            if (!rows[i].classList.contains(literals.row) && !rows[i].classList.contains('e-detailrow')) {\n              grpRow = rows[i];\n              break;\n            }\n          }\n\n          this.expandCollapseRows(grpRow.querySelector(e.action === 'altUpArrow' ? '.e-recordplusexpand' : '.e-recordpluscollapse'));\n        }\n\n        break;\n\n      case 'ctrlDownArrow':\n        this.expandAll();\n        break;\n\n      case 'ctrlUpArrow':\n        this.collapseAll();\n        break;\n\n      case 'enter':\n        if (e.target.classList.contains('e-groupsort')) {\n          this.groupSortFocus = true;\n          this.applySortFromTarget(e.target);\n          break;\n        } else if (e.target.classList.contains('e-ungroupbutton')) {\n          this.groupCancelFocus = true;\n          this.unGroupFromTarget(e.target);\n          break;\n        }\n\n        if (this.parent.isEdit || closest(e.target, '#' + this.parent.element.id + '_searchbar') !== null || parentsUntil(e.target, 'e-pager')) {\n          return;\n        } // eslint-disable-next-line no-case-declarations\n\n\n        var element = this.focus.getFocusedElement();\n\n        if (element.classList.contains('e-icon-grightarrow') || element.classList.contains('e-icon-gdownarrow')) {\n          element = element.parentElement;\n        } // eslint-disable-next-line no-case-declarations\n\n\n        var row = element ? element.parentElement.querySelector('[class^=\"e-record\"]') : null;\n\n        if (!row) {\n          break;\n        }\n\n        this.expandCollapseRows(row);\n        break;\n\n      case 'ctrlSpace':\n        // eslint-disable-next-line no-case-declarations\n        var elem = gObj.focusModule.currentInfo.element;\n\n        if (elem && elem.classList.contains('e-headercell')) {\n          var column = gObj.getColumnByUid(elem.firstElementChild.getAttribute('e-mappinguid'));\n\n          if (column.field && gObj.groupSettings.columns.indexOf(column.field) < 0) {\n            this.groupColumn(column.field);\n          } else {\n            this.ungroupColumn(column.field);\n          }\n        }\n\n        break;\n    }\n  };\n  /**\n   * @returns {Element[]} - Return the focusable grouping items\n   * @hidden */\n\n\n  Group.prototype.getFocusableGroupedItems = function () {\n    var focusableGroupedItems = [];\n\n    if (this.groupSettings.columns.length) {\n      var focusableGroupedHeaderItems = this.element.querySelectorAll('.e-groupheadercell');\n\n      for (var i = 0; i < focusableGroupedHeaderItems.length; i++) {\n        focusableGroupedItems.push(focusableGroupedHeaderItems[i].querySelector('.e-grouptext'));\n        focusableGroupedItems.push(focusableGroupedHeaderItems[i].querySelector('.e-groupsort'));\n        focusableGroupedItems.push(focusableGroupedHeaderItems[i].querySelector('.e-ungroupbutton'));\n      }\n    }\n\n    return focusableGroupedItems;\n  };\n\n  Group.prototype.wireEvent = function () {\n    EventHandler.add(this.element, 'focusin', this.onFocusIn, this);\n    EventHandler.add(this.element, 'focusout', this.onFocusOut, this);\n  };\n\n  Group.prototype.unWireEvent = function () {\n    EventHandler.remove(this.element, 'focusin', this.onFocusIn);\n    EventHandler.remove(this.element, 'focusout', this.onFocusOut);\n  };\n\n  Group.prototype.onFocusIn = function (e) {\n    if (this.parent.focusModule.currentInfo && this.parent.focusModule.currentInfo.element) {\n      removeClass([this.parent.focusModule.currentInfo.element, this.parent.focusModule.currentInfo.elementToFocus], ['e-focused', 'e-focus']);\n      this.parent.focusModule.currentInfo.element.tabIndex = -1;\n    }\n\n    this.addOrRemoveFocus(e);\n  };\n\n  Group.prototype.onFocusOut = function (e) {\n    this.addOrRemoveFocus(e);\n  };\n\n  Group.prototype.addOrRemoveFocus = function (e) {\n    if (e.target.classList.contains('e-groupdroparea') || e.target.classList.contains('e-grouptext') || e.target.classList.contains('e-groupsort') || e.target.classList.contains('e-ungroupbutton')) {\n      var target = e.target.classList.contains('e-grouptext') ? e.target.parentElement.parentElement : e.target;\n\n      if (e.type === 'focusin') {\n        addClass([target], ['e-focused', 'e-focus']);\n        target.tabIndex = 0;\n      } else {\n        removeClass([target], ['e-focused', 'e-focus']);\n        target.tabIndex = -1;\n      }\n    }\n  };\n\n  Group.prototype.clickHandler = function (e) {\n    if (e.target.classList.contains('e-groupsort')) {\n      this.groupSortFocus = true;\n    }\n\n    if (e.target.classList.contains('e-ungroupbutton')) {\n      this.groupCancelFocus = true;\n    }\n\n    this.expandCollapseRows(e.target);\n    this.applySortFromTarget(e.target);\n    this.unGroupFromTarget(e.target);\n    this.toogleGroupFromHeader(e.target);\n  };\n\n  Group.prototype.unGroupFromTarget = function (target) {\n    if (target.classList.contains('e-ungroupbutton')) {\n      this.ungroupColumn(target.parentElement.getAttribute('ej-mappingname'));\n    }\n  };\n\n  Group.prototype.toogleGroupFromHeader = function (target) {\n    if (this.groupSettings.showToggleButton) {\n      if (target.classList.contains('e-grptogglebtn')) {\n        if (target.classList.contains('e-toggleungroup')) {\n          this.ungroupColumn(this.parent.getColumnByUid(target.parentElement.getAttribute('e-mappinguid')).field);\n        } else {\n          this.groupColumn(this.parent.getColumnByUid(target.parentElement.getAttribute('e-mappinguid')).field);\n        }\n      } else {\n        if (target.classList.contains('e-toggleungroup')) {\n          this.ungroupColumn(target.parentElement.getAttribute('ej-mappingname'));\n        }\n      }\n    }\n  };\n\n  Group.prototype.applySortFromTarget = function (target) {\n    var gObj = this.parent;\n    var gHeader = closest(target, '.e-groupheadercell');\n\n    if (gObj.allowSorting && gHeader && !target.classList.contains('e-ungroupbutton') && !target.classList.contains('e-toggleungroup')) {\n      var field = gHeader.firstElementChild.getAttribute('ej-mappingname');\n\n      if (gObj.getColumnHeaderByField(field).getElementsByClassName('e-ascending').length) {\n        gObj.sortColumn(field, 'Descending', true);\n      } else {\n        gObj.sortColumn(field, 'Ascending', true);\n      }\n    }\n  };\n  /**\n   * Expands or collapses grouped rows by target element.\n   *\n   * @param  {Element} target - Defines the target element of the grouped row.\n   * @returns {void}\n   */\n\n\n  Group.prototype.expandCollapseRows = function (target) {\n    var trgt = parentsUntil(target, 'e-recordplusexpand') || parentsUntil(target, 'e-recordpluscollapse');\n\n    if (trgt) {\n      var rowNodes = this.parent.getContentTable().querySelector(literals.tbody).children;\n      var isHide = void 0;\n      var dataManager = void 0;\n      var query = void 0;\n      var gObj = this.parent;\n      var indent = trgt.parentElement.getElementsByClassName('e-indentcell').length;\n      var uid = trgt.parentElement.getAttribute('data-uid');\n      var captionRow = gObj.getRowObjectFromUID(uid);\n      var expand = false;\n\n      if (trgt.classList.contains('e-recordpluscollapse')) {\n        addClass([trgt], 'e-recordplusexpand');\n        removeClass([trgt], 'e-recordpluscollapse');\n        trgt.firstElementChild.className = 'e-icons e-gdiagonaldown e-icon-gdownarrow';\n        trgt.firstElementChild.setAttribute('title', 'expanded');\n        expand = true;\n        captionRow.isExpand = true;\n\n        if (isGroupAdaptive(gObj)) {\n          this.updateVirtualRows(gObj, target, expand, query, dataManager);\n        }\n\n        if (this.parent.groupSettings.enableLazyLoading) {\n          this.parent.contentModule.captionExpand(trgt.parentElement);\n        }\n      } else {\n        isHide = true;\n        captionRow.isExpand = false;\n        removeClass([trgt], 'e-recordplusexpand');\n        addClass([trgt], 'e-recordpluscollapse');\n        trgt.firstElementChild.className = 'e-icons e-gnextforward e-icon-grightarrow';\n        trgt.firstElementChild.setAttribute('title', 'collapsed');\n\n        if (isGroupAdaptive(gObj)) {\n          this.updateVirtualRows(gObj, target, !isHide, query, dataManager);\n        }\n\n        if (this.parent.groupSettings.enableLazyLoading) {\n          this.parent.contentModule.captionCollapse(trgt.parentElement);\n        }\n      }\n\n      this.aria.setExpand(trgt, expand);\n\n      if (!isGroupAdaptive(gObj) && !this.parent.groupSettings.enableLazyLoading) {\n        var rowObjs = gObj.getRowsObject();\n        var startIdx = rowObjs.indexOf(captionRow);\n        var rowsState = {};\n        var cacheStartIdx = gObj.enableInfiniteScrolling && gObj.infiniteScrollSettings && gObj.infiniteScrollSettings.enableCache && rowObjs.length !== rowNodes.length ? Array.from(rowNodes).indexOf(trgt.parentElement) : undefined;\n\n        for (var i = startIdx; i < rowObjs.length; i++) {\n          if (i > startIdx && rowObjs[i].indent === indent) {\n            break;\n          }\n\n          if (rowObjs[i].isDetailRow) {\n            var visible = rowObjs[i - 1].isExpand && rowObjs[i - 1].visible;\n\n            if (cacheStartIdx && cacheStartIdx > 0 && cacheStartIdx < rowNodes.length) {\n              rowNodes[cacheStartIdx].style.display = visible ? '' : 'none';\n            } else if (isNullOrUndefined(cacheStartIdx)) {\n              rowNodes[i].style.display = visible ? '' : 'none';\n            }\n          } else if (rowsState[rowObjs[i].parentUid] === false) {\n            rowObjs[i].visible = false;\n\n            if (cacheStartIdx && cacheStartIdx > 0 && cacheStartIdx < rowNodes.length) {\n              rowNodes[cacheStartIdx].style.display = 'none';\n            } else if (isNullOrUndefined(cacheStartIdx)) {\n              rowNodes[i].style.display = 'none';\n            }\n          } else {\n            if (!(rowObjs[i].isDataRow || rowObjs[i].isCaptionRow || rowObjs[i].isDetailRow || rowObjs[i].isAggregateRow)) {\n              var visible = rowObjs[i].cells.some(function (cell) {\n                return cell.isDataCell && cell.visible;\n              });\n\n              if (visible === rowObjs[i].visible) {\n                continue;\n              }\n            }\n\n            rowObjs[i].visible = true;\n\n            if (cacheStartIdx && cacheStartIdx > 0 && cacheStartIdx < rowNodes.length) {\n              rowNodes[cacheStartIdx].style.display = '';\n              rowNodes[cacheStartIdx].classList.remove('e-hide');\n            } else if (isNullOrUndefined(cacheStartIdx)) {\n              rowNodes[i].style.display = '';\n              rowNodes[i].classList.remove('e-hide');\n            }\n          }\n\n          if (rowObjs[i].isCaptionRow) {\n            rowsState[rowObjs[i].uid] = rowObjs[i].isExpand && rowObjs[i].visible;\n          }\n\n          if (!isNullOrUndefined(cacheStartIdx)) {\n            cacheStartIdx++;\n          }\n        }\n\n        this.parent.notify(events.refreshExpandandCollapse, {\n          rows: this.parent.getRowsObject()\n        });\n      }\n\n      this.parent.notify(events.captionActionComplete, {\n        isCollapse: isHide,\n        parentUid: uid\n      });\n    }\n  };\n\n  Group.prototype.updateVirtualRows = function (gObj, target, isExpand, query, dataManager) {\n    var rObj = gObj.getRowObjectFromUID(target.closest('tr').getAttribute('data-uid'));\n    rObj.isExpand = isExpand;\n    updatecloneRow(gObj);\n    this.parent.notify(events.refreshVirtualMaxPage, {});\n    query = gObj.getDataModule().generateQuery(false);\n    query.queries = gObj.getDataModule().aggregateQuery(gObj.getQuery().clone()).queries;\n    var args = {\n      requestType: 'virtualscroll',\n      rowObject: rObj\n    };\n\n    if (gObj.contentModule) {\n      args.virtualInfo = gObj.contentModule.prevInfo;\n    }\n\n    dataManager = gObj.getDataModule().getData(args, query.requiresCount());\n    dataManager.then(function (e) {\n      return gObj.renderModule.dataManagerSuccess(e, args);\n    });\n  };\n\n  Group.prototype.expandCollapse = function (isExpand) {\n    if (!this.parent.groupSettings.columns.length) {\n      return;\n    }\n\n    if (!isExpand) {\n      this.parent.notify(events.initialCollapse, isExpand);\n    }\n\n    var rowNodes = this.parent.getContentTable().querySelector(literals.tbody).children;\n    var rowObjs = this.parent.getRowsObject();\n    var row;\n\n    for (var i = 0, len = rowNodes.length; i < len; i++) {\n      if (rowNodes[i].querySelectorAll('.e-recordplusexpand, .e-recordpluscollapse').length) {\n        row = rowNodes[i].querySelector(isExpand ? '.e-recordpluscollapse' : '.e-recordplusexpand');\n\n        if (row) {\n          row.className = isExpand ? 'e-recordplusexpand' : 'e-recordpluscollapse';\n          row.firstElementChild.className = isExpand ? 'e-icons e-gdiagonaldown e-icon-gdownarrow' : 'e-icons e-gnextforward e-icon-grightarrow';\n        }\n\n        if (!(rowNodes[i].firstElementChild.classList.contains('e-recordplusexpand') || rowNodes[i].firstElementChild.classList.contains('e-recordpluscollapse'))) {\n          rowNodes[i].style.display = isExpand ? '' : 'none';\n        }\n      } else {\n        rowNodes[i].style.display = isExpand ? '' : 'none';\n      }\n\n      if (rowObjs[i].isCaptionRow) {\n        rowObjs[i].isExpand = isExpand ? true : false;\n      }\n    }\n\n    this.parent.updateVisibleExpandCollapseRows();\n    this.parent.notify(events.refreshExpandandCollapse, {\n      rows: this.parent.getRowsObject()\n    });\n  };\n  /**\n   * Expands all the grouped rows of the Grid.\n   *\n   * @returns {void}\n   */\n\n\n  Group.prototype.expandAll = function () {\n    this.expandCollapse(true);\n  };\n  /**\n   * Collapses all the grouped rows of the Grid.\n   *\n   * @returns {void}\n   */\n\n\n  Group.prototype.collapseAll = function () {\n    this.expandCollapse(false);\n  };\n  /**\n   * The function is used to render grouping\n   *\n   * @returns {void}\n   * @hidden\n   */\n\n\n  Group.prototype.render = function () {\n    this.l10n = this.serviceLocator.getService('localization');\n    this.renderGroupDropArea();\n    this.initDragAndDrop();\n    this.refreshToggleBtn();\n    this.wireEvent();\n  };\n\n  Group.prototype.renderGroupDropArea = function () {\n    var groupElem = this.parent.element.querySelector('.e-groupdroparea');\n\n    if (groupElem) {\n      remove(groupElem);\n    }\n\n    this.element = this.parent.createElement('div', {\n      className: 'e-groupdroparea',\n      attrs: {\n        'tabindex': '-1'\n      }\n    });\n\n    if (this.groupSettings.allowReordering) {\n      this.element.classList.add('e-group-animate');\n    }\n\n    this.updateGroupDropArea();\n    this.parent.element.insertBefore(this.element, this.parent.element.firstChild);\n\n    if (!this.groupSettings.showDropArea) {\n      this.element.style.display = 'none';\n    }\n  };\n\n  Group.prototype.updateGroupDropArea = function (clear) {\n    if (this.groupSettings.showDropArea && !this.groupSettings.columns.length) {\n      var dragLabel = this.l10n.getConstant('GroupDropArea');\n      this.element.innerHTML = dragLabel;\n      this.element.classList.remove('e-grouped');\n    } else {\n      if (this.element.innerHTML === this.l10n.getConstant('GroupDropArea') && (this.groupSettings.columns.length === 1 || !this.isAppliedGroup && !this.isAppliedUnGroup) || clear) {\n        this.element.innerHTML = '';\n      }\n\n      this.element.classList.add('e-grouped');\n    }\n  };\n\n  Group.prototype.initDragAndDrop = function () {\n    this.initializeGHeaderDrop();\n    this.initializeGHeaderDrag();\n  };\n\n  Group.prototype.initializeGHeaderDrag = function () {\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    var drag = new Draggable(this.element, {\n      dragTarget: this.groupSettings.allowReordering ? '.e-drag' : '.e-groupheadercell',\n      distance: this.groupSettings.allowReordering ? -10 : 5,\n      helper: this.helper,\n      dragStart: this.dragStart,\n      drag: this.drag,\n      dragStop: this.dragStop\n    });\n  };\n\n  Group.prototype.initializeGHeaderDrop = function () {\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    var drop = new Droppable(this.element, {\n      accept: '.e-dragclone',\n      drop: this.drop\n    });\n  };\n  /**\n   * Groups a column by column name.\n   *\n   * @param  {string} columnName - Defines the column name to group.\n   * @returns {void}\n   */\n\n\n  Group.prototype.groupColumn = function (columnName) {\n    var gObj = this.parent;\n    var column = gObj.getColumnByField(columnName);\n\n    if (isNullOrUndefined(column) || column.allowGrouping === false || this.contentRefresh && this.groupSettings.columns.indexOf(columnName) > -1) {\n      this.parent.log('action_disabled_column', {\n        moduleName: this.getModuleName(),\n        columnName: column.headerText\n      });\n      return;\n    }\n\n    if (isActionPrevent(gObj)) {\n      gObj.notify(events.preventBatch, {\n        instance: this,\n        handler: this.groupColumn,\n        arg1: columnName\n      });\n      return;\n    }\n\n    column.visible = gObj.groupSettings.showGroupedColumn;\n    this.colName = columnName;\n    this.isAppliedGroup = true;\n\n    if (this.contentRefresh) {\n      this.updateModel();\n    } else {\n      this.addColToGroupDrop(columnName);\n    }\n\n    this.updateGroupDropArea();\n    this.isAppliedGroup = false;\n  };\n  /**\n   * Ungroups a column by column name.\n   *\n   * @param  {string} columnName - Defines the column name to ungroup.\n   * @returns {void}\n   */\n\n\n  Group.prototype.ungroupColumn = function (columnName) {\n    var gObj = this.parent;\n    var column = this.parent.enableColumnVirtualization ? this.parent.columns.filter(function (c) {\n      return c.field === columnName;\n    })[0] : gObj.getColumnByField(columnName);\n\n    if (isNullOrUndefined(column) || column.allowGrouping === false || this.groupSettings.columns.indexOf(columnName) < 0) {\n      return;\n    }\n\n    if (isActionPrevent(gObj)) {\n      gObj.notify(events.preventBatch, {\n        instance: this,\n        handler: this.ungroupColumn,\n        arg1: columnName\n      });\n      return;\n    }\n\n    column.visible = true;\n    this.colName = column.field;\n    var columns = JSON.parse(JSON.stringify(this.groupSettings.columns));\n    columns.splice(columns.indexOf(this.colName), 1);\n\n    if (this.sortedColumns.indexOf(columnName) < 0) {\n      for (var i = 0, len = gObj.sortSettings.columns.length; i < len; i++) {\n        if (columnName === gObj.sortSettings.columns[i].field) {\n          gObj.sortSettings.columns.splice(i, 1);\n          break;\n        }\n      }\n    }\n\n    if (this.groupSettings.allowReordering) {\n      this.reorderingColumns = columns;\n    }\n\n    this.groupSettings.columns = columns;\n\n    if (gObj.allowGrouping) {\n      this.isAppliedUnGroup = true;\n      this.parent.dataBind();\n    }\n  };\n  /**\n   * The function used to update groupSettings\n   *\n   * @returns {void}\n   * @hidden\n   */\n\n\n  Group.prototype.updateModel = function () {\n    var columns = JSON.parse(JSON.stringify(this.groupSettings.columns));\n    columns = this.reorderingColumns.length ? JSON.parse(JSON.stringify(this.reorderingColumns)) : columns;\n\n    if (this.sortRequired) {\n      if (columns.indexOf(this.colName) === -1) {\n        columns.push(this.colName);\n      }\n\n      this.groupAddSortingQuery(this.colName);\n    }\n\n    this.sortRequired = true;\n    this.parent.groupSettings.columns = columns;\n    this.parent.dataBind();\n  };\n  /**\n   * The function used to trigger onActionComplete\n   *\n   * @param {NotifyArgs} e - specifies the NotifyArgs\n   * @returns {void}\n   * @hidden\n   */\n\n\n  Group.prototype.onActionComplete = function (e) {\n    if (e.requestType === 'grouping') {\n      this.addColToGroupDrop(this.colName);\n    } else {\n      this.removeColFromGroupDrop(this.colName);\n    }\n\n    var args = this.groupSettings.columns.indexOf(this.colName) > -1 ? {\n      columnName: this.colName,\n      requestType: 'grouping',\n      type: events.actionComplete\n    } : {\n      requestType: 'ungrouping',\n      type: events.actionComplete\n    };\n    this.parent.trigger(events.actionComplete, extend(e, args));\n    this.colName = null;\n  };\n\n  Group.prototype.groupAddSortingQuery = function (colName) {\n    var i = 0;\n\n    while (i < this.parent.sortSettings.columns.length) {\n      if (this.parent.sortSettings.columns[i].field === colName) {\n        break;\n      }\n\n      i++;\n    }\n\n    if (this.parent.sortSettings.columns.length === i) {\n      this.parent.sortSettings.columns.push({\n        field: colName,\n        direction: 'Ascending',\n        isFromGroup: true\n      });\n    } else if (!this.parent.allowSorting) {\n      this.parent.sortSettings.columns[i].direction = 'Ascending';\n    }\n  };\n\n  Group.prototype.createElement = function (field) {\n    var gObj = this.parent;\n    var direction = 'Ascending';\n    var animator = this.parent.createElement('div', {\n      className: 'e-grid-icon e-group-animator'\n    });\n    var groupedColumn = this.parent.createElement('div', {\n      className: 'e-grid-icon e-groupheadercell'\n    });\n    var childDiv = this.parent.createElement('div', {\n      attrs: {\n        'ej-mappingname': field\n      }\n    });\n\n    if (isComplexField(field)) {\n      childDiv.setAttribute('ej-complexname', getComplexFieldID(field));\n    }\n\n    var column = this.parent.getColumnByField(field); //Todo headerTemplateID for grouped column, disableHtmlEncode\n\n    var headerCell = gObj.getColumnHeaderByUid(column.uid); // if (!isNullOrUndefined(column.headerTemplate)) {\n    //     if (column.headerTemplate.indexOf('#') !== -1) {\n    //         childDiv.innerHTML = document.querySelector(column.headerTemplate).innerHTML.trim();\n    //     } else {\n    //         childDiv.innerHTML = column.headerTemplate;\n    //     }\n    //     childDiv.firstElementChild.classList.add('e-grouptext');\n    // } else {\n\n    if (this.groupSettings.allowReordering) {\n      childDiv.appendChild(this.parent.createElement('span', {\n        className: 'e-drag e-icons e-icon-drag',\n        innerHTML: '&nbsp;',\n        attrs: {\n          title: 'Drag',\n          tabindex: '-1',\n          'aria-label': 'Drag the grouped column'\n        }\n      }));\n    }\n\n    childDiv.appendChild(this.parent.createElement('span', {\n      className: 'e-grouptext',\n      innerHTML: column.headerText,\n      attrs: {\n        tabindex: '-1',\n        'aria-label': 'sort the grouped column'\n      }\n    })); // }\n\n    if (this.groupSettings.showToggleButton) {\n      childDiv.appendChild(this.parent.createElement('span', {\n        className: 'e-togglegroupbutton e-icons e-icon-ungroup e-toggleungroup',\n        innerHTML: '&nbsp;',\n        attrs: {\n          tabindex: '-1',\n          'aria-label': 'ungroup button'\n        }\n      }));\n    }\n\n    if (headerCell.querySelectorAll('.e-ascending,.e-descending').length) {\n      direction = headerCell.querySelector('.e-ascending') ? 'Ascending' : 'Descending';\n    }\n\n    childDiv.appendChild(this.parent.createElement('span', {\n      className: 'e-groupsort e-icons ' + ('e-' + direction.toLowerCase() + ' e-icon-' + direction.toLowerCase()),\n      innerHTML: '&nbsp;',\n      attrs: {\n        tabindex: '-1',\n        'aria-label': 'sort the grouped column',\n        role: 'button'\n      }\n    }));\n    childDiv.appendChild(this.parent.createElement('span', {\n      className: 'e-ungroupbutton e-icons e-icon-hide',\n      innerHTML: '&nbsp;',\n      attrs: {\n        title: this.l10n.getConstant('UnGroup'),\n        tabindex: '-1',\n        'aria-label': 'ungroup the grouped column',\n        role: 'button'\n      },\n      styles: this.groupSettings.showUngroupButton ? '' : 'display:none'\n    }));\n    groupedColumn.appendChild(childDiv);\n\n    if (this.groupSettings.allowReordering) {\n      animator.appendChild(groupedColumn);\n      animator.appendChild(this.createSeparator());\n      groupedColumn = animator;\n    }\n\n    return groupedColumn;\n  };\n\n  Group.prototype.addColToGroupDrop = function (field) {\n    var groupElem = isComplexField(field) ? this.parent.element.querySelector('.e-groupdroparea div[ej-complexname=' + getComplexFieldID(field) + ']') : this.parent.element.querySelector('.e-groupdroparea div[ej-mappingname=' + field + ']');\n\n    if (this.groupSettings.allowReordering && groupElem) {\n      return;\n    }\n\n    var column = this.parent.getColumnByField(field);\n\n    if (isNullOrUndefined(column)) {\n      return;\n    }\n\n    var groupedColumn = this.createElement(field);\n\n    if (this.groupSettings.allowReordering) {\n      var index = this.element.getElementsByClassName('e-group-animator').length;\n      groupedColumn.setAttribute('index', index.toString());\n    }\n\n    this.element.appendChild(groupedColumn); //Todo:  rtl\n  };\n\n  Group.prototype.createSeparator = function () {\n    return this.parent.createElement('span', {\n      className: 'e-nextgroup e-icons e-icon-next',\n      innerHTML: '&nbsp;',\n      attrs: {\n        tabindex: '-1',\n        'aria-label': 'Separator for the grouped columns'\n      },\n      styles: this.groupSettings.showUngroupButton ? '' : 'display:none'\n    });\n  };\n\n  Group.prototype.refreshToggleBtn = function (isRemove) {\n    if (this.groupSettings.showToggleButton) {\n      var headers = [].slice.call(this.parent.getHeaderTable().getElementsByClassName('e-headercelldiv'));\n\n      for (var i = 0, len = headers.length; i < len; i++) {\n        if (!(headers[i].classList.contains('e-emptycell') || headers[i].classList.contains('e-headerchkcelldiv'))) {\n          var column = this.parent.getColumnByUid(headers[i].getAttribute('e-mappinguid'));\n\n          if (!this.parent.showColumnMenu || this.parent.showColumnMenu && !column.showColumnMenu) {\n            if (headers[i].getElementsByClassName('e-grptogglebtn').length) {\n              remove(headers[i].querySelectorAll('.e-grptogglebtn')[0]);\n            }\n\n            if (!isRemove) {\n              headers[i].appendChild(this.parent.createElement('span', {\n                className: 'e-grptogglebtn e-icons ' + (this.groupSettings.columns.indexOf(column.field) > -1 ? 'e-toggleungroup e-icon-ungroup' : 'e-togglegroup e-icon-group'),\n                attrs: {\n                  tabindex: '-1',\n                  'aria-label': 'Group button'\n                }\n              }));\n            }\n          }\n        }\n      }\n    }\n  };\n\n  Group.prototype.removeColFromGroupDrop = function (field) {\n    if (!isNullOrUndefined(this.getGHeaderCell(field))) {\n      var elem = this.getGHeaderCell(field);\n\n      if (this.groupSettings.allowReordering) {\n        var parent_1 = parentsUntil(elem, 'e-group-animator');\n        remove(parent_1);\n      } else {\n        remove(elem);\n      }\n\n      this.updateGroupDropArea();\n    }\n\n    this.isAppliedUnGroup = false;\n  };\n\n  Group.prototype.onPropertyChanged = function (e) {\n    if (e.module !== this.getModuleName()) {\n      return;\n    }\n\n    for (var _i = 0, _a = Object.keys(e.properties); _i < _a.length; _i++) {\n      var prop = _a[_i];\n\n      switch (prop) {\n        case 'columns':\n          // eslint-disable-next-line no-case-declarations\n          var args = void 0;\n\n          if (this.contentRefresh) {\n            if (!this.isAppliedUnGroup) {\n              if (!this.isAppliedGroup) {\n                this.updateGroupDropArea(true);\n\n                for (var j = 0; j < this.parent.sortSettings.columns.length; j++) {\n                  if (this.parent.sortSettings.columns[j].isFromGroup) {\n                    this.parent.sortSettings.columns.splice(j, 1);\n                    j--;\n                  }\n                }\n\n                for (var i = 0; i < this.groupSettings.columns.length; i++) {\n                  this.colName = this.groupSettings.columns[i];\n                  var col = this.parent.getColumnByField(this.colName);\n                  col.visible = this.parent.groupSettings.showGroupedColumn;\n                  this.groupAddSortingQuery(this.colName);\n\n                  if (i < this.groupSettings.columns.length - 1) {\n                    this.addColToGroupDrop(this.groupSettings.columns[i]);\n                  }\n                }\n              }\n\n              args = {\n                columnName: this.colName,\n                requestType: e.properties[prop].length ? 'grouping' : 'ungrouping',\n                type: events.actionBegin\n              };\n            } else {\n              args = {\n                columnName: this.colName,\n                requestType: 'ungrouping',\n                type: events.actionBegin\n              };\n            }\n\n            if (!this.groupSettings.showGroupedColumn) {\n              var columns = e.oldProperties[prop];\n\n              for (var i = 0; i < columns.length; i++) {\n                if (e.properties[prop].indexOf(columns[i]) === -1) {\n                  this.parent.getColumnByField(columns[i]).visible = true;\n                }\n              }\n            }\n\n            this.parent.notify(events.modelChanged, args);\n          }\n\n          break;\n\n        case 'showDropArea':\n          this.updateGroupDropArea();\n\n          if (this.groupSettings.showDropArea) {\n            this.element.style.display = '';\n            this.parent.headerModule.refreshUI();\n          } else {\n            this.element.style.display = 'none';\n          }\n\n          break;\n\n        case 'showGroupedColumn':\n          this.updateGroupedColumn(this.groupSettings.showGroupedColumn);\n          this.parent.notify(events.modelChanged, {\n            requestType: 'refresh'\n          });\n          break;\n\n        case 'showUngroupButton':\n          this.updateButtonVisibility(this.groupSettings.showUngroupButton, 'e-ungroupbutton');\n          break;\n\n        case 'showToggleButton':\n          this.updateButtonVisibility(this.groupSettings.showToggleButton, 'e-togglegroupbutton ');\n          this.parent.refreshHeader();\n          break;\n\n        case 'enableLazyLoading':\n          this.parent.freezeRefresh();\n          break;\n      }\n    }\n  };\n\n  Group.prototype.updateGroupedColumn = function (isVisible) {\n    for (var i = 0; i < this.groupSettings.columns.length; i++) {\n      this.parent.getColumnByField(this.groupSettings.columns[i]).visible = isVisible;\n    }\n  };\n\n  Group.prototype.updateButtonVisibility = function (isVisible, className) {\n    var gHeader = [].slice.call(this.element.getElementsByClassName(className));\n\n    for (var i = 0; i < gHeader.length; i++) {\n      gHeader[i].style.display = isVisible ? '' : 'none';\n    }\n  };\n\n  Group.prototype.enableAfterRender = function (e) {\n    if (e.module === this.getModuleName() && e.enable) {\n      this.render();\n    }\n  };\n  /**\n   * To destroy the reorder\n   *\n   * @returns {void}\n   * @hidden\n   */\n\n\n  Group.prototype.destroy = function () {\n    var gridElement = this.parent.element;\n\n    if (!gridElement || !gridElement.querySelector('.' + literals.gridHeader) && !gridElement.querySelector('.' + literals.gridContent)) {\n      return;\n    } // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n\n    if ((this.parent.isDestroyed || !this.parent.allowGrouping) && !this.parent.refreshing) {\n      this.clearGrouping();\n    }\n\n    this.unWireEvent();\n    this.removeEventListener();\n    this.refreshToggleBtn(true);\n\n    if (this.element.parentNode) {\n      remove(this.element);\n    } //call ejdrag and drop destroy\n\n  };\n  /**\n   * Clears all the grouped columns of the Grid.\n   *\n   * @returns {void}\n   */\n\n\n  Group.prototype.clearGrouping = function () {\n    var cols = JSON.parse(JSON.stringify(this.groupSettings.columns));\n    this.contentRefresh = false;\n\n    for (var i = 0, len = cols.length; i < len; i++) {\n      if (i === len - 1) {\n        this.contentRefresh = true;\n      }\n\n      this.ungroupColumn(cols[i]);\n    }\n\n    this.contentRefresh = true;\n  };\n  /**\n   * For internal use only - Get the module name.\n   *\n   * @returns {string} returns the module name\n   * @private\n   */\n\n\n  Group.prototype.getModuleName = function () {\n    return 'group';\n  };\n\n  Group.prototype.refreshSortIcons = function () {\n    var gObj = this.parent;\n    var header;\n    var cols = gObj.sortSettings.columns;\n    var gCols = gObj.groupSettings.columns;\n    var fieldNames = this.parent.getColumns().map(function (c) {\n      return c.field;\n    });\n    this.refreshToggleBtn();\n\n    for (var i = 0, len = cols.length; i < len; i++) {\n      if (fieldNames.indexOf(cols[i].field) === -1) {\n        continue;\n      }\n\n      header = gObj.getColumnHeaderByField(cols[i].field);\n\n      if (!gObj.allowSorting && (this.sortedColumns.indexOf(cols[i].field) > -1 || this.groupSettings.columns.indexOf(cols[i].field) > -1)) {\n        classList(header.querySelector('.e-sortfilterdiv'), ['e-ascending', 'e-icon-ascending'], []);\n\n        if (cols.length > 1) {\n          header.querySelector('.e-headercelldiv').appendChild(this.parent.createElement('span', {\n            className: 'e-sortnumber',\n            innerHTML: (i + 1).toString()\n          }));\n        }\n      } else if (this.getGHeaderCell(cols[i].field) && this.getGHeaderCell(cols[i].field).getElementsByClassName('e-groupsort').length) {\n        if (cols[i].direction === 'Ascending') {\n          classList(this.getGHeaderCell(cols[i].field).querySelector('.e-groupsort'), ['e-ascending', 'e-icon-ascending'], ['e-descending', 'e-icon-descending']);\n        } else {\n          classList(this.getGHeaderCell(cols[i].field).querySelector('.e-groupsort'), ['e-descending', 'e-icon-descending'], ['e-ascending', 'e-icon-ascending']);\n        }\n      }\n    }\n\n    for (var i = 0, len = gCols.length; i < len; i++) {\n      if (fieldNames.indexOf(gCols[i]) === -1) {\n        continue;\n      }\n\n      gObj.getColumnHeaderByField(gCols[i]).setAttribute('aria-grouped', 'true');\n    }\n  };\n\n  Group.prototype.getGHeaderCell = function (field) {\n    if (this.element && this.element.querySelector('[ej-mappingname=\"' + field + '\"]')) {\n      return this.element.querySelector('[ej-mappingname=\"' + field + '\"]').parentElement;\n    }\n\n    return null;\n  };\n\n  Group.prototype.onGroupAggregates = function (editedData) {\n    var aggregates = this.iterateGroupAggregates(editedData);\n    var rowData = this.groupGenerator.generateRows(aggregates, {});\n    var summaryRows = this.parent.getRowsObject().filter(function (row) {\n      return !row.isDataRow;\n    });\n    var updateSummaryRows = rowData.filter(function (data) {\n      return !data.isDataRow;\n    });\n\n    if (this.parent.isReact || this.parent.isVue) {\n      this.parent.destroyTemplate(['groupFooterTemplate', 'groupCaptionTemplate', 'footerTemplate']);\n    }\n\n    for (var i = 0; i < updateSummaryRows.length; i++) {\n      var row = updateSummaryRows[i];\n      var cells = row.cells.filter(function (cell) {\n        return cell.isDataCell;\n      });\n      var args = {\n        cells: cells,\n        data: row.data,\n        dataUid: summaryRows[i] ? summaryRows[i].uid : ''\n      };\n      this.parent.notify(events.refreshAggregateCell, args);\n    }\n  };\n\n  Group.prototype.iterateGroupAggregates = function (editedData) {\n    var updatedData = editedData instanceof Array ? editedData : [];\n    var rows = this.parent.getRowsObject();\n    var initData = this.parent.getCurrentViewRecords();\n    var deletedCols = [];\n    var changeds = rows.map(function (row) {\n      if (row.edit === 'delete') {\n        deletedCols.push(row.data);\n      }\n\n      return row.changes instanceof Object ? row.changes : row.data;\n    });\n    var field = this.parent.getPrimaryKeyFieldNames()[0];\n    changeds = updatedData.length === 0 ? changeds : updatedData;\n    var mergeData = initData.map(function (item) {\n      var pKeyVal = DataUtil.getObject(field, item);\n      var value;\n      var hasVal = changeds.some(function (cItem) {\n        value = cItem;\n        return pKeyVal === DataUtil.getObject(field, cItem);\n      });\n      return hasVal ? value : item;\n    });\n    var eData = editedData;\n\n    if (!(eData.type && eData.type === 'cancel') && deletedCols.length > 0) {\n      for (var i = 0; i < deletedCols.length; i++) {\n        var index = mergeData.indexOf(deletedCols[i]);\n        mergeData.splice(index, 1);\n      }\n    }\n\n    var aggregates = [];\n    var aggregateRows = this.parent.aggregates;\n\n    for (var j = 0; j < aggregateRows.length; j++) {\n      var row = aggregateRows[j];\n\n      for (var k = 0; k < row.columns.length; k++) {\n        var aggr = {};\n        var type = row.columns[k].type.toString();\n        aggr = {\n          type: type.toLowerCase(),\n          field: row.columns[k].field\n        };\n        aggregates.push(aggr);\n      }\n    }\n\n    var result;\n    var aggrds;\n    var groupedCols = this.parent.groupSettings.columns;\n\n    for (var l = 0; l < groupedCols.length; l++) {\n      aggrds = result ? result : mergeData;\n      result = DataUtil.group(aggrds, groupedCols[l], aggregates, null, null);\n    }\n\n    return result;\n  };\n\n  Group.prototype.updateExpand = function (args) {\n    var uid = args.uid;\n    var isExpand = args.isExpand;\n    var rows = this.parent.getRowsObject();\n\n    for (var i = 0; i < rows.length; i++) {\n      var row = rows[i];\n\n      if (row.uid === uid || isNullOrUndefined(uid)) {\n        row.isExpand = isExpand;\n\n        var _loop_1 = function (j) {\n          var childRow = rows[j];\n          var closestParent = void 0;\n\n          if (childRow.parentUid !== row.uid) {\n            closestParent = rows.filter(function (x) {\n              return x.uid === childRow.parentUid;\n            })[0];\n          }\n\n          if (childRow.parentUid === row.uid) {\n            childRow.visible = row.isExpand;\n          } else if (!isNullOrUndefined(closestParent) && childRow.parentUid === closestParent.uid) {\n            if (closestParent.isExpand && closestParent.visible === true) {\n              childRow.visible = true;\n            } else if (closestParent.isExpand && closestParent.visible === false) {\n              childRow.visible = false;\n            }\n          }\n\n          if (isNullOrUndefined(uid)) {\n            return \"break\";\n          }\n        };\n\n        for (var j = i + 1; j < rows.length; j++) {\n          var state_1 = _loop_1(j);\n\n          if (state_1 === \"break\") break;\n        }\n      }\n    }\n\n    this.parent.notify(events.contentReady, {\n      rows: rows,\n      args: {\n        isFrozen: false,\n        rows: rows\n      }\n    });\n  };\n\n  return Group;\n}();\n\nexport { Group };","map":{"version":3,"names":["Draggable","Droppable","EventHandler","createElement","closest","remove","classList","addClass","removeClass","isNullOrUndefined","extend","parentsUntil","isActionPrevent","isGroupAdaptive","updatecloneRow","getComplexFieldID","isComplexField","events","AriaService","GroupModelGenerator","DataUtil","literals","Group","parent","groupSettings","sortedColumns","serviceLocator","_this","sortRequired","groupSortFocus","groupCancelFocus","isAppliedGroup","isAppliedUnGroup","reorderingColumns","visualElement","className","styles","attrs","action","helper","e","gObj","target","sender","element","contains","allowReordering","column","getColumnByField","firstElementChild","getAttribute","textContent","style","width","offsetWidth","height","offsetHeight","setAttribute","uid","appendChild","dragStart","add","drag","animateDropper","cloneElement","querySelector","trigger","columnDrag","draggableType","gridContent","dragStop","preventDrop","rearrangeGroup","field","getColumnByUid","columns","indexOf","ungroupColumn","dragField","dropTarget","grouped","slice","call","getElementsByClassName","map","cols","JSON","parse","stringify","dropField","dropIndex","dragIndex","splice","flag","push","innerHTML","length","c","addColToGroupDrop","addLabel","removeColFromGroupDrop","drop","droppedElement","aria","setDropTarget","setGrabbed","getHeaderTable","allowGrouping","getColumnHeaderByUid","log","moduleName","getModuleName","columnName","headerText","groupColumn","contentRefresh","focus","getService","addEventListener","groupGenerator","prototype","dragLabel","l10n","getConstant","updateModel","columnDragStart","dropArea","columnDrop","isDestroyed","on","uiUpdate","enableAfterRender","groupComplete","onActionComplete","ungroupComplete","inBoundModelChanged","onPropertyChanged","click","clickHandler","headerDrop","headerRefreshed","refreshSortIcons","sortComplete","keyPressed","keyPressHandler","contentReady","initialEnd","onEmpty","render","groupAggregates","onGroupAggregates","destroy","updateExpand","removeEventListener","off","getColumns","_i","_a","col","focusableGroupedItems","getFocusableGroupedItems","i","preventDefault","index","selected","allowSelection","getSelectedRowIndexes","rows","getContentTable","tbody","children","dataRow","getDataRows","grpRow","rowIndex","row","expandCollapseRows","expandAll","collapseAll","applySortFromTarget","unGroupFromTarget","isEdit","id","getFocusedElement","parentElement","elem","focusModule","currentInfo","focusableGroupedHeaderItems","querySelectorAll","wireEvent","onFocusIn","onFocusOut","unWireEvent","elementToFocus","tabIndex","addOrRemoveFocus","type","toogleGroupFromHeader","showToggleButton","gHeader","allowSorting","getColumnHeaderByField","sortColumn","trgt","rowNodes","isHide","dataManager","query","indent","captionRow","getRowObjectFromUID","expand","isExpand","updateVirtualRows","enableLazyLoading","contentModule","captionExpand","captionCollapse","setExpand","rowObjs","getRowsObject","startIdx","rowsState","cacheStartIdx","enableInfiniteScrolling","infiniteScrollSettings","enableCache","Array","from","undefined","isDetailRow","visible","display","parentUid","isDataRow","isCaptionRow","isAggregateRow","cells","some","cell","isDataCell","notify","refreshExpandandCollapse","captionActionComplete","isCollapse","rObj","refreshVirtualMaxPage","getDataModule","generateQuery","queries","aggregateQuery","getQuery","clone","args","requestType","rowObject","virtualInfo","prevInfo","getData","requiresCount","then","renderModule","dataManagerSuccess","expandCollapse","initialCollapse","len","updateVisibleExpandCollapseRows","renderGroupDropArea","initDragAndDrop","refreshToggleBtn","groupElem","updateGroupDropArea","insertBefore","firstChild","showDropArea","clear","initializeGHeaderDrop","initializeGHeaderDrag","dragTarget","distance","accept","preventBatch","instance","handler","arg1","showGroupedColumn","colName","enableColumnVirtualization","filter","sortSettings","dataBind","groupAddSortingQuery","actionComplete","direction","isFromGroup","animator","groupedColumn","childDiv","headerCell","title","tabindex","toLowerCase","role","showUngroupButton","createSeparator","toString","isRemove","headers","showColumnMenu","getGHeaderCell","parent_1","module","Object","keys","properties","prop","j","actionBegin","oldProperties","modelChanged","headerModule","refreshUI","updateGroupedColumn","updateButtonVisibility","refreshHeader","freezeRefresh","isVisible","enable","gridElement","gridHeader","refreshing","clearGrouping","parentNode","header","gCols","fieldNames","editedData","aggregates","iterateGroupAggregates","rowData","generateRows","summaryRows","updateSummaryRows","data","isReact","isVue","destroyTemplate","dataUid","refreshAggregateCell","updatedData","initData","getCurrentViewRecords","deletedCols","changeds","edit","changes","getPrimaryKeyFieldNames","mergeData","item","pKeyVal","getObject","value","hasVal","cItem","eData","aggregateRows","k","aggr","result","aggrds","groupedCols","l","group","_loop_1","childRow","closestParent","x","state_1","isFrozen"],"sources":["/home/morgan/Desktop/Projets/ENT4/Jwt-Auth-pdf/react-jwt-auth/react-jwt-auth/node_modules/@syncfusion/ej2-grids/src/grid/actions/group.js"],"sourcesContent":["import { Draggable, Droppable, EventHandler } from '@syncfusion/ej2-base';\nimport { createElement, closest, remove, classList, addClass, removeClass } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined, extend } from '@syncfusion/ej2-base';\nimport { parentsUntil, isActionPrevent, isGroupAdaptive, updatecloneRow, getComplexFieldID, isComplexField } from '../base/util';\nimport * as events from '../base/constant';\nimport { AriaService } from '../services/aria-service';\nimport { GroupModelGenerator } from '../services/group-model-generator';\nimport { DataUtil } from '@syncfusion/ej2-data';\nimport * as literals from '../base/string-literals';\n// eslint-disable-next-line valid-jsdoc\n/**\n *\n * The `Group` module is used to handle group action.\n */\nvar Group = /** @class */ (function () {\n    /**\n     * Constructor for Grid group module\n     *\n     * @param {IGrid} parent - specifies the IGrid\n     * @param {GroupSettingsModel} groupSettings - specifies the GroupSettingsModel\n     * @param {string[]} sortedColumns - specifies the sortedColumns\n     * @param {ServiceLocator} serviceLocator - specifies the serviceLocator\n     * @hidden\n     */\n    function Group(parent, groupSettings, sortedColumns, serviceLocator) {\n        var _this = this;\n        //Internal variables\n        this.sortRequired = true;\n        /** @hidden */\n        this.groupSortFocus = false;\n        /** @hidden */\n        this.groupCancelFocus = false;\n        this.isAppliedGroup = false;\n        this.isAppliedUnGroup = false;\n        this.reorderingColumns = [];\n        this.visualElement = createElement('div', {\n            className: 'e-cloneproperties e-dragclone e-gdclone',\n            styles: 'line-height:23px', attrs: { action: 'grouping' }\n        });\n        this.helper = function (e) {\n            var gObj = _this.parent;\n            var target = e.sender.target;\n            var element = target.classList.contains('e-groupheadercell') ? target :\n                parentsUntil(target, 'e-groupheadercell');\n            if (!element || (!target.classList.contains('e-drag') && _this.groupSettings.allowReordering)) {\n                return false;\n            }\n            _this.column = gObj.getColumnByField(element.firstElementChild.getAttribute('ej-mappingname'));\n            _this.visualElement.textContent = element.textContent;\n            _this.visualElement.style.width = element.offsetWidth + 2 + 'px';\n            _this.visualElement.style.height = element.offsetHeight + 2 + 'px';\n            _this.visualElement.setAttribute('e-mappinguid', _this.column.uid);\n            gObj.element.appendChild(_this.visualElement);\n            return _this.visualElement;\n        };\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        this.dragStart = function (e) {\n            _this.parent.element.classList.add('e-ungroupdrag');\n        };\n        this.drag = function (e) {\n            if (_this.groupSettings.allowReordering) {\n                _this.animateDropper(e);\n            }\n            var target = e.target;\n            var cloneElement = _this.parent.element.querySelector('.e-cloneproperties');\n            _this.parent.trigger(events.columnDrag, { target: target, draggableType: 'headercell', column: _this.column });\n            if (!_this.groupSettings.allowReordering) {\n                classList(cloneElement, ['e-defaultcur'], ['e-notallowedcur']);\n                if (!(parentsUntil(target, literals.gridContent) || parentsUntil(target, 'e-headercell'))) {\n                    classList(cloneElement, ['e-notallowedcur'], ['e-defaultcur']);\n                }\n            }\n        };\n        this.dragStop = function (e) {\n            _this.parent.element.classList.remove('e-ungroupdrag');\n            var preventDrop = !(parentsUntil(e.target, literals.gridContent) || parentsUntil(e.target, 'e-gridheader'));\n            if (_this.groupSettings.allowReordering && preventDrop) {\n                remove(e.helper);\n                if (parentsUntil(e.target, 'e-groupdroparea')) {\n                    _this.rearrangeGroup();\n                }\n                else if (!(parentsUntil(e.target, 'e-grid'))) {\n                    var field = _this.parent.getColumnByUid(e.helper.getAttribute('e-mappinguid')).field;\n                    if (_this.groupSettings.columns.indexOf(field) !== -1) {\n                        _this.ungroupColumn(field);\n                    }\n                }\n                return;\n            }\n            else if (preventDrop) {\n                remove(e.helper);\n                return;\n            }\n        };\n        this.animateDropper = function (e) {\n            var uid = _this.parent.element.querySelector('.e-cloneproperties').getAttribute('e-mappinguid');\n            var dragField = _this.parent.getColumnByUid(uid).field;\n            var parent = parentsUntil(e.target, 'e-groupdroparea');\n            var dropTarget = parentsUntil(e.target, 'e-group-animator');\n            var grouped = [].slice.call(_this.element.getElementsByClassName('e-groupheadercell'))\n                .map(function (e) { return e.querySelector('div').getAttribute('ej-mappingname'); });\n            var cols = JSON.parse(JSON.stringify(grouped));\n            if (dropTarget || parent) {\n                if (dropTarget) {\n                    var dropField = dropTarget.querySelector('div[ej-mappingname]').getAttribute('ej-mappingname');\n                    var dropIndex = +(dropTarget.getAttribute('index'));\n                    if (dropField !== dragField) {\n                        var dragIndex = cols.indexOf(dragField);\n                        if (dragIndex !== -1) {\n                            cols.splice(dragIndex, 1);\n                        }\n                        var flag = dropIndex !== -1 && dragIndex === dropIndex;\n                        cols.splice(dropIndex + (flag ? 1 : 0), 0, dragField);\n                    }\n                }\n                else if (parent && cols.indexOf(dragField) === -1) {\n                    cols.push(dragField);\n                }\n                _this.element.innerHTML = '';\n                if (cols.length && !_this.element.classList.contains('e-grouped')) {\n                    _this.element.classList.add('e-grouped');\n                }\n                _this.reorderingColumns = cols;\n                for (var c = 0; c < cols.length; c++) {\n                    _this.addColToGroupDrop(cols[c]);\n                }\n            }\n            else {\n                _this.addLabel();\n                _this.removeColFromGroupDrop(dragField);\n            }\n        };\n        this.drop = function (e) {\n            var gObj = _this.parent;\n            var column = gObj.getColumnByUid(e.droppedElement.getAttribute('e-mappinguid'));\n            _this.element.classList.remove('e-hover');\n            remove(e.droppedElement);\n            _this.aria.setDropTarget(_this.parent.element.querySelector('.e-groupdroparea'), false);\n            _this.aria.setGrabbed(_this.parent.getHeaderTable().querySelector('[aria-grabbed=true]'), false);\n            if (isNullOrUndefined(column) || column.allowGrouping === false ||\n                parentsUntil(gObj.getColumnHeaderByUid(column.uid), 'e-grid').getAttribute('id') !==\n                    gObj.element.getAttribute('id')) {\n                _this.parent.log('action_disabled_column', { moduleName: _this.getModuleName(), columnName: column.headerText });\n                return;\n            }\n            _this.groupColumn(column.field);\n        };\n        this.contentRefresh = true;\n        this.aria = new AriaService();\n        this.parent = parent;\n        this.groupSettings = groupSettings;\n        this.serviceLocator = serviceLocator;\n        this.sortedColumns = sortedColumns;\n        this.focus = serviceLocator.getService('focus');\n        this.addEventListener();\n        this.groupGenerator = new GroupModelGenerator(this.parent);\n    }\n    Group.prototype.addLabel = function () {\n        if (!this.element.getElementsByClassName('e-group-animator').length) {\n            var dragLabel = this.l10n.getConstant('GroupDropArea');\n            this.element.innerHTML = dragLabel;\n            this.element.classList.remove('e-grouped');\n        }\n    };\n    Group.prototype.rearrangeGroup = function () {\n        this.sortRequired = false;\n        this.updateModel();\n    };\n    Group.prototype.columnDrag = function (e) {\n        if (this.groupSettings.allowReordering && e.column.allowGrouping) {\n            this.animateDropper(e);\n        }\n        var cloneElement = this.parent.element.querySelector('.e-cloneproperties');\n        classList(cloneElement, ['e-defaultcur'], ['e-notallowedcur']);\n        if (!parentsUntil(e.target, 'e-groupdroparea') &&\n            !(this.parent.allowReordering && parentsUntil(e.target, 'e-headercell'))) {\n            classList(cloneElement, ['e-notallowedcur'], ['e-defaultcur']);\n        }\n        if (e.target.classList.contains('e-groupdroparea')) {\n            this.element.classList.add('e-hover');\n        }\n        else {\n            this.element.classList.remove('e-hover');\n        }\n    };\n    Group.prototype.columnDragStart = function (e) {\n        if (e.target.classList.contains('e-stackedheadercell')) {\n            return;\n        }\n        var dropArea = this.parent.element.querySelector('.e-groupdroparea');\n        this.aria.setDropTarget(dropArea, e.column.allowGrouping);\n        var element = e.target.classList.contains('e-headercell') ? e.target : parentsUntil(e.target, 'e-headercell');\n        this.aria.setGrabbed(element, true, !e.column.allowGrouping);\n    };\n    Group.prototype.columnDrop = function (e) {\n        var gObj = this.parent;\n        if (e.droppedElement.getAttribute('action') === 'grouping') {\n            var column = gObj.getColumnByUid(e.droppedElement.getAttribute('e-mappinguid'));\n            if (isNullOrUndefined(column) || column.allowGrouping === false ||\n                parentsUntil(gObj.getColumnHeaderByUid(column.uid), 'e-grid').getAttribute('id') !==\n                    gObj.element.getAttribute('id')) {\n                return;\n            }\n            this.ungroupColumn(column.field);\n        }\n    };\n    /**\n     * @returns {void}\n     * @hidden\n     */\n    Group.prototype.addEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.on(events.uiUpdate, this.enableAfterRender, this);\n        this.parent.on(events.groupComplete, this.onActionComplete, this);\n        this.parent.on(events.ungroupComplete, this.onActionComplete, this);\n        this.parent.on(events.inBoundModelChanged, this.onPropertyChanged, this);\n        this.parent.on(events.click, this.clickHandler, this);\n        this.parent.on(events.columnDrag, this.columnDrag, this);\n        this.parent.on(events.columnDragStart, this.columnDragStart, this);\n        this.parent.on(events.headerDrop, this.columnDrop, this);\n        this.parent.on(events.columnDrop, this.columnDrop, this);\n        this.parent.on(events.headerRefreshed, this.refreshSortIcons, this);\n        this.parent.on(events.sortComplete, this.refreshSortIcons, this);\n        this.parent.on(events.keyPressed, this.keyPressHandler, this);\n        this.parent.on(events.contentReady, this.initialEnd, this);\n        this.parent.on(events.onEmpty, this.initialEnd, this);\n        this.parent.on(events.initialEnd, this.render, this);\n        this.parent.on(events.groupAggregates, this.onGroupAggregates, this);\n        this.parent.on(events.destroy, this.destroy, this);\n        this.parent.on('group-expand-collapse', this.updateExpand, this);\n        this.parent.on('persist-data-changed', this.initialEnd, this);\n    };\n    /**\n     * @returns {void}\n     * @hidden\n     */\n    Group.prototype.removeEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.off(events.initialEnd, this.render);\n        this.parent.off(events.uiUpdate, this.enableAfterRender);\n        this.parent.off(events.groupComplete, this.onActionComplete);\n        this.parent.off(events.ungroupComplete, this.onActionComplete);\n        this.parent.off(events.inBoundModelChanged, this.onPropertyChanged);\n        this.parent.off(events.click, this.clickHandler);\n        this.parent.off(events.columnDrag, this.columnDrag);\n        this.parent.off(events.columnDragStart, this.columnDragStart);\n        this.parent.off(events.columnDrop, this.columnDrop);\n        this.parent.off(events.headerDrop, this.columnDrop);\n        this.parent.off(events.headerRefreshed, this.refreshSortIcons);\n        this.parent.off(events.sortComplete, this.refreshSortIcons);\n        this.parent.off(events.keyPressed, this.keyPressHandler);\n        this.parent.off(events.groupAggregates, this.onGroupAggregates);\n        this.parent.off(events.destroy, this.destroy);\n        this.parent.off('group-expand-collapse', this.updateExpand);\n    };\n    Group.prototype.initialEnd = function () {\n        var gObj = this.parent;\n        this.parent.off(events.contentReady, this.initialEnd);\n        this.parent.off(events.onEmpty, this.initialEnd);\n        if (this.parent.getColumns().length && this.groupSettings.columns.length) {\n            this.contentRefresh = false;\n            for (var _i = 0, _a = gObj.groupSettings.columns; _i < _a.length; _i++) {\n                var col = _a[_i];\n                this.groupColumn(col);\n            }\n            this.contentRefresh = true;\n        }\n    };\n    Group.prototype.keyPressHandler = function (e) {\n        var gObj = this.parent;\n        if (e.target && parentsUntil(e.target, 'e-groupheadercell') && (e.action === 'tab' || e.action === 'shiftTab')) {\n            var focusableGroupedItems = this.getFocusableGroupedItems();\n            if ((e.action === 'tab' && e.target === focusableGroupedItems[focusableGroupedItems.length - 1])\n                || (e.action === 'shiftTab' && e.target === focusableGroupedItems[0])) {\n                return;\n            }\n            for (var i = 0; i < focusableGroupedItems.length; i++) {\n                if (e.target === focusableGroupedItems[i]) {\n                    e.preventDefault();\n                    var index = e.action === 'tab' ? i + 1 : i - 1;\n                    focusableGroupedItems[index].focus();\n                    return;\n                }\n            }\n        }\n        if (e.action !== 'ctrlSpace' && (!this.groupSettings.columns.length ||\n            ['altDownArrow', 'altUpArrow', 'ctrlDownArrow', 'ctrlUpArrow', 'enter'].indexOf(e.action) === -1)) {\n            return;\n        }\n        e.preventDefault();\n        switch (e.action) {\n            case 'altDownArrow':\n            case 'altUpArrow':\n                // eslint-disable-next-line no-case-declarations\n                var selected = gObj.allowSelection ? gObj.getSelectedRowIndexes() : [];\n                if (selected.length) {\n                    var rows = gObj.getContentTable().querySelector(literals.tbody).children;\n                    var dataRow = gObj.getDataRows()[selected[selected.length - 1]];\n                    var grpRow = void 0;\n                    for (var i = dataRow.rowIndex; i >= 0; i--) {\n                        if (!rows[i].classList.contains(literals.row) && !rows[i].classList.contains('e-detailrow')) {\n                            grpRow = rows[i];\n                            break;\n                        }\n                    }\n                    this.expandCollapseRows(grpRow.querySelector(e.action === 'altUpArrow' ?\n                        '.e-recordplusexpand' : '.e-recordpluscollapse'));\n                }\n                break;\n            case 'ctrlDownArrow':\n                this.expandAll();\n                break;\n            case 'ctrlUpArrow':\n                this.collapseAll();\n                break;\n            case 'enter':\n                if (e.target.classList.contains('e-groupsort')) {\n                    this.groupSortFocus = true;\n                    this.applySortFromTarget(e.target);\n                    break;\n                }\n                else if (e.target.classList.contains('e-ungroupbutton')) {\n                    this.groupCancelFocus = true;\n                    this.unGroupFromTarget(e.target);\n                    break;\n                }\n                if (this.parent.isEdit || (closest(e.target, '#' + this.parent.element.id + '_searchbar') !== null) ||\n                    parentsUntil(e.target, 'e-pager')) {\n                    return;\n                }\n                // eslint-disable-next-line no-case-declarations\n                var element = this.focus.getFocusedElement();\n                if (element.classList.contains('e-icon-grightarrow') || element.classList.contains('e-icon-gdownarrow')) {\n                    element = element.parentElement;\n                }\n                // eslint-disable-next-line no-case-declarations\n                var row = element ? element.parentElement.querySelector('[class^=\"e-record\"]') : null;\n                if (!row) {\n                    break;\n                }\n                this.expandCollapseRows(row);\n                break;\n            case 'ctrlSpace':\n                // eslint-disable-next-line no-case-declarations\n                var elem = gObj.focusModule.currentInfo.element;\n                if (elem && elem.classList.contains('e-headercell')) {\n                    var column = gObj.getColumnByUid(elem.firstElementChild.getAttribute('e-mappinguid'));\n                    if (column.field && gObj.groupSettings.columns.indexOf(column.field) < 0) {\n                        this.groupColumn(column.field);\n                    }\n                    else {\n                        this.ungroupColumn(column.field);\n                    }\n                }\n                break;\n        }\n    };\n    /**\n     * @returns {Element[]} - Return the focusable grouping items\n     * @hidden */\n    Group.prototype.getFocusableGroupedItems = function () {\n        var focusableGroupedItems = [];\n        if (this.groupSettings.columns.length) {\n            var focusableGroupedHeaderItems = this.element.querySelectorAll('.e-groupheadercell');\n            for (var i = 0; i < focusableGroupedHeaderItems.length; i++) {\n                focusableGroupedItems.push(focusableGroupedHeaderItems[i].querySelector('.e-grouptext'));\n                focusableGroupedItems.push(focusableGroupedHeaderItems[i].querySelector('.e-groupsort'));\n                focusableGroupedItems.push(focusableGroupedHeaderItems[i].querySelector('.e-ungroupbutton'));\n            }\n        }\n        return focusableGroupedItems;\n    };\n    Group.prototype.wireEvent = function () {\n        EventHandler.add(this.element, 'focusin', this.onFocusIn, this);\n        EventHandler.add(this.element, 'focusout', this.onFocusOut, this);\n    };\n    Group.prototype.unWireEvent = function () {\n        EventHandler.remove(this.element, 'focusin', this.onFocusIn);\n        EventHandler.remove(this.element, 'focusout', this.onFocusOut);\n    };\n    Group.prototype.onFocusIn = function (e) {\n        if (this.parent.focusModule.currentInfo && this.parent.focusModule.currentInfo.element) {\n            removeClass([this.parent.focusModule.currentInfo.element, this.parent.focusModule.currentInfo.elementToFocus], ['e-focused', 'e-focus']);\n            this.parent.focusModule.currentInfo.element.tabIndex = -1;\n        }\n        this.addOrRemoveFocus(e);\n    };\n    Group.prototype.onFocusOut = function (e) {\n        this.addOrRemoveFocus(e);\n    };\n    Group.prototype.addOrRemoveFocus = function (e) {\n        if (e.target.classList.contains('e-groupdroparea') || e.target.classList.contains('e-grouptext')\n            || e.target.classList.contains('e-groupsort')\n            || e.target.classList.contains('e-ungroupbutton')) {\n            var target = e.target.classList.contains('e-grouptext') ?\n                e.target.parentElement.parentElement : e.target;\n            if (e.type === 'focusin') {\n                addClass([target], ['e-focused', 'e-focus']);\n                target.tabIndex = 0;\n            }\n            else {\n                removeClass([target], ['e-focused', 'e-focus']);\n                target.tabIndex = -1;\n            }\n        }\n    };\n    Group.prototype.clickHandler = function (e) {\n        if (e.target.classList.contains('e-groupsort')) {\n            this.groupSortFocus = true;\n        }\n        if (e.target.classList.contains('e-ungroupbutton')) {\n            this.groupCancelFocus = true;\n        }\n        this.expandCollapseRows(e.target);\n        this.applySortFromTarget(e.target);\n        this.unGroupFromTarget(e.target);\n        this.toogleGroupFromHeader(e.target);\n    };\n    Group.prototype.unGroupFromTarget = function (target) {\n        if (target.classList.contains('e-ungroupbutton')) {\n            this.ungroupColumn(target.parentElement.getAttribute('ej-mappingname'));\n        }\n    };\n    Group.prototype.toogleGroupFromHeader = function (target) {\n        if (this.groupSettings.showToggleButton) {\n            if (target.classList.contains('e-grptogglebtn')) {\n                if (target.classList.contains('e-toggleungroup')) {\n                    this.ungroupColumn(this.parent.getColumnByUid(target.parentElement.getAttribute('e-mappinguid')).field);\n                }\n                else {\n                    this.groupColumn(this.parent.getColumnByUid(target.parentElement.getAttribute('e-mappinguid')).field);\n                }\n            }\n            else {\n                if (target.classList.contains('e-toggleungroup')) {\n                    this.ungroupColumn(target.parentElement.getAttribute('ej-mappingname'));\n                }\n            }\n        }\n    };\n    Group.prototype.applySortFromTarget = function (target) {\n        var gObj = this.parent;\n        var gHeader = closest(target, '.e-groupheadercell');\n        if (gObj.allowSorting && gHeader && !target.classList.contains('e-ungroupbutton') &&\n            !target.classList.contains('e-toggleungroup')) {\n            var field = gHeader.firstElementChild.getAttribute('ej-mappingname');\n            if (gObj.getColumnHeaderByField(field).getElementsByClassName('e-ascending').length) {\n                gObj.sortColumn(field, 'Descending', true);\n            }\n            else {\n                gObj.sortColumn(field, 'Ascending', true);\n            }\n        }\n    };\n    /**\n     * Expands or collapses grouped rows by target element.\n     *\n     * @param  {Element} target - Defines the target element of the grouped row.\n     * @returns {void}\n     */\n    Group.prototype.expandCollapseRows = function (target) {\n        var trgt = parentsUntil(target, 'e-recordplusexpand') ||\n            parentsUntil(target, 'e-recordpluscollapse');\n        if (trgt) {\n            var rowNodes = this.parent.getContentTable().querySelector(literals.tbody).children;\n            var isHide = void 0;\n            var dataManager = void 0;\n            var query = void 0;\n            var gObj = this.parent;\n            var indent = trgt.parentElement.getElementsByClassName('e-indentcell').length;\n            var uid = trgt.parentElement.getAttribute('data-uid');\n            var captionRow = gObj.getRowObjectFromUID(uid);\n            var expand = false;\n            if (trgt.classList.contains('e-recordpluscollapse')) {\n                addClass([trgt], 'e-recordplusexpand');\n                removeClass([trgt], 'e-recordpluscollapse');\n                trgt.firstElementChild.className = 'e-icons e-gdiagonaldown e-icon-gdownarrow';\n                trgt.firstElementChild.setAttribute('title', 'expanded');\n                expand = true;\n                captionRow.isExpand = true;\n                if (isGroupAdaptive(gObj)) {\n                    this.updateVirtualRows(gObj, target, expand, query, dataManager);\n                }\n                if (this.parent.groupSettings.enableLazyLoading) {\n                    this.parent.contentModule.captionExpand(trgt.parentElement);\n                }\n            }\n            else {\n                isHide = true;\n                captionRow.isExpand = false;\n                removeClass([trgt], 'e-recordplusexpand');\n                addClass([trgt], 'e-recordpluscollapse');\n                trgt.firstElementChild.className = 'e-icons e-gnextforward e-icon-grightarrow';\n                trgt.firstElementChild.setAttribute('title', 'collapsed');\n                if (isGroupAdaptive(gObj)) {\n                    this.updateVirtualRows(gObj, target, !isHide, query, dataManager);\n                }\n                if (this.parent.groupSettings.enableLazyLoading) {\n                    this.parent.contentModule.captionCollapse(trgt.parentElement);\n                }\n            }\n            this.aria.setExpand(trgt, expand);\n            if (!isGroupAdaptive(gObj) && !this.parent.groupSettings.enableLazyLoading) {\n                var rowObjs = gObj.getRowsObject();\n                var startIdx = rowObjs.indexOf(captionRow);\n                var rowsState = {};\n                var cacheStartIdx = gObj.enableInfiniteScrolling && gObj.infiniteScrollSettings &&\n                    gObj.infiniteScrollSettings.enableCache && rowObjs.length !== rowNodes.length ?\n                    Array.from(rowNodes).indexOf(trgt.parentElement) : undefined;\n                for (var i = startIdx; i < rowObjs.length; i++) {\n                    if (i > startIdx && rowObjs[i].indent === indent) {\n                        break;\n                    }\n                    if (rowObjs[i].isDetailRow) {\n                        var visible = rowObjs[i - 1].isExpand && rowObjs[i - 1].visible;\n                        if (cacheStartIdx && cacheStartIdx > 0 && cacheStartIdx < rowNodes.length) {\n                            rowNodes[cacheStartIdx].style.display = visible ? '' : 'none';\n                        }\n                        else if (isNullOrUndefined(cacheStartIdx)) {\n                            rowNodes[i].style.display = visible ? '' : 'none';\n                        }\n                    }\n                    else if (rowsState[rowObjs[i].parentUid] === false) {\n                        rowObjs[i].visible = false;\n                        if (cacheStartIdx && cacheStartIdx > 0 && cacheStartIdx < rowNodes.length) {\n                            rowNodes[cacheStartIdx].style.display = 'none';\n                        }\n                        else if (isNullOrUndefined(cacheStartIdx)) {\n                            rowNodes[i].style.display = 'none';\n                        }\n                    }\n                    else {\n                        if (!(rowObjs[i].isDataRow || rowObjs[i].isCaptionRow || rowObjs[i].isDetailRow || rowObjs[i].isAggregateRow)) {\n                            var visible = rowObjs[i].cells.some(function (cell) { return cell.isDataCell\n                                && cell.visible; });\n                            if (visible === rowObjs[i].visible) {\n                                continue;\n                            }\n                        }\n                        rowObjs[i].visible = true;\n                        if (cacheStartIdx && cacheStartIdx > 0 && cacheStartIdx < rowNodes.length) {\n                            rowNodes[cacheStartIdx].style.display = '';\n                            rowNodes[cacheStartIdx].classList.remove('e-hide');\n                        }\n                        else if (isNullOrUndefined(cacheStartIdx)) {\n                            rowNodes[i].style.display = '';\n                            rowNodes[i].classList.remove('e-hide');\n                        }\n                    }\n                    if (rowObjs[i].isCaptionRow) {\n                        rowsState[rowObjs[i].uid] = rowObjs[i].isExpand && rowObjs[i].visible;\n                    }\n                    if (!isNullOrUndefined(cacheStartIdx)) {\n                        cacheStartIdx++;\n                    }\n                }\n                this.parent.notify(events.refreshExpandandCollapse, { rows: this.parent.getRowsObject() });\n            }\n            this.parent.notify(events.captionActionComplete, { isCollapse: isHide, parentUid: uid });\n        }\n    };\n    Group.prototype.updateVirtualRows = function (gObj, target, isExpand, query, dataManager) {\n        var rObj = gObj.getRowObjectFromUID(target.closest('tr').getAttribute('data-uid'));\n        rObj.isExpand = isExpand;\n        updatecloneRow(gObj);\n        this.parent.notify(events.refreshVirtualMaxPage, {});\n        query = gObj.getDataModule().generateQuery(false);\n        query.queries = gObj.getDataModule().aggregateQuery(gObj.getQuery().clone()).queries;\n        var args = { requestType: 'virtualscroll', rowObject: rObj };\n        if (gObj.contentModule) {\n            args.virtualInfo = gObj.contentModule.prevInfo;\n        }\n        dataManager = gObj.getDataModule().getData(args, query.requiresCount());\n        dataManager.then(function (e) { return gObj.renderModule.dataManagerSuccess(e, args); });\n    };\n    Group.prototype.expandCollapse = function (isExpand) {\n        if (!this.parent.groupSettings.columns.length) {\n            return;\n        }\n        if (!isExpand) {\n            this.parent.notify(events.initialCollapse, isExpand);\n        }\n        var rowNodes = this.parent.getContentTable().querySelector(literals.tbody).children;\n        var rowObjs = this.parent.getRowsObject();\n        var row;\n        for (var i = 0, len = rowNodes.length; i < len; i++) {\n            if (rowNodes[i].querySelectorAll('.e-recordplusexpand, .e-recordpluscollapse').length) {\n                row = rowNodes[i].querySelector(isExpand ? '.e-recordpluscollapse' : '.e-recordplusexpand');\n                if (row) {\n                    row.className = isExpand ? 'e-recordplusexpand' : 'e-recordpluscollapse';\n                    row.firstElementChild.className = isExpand ? 'e-icons e-gdiagonaldown e-icon-gdownarrow' :\n                        'e-icons e-gnextforward e-icon-grightarrow';\n                }\n                if (!(rowNodes[i].firstElementChild.classList.contains('e-recordplusexpand') ||\n                    rowNodes[i].firstElementChild.classList.contains('e-recordpluscollapse'))) {\n                    rowNodes[i].style.display = isExpand ? '' : 'none';\n                }\n            }\n            else {\n                rowNodes[i].style.display = isExpand ? '' : 'none';\n            }\n            if (rowObjs[i].isCaptionRow) {\n                rowObjs[i].isExpand = isExpand ? true : false;\n            }\n        }\n        this.parent.updateVisibleExpandCollapseRows();\n        this.parent.notify(events.refreshExpandandCollapse, { rows: this.parent.getRowsObject() });\n    };\n    /**\n     * Expands all the grouped rows of the Grid.\n     *\n     * @returns {void}\n     */\n    Group.prototype.expandAll = function () {\n        this.expandCollapse(true);\n    };\n    /**\n     * Collapses all the grouped rows of the Grid.\n     *\n     * @returns {void}\n     */\n    Group.prototype.collapseAll = function () {\n        this.expandCollapse(false);\n    };\n    /**\n     * The function is used to render grouping\n     *\n     * @returns {void}\n     * @hidden\n     */\n    Group.prototype.render = function () {\n        this.l10n = this.serviceLocator.getService('localization');\n        this.renderGroupDropArea();\n        this.initDragAndDrop();\n        this.refreshToggleBtn();\n        this.wireEvent();\n    };\n    Group.prototype.renderGroupDropArea = function () {\n        var groupElem = this.parent.element.querySelector('.e-groupdroparea');\n        if (groupElem) {\n            remove(groupElem);\n        }\n        this.element = this.parent.createElement('div', { className: 'e-groupdroparea', attrs: { 'tabindex': '-1' } });\n        if (this.groupSettings.allowReordering) {\n            this.element.classList.add('e-group-animate');\n        }\n        this.updateGroupDropArea();\n        this.parent.element.insertBefore(this.element, this.parent.element.firstChild);\n        if (!this.groupSettings.showDropArea) {\n            this.element.style.display = 'none';\n        }\n    };\n    Group.prototype.updateGroupDropArea = function (clear) {\n        if (this.groupSettings.showDropArea && !this.groupSettings.columns.length) {\n            var dragLabel = this.l10n.getConstant('GroupDropArea');\n            this.element.innerHTML = dragLabel;\n            this.element.classList.remove('e-grouped');\n        }\n        else {\n            if ((this.element.innerHTML === this.l10n.getConstant('GroupDropArea') && (this.groupSettings.columns.length === 1\n                || !this.isAppliedGroup && !this.isAppliedUnGroup)) || clear) {\n                this.element.innerHTML = '';\n            }\n            this.element.classList.add('e-grouped');\n        }\n    };\n    Group.prototype.initDragAndDrop = function () {\n        this.initializeGHeaderDrop();\n        this.initializeGHeaderDrag();\n    };\n    Group.prototype.initializeGHeaderDrag = function () {\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        var drag = new Draggable(this.element, {\n            dragTarget: this.groupSettings.allowReordering ? '.e-drag' : '.e-groupheadercell',\n            distance: this.groupSettings.allowReordering ? -10 : 5,\n            helper: this.helper,\n            dragStart: this.dragStart,\n            drag: this.drag,\n            dragStop: this.dragStop\n        });\n    };\n    Group.prototype.initializeGHeaderDrop = function () {\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        var drop = new Droppable(this.element, {\n            accept: '.e-dragclone',\n            drop: this.drop\n        });\n    };\n    /**\n     * Groups a column by column name.\n     *\n     * @param  {string} columnName - Defines the column name to group.\n     * @returns {void}\n     */\n    Group.prototype.groupColumn = function (columnName) {\n        var gObj = this.parent;\n        var column = gObj.getColumnByField(columnName);\n        if (isNullOrUndefined(column) || column.allowGrouping === false ||\n            (this.contentRefresh && this.groupSettings.columns.indexOf(columnName) > -1)) {\n            this.parent.log('action_disabled_column', { moduleName: this.getModuleName(), columnName: column.headerText });\n            return;\n        }\n        if (isActionPrevent(gObj)) {\n            gObj.notify(events.preventBatch, { instance: this, handler: this.groupColumn, arg1: columnName });\n            return;\n        }\n        column.visible = gObj.groupSettings.showGroupedColumn;\n        this.colName = columnName;\n        this.isAppliedGroup = true;\n        if (this.contentRefresh) {\n            this.updateModel();\n        }\n        else {\n            this.addColToGroupDrop(columnName);\n        }\n        this.updateGroupDropArea();\n        this.isAppliedGroup = false;\n    };\n    /**\n     * Ungroups a column by column name.\n     *\n     * @param  {string} columnName - Defines the column name to ungroup.\n     * @returns {void}\n     */\n    Group.prototype.ungroupColumn = function (columnName) {\n        var gObj = this.parent;\n        var column = this.parent.enableColumnVirtualization ?\n            this.parent.columns.filter(function (c) { return c.field === columnName; })[0] : gObj.getColumnByField(columnName);\n        if (isNullOrUndefined(column) || column.allowGrouping === false || this.groupSettings.columns.indexOf(columnName) < 0) {\n            return;\n        }\n        if (isActionPrevent(gObj)) {\n            gObj.notify(events.preventBatch, { instance: this, handler: this.ungroupColumn, arg1: columnName });\n            return;\n        }\n        column.visible = true;\n        this.colName = column.field;\n        var columns = JSON.parse(JSON.stringify(this.groupSettings.columns));\n        columns.splice(columns.indexOf(this.colName), 1);\n        if (this.sortedColumns.indexOf(columnName) < 0) {\n            for (var i = 0, len = gObj.sortSettings.columns.length; i < len; i++) {\n                if (columnName === gObj.sortSettings.columns[i].field) {\n                    gObj.sortSettings.columns.splice(i, 1);\n                    break;\n                }\n            }\n        }\n        if (this.groupSettings.allowReordering) {\n            this.reorderingColumns = columns;\n        }\n        this.groupSettings.columns = columns;\n        if (gObj.allowGrouping) {\n            this.isAppliedUnGroup = true;\n            this.parent.dataBind();\n        }\n    };\n    /**\n     * The function used to update groupSettings\n     *\n     * @returns {void}\n     * @hidden\n     */\n    Group.prototype.updateModel = function () {\n        var columns = JSON.parse(JSON.stringify(this.groupSettings.columns));\n        columns = this.reorderingColumns.length ? JSON.parse(JSON.stringify(this.reorderingColumns)) : columns;\n        if (this.sortRequired) {\n            if (columns.indexOf(this.colName) === -1) {\n                columns.push(this.colName);\n            }\n            this.groupAddSortingQuery(this.colName);\n        }\n        this.sortRequired = true;\n        this.parent.groupSettings.columns = columns;\n        this.parent.dataBind();\n    };\n    /**\n     * The function used to trigger onActionComplete\n     *\n     * @param {NotifyArgs} e - specifies the NotifyArgs\n     * @returns {void}\n     * @hidden\n     */\n    Group.prototype.onActionComplete = function (e) {\n        if (e.requestType === 'grouping') {\n            this.addColToGroupDrop(this.colName);\n        }\n        else {\n            this.removeColFromGroupDrop(this.colName);\n        }\n        var args = this.groupSettings.columns.indexOf(this.colName) > -1 ? {\n            columnName: this.colName, requestType: 'grouping', type: events.actionComplete\n        } : { requestType: 'ungrouping', type: events.actionComplete };\n        this.parent.trigger(events.actionComplete, extend(e, args));\n        this.colName = null;\n    };\n    Group.prototype.groupAddSortingQuery = function (colName) {\n        var i = 0;\n        while (i < this.parent.sortSettings.columns.length) {\n            if (this.parent.sortSettings.columns[i].field === colName) {\n                break;\n            }\n            i++;\n        }\n        if (this.parent.sortSettings.columns.length === i) {\n            this.parent.sortSettings.columns.push({ field: colName, direction: 'Ascending', isFromGroup: true });\n        }\n        else if (!this.parent.allowSorting) {\n            this.parent.sortSettings.columns[i].direction = 'Ascending';\n        }\n    };\n    Group.prototype.createElement = function (field) {\n        var gObj = this.parent;\n        var direction = 'Ascending';\n        var animator = this.parent.createElement('div', { className: 'e-grid-icon e-group-animator' });\n        var groupedColumn = this.parent.createElement('div', { className: 'e-grid-icon e-groupheadercell' });\n        var childDiv = this.parent.createElement('div', { attrs: { 'ej-mappingname': field } });\n        if (isComplexField(field)) {\n            childDiv.setAttribute('ej-complexname', getComplexFieldID(field));\n        }\n        var column = this.parent.getColumnByField(field);\n        //Todo headerTemplateID for grouped column, disableHtmlEncode\n        var headerCell = gObj.getColumnHeaderByUid(column.uid);\n        // if (!isNullOrUndefined(column.headerTemplate)) {\n        //     if (column.headerTemplate.indexOf('#') !== -1) {\n        //         childDiv.innerHTML = document.querySelector(column.headerTemplate).innerHTML.trim();\n        //     } else {\n        //         childDiv.innerHTML = column.headerTemplate;\n        //     }\n        //     childDiv.firstElementChild.classList.add('e-grouptext');\n        // } else {\n        if (this.groupSettings.allowReordering) {\n            childDiv.appendChild(this.parent.createElement('span', {\n                className: 'e-drag e-icons e-icon-drag', innerHTML: '&nbsp;',\n                attrs: { title: 'Drag', tabindex: '-1', 'aria-label': 'Drag the grouped column' }\n            }));\n        }\n        childDiv.appendChild(this.parent.createElement('span', {\n            className: 'e-grouptext', innerHTML: column.headerText,\n            attrs: { tabindex: '-1', 'aria-label': 'sort the grouped column' }\n        }));\n        // }\n        if (this.groupSettings.showToggleButton) {\n            childDiv.appendChild(this.parent.createElement('span', {\n                className: 'e-togglegroupbutton e-icons e-icon-ungroup e-toggleungroup', innerHTML: '&nbsp;',\n                attrs: { tabindex: '-1', 'aria-label': 'ungroup button' }\n            }));\n        }\n        if (headerCell.querySelectorAll('.e-ascending,.e-descending').length) {\n            direction = headerCell.querySelector('.e-ascending') ? 'Ascending' : 'Descending';\n        }\n        childDiv.appendChild(this.parent.createElement('span', {\n            className: 'e-groupsort e-icons ' +\n                ('e-' + direction.toLowerCase() + ' e-icon-' + direction.toLowerCase()), innerHTML: '&nbsp;',\n            attrs: { tabindex: '-1', 'aria-label': 'sort the grouped column', role: 'button' }\n        }));\n        childDiv.appendChild(this.parent.createElement('span', {\n            className: 'e-ungroupbutton e-icons e-icon-hide', innerHTML: '&nbsp;',\n            attrs: { title: this.l10n.getConstant('UnGroup'),\n                tabindex: '-1', 'aria-label': 'ungroup the grouped column', role: 'button' },\n            styles: this.groupSettings.showUngroupButton ? '' : 'display:none'\n        }));\n        groupedColumn.appendChild(childDiv);\n        if (this.groupSettings.allowReordering) {\n            animator.appendChild(groupedColumn);\n            animator.appendChild(this.createSeparator());\n            groupedColumn = animator;\n        }\n        return groupedColumn;\n    };\n    Group.prototype.addColToGroupDrop = function (field) {\n        var groupElem = isComplexField(field) ? this.parent.element.querySelector('.e-groupdroparea div[ej-complexname=' +\n            getComplexFieldID(field) + ']') : this.parent.element.querySelector('.e-groupdroparea div[ej-mappingname=' + field + ']');\n        if (this.groupSettings.allowReordering && groupElem) {\n            return;\n        }\n        var column = this.parent.getColumnByField(field);\n        if (isNullOrUndefined(column)) {\n            return;\n        }\n        var groupedColumn = this.createElement(field);\n        if (this.groupSettings.allowReordering) {\n            var index = this.element.getElementsByClassName('e-group-animator').length;\n            groupedColumn.setAttribute('index', index.toString());\n        }\n        this.element.appendChild(groupedColumn);\n        //Todo:  rtl\n    };\n    Group.prototype.createSeparator = function () {\n        return this.parent.createElement('span', {\n            className: 'e-nextgroup e-icons e-icon-next', innerHTML: '&nbsp;',\n            attrs: { tabindex: '-1', 'aria-label': 'Separator for the grouped columns' },\n            styles: this.groupSettings.showUngroupButton ? '' : 'display:none'\n        });\n    };\n    Group.prototype.refreshToggleBtn = function (isRemove) {\n        if (this.groupSettings.showToggleButton) {\n            var headers = [].slice.call(this.parent.getHeaderTable().getElementsByClassName('e-headercelldiv'));\n            for (var i = 0, len = headers.length; i < len; i++) {\n                if (!((headers[i].classList.contains('e-emptycell')) || (headers[i].classList.contains('e-headerchkcelldiv')))) {\n                    var column = this.parent.getColumnByUid(headers[i].getAttribute('e-mappinguid'));\n                    if (!this.parent.showColumnMenu || (this.parent.showColumnMenu && !column.showColumnMenu)) {\n                        if (headers[i].getElementsByClassName('e-grptogglebtn').length) {\n                            remove(headers[i].querySelectorAll('.e-grptogglebtn')[0]);\n                        }\n                        if (!isRemove) {\n                            headers[i].appendChild(this.parent.createElement('span', {\n                                className: 'e-grptogglebtn e-icons ' +\n                                    (this.groupSettings.columns.indexOf(column.field) > -1 ? 'e-toggleungroup e-icon-ungroup'\n                                        : 'e-togglegroup e-icon-group'), attrs: { tabindex: '-1', 'aria-label': 'Group button' }\n                            }));\n                        }\n                    }\n                }\n            }\n        }\n    };\n    Group.prototype.removeColFromGroupDrop = function (field) {\n        if (!isNullOrUndefined(this.getGHeaderCell(field))) {\n            var elem = this.getGHeaderCell(field);\n            if (this.groupSettings.allowReordering) {\n                var parent_1 = parentsUntil(elem, 'e-group-animator');\n                remove(parent_1);\n            }\n            else {\n                remove(elem);\n            }\n            this.updateGroupDropArea();\n        }\n        this.isAppliedUnGroup = false;\n    };\n    Group.prototype.onPropertyChanged = function (e) {\n        if (e.module !== this.getModuleName()) {\n            return;\n        }\n        for (var _i = 0, _a = Object.keys(e.properties); _i < _a.length; _i++) {\n            var prop = _a[_i];\n            switch (prop) {\n                case 'columns':\n                    // eslint-disable-next-line no-case-declarations\n                    var args = void 0;\n                    if (this.contentRefresh) {\n                        if (!this.isAppliedUnGroup) {\n                            if (!this.isAppliedGroup) {\n                                this.updateGroupDropArea(true);\n                                for (var j = 0; j < this.parent.sortSettings.columns.length; j++) {\n                                    if (this.parent.sortSettings.columns[j].isFromGroup) {\n                                        this.parent.sortSettings.columns.splice(j, 1);\n                                        j--;\n                                    }\n                                }\n                                for (var i = 0; i < this.groupSettings.columns.length; i++) {\n                                    this.colName = this.groupSettings.columns[i];\n                                    var col = this.parent.getColumnByField(this.colName);\n                                    col.visible = this.parent.groupSettings.showGroupedColumn;\n                                    this.groupAddSortingQuery(this.colName);\n                                    if (i < this.groupSettings.columns.length - 1) {\n                                        this.addColToGroupDrop(this.groupSettings.columns[i]);\n                                    }\n                                }\n                            }\n                            args = {\n                                columnName: this.colName, requestType: e.properties[prop].length ? 'grouping' : 'ungrouping',\n                                type: events.actionBegin\n                            };\n                        }\n                        else {\n                            args = { columnName: this.colName, requestType: 'ungrouping', type: events.actionBegin };\n                        }\n                        if (!this.groupSettings.showGroupedColumn) {\n                            var columns = e.oldProperties[prop];\n                            for (var i = 0; i < columns.length; i++) {\n                                if (e.properties[prop].indexOf(columns[i]) === -1) {\n                                    this.parent.getColumnByField(columns[i]).visible = true;\n                                }\n                            }\n                        }\n                        this.parent.notify(events.modelChanged, args);\n                    }\n                    break;\n                case 'showDropArea':\n                    this.updateGroupDropArea();\n                    if (this.groupSettings.showDropArea) {\n                        this.element.style.display = '';\n                        this.parent.headerModule.refreshUI();\n                    }\n                    else {\n                        this.element.style.display = 'none';\n                    }\n                    break;\n                case 'showGroupedColumn':\n                    this.updateGroupedColumn(this.groupSettings.showGroupedColumn);\n                    this.parent.notify(events.modelChanged, { requestType: 'refresh' });\n                    break;\n                case 'showUngroupButton':\n                    this.updateButtonVisibility(this.groupSettings.showUngroupButton, 'e-ungroupbutton');\n                    break;\n                case 'showToggleButton':\n                    this.updateButtonVisibility(this.groupSettings.showToggleButton, 'e-togglegroupbutton ');\n                    this.parent.refreshHeader();\n                    break;\n                case 'enableLazyLoading':\n                    this.parent.freezeRefresh();\n                    break;\n            }\n        }\n    };\n    Group.prototype.updateGroupedColumn = function (isVisible) {\n        for (var i = 0; i < this.groupSettings.columns.length; i++) {\n            this.parent.getColumnByField(this.groupSettings.columns[i]).visible = isVisible;\n        }\n    };\n    Group.prototype.updateButtonVisibility = function (isVisible, className) {\n        var gHeader = [].slice.call(this.element.getElementsByClassName(className));\n        for (var i = 0; i < gHeader.length; i++) {\n            gHeader[i].style.display = isVisible ? '' : 'none';\n        }\n    };\n    Group.prototype.enableAfterRender = function (e) {\n        if (e.module === this.getModuleName() && e.enable) {\n            this.render();\n        }\n    };\n    /**\n     * To destroy the reorder\n     *\n     * @returns {void}\n     * @hidden\n     */\n    Group.prototype.destroy = function () {\n        var gridElement = this.parent.element;\n        if (!gridElement || (!gridElement.querySelector('.' + literals.gridHeader) && !gridElement.querySelector('.' + literals.gridContent))) {\n            return;\n        }\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        if ((this.parent.isDestroyed || !this.parent.allowGrouping) && !this.parent.refreshing) {\n            this.clearGrouping();\n        }\n        this.unWireEvent();\n        this.removeEventListener();\n        this.refreshToggleBtn(true);\n        if (this.element.parentNode) {\n            remove(this.element);\n        }\n        //call ejdrag and drop destroy\n    };\n    /**\n     * Clears all the grouped columns of the Grid.\n     *\n     * @returns {void}\n     */\n    Group.prototype.clearGrouping = function () {\n        var cols = JSON.parse(JSON.stringify(this.groupSettings.columns));\n        this.contentRefresh = false;\n        for (var i = 0, len = cols.length; i < len; i++) {\n            if (i === (len - 1)) {\n                this.contentRefresh = true;\n            }\n            this.ungroupColumn(cols[i]);\n        }\n        this.contentRefresh = true;\n    };\n    /**\n     * For internal use only - Get the module name.\n     *\n     * @returns {string} returns the module name\n     * @private\n     */\n    Group.prototype.getModuleName = function () {\n        return 'group';\n    };\n    Group.prototype.refreshSortIcons = function () {\n        var gObj = this.parent;\n        var header;\n        var cols = gObj.sortSettings.columns;\n        var gCols = gObj.groupSettings.columns;\n        var fieldNames = this.parent.getColumns().map(function (c) { return c.field; });\n        this.refreshToggleBtn();\n        for (var i = 0, len = cols.length; i < len; i++) {\n            if (fieldNames.indexOf(cols[i].field) === -1) {\n                continue;\n            }\n            header = gObj.getColumnHeaderByField(cols[i].field);\n            if (!gObj.allowSorting && (this.sortedColumns.indexOf(cols[i].field) > -1 ||\n                this.groupSettings.columns.indexOf(cols[i].field) > -1)) {\n                classList(header.querySelector('.e-sortfilterdiv'), ['e-ascending', 'e-icon-ascending'], []);\n                if (cols.length > 1) {\n                    header.querySelector('.e-headercelldiv').appendChild(this.parent.createElement('span', { className: 'e-sortnumber', innerHTML: (i + 1).toString() }));\n                }\n            }\n            else if (this.getGHeaderCell(cols[i].field) && this.getGHeaderCell(cols[i].field).getElementsByClassName('e-groupsort').length) {\n                if (cols[i].direction === 'Ascending') {\n                    classList(this.getGHeaderCell(cols[i].field).querySelector('.e-groupsort'), ['e-ascending', 'e-icon-ascending'], ['e-descending', 'e-icon-descending']);\n                }\n                else {\n                    classList(this.getGHeaderCell(cols[i].field).querySelector('.e-groupsort'), ['e-descending', 'e-icon-descending'], ['e-ascending', 'e-icon-ascending']);\n                }\n            }\n        }\n        for (var i = 0, len = gCols.length; i < len; i++) {\n            if (fieldNames.indexOf(gCols[i]) === -1) {\n                continue;\n            }\n            gObj.getColumnHeaderByField(gCols[i]).setAttribute('aria-grouped', 'true');\n        }\n    };\n    Group.prototype.getGHeaderCell = function (field) {\n        if (this.element && this.element.querySelector('[ej-mappingname=\"' + field + '\"]')) {\n            return this.element.querySelector('[ej-mappingname=\"' + field + '\"]').parentElement;\n        }\n        return null;\n    };\n    Group.prototype.onGroupAggregates = function (editedData) {\n        var aggregates = this.iterateGroupAggregates(editedData);\n        var rowData = this.groupGenerator.generateRows(aggregates, {});\n        var summaryRows = this.parent.getRowsObject().filter(function (row) { return !row.isDataRow; });\n        var updateSummaryRows = rowData.filter(function (data) { return !data.isDataRow; });\n        if (this.parent.isReact || this.parent.isVue) {\n            this.parent.destroyTemplate(['groupFooterTemplate', 'groupCaptionTemplate', 'footerTemplate']);\n        }\n        for (var i = 0; i < updateSummaryRows.length; i++) {\n            var row = updateSummaryRows[i];\n            var cells = row.cells.filter(function (cell) { return cell.isDataCell; });\n            var args = { cells: cells, data: row.data, dataUid: summaryRows[i] ? summaryRows[i].uid : '' };\n            this.parent.notify(events.refreshAggregateCell, args);\n        }\n    };\n    Group.prototype.iterateGroupAggregates = function (editedData) {\n        var updatedData = editedData instanceof Array ? editedData : [];\n        var rows = this.parent.getRowsObject();\n        var initData = this.parent.getCurrentViewRecords();\n        var deletedCols = [];\n        var changeds = rows.map(function (row) {\n            if (row.edit === 'delete') {\n                deletedCols.push(row.data);\n            }\n            return row.changes instanceof Object ? row.changes : row.data;\n        });\n        var field = this.parent.getPrimaryKeyFieldNames()[0];\n        changeds = updatedData.length === 0 ? changeds : updatedData;\n        var mergeData = initData.map(function (item) {\n            var pKeyVal = DataUtil.getObject(field, item);\n            var value;\n            var hasVal = changeds.some(function (cItem) {\n                value = cItem;\n                return pKeyVal === DataUtil.getObject(field, cItem);\n            });\n            return hasVal ? value : item;\n        });\n        var eData = editedData;\n        if (!(eData.type && eData.type === 'cancel') && deletedCols.length > 0) {\n            for (var i = 0; i < deletedCols.length; i++) {\n                var index = mergeData.indexOf(deletedCols[i]);\n                mergeData.splice(index, 1);\n            }\n        }\n        var aggregates = [];\n        var aggregateRows = this.parent.aggregates;\n        for (var j = 0; j < aggregateRows.length; j++) {\n            var row = aggregateRows[j];\n            for (var k = 0; k < row.columns.length; k++) {\n                var aggr = {};\n                var type = row.columns[k].type.toString();\n                aggr = { type: type.toLowerCase(), field: row.columns[k].field };\n                aggregates.push(aggr);\n            }\n        }\n        var result;\n        var aggrds;\n        var groupedCols = this.parent.groupSettings.columns;\n        for (var l = 0; l < groupedCols.length; l++) {\n            aggrds = result ? result : mergeData;\n            result = DataUtil.group(aggrds, groupedCols[l], aggregates, null, null);\n        }\n        return result;\n    };\n    Group.prototype.updateExpand = function (args) {\n        var uid = args.uid;\n        var isExpand = args.isExpand;\n        var rows = this.parent.getRowsObject();\n        for (var i = 0; i < rows.length; i++) {\n            var row = rows[i];\n            if (row.uid === uid || isNullOrUndefined(uid)) {\n                row.isExpand = isExpand;\n                var _loop_1 = function (j) {\n                    var childRow = rows[j];\n                    var closestParent = void 0;\n                    if (childRow.parentUid !== row.uid) {\n                        closestParent = rows.filter(function (x) { return x.uid === childRow.parentUid; })[0];\n                    }\n                    if (childRow.parentUid === row.uid) {\n                        childRow.visible = row.isExpand;\n                    }\n                    else if (!isNullOrUndefined(closestParent) && childRow.parentUid === closestParent.uid) {\n                        if (closestParent.isExpand && closestParent.visible === true) {\n                            childRow.visible = true;\n                        }\n                        else if (closestParent.isExpand && closestParent.visible === false) {\n                            childRow.visible = false;\n                        }\n                    }\n                    if (isNullOrUndefined(uid)) {\n                        return \"break\";\n                    }\n                };\n                for (var j = i + 1; j < rows.length; j++) {\n                    var state_1 = _loop_1(j);\n                    if (state_1 === \"break\")\n                        break;\n                }\n            }\n        }\n        this.parent.notify(events.contentReady, { rows: rows, args: { isFrozen: false, rows: rows } });\n    };\n    return Group;\n}());\nexport { Group };\n"],"mappings":"AAAA,SAASA,SAAT,EAAoBC,SAApB,EAA+BC,YAA/B,QAAmD,sBAAnD;AACA,SAASC,aAAT,EAAwBC,OAAxB,EAAiCC,MAAjC,EAAyCC,SAAzC,EAAoDC,QAApD,EAA8DC,WAA9D,QAAiF,sBAAjF;AACA,SAASC,iBAAT,EAA4BC,MAA5B,QAA0C,sBAA1C;AACA,SAASC,YAAT,EAAuBC,eAAvB,EAAwCC,eAAxC,EAAyDC,cAAzD,EAAyEC,iBAAzE,EAA4FC,cAA5F,QAAkH,cAAlH;AACA,OAAO,KAAKC,MAAZ,MAAwB,kBAAxB;AACA,SAASC,WAAT,QAA4B,0BAA5B;AACA,SAASC,mBAAT,QAAoC,mCAApC;AACA,SAASC,QAAT,QAAyB,sBAAzB;AACA,OAAO,KAAKC,QAAZ,MAA0B,yBAA1B,C,CACA;;AACA;AACA;AACA;AACA;;AACA,IAAIC,KAAK;AAAG;AAAe,YAAY;EACnC;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACI,SAASA,KAAT,CAAeC,MAAf,EAAuBC,aAAvB,EAAsCC,aAAtC,EAAqDC,cAArD,EAAqE;IACjE,IAAIC,KAAK,GAAG,IAAZ,CADiE,CAEjE;;;IACA,KAAKC,YAAL,GAAoB,IAApB;IACA;;IACA,KAAKC,cAAL,GAAsB,KAAtB;IACA;;IACA,KAAKC,gBAAL,GAAwB,KAAxB;IACA,KAAKC,cAAL,GAAsB,KAAtB;IACA,KAAKC,gBAAL,GAAwB,KAAxB;IACA,KAAKC,iBAAL,GAAyB,EAAzB;IACA,KAAKC,aAAL,GAAqB/B,aAAa,CAAC,KAAD,EAAQ;MACtCgC,SAAS,EAAE,yCAD2B;MAEtCC,MAAM,EAAE,kBAF8B;MAEVC,KAAK,EAAE;QAAEC,MAAM,EAAE;MAAV;IAFG,CAAR,CAAlC;;IAIA,KAAKC,MAAL,GAAc,UAAUC,CAAV,EAAa;MACvB,IAAIC,IAAI,GAAGd,KAAK,CAACJ,MAAjB;MACA,IAAImB,MAAM,GAAGF,CAAC,CAACG,MAAF,CAASD,MAAtB;MACA,IAAIE,OAAO,GAAGF,MAAM,CAACpC,SAAP,CAAiBuC,QAAjB,CAA0B,mBAA1B,IAAiDH,MAAjD,GACV/B,YAAY,CAAC+B,MAAD,EAAS,mBAAT,CADhB;;MAEA,IAAI,CAACE,OAAD,IAAa,CAACF,MAAM,CAACpC,SAAP,CAAiBuC,QAAjB,CAA0B,QAA1B,CAAD,IAAwClB,KAAK,CAACH,aAAN,CAAoBsB,eAA7E,EAA+F;QAC3F,OAAO,KAAP;MACH;;MACDnB,KAAK,CAACoB,MAAN,GAAeN,IAAI,CAACO,gBAAL,CAAsBJ,OAAO,CAACK,iBAAR,CAA0BC,YAA1B,CAAuC,gBAAvC,CAAtB,CAAf;MACAvB,KAAK,CAACO,aAAN,CAAoBiB,WAApB,GAAkCP,OAAO,CAACO,WAA1C;MACAxB,KAAK,CAACO,aAAN,CAAoBkB,KAApB,CAA0BC,KAA1B,GAAkCT,OAAO,CAACU,WAAR,GAAsB,CAAtB,GAA0B,IAA5D;MACA3B,KAAK,CAACO,aAAN,CAAoBkB,KAApB,CAA0BG,MAA1B,GAAmCX,OAAO,CAACY,YAAR,GAAuB,CAAvB,GAA2B,IAA9D;;MACA7B,KAAK,CAACO,aAAN,CAAoBuB,YAApB,CAAiC,cAAjC,EAAiD9B,KAAK,CAACoB,MAAN,CAAaW,GAA9D;;MACAjB,IAAI,CAACG,OAAL,CAAae,WAAb,CAAyBhC,KAAK,CAACO,aAA/B;MACA,OAAOP,KAAK,CAACO,aAAb;IACH,CAfD,CAfiE,CA+BjE;;;IACA,KAAK0B,SAAL,GAAiB,UAAUpB,CAAV,EAAa;MAC1Bb,KAAK,CAACJ,MAAN,CAAaqB,OAAb,CAAqBtC,SAArB,CAA+BuD,GAA/B,CAAmC,eAAnC;IACH,CAFD;;IAGA,KAAKC,IAAL,GAAY,UAAUtB,CAAV,EAAa;MACrB,IAAIb,KAAK,CAACH,aAAN,CAAoBsB,eAAxB,EAAyC;QACrCnB,KAAK,CAACoC,cAAN,CAAqBvB,CAArB;MACH;;MACD,IAAIE,MAAM,GAAGF,CAAC,CAACE,MAAf;;MACA,IAAIsB,YAAY,GAAGrC,KAAK,CAACJ,MAAN,CAAaqB,OAAb,CAAqBqB,aAArB,CAAmC,oBAAnC,CAAnB;;MACAtC,KAAK,CAACJ,MAAN,CAAa2C,OAAb,CAAqBjD,MAAM,CAACkD,UAA5B,EAAwC;QAAEzB,MAAM,EAAEA,MAAV;QAAkB0B,aAAa,EAAE,YAAjC;QAA+CrB,MAAM,EAAEpB,KAAK,CAACoB;MAA7D,CAAxC;;MACA,IAAI,CAACpB,KAAK,CAACH,aAAN,CAAoBsB,eAAzB,EAA0C;QACtCxC,SAAS,CAAC0D,YAAD,EAAe,CAAC,cAAD,CAAf,EAAiC,CAAC,iBAAD,CAAjC,CAAT;;QACA,IAAI,EAAErD,YAAY,CAAC+B,MAAD,EAASrB,QAAQ,CAACgD,WAAlB,CAAZ,IAA8C1D,YAAY,CAAC+B,MAAD,EAAS,cAAT,CAA5D,CAAJ,EAA2F;UACvFpC,SAAS,CAAC0D,YAAD,EAAe,CAAC,iBAAD,CAAf,EAAoC,CAAC,cAAD,CAApC,CAAT;QACH;MACJ;IACJ,CAbD;;IAcA,KAAKM,QAAL,GAAgB,UAAU9B,CAAV,EAAa;MACzBb,KAAK,CAACJ,MAAN,CAAaqB,OAAb,CAAqBtC,SAArB,CAA+BD,MAA/B,CAAsC,eAAtC;;MACA,IAAIkE,WAAW,GAAG,EAAE5D,YAAY,CAAC6B,CAAC,CAACE,MAAH,EAAWrB,QAAQ,CAACgD,WAApB,CAAZ,IAAgD1D,YAAY,CAAC6B,CAAC,CAACE,MAAH,EAAW,cAAX,CAA9D,CAAlB;;MACA,IAAIf,KAAK,CAACH,aAAN,CAAoBsB,eAApB,IAAuCyB,WAA3C,EAAwD;QACpDlE,MAAM,CAACmC,CAAC,CAACD,MAAH,CAAN;;QACA,IAAI5B,YAAY,CAAC6B,CAAC,CAACE,MAAH,EAAW,iBAAX,CAAhB,EAA+C;UAC3Cf,KAAK,CAAC6C,cAAN;QACH,CAFD,MAGK,IAAI,CAAE7D,YAAY,CAAC6B,CAAC,CAACE,MAAH,EAAW,QAAX,CAAlB,EAAyC;UAC1C,IAAI+B,KAAK,GAAG9C,KAAK,CAACJ,MAAN,CAAamD,cAAb,CAA4BlC,CAAC,CAACD,MAAF,CAASW,YAAT,CAAsB,cAAtB,CAA5B,EAAmEuB,KAA/E;;UACA,IAAI9C,KAAK,CAACH,aAAN,CAAoBmD,OAApB,CAA4BC,OAA5B,CAAoCH,KAApC,MAA+C,CAAC,CAApD,EAAuD;YACnD9C,KAAK,CAACkD,aAAN,CAAoBJ,KAApB;UACH;QACJ;;QACD;MACH,CAZD,MAaK,IAAIF,WAAJ,EAAiB;QAClBlE,MAAM,CAACmC,CAAC,CAACD,MAAH,CAAN;QACA;MACH;IACJ,CApBD;;IAqBA,KAAKwB,cAAL,GAAsB,UAAUvB,CAAV,EAAa;MAC/B,IAAIkB,GAAG,GAAG/B,KAAK,CAACJ,MAAN,CAAaqB,OAAb,CAAqBqB,aAArB,CAAmC,oBAAnC,EAAyDf,YAAzD,CAAsE,cAAtE,CAAV;;MACA,IAAI4B,SAAS,GAAGnD,KAAK,CAACJ,MAAN,CAAamD,cAAb,CAA4BhB,GAA5B,EAAiCe,KAAjD;;MACA,IAAIlD,MAAM,GAAGZ,YAAY,CAAC6B,CAAC,CAACE,MAAH,EAAW,iBAAX,CAAzB;MACA,IAAIqC,UAAU,GAAGpE,YAAY,CAAC6B,CAAC,CAACE,MAAH,EAAW,kBAAX,CAA7B;MACA,IAAIsC,OAAO,GAAG,GAAGC,KAAH,CAASC,IAAT,CAAcvD,KAAK,CAACiB,OAAN,CAAcuC,sBAAd,CAAqC,mBAArC,CAAd,EACTC,GADS,CACL,UAAU5C,CAAV,EAAa;QAAE,OAAOA,CAAC,CAACyB,aAAF,CAAgB,KAAhB,EAAuBf,YAAvB,CAAoC,gBAApC,CAAP;MAA+D,CADzE,CAAd;MAEA,IAAImC,IAAI,GAAGC,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,SAAL,CAAeR,OAAf,CAAX,CAAX;;MACA,IAAID,UAAU,IAAIxD,MAAlB,EAA0B;QACtB,IAAIwD,UAAJ,EAAgB;UACZ,IAAIU,SAAS,GAAGV,UAAU,CAACd,aAAX,CAAyB,qBAAzB,EAAgDf,YAAhD,CAA6D,gBAA7D,CAAhB;UACA,IAAIwC,SAAS,GAAG,CAAEX,UAAU,CAAC7B,YAAX,CAAwB,OAAxB,CAAlB;;UACA,IAAIuC,SAAS,KAAKX,SAAlB,EAA6B;YACzB,IAAIa,SAAS,GAAGN,IAAI,CAACT,OAAL,CAAaE,SAAb,CAAhB;;YACA,IAAIa,SAAS,KAAK,CAAC,CAAnB,EAAsB;cAClBN,IAAI,CAACO,MAAL,CAAYD,SAAZ,EAAuB,CAAvB;YACH;;YACD,IAAIE,IAAI,GAAGH,SAAS,KAAK,CAAC,CAAf,IAAoBC,SAAS,KAAKD,SAA7C;YACAL,IAAI,CAACO,MAAL,CAAYF,SAAS,IAAIG,IAAI,GAAG,CAAH,GAAO,CAAf,CAArB,EAAwC,CAAxC,EAA2Cf,SAA3C;UACH;QACJ,CAXD,MAYK,IAAIvD,MAAM,IAAI8D,IAAI,CAACT,OAAL,CAAaE,SAAb,MAA4B,CAAC,CAA3C,EAA8C;UAC/CO,IAAI,CAACS,IAAL,CAAUhB,SAAV;QACH;;QACDnD,KAAK,CAACiB,OAAN,CAAcmD,SAAd,GAA0B,EAA1B;;QACA,IAAIV,IAAI,CAACW,MAAL,IAAe,CAACrE,KAAK,CAACiB,OAAN,CAActC,SAAd,CAAwBuC,QAAxB,CAAiC,WAAjC,CAApB,EAAmE;UAC/DlB,KAAK,CAACiB,OAAN,CAActC,SAAd,CAAwBuD,GAAxB,CAA4B,WAA5B;QACH;;QACDlC,KAAK,CAACM,iBAAN,GAA0BoD,IAA1B;;QACA,KAAK,IAAIY,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGZ,IAAI,CAACW,MAAzB,EAAiCC,CAAC,EAAlC,EAAsC;UAClCtE,KAAK,CAACuE,iBAAN,CAAwBb,IAAI,CAACY,CAAD,CAA5B;QACH;MACJ,CAxBD,MAyBK;QACDtE,KAAK,CAACwE,QAAN;;QACAxE,KAAK,CAACyE,sBAAN,CAA6BtB,SAA7B;MACH;IACJ,CArCD;;IAsCA,KAAKuB,IAAL,GAAY,UAAU7D,CAAV,EAAa;MACrB,IAAIC,IAAI,GAAGd,KAAK,CAACJ,MAAjB;MACA,IAAIwB,MAAM,GAAGN,IAAI,CAACiC,cAAL,CAAoBlC,CAAC,CAAC8D,cAAF,CAAiBpD,YAAjB,CAA8B,cAA9B,CAApB,CAAb;;MACAvB,KAAK,CAACiB,OAAN,CAActC,SAAd,CAAwBD,MAAxB,CAA+B,SAA/B;;MACAA,MAAM,CAACmC,CAAC,CAAC8D,cAAH,CAAN;;MACA3E,KAAK,CAAC4E,IAAN,CAAWC,aAAX,CAAyB7E,KAAK,CAACJ,MAAN,CAAaqB,OAAb,CAAqBqB,aAArB,CAAmC,kBAAnC,CAAzB,EAAiF,KAAjF;;MACAtC,KAAK,CAAC4E,IAAN,CAAWE,UAAX,CAAsB9E,KAAK,CAACJ,MAAN,CAAamF,cAAb,GAA8BzC,aAA9B,CAA4C,qBAA5C,CAAtB,EAA0F,KAA1F;;MACA,IAAIxD,iBAAiB,CAACsC,MAAD,CAAjB,IAA6BA,MAAM,CAAC4D,aAAP,KAAyB,KAAtD,IACAhG,YAAY,CAAC8B,IAAI,CAACmE,oBAAL,CAA0B7D,MAAM,CAACW,GAAjC,CAAD,EAAwC,QAAxC,CAAZ,CAA8DR,YAA9D,CAA2E,IAA3E,MACIT,IAAI,CAACG,OAAL,CAAaM,YAAb,CAA0B,IAA1B,CAFR,EAEyC;QACrCvB,KAAK,CAACJ,MAAN,CAAasF,GAAb,CAAiB,wBAAjB,EAA2C;UAAEC,UAAU,EAAEnF,KAAK,CAACoF,aAAN,EAAd;UAAqCC,UAAU,EAAEjE,MAAM,CAACkE;QAAxD,CAA3C;;QACA;MACH;;MACDtF,KAAK,CAACuF,WAAN,CAAkBnE,MAAM,CAAC0B,KAAzB;IACH,CAdD;;IAeA,KAAK0C,cAAL,GAAsB,IAAtB;IACA,KAAKZ,IAAL,GAAY,IAAIrF,WAAJ,EAAZ;IACA,KAAKK,MAAL,GAAcA,MAAd;IACA,KAAKC,aAAL,GAAqBA,aAArB;IACA,KAAKE,cAAL,GAAsBA,cAAtB;IACA,KAAKD,aAAL,GAAqBA,aAArB;IACA,KAAK2F,KAAL,GAAa1F,cAAc,CAAC2F,UAAf,CAA0B,OAA1B,CAAb;IACA,KAAKC,gBAAL;IACA,KAAKC,cAAL,GAAsB,IAAIpG,mBAAJ,CAAwB,KAAKI,MAA7B,CAAtB;EACH;;EACDD,KAAK,CAACkG,SAAN,CAAgBrB,QAAhB,GAA2B,YAAY;IACnC,IAAI,CAAC,KAAKvD,OAAL,CAAauC,sBAAb,CAAoC,kBAApC,EAAwDa,MAA7D,EAAqE;MACjE,IAAIyB,SAAS,GAAG,KAAKC,IAAL,CAAUC,WAAV,CAAsB,eAAtB,CAAhB;MACA,KAAK/E,OAAL,CAAamD,SAAb,GAAyB0B,SAAzB;MACA,KAAK7E,OAAL,CAAatC,SAAb,CAAuBD,MAAvB,CAA8B,WAA9B;IACH;EACJ,CAND;;EAOAiB,KAAK,CAACkG,SAAN,CAAgBhD,cAAhB,GAAiC,YAAY;IACzC,KAAK5C,YAAL,GAAoB,KAApB;IACA,KAAKgG,WAAL;EACH,CAHD;;EAIAtG,KAAK,CAACkG,SAAN,CAAgBrD,UAAhB,GAA6B,UAAU3B,CAAV,EAAa;IACtC,IAAI,KAAKhB,aAAL,CAAmBsB,eAAnB,IAAsCN,CAAC,CAACO,MAAF,CAAS4D,aAAnD,EAAkE;MAC9D,KAAK5C,cAAL,CAAoBvB,CAApB;IACH;;IACD,IAAIwB,YAAY,GAAG,KAAKzC,MAAL,CAAYqB,OAAZ,CAAoBqB,aAApB,CAAkC,oBAAlC,CAAnB;IACA3D,SAAS,CAAC0D,YAAD,EAAe,CAAC,cAAD,CAAf,EAAiC,CAAC,iBAAD,CAAjC,CAAT;;IACA,IAAI,CAACrD,YAAY,CAAC6B,CAAC,CAACE,MAAH,EAAW,iBAAX,CAAb,IACA,EAAE,KAAKnB,MAAL,CAAYuB,eAAZ,IAA+BnC,YAAY,CAAC6B,CAAC,CAACE,MAAH,EAAW,cAAX,CAA7C,CADJ,EAC8E;MAC1EpC,SAAS,CAAC0D,YAAD,EAAe,CAAC,iBAAD,CAAf,EAAoC,CAAC,cAAD,CAApC,CAAT;IACH;;IACD,IAAIxB,CAAC,CAACE,MAAF,CAASpC,SAAT,CAAmBuC,QAAnB,CAA4B,iBAA5B,CAAJ,EAAoD;MAChD,KAAKD,OAAL,CAAatC,SAAb,CAAuBuD,GAAvB,CAA2B,SAA3B;IACH,CAFD,MAGK;MACD,KAAKjB,OAAL,CAAatC,SAAb,CAAuBD,MAAvB,CAA8B,SAA9B;IACH;EACJ,CAhBD;;EAiBAiB,KAAK,CAACkG,SAAN,CAAgBK,eAAhB,GAAkC,UAAUrF,CAAV,EAAa;IAC3C,IAAIA,CAAC,CAACE,MAAF,CAASpC,SAAT,CAAmBuC,QAAnB,CAA4B,qBAA5B,CAAJ,EAAwD;MACpD;IACH;;IACD,IAAIiF,QAAQ,GAAG,KAAKvG,MAAL,CAAYqB,OAAZ,CAAoBqB,aAApB,CAAkC,kBAAlC,CAAf;IACA,KAAKsC,IAAL,CAAUC,aAAV,CAAwBsB,QAAxB,EAAkCtF,CAAC,CAACO,MAAF,CAAS4D,aAA3C;IACA,IAAI/D,OAAO,GAAGJ,CAAC,CAACE,MAAF,CAASpC,SAAT,CAAmBuC,QAAnB,CAA4B,cAA5B,IAA8CL,CAAC,CAACE,MAAhD,GAAyD/B,YAAY,CAAC6B,CAAC,CAACE,MAAH,EAAW,cAAX,CAAnF;IACA,KAAK6D,IAAL,CAAUE,UAAV,CAAqB7D,OAArB,EAA8B,IAA9B,EAAoC,CAACJ,CAAC,CAACO,MAAF,CAAS4D,aAA9C;EACH,CARD;;EASArF,KAAK,CAACkG,SAAN,CAAgBO,UAAhB,GAA6B,UAAUvF,CAAV,EAAa;IACtC,IAAIC,IAAI,GAAG,KAAKlB,MAAhB;;IACA,IAAIiB,CAAC,CAAC8D,cAAF,CAAiBpD,YAAjB,CAA8B,QAA9B,MAA4C,UAAhD,EAA4D;MACxD,IAAIH,MAAM,GAAGN,IAAI,CAACiC,cAAL,CAAoBlC,CAAC,CAAC8D,cAAF,CAAiBpD,YAAjB,CAA8B,cAA9B,CAApB,CAAb;;MACA,IAAIzC,iBAAiB,CAACsC,MAAD,CAAjB,IAA6BA,MAAM,CAAC4D,aAAP,KAAyB,KAAtD,IACAhG,YAAY,CAAC8B,IAAI,CAACmE,oBAAL,CAA0B7D,MAAM,CAACW,GAAjC,CAAD,EAAwC,QAAxC,CAAZ,CAA8DR,YAA9D,CAA2E,IAA3E,MACIT,IAAI,CAACG,OAAL,CAAaM,YAAb,CAA0B,IAA1B,CAFR,EAEyC;QACrC;MACH;;MACD,KAAK2B,aAAL,CAAmB9B,MAAM,CAAC0B,KAA1B;IACH;EACJ,CAXD;EAYA;AACJ;AACA;AACA;;;EACInD,KAAK,CAACkG,SAAN,CAAgBF,gBAAhB,GAAmC,YAAY;IAC3C,IAAI,KAAK/F,MAAL,CAAYyG,WAAhB,EAA6B;MACzB;IACH;;IACD,KAAKzG,MAAL,CAAY0G,EAAZ,CAAehH,MAAM,CAACiH,QAAtB,EAAgC,KAAKC,iBAArC,EAAwD,IAAxD;IACA,KAAK5G,MAAL,CAAY0G,EAAZ,CAAehH,MAAM,CAACmH,aAAtB,EAAqC,KAAKC,gBAA1C,EAA4D,IAA5D;IACA,KAAK9G,MAAL,CAAY0G,EAAZ,CAAehH,MAAM,CAACqH,eAAtB,EAAuC,KAAKD,gBAA5C,EAA8D,IAA9D;IACA,KAAK9G,MAAL,CAAY0G,EAAZ,CAAehH,MAAM,CAACsH,mBAAtB,EAA2C,KAAKC,iBAAhD,EAAmE,IAAnE;IACA,KAAKjH,MAAL,CAAY0G,EAAZ,CAAehH,MAAM,CAACwH,KAAtB,EAA6B,KAAKC,YAAlC,EAAgD,IAAhD;IACA,KAAKnH,MAAL,CAAY0G,EAAZ,CAAehH,MAAM,CAACkD,UAAtB,EAAkC,KAAKA,UAAvC,EAAmD,IAAnD;IACA,KAAK5C,MAAL,CAAY0G,EAAZ,CAAehH,MAAM,CAAC4G,eAAtB,EAAuC,KAAKA,eAA5C,EAA6D,IAA7D;IACA,KAAKtG,MAAL,CAAY0G,EAAZ,CAAehH,MAAM,CAAC0H,UAAtB,EAAkC,KAAKZ,UAAvC,EAAmD,IAAnD;IACA,KAAKxG,MAAL,CAAY0G,EAAZ,CAAehH,MAAM,CAAC8G,UAAtB,EAAkC,KAAKA,UAAvC,EAAmD,IAAnD;IACA,KAAKxG,MAAL,CAAY0G,EAAZ,CAAehH,MAAM,CAAC2H,eAAtB,EAAuC,KAAKC,gBAA5C,EAA8D,IAA9D;IACA,KAAKtH,MAAL,CAAY0G,EAAZ,CAAehH,MAAM,CAAC6H,YAAtB,EAAoC,KAAKD,gBAAzC,EAA2D,IAA3D;IACA,KAAKtH,MAAL,CAAY0G,EAAZ,CAAehH,MAAM,CAAC8H,UAAtB,EAAkC,KAAKC,eAAvC,EAAwD,IAAxD;IACA,KAAKzH,MAAL,CAAY0G,EAAZ,CAAehH,MAAM,CAACgI,YAAtB,EAAoC,KAAKC,UAAzC,EAAqD,IAArD;IACA,KAAK3H,MAAL,CAAY0G,EAAZ,CAAehH,MAAM,CAACkI,OAAtB,EAA+B,KAAKD,UAApC,EAAgD,IAAhD;IACA,KAAK3H,MAAL,CAAY0G,EAAZ,CAAehH,MAAM,CAACiI,UAAtB,EAAkC,KAAKE,MAAvC,EAA+C,IAA/C;IACA,KAAK7H,MAAL,CAAY0G,EAAZ,CAAehH,MAAM,CAACoI,eAAtB,EAAuC,KAAKC,iBAA5C,EAA+D,IAA/D;IACA,KAAK/H,MAAL,CAAY0G,EAAZ,CAAehH,MAAM,CAACsI,OAAtB,EAA+B,KAAKA,OAApC,EAA6C,IAA7C;IACA,KAAKhI,MAAL,CAAY0G,EAAZ,CAAe,uBAAf,EAAwC,KAAKuB,YAA7C,EAA2D,IAA3D;IACA,KAAKjI,MAAL,CAAY0G,EAAZ,CAAe,sBAAf,EAAuC,KAAKiB,UAA5C,EAAwD,IAAxD;EACH,CAvBD;EAwBA;AACJ;AACA;AACA;;;EACI5H,KAAK,CAACkG,SAAN,CAAgBiC,mBAAhB,GAAsC,YAAY;IAC9C,IAAI,KAAKlI,MAAL,CAAYyG,WAAhB,EAA6B;MACzB;IACH;;IACD,KAAKzG,MAAL,CAAYmI,GAAZ,CAAgBzI,MAAM,CAACiI,UAAvB,EAAmC,KAAKE,MAAxC;IACA,KAAK7H,MAAL,CAAYmI,GAAZ,CAAgBzI,MAAM,CAACiH,QAAvB,EAAiC,KAAKC,iBAAtC;IACA,KAAK5G,MAAL,CAAYmI,GAAZ,CAAgBzI,MAAM,CAACmH,aAAvB,EAAsC,KAAKC,gBAA3C;IACA,KAAK9G,MAAL,CAAYmI,GAAZ,CAAgBzI,MAAM,CAACqH,eAAvB,EAAwC,KAAKD,gBAA7C;IACA,KAAK9G,MAAL,CAAYmI,GAAZ,CAAgBzI,MAAM,CAACsH,mBAAvB,EAA4C,KAAKC,iBAAjD;IACA,KAAKjH,MAAL,CAAYmI,GAAZ,CAAgBzI,MAAM,CAACwH,KAAvB,EAA8B,KAAKC,YAAnC;IACA,KAAKnH,MAAL,CAAYmI,GAAZ,CAAgBzI,MAAM,CAACkD,UAAvB,EAAmC,KAAKA,UAAxC;IACA,KAAK5C,MAAL,CAAYmI,GAAZ,CAAgBzI,MAAM,CAAC4G,eAAvB,EAAwC,KAAKA,eAA7C;IACA,KAAKtG,MAAL,CAAYmI,GAAZ,CAAgBzI,MAAM,CAAC8G,UAAvB,EAAmC,KAAKA,UAAxC;IACA,KAAKxG,MAAL,CAAYmI,GAAZ,CAAgBzI,MAAM,CAAC0H,UAAvB,EAAmC,KAAKZ,UAAxC;IACA,KAAKxG,MAAL,CAAYmI,GAAZ,CAAgBzI,MAAM,CAAC2H,eAAvB,EAAwC,KAAKC,gBAA7C;IACA,KAAKtH,MAAL,CAAYmI,GAAZ,CAAgBzI,MAAM,CAAC6H,YAAvB,EAAqC,KAAKD,gBAA1C;IACA,KAAKtH,MAAL,CAAYmI,GAAZ,CAAgBzI,MAAM,CAAC8H,UAAvB,EAAmC,KAAKC,eAAxC;IACA,KAAKzH,MAAL,CAAYmI,GAAZ,CAAgBzI,MAAM,CAACoI,eAAvB,EAAwC,KAAKC,iBAA7C;IACA,KAAK/H,MAAL,CAAYmI,GAAZ,CAAgBzI,MAAM,CAACsI,OAAvB,EAAgC,KAAKA,OAArC;IACA,KAAKhI,MAAL,CAAYmI,GAAZ,CAAgB,uBAAhB,EAAyC,KAAKF,YAA9C;EACH,CApBD;;EAqBAlI,KAAK,CAACkG,SAAN,CAAgB0B,UAAhB,GAA6B,YAAY;IACrC,IAAIzG,IAAI,GAAG,KAAKlB,MAAhB;IACA,KAAKA,MAAL,CAAYmI,GAAZ,CAAgBzI,MAAM,CAACgI,YAAvB,EAAqC,KAAKC,UAA1C;IACA,KAAK3H,MAAL,CAAYmI,GAAZ,CAAgBzI,MAAM,CAACkI,OAAvB,EAAgC,KAAKD,UAArC;;IACA,IAAI,KAAK3H,MAAL,CAAYoI,UAAZ,GAAyB3D,MAAzB,IAAmC,KAAKxE,aAAL,CAAmBmD,OAAnB,CAA2BqB,MAAlE,EAA0E;MACtE,KAAKmB,cAAL,GAAsB,KAAtB;;MACA,KAAK,IAAIyC,EAAE,GAAG,CAAT,EAAYC,EAAE,GAAGpH,IAAI,CAACjB,aAAL,CAAmBmD,OAAzC,EAAkDiF,EAAE,GAAGC,EAAE,CAAC7D,MAA1D,EAAkE4D,EAAE,EAApE,EAAwE;QACpE,IAAIE,GAAG,GAAGD,EAAE,CAACD,EAAD,CAAZ;QACA,KAAK1C,WAAL,CAAiB4C,GAAjB;MACH;;MACD,KAAK3C,cAAL,GAAsB,IAAtB;IACH;EACJ,CAZD;;EAaA7F,KAAK,CAACkG,SAAN,CAAgBwB,eAAhB,GAAkC,UAAUxG,CAAV,EAAa;IAC3C,IAAIC,IAAI,GAAG,KAAKlB,MAAhB;;IACA,IAAIiB,CAAC,CAACE,MAAF,IAAY/B,YAAY,CAAC6B,CAAC,CAACE,MAAH,EAAW,mBAAX,CAAxB,KAA4DF,CAAC,CAACF,MAAF,KAAa,KAAb,IAAsBE,CAAC,CAACF,MAAF,KAAa,UAA/F,CAAJ,EAAgH;MAC5G,IAAIyH,qBAAqB,GAAG,KAAKC,wBAAL,EAA5B;;MACA,IAAKxH,CAAC,CAACF,MAAF,KAAa,KAAb,IAAsBE,CAAC,CAACE,MAAF,KAAaqH,qBAAqB,CAACA,qBAAqB,CAAC/D,MAAtB,GAA+B,CAAhC,CAAzD,IACIxD,CAAC,CAACF,MAAF,KAAa,UAAb,IAA2BE,CAAC,CAACE,MAAF,KAAaqH,qBAAqB,CAAC,CAAD,CADrE,EAC2E;QACvE;MACH;;MACD,KAAK,IAAIE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,qBAAqB,CAAC/D,MAA1C,EAAkDiE,CAAC,EAAnD,EAAuD;QACnD,IAAIzH,CAAC,CAACE,MAAF,KAAaqH,qBAAqB,CAACE,CAAD,CAAtC,EAA2C;UACvCzH,CAAC,CAAC0H,cAAF;UACA,IAAIC,KAAK,GAAG3H,CAAC,CAACF,MAAF,KAAa,KAAb,GAAqB2H,CAAC,GAAG,CAAzB,GAA6BA,CAAC,GAAG,CAA7C;UACAF,qBAAqB,CAACI,KAAD,CAArB,CAA6B/C,KAA7B;UACA;QACH;MACJ;IACJ;;IACD,IAAI5E,CAAC,CAACF,MAAF,KAAa,WAAb,KAA6B,CAAC,KAAKd,aAAL,CAAmBmD,OAAnB,CAA2BqB,MAA5B,IAC7B,CAAC,cAAD,EAAiB,YAAjB,EAA+B,eAA/B,EAAgD,aAAhD,EAA+D,OAA/D,EAAwEpB,OAAxE,CAAgFpC,CAAC,CAACF,MAAlF,MAA8F,CAAC,CAD/F,CAAJ,EACuG;MACnG;IACH;;IACDE,CAAC,CAAC0H,cAAF;;IACA,QAAQ1H,CAAC,CAACF,MAAV;MACI,KAAK,cAAL;MACA,KAAK,YAAL;QACI;QACA,IAAI8H,QAAQ,GAAG3H,IAAI,CAAC4H,cAAL,GAAsB5H,IAAI,CAAC6H,qBAAL,EAAtB,GAAqD,EAApE;;QACA,IAAIF,QAAQ,CAACpE,MAAb,EAAqB;UACjB,IAAIuE,IAAI,GAAG9H,IAAI,CAAC+H,eAAL,GAAuBvG,aAAvB,CAAqC5C,QAAQ,CAACoJ,KAA9C,EAAqDC,QAAhE;UACA,IAAIC,OAAO,GAAGlI,IAAI,CAACmI,WAAL,GAAmBR,QAAQ,CAACA,QAAQ,CAACpE,MAAT,GAAkB,CAAnB,CAA3B,CAAd;UACA,IAAI6E,MAAM,GAAG,KAAK,CAAlB;;UACA,KAAK,IAAIZ,CAAC,GAAGU,OAAO,CAACG,QAArB,EAA+Bb,CAAC,IAAI,CAApC,EAAuCA,CAAC,EAAxC,EAA4C;YACxC,IAAI,CAACM,IAAI,CAACN,CAAD,CAAJ,CAAQ3J,SAAR,CAAkBuC,QAAlB,CAA2BxB,QAAQ,CAAC0J,GAApC,CAAD,IAA6C,CAACR,IAAI,CAACN,CAAD,CAAJ,CAAQ3J,SAAR,CAAkBuC,QAAlB,CAA2B,aAA3B,CAAlD,EAA6F;cACzFgI,MAAM,GAAGN,IAAI,CAACN,CAAD,CAAb;cACA;YACH;UACJ;;UACD,KAAKe,kBAAL,CAAwBH,MAAM,CAAC5G,aAAP,CAAqBzB,CAAC,CAACF,MAAF,KAAa,YAAb,GACzC,qBADyC,GACjB,uBADJ,CAAxB;QAEH;;QACD;;MACJ,KAAK,eAAL;QACI,KAAK2I,SAAL;QACA;;MACJ,KAAK,aAAL;QACI,KAAKC,WAAL;QACA;;MACJ,KAAK,OAAL;QACI,IAAI1I,CAAC,CAACE,MAAF,CAASpC,SAAT,CAAmBuC,QAAnB,CAA4B,aAA5B,CAAJ,EAAgD;UAC5C,KAAKhB,cAAL,GAAsB,IAAtB;UACA,KAAKsJ,mBAAL,CAAyB3I,CAAC,CAACE,MAA3B;UACA;QACH,CAJD,MAKK,IAAIF,CAAC,CAACE,MAAF,CAASpC,SAAT,CAAmBuC,QAAnB,CAA4B,iBAA5B,CAAJ,EAAoD;UACrD,KAAKf,gBAAL,GAAwB,IAAxB;UACA,KAAKsJ,iBAAL,CAAuB5I,CAAC,CAACE,MAAzB;UACA;QACH;;QACD,IAAI,KAAKnB,MAAL,CAAY8J,MAAZ,IAAuBjL,OAAO,CAACoC,CAAC,CAACE,MAAH,EAAW,MAAM,KAAKnB,MAAL,CAAYqB,OAAZ,CAAoB0I,EAA1B,GAA+B,YAA1C,CAAP,KAAmE,IAA1F,IACA3K,YAAY,CAAC6B,CAAC,CAACE,MAAH,EAAW,SAAX,CADhB,EACuC;UACnC;QACH,CAdL,CAeI;;;QACA,IAAIE,OAAO,GAAG,KAAKwE,KAAL,CAAWmE,iBAAX,EAAd;;QACA,IAAI3I,OAAO,CAACtC,SAAR,CAAkBuC,QAAlB,CAA2B,oBAA3B,KAAoDD,OAAO,CAACtC,SAAR,CAAkBuC,QAAlB,CAA2B,mBAA3B,CAAxD,EAAyG;UACrGD,OAAO,GAAGA,OAAO,CAAC4I,aAAlB;QACH,CAnBL,CAoBI;;;QACA,IAAIT,GAAG,GAAGnI,OAAO,GAAGA,OAAO,CAAC4I,aAAR,CAAsBvH,aAAtB,CAAoC,qBAApC,CAAH,GAAgE,IAAjF;;QACA,IAAI,CAAC8G,GAAL,EAAU;UACN;QACH;;QACD,KAAKC,kBAAL,CAAwBD,GAAxB;QACA;;MACJ,KAAK,WAAL;QACI;QACA,IAAIU,IAAI,GAAGhJ,IAAI,CAACiJ,WAAL,CAAiBC,WAAjB,CAA6B/I,OAAxC;;QACA,IAAI6I,IAAI,IAAIA,IAAI,CAACnL,SAAL,CAAeuC,QAAf,CAAwB,cAAxB,CAAZ,EAAqD;UACjD,IAAIE,MAAM,GAAGN,IAAI,CAACiC,cAAL,CAAoB+G,IAAI,CAACxI,iBAAL,CAAuBC,YAAvB,CAAoC,cAApC,CAApB,CAAb;;UACA,IAAIH,MAAM,CAAC0B,KAAP,IAAgBhC,IAAI,CAACjB,aAAL,CAAmBmD,OAAnB,CAA2BC,OAA3B,CAAmC7B,MAAM,CAAC0B,KAA1C,IAAmD,CAAvE,EAA0E;YACtE,KAAKyC,WAAL,CAAiBnE,MAAM,CAAC0B,KAAxB;UACH,CAFD,MAGK;YACD,KAAKI,aAAL,CAAmB9B,MAAM,CAAC0B,KAA1B;UACH;QACJ;;QACD;IAhER;EAkEH,CAxFD;EAyFA;AACJ;AACA;;;EACInD,KAAK,CAACkG,SAAN,CAAgBwC,wBAAhB,GAA2C,YAAY;IACnD,IAAID,qBAAqB,GAAG,EAA5B;;IACA,IAAI,KAAKvI,aAAL,CAAmBmD,OAAnB,CAA2BqB,MAA/B,EAAuC;MACnC,IAAI4F,2BAA2B,GAAG,KAAKhJ,OAAL,CAAaiJ,gBAAb,CAA8B,oBAA9B,CAAlC;;MACA,KAAK,IAAI5B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG2B,2BAA2B,CAAC5F,MAAhD,EAAwDiE,CAAC,EAAzD,EAA6D;QACzDF,qBAAqB,CAACjE,IAAtB,CAA2B8F,2BAA2B,CAAC3B,CAAD,CAA3B,CAA+BhG,aAA/B,CAA6C,cAA7C,CAA3B;QACA8F,qBAAqB,CAACjE,IAAtB,CAA2B8F,2BAA2B,CAAC3B,CAAD,CAA3B,CAA+BhG,aAA/B,CAA6C,cAA7C,CAA3B;QACA8F,qBAAqB,CAACjE,IAAtB,CAA2B8F,2BAA2B,CAAC3B,CAAD,CAA3B,CAA+BhG,aAA/B,CAA6C,kBAA7C,CAA3B;MACH;IACJ;;IACD,OAAO8F,qBAAP;EACH,CAXD;;EAYAzI,KAAK,CAACkG,SAAN,CAAgBsE,SAAhB,GAA4B,YAAY;IACpC5L,YAAY,CAAC2D,GAAb,CAAiB,KAAKjB,OAAtB,EAA+B,SAA/B,EAA0C,KAAKmJ,SAA/C,EAA0D,IAA1D;IACA7L,YAAY,CAAC2D,GAAb,CAAiB,KAAKjB,OAAtB,EAA+B,UAA/B,EAA2C,KAAKoJ,UAAhD,EAA4D,IAA5D;EACH,CAHD;;EAIA1K,KAAK,CAACkG,SAAN,CAAgByE,WAAhB,GAA8B,YAAY;IACtC/L,YAAY,CAACG,MAAb,CAAoB,KAAKuC,OAAzB,EAAkC,SAAlC,EAA6C,KAAKmJ,SAAlD;IACA7L,YAAY,CAACG,MAAb,CAAoB,KAAKuC,OAAzB,EAAkC,UAAlC,EAA8C,KAAKoJ,UAAnD;EACH,CAHD;;EAIA1K,KAAK,CAACkG,SAAN,CAAgBuE,SAAhB,GAA4B,UAAUvJ,CAAV,EAAa;IACrC,IAAI,KAAKjB,MAAL,CAAYmK,WAAZ,CAAwBC,WAAxB,IAAuC,KAAKpK,MAAL,CAAYmK,WAAZ,CAAwBC,WAAxB,CAAoC/I,OAA/E,EAAwF;MACpFpC,WAAW,CAAC,CAAC,KAAKe,MAAL,CAAYmK,WAAZ,CAAwBC,WAAxB,CAAoC/I,OAArC,EAA8C,KAAKrB,MAAL,CAAYmK,WAAZ,CAAwBC,WAAxB,CAAoCO,cAAlF,CAAD,EAAoG,CAAC,WAAD,EAAc,SAAd,CAApG,CAAX;MACA,KAAK3K,MAAL,CAAYmK,WAAZ,CAAwBC,WAAxB,CAAoC/I,OAApC,CAA4CuJ,QAA5C,GAAuD,CAAC,CAAxD;IACH;;IACD,KAAKC,gBAAL,CAAsB5J,CAAtB;EACH,CAND;;EAOAlB,KAAK,CAACkG,SAAN,CAAgBwE,UAAhB,GAA6B,UAAUxJ,CAAV,EAAa;IACtC,KAAK4J,gBAAL,CAAsB5J,CAAtB;EACH,CAFD;;EAGAlB,KAAK,CAACkG,SAAN,CAAgB4E,gBAAhB,GAAmC,UAAU5J,CAAV,EAAa;IAC5C,IAAIA,CAAC,CAACE,MAAF,CAASpC,SAAT,CAAmBuC,QAAnB,CAA4B,iBAA5B,KAAkDL,CAAC,CAACE,MAAF,CAASpC,SAAT,CAAmBuC,QAAnB,CAA4B,aAA5B,CAAlD,IACGL,CAAC,CAACE,MAAF,CAASpC,SAAT,CAAmBuC,QAAnB,CAA4B,aAA5B,CADH,IAEGL,CAAC,CAACE,MAAF,CAASpC,SAAT,CAAmBuC,QAAnB,CAA4B,iBAA5B,CAFP,EAEuD;MACnD,IAAIH,MAAM,GAAGF,CAAC,CAACE,MAAF,CAASpC,SAAT,CAAmBuC,QAAnB,CAA4B,aAA5B,IACTL,CAAC,CAACE,MAAF,CAAS8I,aAAT,CAAuBA,aADd,GAC8BhJ,CAAC,CAACE,MAD7C;;MAEA,IAAIF,CAAC,CAAC6J,IAAF,KAAW,SAAf,EAA0B;QACtB9L,QAAQ,CAAC,CAACmC,MAAD,CAAD,EAAW,CAAC,WAAD,EAAc,SAAd,CAAX,CAAR;QACAA,MAAM,CAACyJ,QAAP,GAAkB,CAAlB;MACH,CAHD,MAIK;QACD3L,WAAW,CAAC,CAACkC,MAAD,CAAD,EAAW,CAAC,WAAD,EAAc,SAAd,CAAX,CAAX;QACAA,MAAM,CAACyJ,QAAP,GAAkB,CAAC,CAAnB;MACH;IACJ;EACJ,CAfD;;EAgBA7K,KAAK,CAACkG,SAAN,CAAgBkB,YAAhB,GAA+B,UAAUlG,CAAV,EAAa;IACxC,IAAIA,CAAC,CAACE,MAAF,CAASpC,SAAT,CAAmBuC,QAAnB,CAA4B,aAA5B,CAAJ,EAAgD;MAC5C,KAAKhB,cAAL,GAAsB,IAAtB;IACH;;IACD,IAAIW,CAAC,CAACE,MAAF,CAASpC,SAAT,CAAmBuC,QAAnB,CAA4B,iBAA5B,CAAJ,EAAoD;MAChD,KAAKf,gBAAL,GAAwB,IAAxB;IACH;;IACD,KAAKkJ,kBAAL,CAAwBxI,CAAC,CAACE,MAA1B;IACA,KAAKyI,mBAAL,CAAyB3I,CAAC,CAACE,MAA3B;IACA,KAAK0I,iBAAL,CAAuB5I,CAAC,CAACE,MAAzB;IACA,KAAK4J,qBAAL,CAA2B9J,CAAC,CAACE,MAA7B;EACH,CAXD;;EAYApB,KAAK,CAACkG,SAAN,CAAgB4D,iBAAhB,GAAoC,UAAU1I,MAAV,EAAkB;IAClD,IAAIA,MAAM,CAACpC,SAAP,CAAiBuC,QAAjB,CAA0B,iBAA1B,CAAJ,EAAkD;MAC9C,KAAKgC,aAAL,CAAmBnC,MAAM,CAAC8I,aAAP,CAAqBtI,YAArB,CAAkC,gBAAlC,CAAnB;IACH;EACJ,CAJD;;EAKA5B,KAAK,CAACkG,SAAN,CAAgB8E,qBAAhB,GAAwC,UAAU5J,MAAV,EAAkB;IACtD,IAAI,KAAKlB,aAAL,CAAmB+K,gBAAvB,EAAyC;MACrC,IAAI7J,MAAM,CAACpC,SAAP,CAAiBuC,QAAjB,CAA0B,gBAA1B,CAAJ,EAAiD;QAC7C,IAAIH,MAAM,CAACpC,SAAP,CAAiBuC,QAAjB,CAA0B,iBAA1B,CAAJ,EAAkD;UAC9C,KAAKgC,aAAL,CAAmB,KAAKtD,MAAL,CAAYmD,cAAZ,CAA2BhC,MAAM,CAAC8I,aAAP,CAAqBtI,YAArB,CAAkC,cAAlC,CAA3B,EAA8EuB,KAAjG;QACH,CAFD,MAGK;UACD,KAAKyC,WAAL,CAAiB,KAAK3F,MAAL,CAAYmD,cAAZ,CAA2BhC,MAAM,CAAC8I,aAAP,CAAqBtI,YAArB,CAAkC,cAAlC,CAA3B,EAA8EuB,KAA/F;QACH;MACJ,CAPD,MAQK;QACD,IAAI/B,MAAM,CAACpC,SAAP,CAAiBuC,QAAjB,CAA0B,iBAA1B,CAAJ,EAAkD;UAC9C,KAAKgC,aAAL,CAAmBnC,MAAM,CAAC8I,aAAP,CAAqBtI,YAArB,CAAkC,gBAAlC,CAAnB;QACH;MACJ;IACJ;EACJ,CAhBD;;EAiBA5B,KAAK,CAACkG,SAAN,CAAgB2D,mBAAhB,GAAsC,UAAUzI,MAAV,EAAkB;IACpD,IAAID,IAAI,GAAG,KAAKlB,MAAhB;IACA,IAAIiL,OAAO,GAAGpM,OAAO,CAACsC,MAAD,EAAS,oBAAT,CAArB;;IACA,IAAID,IAAI,CAACgK,YAAL,IAAqBD,OAArB,IAAgC,CAAC9J,MAAM,CAACpC,SAAP,CAAiBuC,QAAjB,CAA0B,iBAA1B,CAAjC,IACA,CAACH,MAAM,CAACpC,SAAP,CAAiBuC,QAAjB,CAA0B,iBAA1B,CADL,EACmD;MAC/C,IAAI4B,KAAK,GAAG+H,OAAO,CAACvJ,iBAAR,CAA0BC,YAA1B,CAAuC,gBAAvC,CAAZ;;MACA,IAAIT,IAAI,CAACiK,sBAAL,CAA4BjI,KAA5B,EAAmCU,sBAAnC,CAA0D,aAA1D,EAAyEa,MAA7E,EAAqF;QACjFvD,IAAI,CAACkK,UAAL,CAAgBlI,KAAhB,EAAuB,YAAvB,EAAqC,IAArC;MACH,CAFD,MAGK;QACDhC,IAAI,CAACkK,UAAL,CAAgBlI,KAAhB,EAAuB,WAAvB,EAAoC,IAApC;MACH;IACJ;EACJ,CAbD;EAcA;AACJ;AACA;AACA;AACA;AACA;;;EACInD,KAAK,CAACkG,SAAN,CAAgBwD,kBAAhB,GAAqC,UAAUtI,MAAV,EAAkB;IACnD,IAAIkK,IAAI,GAAGjM,YAAY,CAAC+B,MAAD,EAAS,oBAAT,CAAZ,IACP/B,YAAY,CAAC+B,MAAD,EAAS,sBAAT,CADhB;;IAEA,IAAIkK,IAAJ,EAAU;MACN,IAAIC,QAAQ,GAAG,KAAKtL,MAAL,CAAYiJ,eAAZ,GAA8BvG,aAA9B,CAA4C5C,QAAQ,CAACoJ,KAArD,EAA4DC,QAA3E;MACA,IAAIoC,MAAM,GAAG,KAAK,CAAlB;MACA,IAAIC,WAAW,GAAG,KAAK,CAAvB;MACA,IAAIC,KAAK,GAAG,KAAK,CAAjB;MACA,IAAIvK,IAAI,GAAG,KAAKlB,MAAhB;MACA,IAAI0L,MAAM,GAAGL,IAAI,CAACpB,aAAL,CAAmBrG,sBAAnB,CAA0C,cAA1C,EAA0Da,MAAvE;MACA,IAAItC,GAAG,GAAGkJ,IAAI,CAACpB,aAAL,CAAmBtI,YAAnB,CAAgC,UAAhC,CAAV;MACA,IAAIgK,UAAU,GAAGzK,IAAI,CAAC0K,mBAAL,CAAyBzJ,GAAzB,CAAjB;MACA,IAAI0J,MAAM,GAAG,KAAb;;MACA,IAAIR,IAAI,CAACtM,SAAL,CAAeuC,QAAf,CAAwB,sBAAxB,CAAJ,EAAqD;QACjDtC,QAAQ,CAAC,CAACqM,IAAD,CAAD,EAAS,oBAAT,CAAR;QACApM,WAAW,CAAC,CAACoM,IAAD,CAAD,EAAS,sBAAT,CAAX;QACAA,IAAI,CAAC3J,iBAAL,CAAuBd,SAAvB,GAAmC,2CAAnC;QACAyK,IAAI,CAAC3J,iBAAL,CAAuBQ,YAAvB,CAAoC,OAApC,EAA6C,UAA7C;QACA2J,MAAM,GAAG,IAAT;QACAF,UAAU,CAACG,QAAX,GAAsB,IAAtB;;QACA,IAAIxM,eAAe,CAAC4B,IAAD,CAAnB,EAA2B;UACvB,KAAK6K,iBAAL,CAAuB7K,IAAvB,EAA6BC,MAA7B,EAAqC0K,MAArC,EAA6CJ,KAA7C,EAAoDD,WAApD;QACH;;QACD,IAAI,KAAKxL,MAAL,CAAYC,aAAZ,CAA0B+L,iBAA9B,EAAiD;UAC7C,KAAKhM,MAAL,CAAYiM,aAAZ,CAA0BC,aAA1B,CAAwCb,IAAI,CAACpB,aAA7C;QACH;MACJ,CAbD,MAcK;QACDsB,MAAM,GAAG,IAAT;QACAI,UAAU,CAACG,QAAX,GAAsB,KAAtB;QACA7M,WAAW,CAAC,CAACoM,IAAD,CAAD,EAAS,oBAAT,CAAX;QACArM,QAAQ,CAAC,CAACqM,IAAD,CAAD,EAAS,sBAAT,CAAR;QACAA,IAAI,CAAC3J,iBAAL,CAAuBd,SAAvB,GAAmC,2CAAnC;QACAyK,IAAI,CAAC3J,iBAAL,CAAuBQ,YAAvB,CAAoC,OAApC,EAA6C,WAA7C;;QACA,IAAI5C,eAAe,CAAC4B,IAAD,CAAnB,EAA2B;UACvB,KAAK6K,iBAAL,CAAuB7K,IAAvB,EAA6BC,MAA7B,EAAqC,CAACoK,MAAtC,EAA8CE,KAA9C,EAAqDD,WAArD;QACH;;QACD,IAAI,KAAKxL,MAAL,CAAYC,aAAZ,CAA0B+L,iBAA9B,EAAiD;UAC7C,KAAKhM,MAAL,CAAYiM,aAAZ,CAA0BE,eAA1B,CAA0Cd,IAAI,CAACpB,aAA/C;QACH;MACJ;;MACD,KAAKjF,IAAL,CAAUoH,SAAV,CAAoBf,IAApB,EAA0BQ,MAA1B;;MACA,IAAI,CAACvM,eAAe,CAAC4B,IAAD,CAAhB,IAA0B,CAAC,KAAKlB,MAAL,CAAYC,aAAZ,CAA0B+L,iBAAzD,EAA4E;QACxE,IAAIK,OAAO,GAAGnL,IAAI,CAACoL,aAAL,EAAd;QACA,IAAIC,QAAQ,GAAGF,OAAO,CAAChJ,OAAR,CAAgBsI,UAAhB,CAAf;QACA,IAAIa,SAAS,GAAG,EAAhB;QACA,IAAIC,aAAa,GAAGvL,IAAI,CAACwL,uBAAL,IAAgCxL,IAAI,CAACyL,sBAArC,IAChBzL,IAAI,CAACyL,sBAAL,CAA4BC,WADZ,IAC2BP,OAAO,CAAC5H,MAAR,KAAmB6G,QAAQ,CAAC7G,MADvD,GAEhBoI,KAAK,CAACC,IAAN,CAAWxB,QAAX,EAAqBjI,OAArB,CAA6BgI,IAAI,CAACpB,aAAlC,CAFgB,GAEmC8C,SAFvD;;QAGA,KAAK,IAAIrE,CAAC,GAAG6D,QAAb,EAAuB7D,CAAC,GAAG2D,OAAO,CAAC5H,MAAnC,EAA2CiE,CAAC,EAA5C,EAAgD;UAC5C,IAAIA,CAAC,GAAG6D,QAAJ,IAAgBF,OAAO,CAAC3D,CAAD,CAAP,CAAWgD,MAAX,KAAsBA,MAA1C,EAAkD;YAC9C;UACH;;UACD,IAAIW,OAAO,CAAC3D,CAAD,CAAP,CAAWsE,WAAf,EAA4B;YACxB,IAAIC,OAAO,GAAGZ,OAAO,CAAC3D,CAAC,GAAG,CAAL,CAAP,CAAeoD,QAAf,IAA2BO,OAAO,CAAC3D,CAAC,GAAG,CAAL,CAAP,CAAeuE,OAAxD;;YACA,IAAIR,aAAa,IAAIA,aAAa,GAAG,CAAjC,IAAsCA,aAAa,GAAGnB,QAAQ,CAAC7G,MAAnE,EAA2E;cACvE6G,QAAQ,CAACmB,aAAD,CAAR,CAAwB5K,KAAxB,CAA8BqL,OAA9B,GAAwCD,OAAO,GAAG,EAAH,GAAQ,MAAvD;YACH,CAFD,MAGK,IAAI/N,iBAAiB,CAACuN,aAAD,CAArB,EAAsC;cACvCnB,QAAQ,CAAC5C,CAAD,CAAR,CAAY7G,KAAZ,CAAkBqL,OAAlB,GAA4BD,OAAO,GAAG,EAAH,GAAQ,MAA3C;YACH;UACJ,CARD,MASK,IAAIT,SAAS,CAACH,OAAO,CAAC3D,CAAD,CAAP,CAAWyE,SAAZ,CAAT,KAAoC,KAAxC,EAA+C;YAChDd,OAAO,CAAC3D,CAAD,CAAP,CAAWuE,OAAX,GAAqB,KAArB;;YACA,IAAIR,aAAa,IAAIA,aAAa,GAAG,CAAjC,IAAsCA,aAAa,GAAGnB,QAAQ,CAAC7G,MAAnE,EAA2E;cACvE6G,QAAQ,CAACmB,aAAD,CAAR,CAAwB5K,KAAxB,CAA8BqL,OAA9B,GAAwC,MAAxC;YACH,CAFD,MAGK,IAAIhO,iBAAiB,CAACuN,aAAD,CAArB,EAAsC;cACvCnB,QAAQ,CAAC5C,CAAD,CAAR,CAAY7G,KAAZ,CAAkBqL,OAAlB,GAA4B,MAA5B;YACH;UACJ,CARI,MASA;YACD,IAAI,EAAEb,OAAO,CAAC3D,CAAD,CAAP,CAAW0E,SAAX,IAAwBf,OAAO,CAAC3D,CAAD,CAAP,CAAW2E,YAAnC,IAAmDhB,OAAO,CAAC3D,CAAD,CAAP,CAAWsE,WAA9D,IAA6EX,OAAO,CAAC3D,CAAD,CAAP,CAAW4E,cAA1F,CAAJ,EAA+G;cAC3G,IAAIL,OAAO,GAAGZ,OAAO,CAAC3D,CAAD,CAAP,CAAW6E,KAAX,CAAiBC,IAAjB,CAAsB,UAAUC,IAAV,EAAgB;gBAAE,OAAOA,IAAI,CAACC,UAAL,IACtDD,IAAI,CAACR,OAD0C;cAChC,CADR,CAAd;;cAEA,IAAIA,OAAO,KAAKZ,OAAO,CAAC3D,CAAD,CAAP,CAAWuE,OAA3B,EAAoC;gBAChC;cACH;YACJ;;YACDZ,OAAO,CAAC3D,CAAD,CAAP,CAAWuE,OAAX,GAAqB,IAArB;;YACA,IAAIR,aAAa,IAAIA,aAAa,GAAG,CAAjC,IAAsCA,aAAa,GAAGnB,QAAQ,CAAC7G,MAAnE,EAA2E;cACvE6G,QAAQ,CAACmB,aAAD,CAAR,CAAwB5K,KAAxB,CAA8BqL,OAA9B,GAAwC,EAAxC;cACA5B,QAAQ,CAACmB,aAAD,CAAR,CAAwB1N,SAAxB,CAAkCD,MAAlC,CAAyC,QAAzC;YACH,CAHD,MAIK,IAAII,iBAAiB,CAACuN,aAAD,CAArB,EAAsC;cACvCnB,QAAQ,CAAC5C,CAAD,CAAR,CAAY7G,KAAZ,CAAkBqL,OAAlB,GAA4B,EAA5B;cACA5B,QAAQ,CAAC5C,CAAD,CAAR,CAAY3J,SAAZ,CAAsBD,MAAtB,CAA6B,QAA7B;YACH;UACJ;;UACD,IAAIuN,OAAO,CAAC3D,CAAD,CAAP,CAAW2E,YAAf,EAA6B;YACzBb,SAAS,CAACH,OAAO,CAAC3D,CAAD,CAAP,CAAWvG,GAAZ,CAAT,GAA4BkK,OAAO,CAAC3D,CAAD,CAAP,CAAWoD,QAAX,IAAuBO,OAAO,CAAC3D,CAAD,CAAP,CAAWuE,OAA9D;UACH;;UACD,IAAI,CAAC/N,iBAAiB,CAACuN,aAAD,CAAtB,EAAuC;YACnCA,aAAa;UAChB;QACJ;;QACD,KAAKzM,MAAL,CAAY2N,MAAZ,CAAmBjO,MAAM,CAACkO,wBAA1B,EAAoD;UAAE5E,IAAI,EAAE,KAAKhJ,MAAL,CAAYsM,aAAZ;QAAR,CAApD;MACH;;MACD,KAAKtM,MAAL,CAAY2N,MAAZ,CAAmBjO,MAAM,CAACmO,qBAA1B,EAAiD;QAAEC,UAAU,EAAEvC,MAAd;QAAsB4B,SAAS,EAAEhL;MAAjC,CAAjD;IACH;EACJ,CApGD;;EAqGApC,KAAK,CAACkG,SAAN,CAAgB8F,iBAAhB,GAAoC,UAAU7K,IAAV,EAAgBC,MAAhB,EAAwB2K,QAAxB,EAAkCL,KAAlC,EAAyCD,WAAzC,EAAsD;IACtF,IAAIuC,IAAI,GAAG7M,IAAI,CAAC0K,mBAAL,CAAyBzK,MAAM,CAACtC,OAAP,CAAe,IAAf,EAAqB8C,YAArB,CAAkC,UAAlC,CAAzB,CAAX;IACAoM,IAAI,CAACjC,QAAL,GAAgBA,QAAhB;IACAvM,cAAc,CAAC2B,IAAD,CAAd;IACA,KAAKlB,MAAL,CAAY2N,MAAZ,CAAmBjO,MAAM,CAACsO,qBAA1B,EAAiD,EAAjD;IACAvC,KAAK,GAAGvK,IAAI,CAAC+M,aAAL,GAAqBC,aAArB,CAAmC,KAAnC,CAAR;IACAzC,KAAK,CAAC0C,OAAN,GAAgBjN,IAAI,CAAC+M,aAAL,GAAqBG,cAArB,CAAoClN,IAAI,CAACmN,QAAL,GAAgBC,KAAhB,EAApC,EAA6DH,OAA7E;IACA,IAAII,IAAI,GAAG;MAAEC,WAAW,EAAE,eAAf;MAAgCC,SAAS,EAAEV;IAA3C,CAAX;;IACA,IAAI7M,IAAI,CAAC+K,aAAT,EAAwB;MACpBsC,IAAI,CAACG,WAAL,GAAmBxN,IAAI,CAAC+K,aAAL,CAAmB0C,QAAtC;IACH;;IACDnD,WAAW,GAAGtK,IAAI,CAAC+M,aAAL,GAAqBW,OAArB,CAA6BL,IAA7B,EAAmC9C,KAAK,CAACoD,aAAN,EAAnC,CAAd;IACArD,WAAW,CAACsD,IAAZ,CAAiB,UAAU7N,CAAV,EAAa;MAAE,OAAOC,IAAI,CAAC6N,YAAL,CAAkBC,kBAAlB,CAAqC/N,CAArC,EAAwCsN,IAAxC,CAAP;IAAuD,CAAvF;EACH,CAbD;;EAcAxO,KAAK,CAACkG,SAAN,CAAgBgJ,cAAhB,GAAiC,UAAUnD,QAAV,EAAoB;IACjD,IAAI,CAAC,KAAK9L,MAAL,CAAYC,aAAZ,CAA0BmD,OAA1B,CAAkCqB,MAAvC,EAA+C;MAC3C;IACH;;IACD,IAAI,CAACqH,QAAL,EAAe;MACX,KAAK9L,MAAL,CAAY2N,MAAZ,CAAmBjO,MAAM,CAACwP,eAA1B,EAA2CpD,QAA3C;IACH;;IACD,IAAIR,QAAQ,GAAG,KAAKtL,MAAL,CAAYiJ,eAAZ,GAA8BvG,aAA9B,CAA4C5C,QAAQ,CAACoJ,KAArD,EAA4DC,QAA3E;IACA,IAAIkD,OAAO,GAAG,KAAKrM,MAAL,CAAYsM,aAAZ,EAAd;IACA,IAAI9C,GAAJ;;IACA,KAAK,IAAId,CAAC,GAAG,CAAR,EAAWyG,GAAG,GAAG7D,QAAQ,CAAC7G,MAA/B,EAAuCiE,CAAC,GAAGyG,GAA3C,EAAgDzG,CAAC,EAAjD,EAAqD;MACjD,IAAI4C,QAAQ,CAAC5C,CAAD,CAAR,CAAY4B,gBAAZ,CAA6B,4CAA7B,EAA2E7F,MAA/E,EAAuF;QACnF+E,GAAG,GAAG8B,QAAQ,CAAC5C,CAAD,CAAR,CAAYhG,aAAZ,CAA0BoJ,QAAQ,GAAG,uBAAH,GAA6B,qBAA/D,CAAN;;QACA,IAAItC,GAAJ,EAAS;UACLA,GAAG,CAAC5I,SAAJ,GAAgBkL,QAAQ,GAAG,oBAAH,GAA0B,sBAAlD;UACAtC,GAAG,CAAC9H,iBAAJ,CAAsBd,SAAtB,GAAkCkL,QAAQ,GAAG,2CAAH,GACtC,2CADJ;QAEH;;QACD,IAAI,EAAER,QAAQ,CAAC5C,CAAD,CAAR,CAAYhH,iBAAZ,CAA8B3C,SAA9B,CAAwCuC,QAAxC,CAAiD,oBAAjD,KACFgK,QAAQ,CAAC5C,CAAD,CAAR,CAAYhH,iBAAZ,CAA8B3C,SAA9B,CAAwCuC,QAAxC,CAAiD,sBAAjD,CADA,CAAJ,EAC+E;UAC3EgK,QAAQ,CAAC5C,CAAD,CAAR,CAAY7G,KAAZ,CAAkBqL,OAAlB,GAA4BpB,QAAQ,GAAG,EAAH,GAAQ,MAA5C;QACH;MACJ,CAXD,MAYK;QACDR,QAAQ,CAAC5C,CAAD,CAAR,CAAY7G,KAAZ,CAAkBqL,OAAlB,GAA4BpB,QAAQ,GAAG,EAAH,GAAQ,MAA5C;MACH;;MACD,IAAIO,OAAO,CAAC3D,CAAD,CAAP,CAAW2E,YAAf,EAA6B;QACzBhB,OAAO,CAAC3D,CAAD,CAAP,CAAWoD,QAAX,GAAsBA,QAAQ,GAAG,IAAH,GAAU,KAAxC;MACH;IACJ;;IACD,KAAK9L,MAAL,CAAYoP,+BAAZ;IACA,KAAKpP,MAAL,CAAY2N,MAAZ,CAAmBjO,MAAM,CAACkO,wBAA1B,EAAoD;MAAE5E,IAAI,EAAE,KAAKhJ,MAAL,CAAYsM,aAAZ;IAAR,CAApD;EACH,CAhCD;EAiCA;AACJ;AACA;AACA;AACA;;;EACIvM,KAAK,CAACkG,SAAN,CAAgByD,SAAhB,GAA4B,YAAY;IACpC,KAAKuF,cAAL,CAAoB,IAApB;EACH,CAFD;EAGA;AACJ;AACA;AACA;AACA;;;EACIlP,KAAK,CAACkG,SAAN,CAAgB0D,WAAhB,GAA8B,YAAY;IACtC,KAAKsF,cAAL,CAAoB,KAApB;EACH,CAFD;EAGA;AACJ;AACA;AACA;AACA;AACA;;;EACIlP,KAAK,CAACkG,SAAN,CAAgB4B,MAAhB,GAAyB,YAAY;IACjC,KAAK1B,IAAL,GAAY,KAAKhG,cAAL,CAAoB2F,UAApB,CAA+B,cAA/B,CAAZ;IACA,KAAKuJ,mBAAL;IACA,KAAKC,eAAL;IACA,KAAKC,gBAAL;IACA,KAAKhF,SAAL;EACH,CAND;;EAOAxK,KAAK,CAACkG,SAAN,CAAgBoJ,mBAAhB,GAAsC,YAAY;IAC9C,IAAIG,SAAS,GAAG,KAAKxP,MAAL,CAAYqB,OAAZ,CAAoBqB,aAApB,CAAkC,kBAAlC,CAAhB;;IACA,IAAI8M,SAAJ,EAAe;MACX1Q,MAAM,CAAC0Q,SAAD,CAAN;IACH;;IACD,KAAKnO,OAAL,GAAe,KAAKrB,MAAL,CAAYpB,aAAZ,CAA0B,KAA1B,EAAiC;MAAEgC,SAAS,EAAE,iBAAb;MAAgCE,KAAK,EAAE;QAAE,YAAY;MAAd;IAAvC,CAAjC,CAAf;;IACA,IAAI,KAAKb,aAAL,CAAmBsB,eAAvB,EAAwC;MACpC,KAAKF,OAAL,CAAatC,SAAb,CAAuBuD,GAAvB,CAA2B,iBAA3B;IACH;;IACD,KAAKmN,mBAAL;IACA,KAAKzP,MAAL,CAAYqB,OAAZ,CAAoBqO,YAApB,CAAiC,KAAKrO,OAAtC,EAA+C,KAAKrB,MAAL,CAAYqB,OAAZ,CAAoBsO,UAAnE;;IACA,IAAI,CAAC,KAAK1P,aAAL,CAAmB2P,YAAxB,EAAsC;MAClC,KAAKvO,OAAL,CAAaQ,KAAb,CAAmBqL,OAAnB,GAA6B,MAA7B;IACH;EACJ,CAdD;;EAeAnN,KAAK,CAACkG,SAAN,CAAgBwJ,mBAAhB,GAAsC,UAAUI,KAAV,EAAiB;IACnD,IAAI,KAAK5P,aAAL,CAAmB2P,YAAnB,IAAmC,CAAC,KAAK3P,aAAL,CAAmBmD,OAAnB,CAA2BqB,MAAnE,EAA2E;MACvE,IAAIyB,SAAS,GAAG,KAAKC,IAAL,CAAUC,WAAV,CAAsB,eAAtB,CAAhB;MACA,KAAK/E,OAAL,CAAamD,SAAb,GAAyB0B,SAAzB;MACA,KAAK7E,OAAL,CAAatC,SAAb,CAAuBD,MAAvB,CAA8B,WAA9B;IACH,CAJD,MAKK;MACD,IAAK,KAAKuC,OAAL,CAAamD,SAAb,KAA2B,KAAK2B,IAAL,CAAUC,WAAV,CAAsB,eAAtB,CAA3B,KAAsE,KAAKnG,aAAL,CAAmBmD,OAAnB,CAA2BqB,MAA3B,KAAsC,CAAtC,IACpE,CAAC,KAAKjE,cAAN,IAAwB,CAAC,KAAKC,gBADhC,CAAD,IACuDoP,KAD3D,EACkE;QAC9D,KAAKxO,OAAL,CAAamD,SAAb,GAAyB,EAAzB;MACH;;MACD,KAAKnD,OAAL,CAAatC,SAAb,CAAuBuD,GAAvB,CAA2B,WAA3B;IACH;EACJ,CAbD;;EAcAvC,KAAK,CAACkG,SAAN,CAAgBqJ,eAAhB,GAAkC,YAAY;IAC1C,KAAKQ,qBAAL;IACA,KAAKC,qBAAL;EACH,CAHD;;EAIAhQ,KAAK,CAACkG,SAAN,CAAgB8J,qBAAhB,GAAwC,YAAY;IAChD;IACA,IAAIxN,IAAI,GAAG,IAAI9D,SAAJ,CAAc,KAAK4C,OAAnB,EAA4B;MACnC2O,UAAU,EAAE,KAAK/P,aAAL,CAAmBsB,eAAnB,GAAqC,SAArC,GAAiD,oBAD1B;MAEnC0O,QAAQ,EAAE,KAAKhQ,aAAL,CAAmBsB,eAAnB,GAAqC,CAAC,EAAtC,GAA2C,CAFlB;MAGnCP,MAAM,EAAE,KAAKA,MAHsB;MAInCqB,SAAS,EAAE,KAAKA,SAJmB;MAKnCE,IAAI,EAAE,KAAKA,IALwB;MAMnCQ,QAAQ,EAAE,KAAKA;IANoB,CAA5B,CAAX;EAQH,CAVD;;EAWAhD,KAAK,CAACkG,SAAN,CAAgB6J,qBAAhB,GAAwC,YAAY;IAChD;IACA,IAAIhL,IAAI,GAAG,IAAIpG,SAAJ,CAAc,KAAK2C,OAAnB,EAA4B;MACnC6O,MAAM,EAAE,cAD2B;MAEnCpL,IAAI,EAAE,KAAKA;IAFwB,CAA5B,CAAX;EAIH,CAND;EAOA;AACJ;AACA;AACA;AACA;AACA;;;EACI/E,KAAK,CAACkG,SAAN,CAAgBN,WAAhB,GAA8B,UAAUF,UAAV,EAAsB;IAChD,IAAIvE,IAAI,GAAG,KAAKlB,MAAhB;IACA,IAAIwB,MAAM,GAAGN,IAAI,CAACO,gBAAL,CAAsBgE,UAAtB,CAAb;;IACA,IAAIvG,iBAAiB,CAACsC,MAAD,CAAjB,IAA6BA,MAAM,CAAC4D,aAAP,KAAyB,KAAtD,IACC,KAAKQ,cAAL,IAAuB,KAAK3F,aAAL,CAAmBmD,OAAnB,CAA2BC,OAA3B,CAAmCoC,UAAnC,IAAiD,CAAC,CAD9E,EACkF;MAC9E,KAAKzF,MAAL,CAAYsF,GAAZ,CAAgB,wBAAhB,EAA0C;QAAEC,UAAU,EAAE,KAAKC,aAAL,EAAd;QAAoCC,UAAU,EAAEjE,MAAM,CAACkE;MAAvD,CAA1C;MACA;IACH;;IACD,IAAIrG,eAAe,CAAC6B,IAAD,CAAnB,EAA2B;MACvBA,IAAI,CAACyM,MAAL,CAAYjO,MAAM,CAACyQ,YAAnB,EAAiC;QAAEC,QAAQ,EAAE,IAAZ;QAAkBC,OAAO,EAAE,KAAK1K,WAAhC;QAA6C2K,IAAI,EAAE7K;MAAnD,CAAjC;MACA;IACH;;IACDjE,MAAM,CAACyL,OAAP,GAAiB/L,IAAI,CAACjB,aAAL,CAAmBsQ,iBAApC;IACA,KAAKC,OAAL,GAAe/K,UAAf;IACA,KAAKjF,cAAL,GAAsB,IAAtB;;IACA,IAAI,KAAKoF,cAAT,EAAyB;MACrB,KAAKS,WAAL;IACH,CAFD,MAGK;MACD,KAAK1B,iBAAL,CAAuBc,UAAvB;IACH;;IACD,KAAKgK,mBAAL;IACA,KAAKjP,cAAL,GAAsB,KAAtB;EACH,CAvBD;EAwBA;AACJ;AACA;AACA;AACA;AACA;;;EACIT,KAAK,CAACkG,SAAN,CAAgB3C,aAAhB,GAAgC,UAAUmC,UAAV,EAAsB;IAClD,IAAIvE,IAAI,GAAG,KAAKlB,MAAhB;IACA,IAAIwB,MAAM,GAAG,KAAKxB,MAAL,CAAYyQ,0BAAZ,GACT,KAAKzQ,MAAL,CAAYoD,OAAZ,CAAoBsN,MAApB,CAA2B,UAAUhM,CAAV,EAAa;MAAE,OAAOA,CAAC,CAACxB,KAAF,KAAYuC,UAAnB;IAAgC,CAA1E,EAA4E,CAA5E,CADS,GACwEvE,IAAI,CAACO,gBAAL,CAAsBgE,UAAtB,CADrF;;IAEA,IAAIvG,iBAAiB,CAACsC,MAAD,CAAjB,IAA6BA,MAAM,CAAC4D,aAAP,KAAyB,KAAtD,IAA+D,KAAKnF,aAAL,CAAmBmD,OAAnB,CAA2BC,OAA3B,CAAmCoC,UAAnC,IAAiD,CAApH,EAAuH;MACnH;IACH;;IACD,IAAIpG,eAAe,CAAC6B,IAAD,CAAnB,EAA2B;MACvBA,IAAI,CAACyM,MAAL,CAAYjO,MAAM,CAACyQ,YAAnB,EAAiC;QAAEC,QAAQ,EAAE,IAAZ;QAAkBC,OAAO,EAAE,KAAK/M,aAAhC;QAA+CgN,IAAI,EAAE7K;MAArD,CAAjC;MACA;IACH;;IACDjE,MAAM,CAACyL,OAAP,GAAiB,IAAjB;IACA,KAAKuD,OAAL,GAAehP,MAAM,CAAC0B,KAAtB;IACA,IAAIE,OAAO,GAAGW,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,SAAL,CAAe,KAAKhE,aAAL,CAAmBmD,OAAlC,CAAX,CAAd;IACAA,OAAO,CAACiB,MAAR,CAAejB,OAAO,CAACC,OAAR,CAAgB,KAAKmN,OAArB,CAAf,EAA8C,CAA9C;;IACA,IAAI,KAAKtQ,aAAL,CAAmBmD,OAAnB,CAA2BoC,UAA3B,IAAyC,CAA7C,EAAgD;MAC5C,KAAK,IAAIiD,CAAC,GAAG,CAAR,EAAWyG,GAAG,GAAGjO,IAAI,CAACyP,YAAL,CAAkBvN,OAAlB,CAA0BqB,MAAhD,EAAwDiE,CAAC,GAAGyG,GAA5D,EAAiEzG,CAAC,EAAlE,EAAsE;QAClE,IAAIjD,UAAU,KAAKvE,IAAI,CAACyP,YAAL,CAAkBvN,OAAlB,CAA0BsF,CAA1B,EAA6BxF,KAAhD,EAAuD;UACnDhC,IAAI,CAACyP,YAAL,CAAkBvN,OAAlB,CAA0BiB,MAA1B,CAAiCqE,CAAjC,EAAoC,CAApC;UACA;QACH;MACJ;IACJ;;IACD,IAAI,KAAKzI,aAAL,CAAmBsB,eAAvB,EAAwC;MACpC,KAAKb,iBAAL,GAAyB0C,OAAzB;IACH;;IACD,KAAKnD,aAAL,CAAmBmD,OAAnB,GAA6BA,OAA7B;;IACA,IAAIlC,IAAI,CAACkE,aAAT,EAAwB;MACpB,KAAK3E,gBAAL,GAAwB,IAAxB;MACA,KAAKT,MAAL,CAAY4Q,QAAZ;IACH;EACJ,CA/BD;EAgCA;AACJ;AACA;AACA;AACA;AACA;;;EACI7Q,KAAK,CAACkG,SAAN,CAAgBI,WAAhB,GAA8B,YAAY;IACtC,IAAIjD,OAAO,GAAGW,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,SAAL,CAAe,KAAKhE,aAAL,CAAmBmD,OAAlC,CAAX,CAAd;IACAA,OAAO,GAAG,KAAK1C,iBAAL,CAAuB+D,MAAvB,GAAgCV,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,SAAL,CAAe,KAAKvD,iBAApB,CAAX,CAAhC,GAAqF0C,OAA/F;;IACA,IAAI,KAAK/C,YAAT,EAAuB;MACnB,IAAI+C,OAAO,CAACC,OAAR,CAAgB,KAAKmN,OAArB,MAAkC,CAAC,CAAvC,EAA0C;QACtCpN,OAAO,CAACmB,IAAR,CAAa,KAAKiM,OAAlB;MACH;;MACD,KAAKK,oBAAL,CAA0B,KAAKL,OAA/B;IACH;;IACD,KAAKnQ,YAAL,GAAoB,IAApB;IACA,KAAKL,MAAL,CAAYC,aAAZ,CAA0BmD,OAA1B,GAAoCA,OAApC;IACA,KAAKpD,MAAL,CAAY4Q,QAAZ;EACH,CAZD;EAaA;AACJ;AACA;AACA;AACA;AACA;AACA;;;EACI7Q,KAAK,CAACkG,SAAN,CAAgBa,gBAAhB,GAAmC,UAAU7F,CAAV,EAAa;IAC5C,IAAIA,CAAC,CAACuN,WAAF,KAAkB,UAAtB,EAAkC;MAC9B,KAAK7J,iBAAL,CAAuB,KAAK6L,OAA5B;IACH,CAFD,MAGK;MACD,KAAK3L,sBAAL,CAA4B,KAAK2L,OAAjC;IACH;;IACD,IAAIjC,IAAI,GAAG,KAAKtO,aAAL,CAAmBmD,OAAnB,CAA2BC,OAA3B,CAAmC,KAAKmN,OAAxC,IAAmD,CAAC,CAApD,GAAwD;MAC/D/K,UAAU,EAAE,KAAK+K,OAD8C;MACrChC,WAAW,EAAE,UADwB;MACZ1D,IAAI,EAAEpL,MAAM,CAACoR;IADD,CAAxD,GAEP;MAAEtC,WAAW,EAAE,YAAf;MAA6B1D,IAAI,EAAEpL,MAAM,CAACoR;IAA1C,CAFJ;IAGA,KAAK9Q,MAAL,CAAY2C,OAAZ,CAAoBjD,MAAM,CAACoR,cAA3B,EAA2C3R,MAAM,CAAC8B,CAAD,EAAIsN,IAAJ,CAAjD;IACA,KAAKiC,OAAL,GAAe,IAAf;EACH,CAZD;;EAaAzQ,KAAK,CAACkG,SAAN,CAAgB4K,oBAAhB,GAAuC,UAAUL,OAAV,EAAmB;IACtD,IAAI9H,CAAC,GAAG,CAAR;;IACA,OAAOA,CAAC,GAAG,KAAK1I,MAAL,CAAY2Q,YAAZ,CAAyBvN,OAAzB,CAAiCqB,MAA5C,EAAoD;MAChD,IAAI,KAAKzE,MAAL,CAAY2Q,YAAZ,CAAyBvN,OAAzB,CAAiCsF,CAAjC,EAAoCxF,KAApC,KAA8CsN,OAAlD,EAA2D;QACvD;MACH;;MACD9H,CAAC;IACJ;;IACD,IAAI,KAAK1I,MAAL,CAAY2Q,YAAZ,CAAyBvN,OAAzB,CAAiCqB,MAAjC,KAA4CiE,CAAhD,EAAmD;MAC/C,KAAK1I,MAAL,CAAY2Q,YAAZ,CAAyBvN,OAAzB,CAAiCmB,IAAjC,CAAsC;QAAErB,KAAK,EAAEsN,OAAT;QAAkBO,SAAS,EAAE,WAA7B;QAA0CC,WAAW,EAAE;MAAvD,CAAtC;IACH,CAFD,MAGK,IAAI,CAAC,KAAKhR,MAAL,CAAYkL,YAAjB,EAA+B;MAChC,KAAKlL,MAAL,CAAY2Q,YAAZ,CAAyBvN,OAAzB,CAAiCsF,CAAjC,EAAoCqI,SAApC,GAAgD,WAAhD;IACH;EACJ,CAdD;;EAeAhR,KAAK,CAACkG,SAAN,CAAgBrH,aAAhB,GAAgC,UAAUsE,KAAV,EAAiB;IAC7C,IAAIhC,IAAI,GAAG,KAAKlB,MAAhB;IACA,IAAI+Q,SAAS,GAAG,WAAhB;IACA,IAAIE,QAAQ,GAAG,KAAKjR,MAAL,CAAYpB,aAAZ,CAA0B,KAA1B,EAAiC;MAAEgC,SAAS,EAAE;IAAb,CAAjC,CAAf;IACA,IAAIsQ,aAAa,GAAG,KAAKlR,MAAL,CAAYpB,aAAZ,CAA0B,KAA1B,EAAiC;MAAEgC,SAAS,EAAE;IAAb,CAAjC,CAApB;IACA,IAAIuQ,QAAQ,GAAG,KAAKnR,MAAL,CAAYpB,aAAZ,CAA0B,KAA1B,EAAiC;MAAEkC,KAAK,EAAE;QAAE,kBAAkBoC;MAApB;IAAT,CAAjC,CAAf;;IACA,IAAIzD,cAAc,CAACyD,KAAD,CAAlB,EAA2B;MACvBiO,QAAQ,CAACjP,YAAT,CAAsB,gBAAtB,EAAwC1C,iBAAiB,CAAC0D,KAAD,CAAzD;IACH;;IACD,IAAI1B,MAAM,GAAG,KAAKxB,MAAL,CAAYyB,gBAAZ,CAA6ByB,KAA7B,CAAb,CAT6C,CAU7C;;IACA,IAAIkO,UAAU,GAAGlQ,IAAI,CAACmE,oBAAL,CAA0B7D,MAAM,CAACW,GAAjC,CAAjB,CAX6C,CAY7C;IACA;IACA;IACA;IACA;IACA;IACA;IACA;;IACA,IAAI,KAAKlC,aAAL,CAAmBsB,eAAvB,EAAwC;MACpC4P,QAAQ,CAAC/O,WAAT,CAAqB,KAAKpC,MAAL,CAAYpB,aAAZ,CAA0B,MAA1B,EAAkC;QACnDgC,SAAS,EAAE,4BADwC;QACV4D,SAAS,EAAE,QADD;QAEnD1D,KAAK,EAAE;UAAEuQ,KAAK,EAAE,MAAT;UAAiBC,QAAQ,EAAE,IAA3B;UAAiC,cAAc;QAA/C;MAF4C,CAAlC,CAArB;IAIH;;IACDH,QAAQ,CAAC/O,WAAT,CAAqB,KAAKpC,MAAL,CAAYpB,aAAZ,CAA0B,MAA1B,EAAkC;MACnDgC,SAAS,EAAE,aADwC;MACzB4D,SAAS,EAAEhD,MAAM,CAACkE,UADO;MAEnD5E,KAAK,EAAE;QAAEwQ,QAAQ,EAAE,IAAZ;QAAkB,cAAc;MAAhC;IAF4C,CAAlC,CAArB,EA1B6C,CA8B7C;;IACA,IAAI,KAAKrR,aAAL,CAAmB+K,gBAAvB,EAAyC;MACrCmG,QAAQ,CAAC/O,WAAT,CAAqB,KAAKpC,MAAL,CAAYpB,aAAZ,CAA0B,MAA1B,EAAkC;QACnDgC,SAAS,EAAE,4DADwC;QACsB4D,SAAS,EAAE,QADjC;QAEnD1D,KAAK,EAAE;UAAEwQ,QAAQ,EAAE,IAAZ;UAAkB,cAAc;QAAhC;MAF4C,CAAlC,CAArB;IAIH;;IACD,IAAIF,UAAU,CAAC9G,gBAAX,CAA4B,4BAA5B,EAA0D7F,MAA9D,EAAsE;MAClEsM,SAAS,GAAGK,UAAU,CAAC1O,aAAX,CAAyB,cAAzB,IAA2C,WAA3C,GAAyD,YAArE;IACH;;IACDyO,QAAQ,CAAC/O,WAAT,CAAqB,KAAKpC,MAAL,CAAYpB,aAAZ,CAA0B,MAA1B,EAAkC;MACnDgC,SAAS,EAAE,0BACN,OAAOmQ,SAAS,CAACQ,WAAV,EAAP,GAAiC,UAAjC,GAA8CR,SAAS,CAACQ,WAAV,EADxC,CADwC;MAE0B/M,SAAS,EAAE,QAFrC;MAGnD1D,KAAK,EAAE;QAAEwQ,QAAQ,EAAE,IAAZ;QAAkB,cAAc,yBAAhC;QAA2DE,IAAI,EAAE;MAAjE;IAH4C,CAAlC,CAArB;IAKAL,QAAQ,CAAC/O,WAAT,CAAqB,KAAKpC,MAAL,CAAYpB,aAAZ,CAA0B,MAA1B,EAAkC;MACnDgC,SAAS,EAAE,qCADwC;MACD4D,SAAS,EAAE,QADV;MAEnD1D,KAAK,EAAE;QAAEuQ,KAAK,EAAE,KAAKlL,IAAL,CAAUC,WAAV,CAAsB,SAAtB,CAAT;QACHkL,QAAQ,EAAE,IADP;QACa,cAAc,4BAD3B;QACyDE,IAAI,EAAE;MAD/D,CAF4C;MAInD3Q,MAAM,EAAE,KAAKZ,aAAL,CAAmBwR,iBAAnB,GAAuC,EAAvC,GAA4C;IAJD,CAAlC,CAArB;IAMAP,aAAa,CAAC9O,WAAd,CAA0B+O,QAA1B;;IACA,IAAI,KAAKlR,aAAL,CAAmBsB,eAAvB,EAAwC;MACpC0P,QAAQ,CAAC7O,WAAT,CAAqB8O,aAArB;MACAD,QAAQ,CAAC7O,WAAT,CAAqB,KAAKsP,eAAL,EAArB;MACAR,aAAa,GAAGD,QAAhB;IACH;;IACD,OAAOC,aAAP;EACH,CA1DD;;EA2DAnR,KAAK,CAACkG,SAAN,CAAgBtB,iBAAhB,GAAoC,UAAUzB,KAAV,EAAiB;IACjD,IAAIsM,SAAS,GAAG/P,cAAc,CAACyD,KAAD,CAAd,GAAwB,KAAKlD,MAAL,CAAYqB,OAAZ,CAAoBqB,aAApB,CAAkC,yCACtElD,iBAAiB,CAAC0D,KAAD,CADqD,GAC3C,GADS,CAAxB,GACsB,KAAKlD,MAAL,CAAYqB,OAAZ,CAAoBqB,aAApB,CAAkC,yCAAyCQ,KAAzC,GAAiD,GAAnF,CADtC;;IAEA,IAAI,KAAKjD,aAAL,CAAmBsB,eAAnB,IAAsCiO,SAA1C,EAAqD;MACjD;IACH;;IACD,IAAIhO,MAAM,GAAG,KAAKxB,MAAL,CAAYyB,gBAAZ,CAA6ByB,KAA7B,CAAb;;IACA,IAAIhE,iBAAiB,CAACsC,MAAD,CAArB,EAA+B;MAC3B;IACH;;IACD,IAAI0P,aAAa,GAAG,KAAKtS,aAAL,CAAmBsE,KAAnB,CAApB;;IACA,IAAI,KAAKjD,aAAL,CAAmBsB,eAAvB,EAAwC;MACpC,IAAIqH,KAAK,GAAG,KAAKvH,OAAL,CAAauC,sBAAb,CAAoC,kBAApC,EAAwDa,MAApE;MACAyM,aAAa,CAAChP,YAAd,CAA2B,OAA3B,EAAoC0G,KAAK,CAAC+I,QAAN,EAApC;IACH;;IACD,KAAKtQ,OAAL,CAAae,WAAb,CAAyB8O,aAAzB,EAfiD,CAgBjD;EACH,CAjBD;;EAkBAnR,KAAK,CAACkG,SAAN,CAAgByL,eAAhB,GAAkC,YAAY;IAC1C,OAAO,KAAK1R,MAAL,CAAYpB,aAAZ,CAA0B,MAA1B,EAAkC;MACrCgC,SAAS,EAAE,iCAD0B;MACS4D,SAAS,EAAE,QADpB;MAErC1D,KAAK,EAAE;QAAEwQ,QAAQ,EAAE,IAAZ;QAAkB,cAAc;MAAhC,CAF8B;MAGrCzQ,MAAM,EAAE,KAAKZ,aAAL,CAAmBwR,iBAAnB,GAAuC,EAAvC,GAA4C;IAHf,CAAlC,CAAP;EAKH,CAND;;EAOA1R,KAAK,CAACkG,SAAN,CAAgBsJ,gBAAhB,GAAmC,UAAUqC,QAAV,EAAoB;IACnD,IAAI,KAAK3R,aAAL,CAAmB+K,gBAAvB,EAAyC;MACrC,IAAI6G,OAAO,GAAG,GAAGnO,KAAH,CAASC,IAAT,CAAc,KAAK3D,MAAL,CAAYmF,cAAZ,GAA6BvB,sBAA7B,CAAoD,iBAApD,CAAd,CAAd;;MACA,KAAK,IAAI8E,CAAC,GAAG,CAAR,EAAWyG,GAAG,GAAG0C,OAAO,CAACpN,MAA9B,EAAsCiE,CAAC,GAAGyG,GAA1C,EAA+CzG,CAAC,EAAhD,EAAoD;QAChD,IAAI,EAAGmJ,OAAO,CAACnJ,CAAD,CAAP,CAAW3J,SAAX,CAAqBuC,QAArB,CAA8B,aAA9B,CAAD,IAAmDuQ,OAAO,CAACnJ,CAAD,CAAP,CAAW3J,SAAX,CAAqBuC,QAArB,CAA8B,oBAA9B,CAArD,CAAJ,EAAgH;UAC5G,IAAIE,MAAM,GAAG,KAAKxB,MAAL,CAAYmD,cAAZ,CAA2B0O,OAAO,CAACnJ,CAAD,CAAP,CAAW/G,YAAX,CAAwB,cAAxB,CAA3B,CAAb;;UACA,IAAI,CAAC,KAAK3B,MAAL,CAAY8R,cAAb,IAAgC,KAAK9R,MAAL,CAAY8R,cAAZ,IAA8B,CAACtQ,MAAM,CAACsQ,cAA1E,EAA2F;YACvF,IAAID,OAAO,CAACnJ,CAAD,CAAP,CAAW9E,sBAAX,CAAkC,gBAAlC,EAAoDa,MAAxD,EAAgE;cAC5D3F,MAAM,CAAC+S,OAAO,CAACnJ,CAAD,CAAP,CAAW4B,gBAAX,CAA4B,iBAA5B,EAA+C,CAA/C,CAAD,CAAN;YACH;;YACD,IAAI,CAACsH,QAAL,EAAe;cACXC,OAAO,CAACnJ,CAAD,CAAP,CAAWtG,WAAX,CAAuB,KAAKpC,MAAL,CAAYpB,aAAZ,CAA0B,MAA1B,EAAkC;gBACrDgC,SAAS,EAAE,6BACN,KAAKX,aAAL,CAAmBmD,OAAnB,CAA2BC,OAA3B,CAAmC7B,MAAM,CAAC0B,KAA1C,IAAmD,CAAC,CAApD,GAAwD,gCAAxD,GACK,4BAFC,CAD0C;gBAGZpC,KAAK,EAAE;kBAAEwQ,QAAQ,EAAE,IAAZ;kBAAkB,cAAc;gBAAhC;cAHK,CAAlC,CAAvB;YAKH;UACJ;QACJ;MACJ;IACJ;EACJ,CArBD;;EAsBAvR,KAAK,CAACkG,SAAN,CAAgBpB,sBAAhB,GAAyC,UAAU3B,KAAV,EAAiB;IACtD,IAAI,CAAChE,iBAAiB,CAAC,KAAK6S,cAAL,CAAoB7O,KAApB,CAAD,CAAtB,EAAoD;MAChD,IAAIgH,IAAI,GAAG,KAAK6H,cAAL,CAAoB7O,KAApB,CAAX;;MACA,IAAI,KAAKjD,aAAL,CAAmBsB,eAAvB,EAAwC;QACpC,IAAIyQ,QAAQ,GAAG5S,YAAY,CAAC8K,IAAD,EAAO,kBAAP,CAA3B;QACApL,MAAM,CAACkT,QAAD,CAAN;MACH,CAHD,MAIK;QACDlT,MAAM,CAACoL,IAAD,CAAN;MACH;;MACD,KAAKuF,mBAAL;IACH;;IACD,KAAKhP,gBAAL,GAAwB,KAAxB;EACH,CAbD;;EAcAV,KAAK,CAACkG,SAAN,CAAgBgB,iBAAhB,GAAoC,UAAUhG,CAAV,EAAa;IAC7C,IAAIA,CAAC,CAACgR,MAAF,KAAa,KAAKzM,aAAL,EAAjB,EAAuC;MACnC;IACH;;IACD,KAAK,IAAI6C,EAAE,GAAG,CAAT,EAAYC,EAAE,GAAG4J,MAAM,CAACC,IAAP,CAAYlR,CAAC,CAACmR,UAAd,CAAtB,EAAiD/J,EAAE,GAAGC,EAAE,CAAC7D,MAAzD,EAAiE4D,EAAE,EAAnE,EAAuE;MACnE,IAAIgK,IAAI,GAAG/J,EAAE,CAACD,EAAD,CAAb;;MACA,QAAQgK,IAAR;QACI,KAAK,SAAL;UACI;UACA,IAAI9D,IAAI,GAAG,KAAK,CAAhB;;UACA,IAAI,KAAK3I,cAAT,EAAyB;YACrB,IAAI,CAAC,KAAKnF,gBAAV,EAA4B;cACxB,IAAI,CAAC,KAAKD,cAAV,EAA0B;gBACtB,KAAKiP,mBAAL,CAAyB,IAAzB;;gBACA,KAAK,IAAI6C,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKtS,MAAL,CAAY2Q,YAAZ,CAAyBvN,OAAzB,CAAiCqB,MAArD,EAA6D6N,CAAC,EAA9D,EAAkE;kBAC9D,IAAI,KAAKtS,MAAL,CAAY2Q,YAAZ,CAAyBvN,OAAzB,CAAiCkP,CAAjC,EAAoCtB,WAAxC,EAAqD;oBACjD,KAAKhR,MAAL,CAAY2Q,YAAZ,CAAyBvN,OAAzB,CAAiCiB,MAAjC,CAAwCiO,CAAxC,EAA2C,CAA3C;oBACAA,CAAC;kBACJ;gBACJ;;gBACD,KAAK,IAAI5J,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKzI,aAAL,CAAmBmD,OAAnB,CAA2BqB,MAA/C,EAAuDiE,CAAC,EAAxD,EAA4D;kBACxD,KAAK8H,OAAL,GAAe,KAAKvQ,aAAL,CAAmBmD,OAAnB,CAA2BsF,CAA3B,CAAf;kBACA,IAAIH,GAAG,GAAG,KAAKvI,MAAL,CAAYyB,gBAAZ,CAA6B,KAAK+O,OAAlC,CAAV;kBACAjI,GAAG,CAAC0E,OAAJ,GAAc,KAAKjN,MAAL,CAAYC,aAAZ,CAA0BsQ,iBAAxC;kBACA,KAAKM,oBAAL,CAA0B,KAAKL,OAA/B;;kBACA,IAAI9H,CAAC,GAAG,KAAKzI,aAAL,CAAmBmD,OAAnB,CAA2BqB,MAA3B,GAAoC,CAA5C,EAA+C;oBAC3C,KAAKE,iBAAL,CAAuB,KAAK1E,aAAL,CAAmBmD,OAAnB,CAA2BsF,CAA3B,CAAvB;kBACH;gBACJ;cACJ;;cACD6F,IAAI,GAAG;gBACH9I,UAAU,EAAE,KAAK+K,OADd;gBACuBhC,WAAW,EAAEvN,CAAC,CAACmR,UAAF,CAAaC,IAAb,EAAmB5N,MAAnB,GAA4B,UAA5B,GAAyC,YAD7E;gBAEHqG,IAAI,EAAEpL,MAAM,CAAC6S;cAFV,CAAP;YAIH,CAvBD,MAwBK;cACDhE,IAAI,GAAG;gBAAE9I,UAAU,EAAE,KAAK+K,OAAnB;gBAA4BhC,WAAW,EAAE,YAAzC;gBAAuD1D,IAAI,EAAEpL,MAAM,CAAC6S;cAApE,CAAP;YACH;;YACD,IAAI,CAAC,KAAKtS,aAAL,CAAmBsQ,iBAAxB,EAA2C;cACvC,IAAInN,OAAO,GAAGnC,CAAC,CAACuR,aAAF,CAAgBH,IAAhB,CAAd;;cACA,KAAK,IAAI3J,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGtF,OAAO,CAACqB,MAA5B,EAAoCiE,CAAC,EAArC,EAAyC;gBACrC,IAAIzH,CAAC,CAACmR,UAAF,CAAaC,IAAb,EAAmBhP,OAAnB,CAA2BD,OAAO,CAACsF,CAAD,CAAlC,MAA2C,CAAC,CAAhD,EAAmD;kBAC/C,KAAK1I,MAAL,CAAYyB,gBAAZ,CAA6B2B,OAAO,CAACsF,CAAD,CAApC,EAAyCuE,OAAzC,GAAmD,IAAnD;gBACH;cACJ;YACJ;;YACD,KAAKjN,MAAL,CAAY2N,MAAZ,CAAmBjO,MAAM,CAAC+S,YAA1B,EAAwClE,IAAxC;UACH;;UACD;;QACJ,KAAK,cAAL;UACI,KAAKkB,mBAAL;;UACA,IAAI,KAAKxP,aAAL,CAAmB2P,YAAvB,EAAqC;YACjC,KAAKvO,OAAL,CAAaQ,KAAb,CAAmBqL,OAAnB,GAA6B,EAA7B;YACA,KAAKlN,MAAL,CAAY0S,YAAZ,CAAyBC,SAAzB;UACH,CAHD,MAIK;YACD,KAAKtR,OAAL,CAAaQ,KAAb,CAAmBqL,OAAnB,GAA6B,MAA7B;UACH;;UACD;;QACJ,KAAK,mBAAL;UACI,KAAK0F,mBAAL,CAAyB,KAAK3S,aAAL,CAAmBsQ,iBAA5C;UACA,KAAKvQ,MAAL,CAAY2N,MAAZ,CAAmBjO,MAAM,CAAC+S,YAA1B,EAAwC;YAAEjE,WAAW,EAAE;UAAf,CAAxC;UACA;;QACJ,KAAK,mBAAL;UACI,KAAKqE,sBAAL,CAA4B,KAAK5S,aAAL,CAAmBwR,iBAA/C,EAAkE,iBAAlE;UACA;;QACJ,KAAK,kBAAL;UACI,KAAKoB,sBAAL,CAA4B,KAAK5S,aAAL,CAAmB+K,gBAA/C,EAAiE,sBAAjE;UACA,KAAKhL,MAAL,CAAY8S,aAAZ;UACA;;QACJ,KAAK,mBAAL;UACI,KAAK9S,MAAL,CAAY+S,aAAZ;UACA;MAlER;IAoEH;EACJ,CA3ED;;EA4EAhT,KAAK,CAACkG,SAAN,CAAgB2M,mBAAhB,GAAsC,UAAUI,SAAV,EAAqB;IACvD,KAAK,IAAItK,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKzI,aAAL,CAAmBmD,OAAnB,CAA2BqB,MAA/C,EAAuDiE,CAAC,EAAxD,EAA4D;MACxD,KAAK1I,MAAL,CAAYyB,gBAAZ,CAA6B,KAAKxB,aAAL,CAAmBmD,OAAnB,CAA2BsF,CAA3B,CAA7B,EAA4DuE,OAA5D,GAAsE+F,SAAtE;IACH;EACJ,CAJD;;EAKAjT,KAAK,CAACkG,SAAN,CAAgB4M,sBAAhB,GAAyC,UAAUG,SAAV,EAAqBpS,SAArB,EAAgC;IACrE,IAAIqK,OAAO,GAAG,GAAGvH,KAAH,CAASC,IAAT,CAAc,KAAKtC,OAAL,CAAauC,sBAAb,CAAoChD,SAApC,CAAd,CAAd;;IACA,KAAK,IAAI8H,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGuC,OAAO,CAACxG,MAA5B,EAAoCiE,CAAC,EAArC,EAAyC;MACrCuC,OAAO,CAACvC,CAAD,CAAP,CAAW7G,KAAX,CAAiBqL,OAAjB,GAA2B8F,SAAS,GAAG,EAAH,GAAQ,MAA5C;IACH;EACJ,CALD;;EAMAjT,KAAK,CAACkG,SAAN,CAAgBW,iBAAhB,GAAoC,UAAU3F,CAAV,EAAa;IAC7C,IAAIA,CAAC,CAACgR,MAAF,KAAa,KAAKzM,aAAL,EAAb,IAAqCvE,CAAC,CAACgS,MAA3C,EAAmD;MAC/C,KAAKpL,MAAL;IACH;EACJ,CAJD;EAKA;AACJ;AACA;AACA;AACA;AACA;;;EACI9H,KAAK,CAACkG,SAAN,CAAgB+B,OAAhB,GAA0B,YAAY;IAClC,IAAIkL,WAAW,GAAG,KAAKlT,MAAL,CAAYqB,OAA9B;;IACA,IAAI,CAAC6R,WAAD,IAAiB,CAACA,WAAW,CAACxQ,aAAZ,CAA0B,MAAM5C,QAAQ,CAACqT,UAAzC,CAAD,IAAyD,CAACD,WAAW,CAACxQ,aAAZ,CAA0B,MAAM5C,QAAQ,CAACgD,WAAzC,CAA/E,EAAuI;MACnI;IACH,CAJiC,CAKlC;;;IACA,IAAI,CAAC,KAAK9C,MAAL,CAAYyG,WAAZ,IAA2B,CAAC,KAAKzG,MAAL,CAAYoF,aAAzC,KAA2D,CAAC,KAAKpF,MAAL,CAAYoT,UAA5E,EAAwF;MACpF,KAAKC,aAAL;IACH;;IACD,KAAK3I,WAAL;IACA,KAAKxC,mBAAL;IACA,KAAKqH,gBAAL,CAAsB,IAAtB;;IACA,IAAI,KAAKlO,OAAL,CAAaiS,UAAjB,EAA6B;MACzBxU,MAAM,CAAC,KAAKuC,OAAN,CAAN;IACH,CAdiC,CAelC;;EACH,CAhBD;EAiBA;AACJ;AACA;AACA;AACA;;;EACItB,KAAK,CAACkG,SAAN,CAAgBoN,aAAhB,GAAgC,YAAY;IACxC,IAAIvP,IAAI,GAAGC,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,SAAL,CAAe,KAAKhE,aAAL,CAAmBmD,OAAlC,CAAX,CAAX;IACA,KAAKwC,cAAL,GAAsB,KAAtB;;IACA,KAAK,IAAI8C,CAAC,GAAG,CAAR,EAAWyG,GAAG,GAAGrL,IAAI,CAACW,MAA3B,EAAmCiE,CAAC,GAAGyG,GAAvC,EAA4CzG,CAAC,EAA7C,EAAiD;MAC7C,IAAIA,CAAC,KAAMyG,GAAG,GAAG,CAAjB,EAAqB;QACjB,KAAKvJ,cAAL,GAAsB,IAAtB;MACH;;MACD,KAAKtC,aAAL,CAAmBQ,IAAI,CAAC4E,CAAD,CAAvB;IACH;;IACD,KAAK9C,cAAL,GAAsB,IAAtB;EACH,CAVD;EAWA;AACJ;AACA;AACA;AACA;AACA;;;EACI7F,KAAK,CAACkG,SAAN,CAAgBT,aAAhB,GAAgC,YAAY;IACxC,OAAO,OAAP;EACH,CAFD;;EAGAzF,KAAK,CAACkG,SAAN,CAAgBqB,gBAAhB,GAAmC,YAAY;IAC3C,IAAIpG,IAAI,GAAG,KAAKlB,MAAhB;IACA,IAAIuT,MAAJ;IACA,IAAIzP,IAAI,GAAG5C,IAAI,CAACyP,YAAL,CAAkBvN,OAA7B;IACA,IAAIoQ,KAAK,GAAGtS,IAAI,CAACjB,aAAL,CAAmBmD,OAA/B;IACA,IAAIqQ,UAAU,GAAG,KAAKzT,MAAL,CAAYoI,UAAZ,GAAyBvE,GAAzB,CAA6B,UAAUa,CAAV,EAAa;MAAE,OAAOA,CAAC,CAACxB,KAAT;IAAiB,CAA7D,CAAjB;IACA,KAAKqM,gBAAL;;IACA,KAAK,IAAI7G,CAAC,GAAG,CAAR,EAAWyG,GAAG,GAAGrL,IAAI,CAACW,MAA3B,EAAmCiE,CAAC,GAAGyG,GAAvC,EAA4CzG,CAAC,EAA7C,EAAiD;MAC7C,IAAI+K,UAAU,CAACpQ,OAAX,CAAmBS,IAAI,CAAC4E,CAAD,CAAJ,CAAQxF,KAA3B,MAAsC,CAAC,CAA3C,EAA8C;QAC1C;MACH;;MACDqQ,MAAM,GAAGrS,IAAI,CAACiK,sBAAL,CAA4BrH,IAAI,CAAC4E,CAAD,CAAJ,CAAQxF,KAApC,CAAT;;MACA,IAAI,CAAChC,IAAI,CAACgK,YAAN,KAAuB,KAAKhL,aAAL,CAAmBmD,OAAnB,CAA2BS,IAAI,CAAC4E,CAAD,CAAJ,CAAQxF,KAAnC,IAA4C,CAAC,CAA7C,IACvB,KAAKjD,aAAL,CAAmBmD,OAAnB,CAA2BC,OAA3B,CAAmCS,IAAI,CAAC4E,CAAD,CAAJ,CAAQxF,KAA3C,IAAoD,CAAC,CADrD,CAAJ,EAC6D;QACzDnE,SAAS,CAACwU,MAAM,CAAC7Q,aAAP,CAAqB,kBAArB,CAAD,EAA2C,CAAC,aAAD,EAAgB,kBAAhB,CAA3C,EAAgF,EAAhF,CAAT;;QACA,IAAIoB,IAAI,CAACW,MAAL,GAAc,CAAlB,EAAqB;UACjB8O,MAAM,CAAC7Q,aAAP,CAAqB,kBAArB,EAAyCN,WAAzC,CAAqD,KAAKpC,MAAL,CAAYpB,aAAZ,CAA0B,MAA1B,EAAkC;YAAEgC,SAAS,EAAE,cAAb;YAA6B4D,SAAS,EAAE,CAACkE,CAAC,GAAG,CAAL,EAAQiJ,QAAR;UAAxC,CAAlC,CAArD;QACH;MACJ,CAND,MAOK,IAAI,KAAKI,cAAL,CAAoBjO,IAAI,CAAC4E,CAAD,CAAJ,CAAQxF,KAA5B,KAAsC,KAAK6O,cAAL,CAAoBjO,IAAI,CAAC4E,CAAD,CAAJ,CAAQxF,KAA5B,EAAmCU,sBAAnC,CAA0D,aAA1D,EAAyEa,MAAnH,EAA2H;QAC5H,IAAIX,IAAI,CAAC4E,CAAD,CAAJ,CAAQqI,SAAR,KAAsB,WAA1B,EAAuC;UACnChS,SAAS,CAAC,KAAKgT,cAAL,CAAoBjO,IAAI,CAAC4E,CAAD,CAAJ,CAAQxF,KAA5B,EAAmCR,aAAnC,CAAiD,cAAjD,CAAD,EAAmE,CAAC,aAAD,EAAgB,kBAAhB,CAAnE,EAAwG,CAAC,cAAD,EAAiB,mBAAjB,CAAxG,CAAT;QACH,CAFD,MAGK;UACD3D,SAAS,CAAC,KAAKgT,cAAL,CAAoBjO,IAAI,CAAC4E,CAAD,CAAJ,CAAQxF,KAA5B,EAAmCR,aAAnC,CAAiD,cAAjD,CAAD,EAAmE,CAAC,cAAD,EAAiB,mBAAjB,CAAnE,EAA0G,CAAC,aAAD,EAAgB,kBAAhB,CAA1G,CAAT;QACH;MACJ;IACJ;;IACD,KAAK,IAAIgG,CAAC,GAAG,CAAR,EAAWyG,GAAG,GAAGqE,KAAK,CAAC/O,MAA5B,EAAoCiE,CAAC,GAAGyG,GAAxC,EAA6CzG,CAAC,EAA9C,EAAkD;MAC9C,IAAI+K,UAAU,CAACpQ,OAAX,CAAmBmQ,KAAK,CAAC9K,CAAD,CAAxB,MAAiC,CAAC,CAAtC,EAAyC;QACrC;MACH;;MACDxH,IAAI,CAACiK,sBAAL,CAA4BqI,KAAK,CAAC9K,CAAD,CAAjC,EAAsCxG,YAAtC,CAAmD,cAAnD,EAAmE,MAAnE;IACH;EACJ,CAlCD;;EAmCAnC,KAAK,CAACkG,SAAN,CAAgB8L,cAAhB,GAAiC,UAAU7O,KAAV,EAAiB;IAC9C,IAAI,KAAK7B,OAAL,IAAgB,KAAKA,OAAL,CAAaqB,aAAb,CAA2B,sBAAsBQ,KAAtB,GAA8B,IAAzD,CAApB,EAAoF;MAChF,OAAO,KAAK7B,OAAL,CAAaqB,aAAb,CAA2B,sBAAsBQ,KAAtB,GAA8B,IAAzD,EAA+D+G,aAAtE;IACH;;IACD,OAAO,IAAP;EACH,CALD;;EAMAlK,KAAK,CAACkG,SAAN,CAAgB8B,iBAAhB,GAAoC,UAAU2L,UAAV,EAAsB;IACtD,IAAIC,UAAU,GAAG,KAAKC,sBAAL,CAA4BF,UAA5B,CAAjB;IACA,IAAIG,OAAO,GAAG,KAAK7N,cAAL,CAAoB8N,YAApB,CAAiCH,UAAjC,EAA6C,EAA7C,CAAd;IACA,IAAII,WAAW,GAAG,KAAK/T,MAAL,CAAYsM,aAAZ,GAA4BoE,MAA5B,CAAmC,UAAUlH,GAAV,EAAe;MAAE,OAAO,CAACA,GAAG,CAAC4D,SAAZ;IAAwB,CAA5E,CAAlB;IACA,IAAI4G,iBAAiB,GAAGH,OAAO,CAACnD,MAAR,CAAe,UAAUuD,IAAV,EAAgB;MAAE,OAAO,CAACA,IAAI,CAAC7G,SAAb;IAAyB,CAA1D,CAAxB;;IACA,IAAI,KAAKpN,MAAL,CAAYkU,OAAZ,IAAuB,KAAKlU,MAAL,CAAYmU,KAAvC,EAA8C;MAC1C,KAAKnU,MAAL,CAAYoU,eAAZ,CAA4B,CAAC,qBAAD,EAAwB,sBAAxB,EAAgD,gBAAhD,CAA5B;IACH;;IACD,KAAK,IAAI1L,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGsL,iBAAiB,CAACvP,MAAtC,EAA8CiE,CAAC,EAA/C,EAAmD;MAC/C,IAAIc,GAAG,GAAGwK,iBAAiB,CAACtL,CAAD,CAA3B;MACA,IAAI6E,KAAK,GAAG/D,GAAG,CAAC+D,KAAJ,CAAUmD,MAAV,CAAiB,UAAUjD,IAAV,EAAgB;QAAE,OAAOA,IAAI,CAACC,UAAZ;MAAyB,CAA5D,CAAZ;MACA,IAAIa,IAAI,GAAG;QAAEhB,KAAK,EAAEA,KAAT;QAAgB0G,IAAI,EAAEzK,GAAG,CAACyK,IAA1B;QAAgCI,OAAO,EAAEN,WAAW,CAACrL,CAAD,CAAX,GAAiBqL,WAAW,CAACrL,CAAD,CAAX,CAAevG,GAAhC,GAAsC;MAA/E,CAAX;MACA,KAAKnC,MAAL,CAAY2N,MAAZ,CAAmBjO,MAAM,CAAC4U,oBAA1B,EAAgD/F,IAAhD;IACH;EACJ,CAdD;;EAeAxO,KAAK,CAACkG,SAAN,CAAgB2N,sBAAhB,GAAyC,UAAUF,UAAV,EAAsB;IAC3D,IAAIa,WAAW,GAAGb,UAAU,YAAY7G,KAAtB,GAA8B6G,UAA9B,GAA2C,EAA7D;IACA,IAAI1K,IAAI,GAAG,KAAKhJ,MAAL,CAAYsM,aAAZ,EAAX;IACA,IAAIkI,QAAQ,GAAG,KAAKxU,MAAL,CAAYyU,qBAAZ,EAAf;IACA,IAAIC,WAAW,GAAG,EAAlB;IACA,IAAIC,QAAQ,GAAG3L,IAAI,CAACnF,GAAL,CAAS,UAAU2F,GAAV,EAAe;MACnC,IAAIA,GAAG,CAACoL,IAAJ,KAAa,QAAjB,EAA2B;QACvBF,WAAW,CAACnQ,IAAZ,CAAiBiF,GAAG,CAACyK,IAArB;MACH;;MACD,OAAOzK,GAAG,CAACqL,OAAJ,YAAuB3C,MAAvB,GAAgC1I,GAAG,CAACqL,OAApC,GAA8CrL,GAAG,CAACyK,IAAzD;IACH,CALc,CAAf;IAMA,IAAI/Q,KAAK,GAAG,KAAKlD,MAAL,CAAY8U,uBAAZ,GAAsC,CAAtC,CAAZ;IACAH,QAAQ,GAAGJ,WAAW,CAAC9P,MAAZ,KAAuB,CAAvB,GAA2BkQ,QAA3B,GAAsCJ,WAAjD;IACA,IAAIQ,SAAS,GAAGP,QAAQ,CAAC3Q,GAAT,CAAa,UAAUmR,IAAV,EAAgB;MACzC,IAAIC,OAAO,GAAGpV,QAAQ,CAACqV,SAAT,CAAmBhS,KAAnB,EAA0B8R,IAA1B,CAAd;MACA,IAAIG,KAAJ;MACA,IAAIC,MAAM,GAAGT,QAAQ,CAACnH,IAAT,CAAc,UAAU6H,KAAV,EAAiB;QACxCF,KAAK,GAAGE,KAAR;QACA,OAAOJ,OAAO,KAAKpV,QAAQ,CAACqV,SAAT,CAAmBhS,KAAnB,EAA0BmS,KAA1B,CAAnB;MACH,CAHY,CAAb;MAIA,OAAOD,MAAM,GAAGD,KAAH,GAAWH,IAAxB;IACH,CARe,CAAhB;IASA,IAAIM,KAAK,GAAG5B,UAAZ;;IACA,IAAI,EAAE4B,KAAK,CAACxK,IAAN,IAAcwK,KAAK,CAACxK,IAAN,KAAe,QAA/B,KAA4C4J,WAAW,CAACjQ,MAAZ,GAAqB,CAArE,EAAwE;MACpE,KAAK,IAAIiE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGgM,WAAW,CAACjQ,MAAhC,EAAwCiE,CAAC,EAAzC,EAA6C;QACzC,IAAIE,KAAK,GAAGmM,SAAS,CAAC1R,OAAV,CAAkBqR,WAAW,CAAChM,CAAD,CAA7B,CAAZ;QACAqM,SAAS,CAAC1Q,MAAV,CAAiBuE,KAAjB,EAAwB,CAAxB;MACH;IACJ;;IACD,IAAI+K,UAAU,GAAG,EAAjB;IACA,IAAI4B,aAAa,GAAG,KAAKvV,MAAL,CAAY2T,UAAhC;;IACA,KAAK,IAAIrB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGiD,aAAa,CAAC9Q,MAAlC,EAA0C6N,CAAC,EAA3C,EAA+C;MAC3C,IAAI9I,GAAG,GAAG+L,aAAa,CAACjD,CAAD,CAAvB;;MACA,KAAK,IAAIkD,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGhM,GAAG,CAACpG,OAAJ,CAAYqB,MAAhC,EAAwC+Q,CAAC,EAAzC,EAA6C;QACzC,IAAIC,IAAI,GAAG,EAAX;QACA,IAAI3K,IAAI,GAAGtB,GAAG,CAACpG,OAAJ,CAAYoS,CAAZ,EAAe1K,IAAf,CAAoB6G,QAApB,EAAX;QACA8D,IAAI,GAAG;UAAE3K,IAAI,EAAEA,IAAI,CAACyG,WAAL,EAAR;UAA4BrO,KAAK,EAAEsG,GAAG,CAACpG,OAAJ,CAAYoS,CAAZ,EAAetS;QAAlD,CAAP;QACAyQ,UAAU,CAACpP,IAAX,CAAgBkR,IAAhB;MACH;IACJ;;IACD,IAAIC,MAAJ;IACA,IAAIC,MAAJ;IACA,IAAIC,WAAW,GAAG,KAAK5V,MAAL,CAAYC,aAAZ,CAA0BmD,OAA5C;;IACA,KAAK,IAAIyS,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,WAAW,CAACnR,MAAhC,EAAwCoR,CAAC,EAAzC,EAA6C;MACzCF,MAAM,GAAGD,MAAM,GAAGA,MAAH,GAAYX,SAA3B;MACAW,MAAM,GAAG7V,QAAQ,CAACiW,KAAT,CAAeH,MAAf,EAAuBC,WAAW,CAACC,CAAD,CAAlC,EAAuClC,UAAvC,EAAmD,IAAnD,EAAyD,IAAzD,CAAT;IACH;;IACD,OAAO+B,MAAP;EACH,CAhDD;;EAiDA3V,KAAK,CAACkG,SAAN,CAAgBgC,YAAhB,GAA+B,UAAUsG,IAAV,EAAgB;IAC3C,IAAIpM,GAAG,GAAGoM,IAAI,CAACpM,GAAf;IACA,IAAI2J,QAAQ,GAAGyC,IAAI,CAACzC,QAApB;IACA,IAAI9C,IAAI,GAAG,KAAKhJ,MAAL,CAAYsM,aAAZ,EAAX;;IACA,KAAK,IAAI5D,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGM,IAAI,CAACvE,MAAzB,EAAiCiE,CAAC,EAAlC,EAAsC;MAClC,IAAIc,GAAG,GAAGR,IAAI,CAACN,CAAD,CAAd;;MACA,IAAIc,GAAG,CAACrH,GAAJ,KAAYA,GAAZ,IAAmBjD,iBAAiB,CAACiD,GAAD,CAAxC,EAA+C;QAC3CqH,GAAG,CAACsC,QAAJ,GAAeA,QAAf;;QACA,IAAIiK,OAAO,GAAG,UAAUzD,CAAV,EAAa;UACvB,IAAI0D,QAAQ,GAAGhN,IAAI,CAACsJ,CAAD,CAAnB;UACA,IAAI2D,aAAa,GAAG,KAAK,CAAzB;;UACA,IAAID,QAAQ,CAAC7I,SAAT,KAAuB3D,GAAG,CAACrH,GAA/B,EAAoC;YAChC8T,aAAa,GAAGjN,IAAI,CAAC0H,MAAL,CAAY,UAAUwF,CAAV,EAAa;cAAE,OAAOA,CAAC,CAAC/T,GAAF,KAAU6T,QAAQ,CAAC7I,SAA1B;YAAsC,CAAjE,EAAmE,CAAnE,CAAhB;UACH;;UACD,IAAI6I,QAAQ,CAAC7I,SAAT,KAAuB3D,GAAG,CAACrH,GAA/B,EAAoC;YAChC6T,QAAQ,CAAC/I,OAAT,GAAmBzD,GAAG,CAACsC,QAAvB;UACH,CAFD,MAGK,IAAI,CAAC5M,iBAAiB,CAAC+W,aAAD,CAAlB,IAAqCD,QAAQ,CAAC7I,SAAT,KAAuB8I,aAAa,CAAC9T,GAA9E,EAAmF;YACpF,IAAI8T,aAAa,CAACnK,QAAd,IAA0BmK,aAAa,CAAChJ,OAAd,KAA0B,IAAxD,EAA8D;cAC1D+I,QAAQ,CAAC/I,OAAT,GAAmB,IAAnB;YACH,CAFD,MAGK,IAAIgJ,aAAa,CAACnK,QAAd,IAA0BmK,aAAa,CAAChJ,OAAd,KAA0B,KAAxD,EAA+D;cAChE+I,QAAQ,CAAC/I,OAAT,GAAmB,KAAnB;YACH;UACJ;;UACD,IAAI/N,iBAAiB,CAACiD,GAAD,CAArB,EAA4B;YACxB,OAAO,OAAP;UACH;QACJ,CApBD;;QAqBA,KAAK,IAAImQ,CAAC,GAAG5J,CAAC,GAAG,CAAjB,EAAoB4J,CAAC,GAAGtJ,IAAI,CAACvE,MAA7B,EAAqC6N,CAAC,EAAtC,EAA0C;UACtC,IAAI6D,OAAO,GAAGJ,OAAO,CAACzD,CAAD,CAArB;;UACA,IAAI6D,OAAO,KAAK,OAAhB,EACI;QACP;MACJ;IACJ;;IACD,KAAKnW,MAAL,CAAY2N,MAAZ,CAAmBjO,MAAM,CAACgI,YAA1B,EAAwC;MAAEsB,IAAI,EAAEA,IAAR;MAAcuF,IAAI,EAAE;QAAE6H,QAAQ,EAAE,KAAZ;QAAmBpN,IAAI,EAAEA;MAAzB;IAApB,CAAxC;EACH,CArCD;;EAsCA,OAAOjJ,KAAP;AACH,CAprC0B,EAA3B;;AAqrCA,SAASA,KAAT"},"metadata":{},"sourceType":"module"}